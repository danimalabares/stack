\input{preamble}

\begin{document}

\title{Algebra}
\maketitle

\phantomsection
\label{section-phantom}
\hfill
\href{http://github.com/danimalabares/stack}{github.com/danimalabares/stack}

\tableofcontents

\section{Modules}
\label{section-modules}

It looks like most books (at least
\cite{eis} and \cite{Samuel-Zariski-Vol1})
define a module to be an abelian group
along with a certain operation with
elements of the ring.

Which secretly just says that

\begin{definition}
\label{definition-module}
Let $R$ be a ring.
An {\it (left) $R$-module} $M$ is an abelian group
such that there exists a (left) ring morphism
$$
R \to \text{End}(M).
$$
\end{definition}

\noindent
Indeed, the three usual requirements
correspond to:

\begin{enumerate}
\item The endomorphism corresponding to $a \in R$ 
respect the group structure of the group $M$:
$$
a(x+y)=ax+ay,
$$

\item The representation map is a map of rings
$$
(a+b)x=ax+by,\qquad (ab)x=a(bx).
$$
\end{enumerate}

\noindent


\section{Algebras}
\label{section-algebras}

\noindent
There appears to be no definition of ``algebra''
in Stacks Project.
But there is one in \cite{Eisenbud}:

\begin{definition}
\label{definition-algebra}
If $R$ is a commutative ring,
then a {\it commutative algebra} over $R$ 
is a commutative ring $S$ together
with a ring morphism $R \to S$.
\end{definition}

\noindent
But actually I was expecting that 
$S$ would be defined as 
a ring that is also an $R$-module.
So let us note that a morphism of rings
$R \to S$ gives a representation
$R \to \text{End}(S)$ via left multiplication.
But the other way around,
given an endomorphism associated
to some element in $R$,
how do we assign an element of $S$
so as to produce a map $R \to S$?

\section{Finitely-generated and finitely presented algebras}
\label{section-finitely-presented-generated}

\noindent
See Stacks Project tag \href{https://stacks.math.columbia.edu/tag/00F2}{00F2}.

Upshot: a finitely-generated $R$-algebra $S$ is such that
$S \simeq R[x_1,\ldots,x_n]/I$ for some ideal $I \subset R$.
Finitely-presentedness is when $I = (s_1,\ldots,s_k)$.

Fun fact: The second item in the following definition
is the algebraic counterpart to an
affine algebraic set (variety);
i.e. the reason why we hear that
``affine varieties are in correspondence
with finitely presented $k$-algebras''
(wasn't there a notion of reduced algebra in that phraseâ€¦?)
And the difference with that and finite type,
I think,
is that the kernel is finitely generated.

\begin{definition}
\label{definition-finite-type}
Let $R \to S$ be a ring map.
\begin{enumerate}
\item We say $R \to S$ is of {\it finite type}, or that {\it $S$ is a finite
type $R$-algebra} if there exist an $n \in \mathbf{N}$ and an surjection
of $R$-algebras $R[x_1, \ldots, x_n] \to S$.
\item We say $R \to S$ is of {\it finite presentation} if there
exist integers $n, m \in \mathbf{N}$ and polynomials
$f_1, \ldots, f_m \in R[x_1, \ldots, x_n]$
and an isomorphism of $R$-algebras
$R[x_1, \ldots, x_n]/(f_1, \ldots, f_m) \cong S$.
\end{enumerate}
\end{definition}

Informally, $M$ is a finitely presented $R$-module if and only if
it is finitely generated and the module of relations among these
generators is finitely generated as well.
A choice of an exact sequence as in the definition is called a
{\it presentation} of $M$.

So, probably an ``algebra'' $A$ over a ring  $R$ is when $A$ contains 
(or, is isomorphic to?)  $R[X]$ for some possibly very arbitrary set
 $X\subset R$.


\section{Finite and integral ring extensions}
\label{section-finite-ring-extensions}

Trivial lemmas concerning finite and integral ring maps.
We recall the definition.

\begin{definition}
\label{definition-integral-ring-map}
Let $\varphi : R \to S$ be a ring map.
\begin{enumerate}
\item An element $s \in S$
is {\it integral over $R$} if there exists a monic
polynomial $P(x) \in R[x]$ such that
$P^\varphi(s) = 0$, where $P^\varphi(x) \in S[x]$
is the image of $P$ under $\varphi : R[x] \to S[x]$.
\item  The ring map $\varphi$ is {\it integral}
if every $s \in S$ is integral over $R$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-characterize-integral-element}
Let $\varphi : R \to S$ be a ring map. Let $y \in S$. If there exists a
finite $R$-submodule $M$ of $S$ such that $1 \in M$ and $yM \subset M$,
then $y$ is integral over $R$.
\end{lemma}

\begin{proof}
Consider the map $\varphi : M \to M$, $x \mapsto y \cdot x$.
By Lemma \ref{lemma-charpoly-module} there exists a monic polynomial
$P \in R[T]$ with $P(\varphi) = 0$. In the ring $S$ we get
$P(y) = P(y) \cdot 1 = P(\varphi)(1) = 0$.
\end{proof}

\begin{lemma}
\label{lemma-finite-is-integral}
A finite ring map is integral.
\end{lemma}

\begin{proof}
Let $R \to S$ be finite. Let $y \in S$. Apply
Lemma \ref{lemma-characterize-integral-element}
to $M = S$ to see that $y$ is integral over $R$.
\end{proof}

\begin{lemma}
\label{lemma-characterize-integral}
Let $\varphi : R \to S$ be a ring map. Let $s_1, \ldots, s_n$
be a finite set of elements of $S$.
In this case $s_i$ is integral over $R$ for all $i = 1, \ldots, n$
if and only if
there exists an $R$-subalgebra $S' \subset S$ finite over $R$
containing all of the $s_i$.
\end{lemma}

\begin{proof}
If each $s_i$ is integral, then the subalgebra
generated by $\varphi(R)$ and the $s_i$ is finite
over $R$. Namely, if $s_i$ satisfies a monic equation
of degree $d_i$ over $R$, then this subalgebra is generated as an
$R$-module by the elements $s_1^{e_1} \ldots s_n^{e_n}$
with $0 \leq e_i \leq d_i - 1$.
Conversely, suppose given a finite $R$-subalgebra
$S'$ containing all the $s_i$. Then all of the
$s_i$ are integral by Lemma \ref{lemma-finite-is-integral}.
\end{proof}

\begin{lemma}
\label{lemma-characterize-finite-in-terms-of-integral}
Let $R \to S$ be a ring map. The following are equivalent
\begin{enumerate}
\item $R \to S$ is finite,
\item $R \to S$ is integral and of finite type, and
\item there exist $x_1, \ldots, x_n \in S$ which generate $S$ as an
algebra over $R$ such that each $x_i$ is integral over $R$.
\end{enumerate}
\end{lemma}

\begin{proof}
Clear from Lemma \ref{lemma-characterize-integral}.
\end{proof}

\begin{lemma}
\label{lemma-integral-transitive}
\begin{slogan}
A composition of integral ring maps is integral
\end{slogan}
Suppose that $R \to S$ and $S \to T$ are integral
ring maps. Then $R \to T$ is integral.
\end{lemma}

\begin{proof}
Let $t \in T$. Let $P(x) \in S[x]$ be a
monic polynomial such that $P(t) = 0$.
Apply Lemma \ref{lemma-characterize-integral}
to the finite set of coefficients of $P$.
Hence $t$ is integral over some subalgebra
$S' \subset S$ finite over $R$. Apply Lemma
\ref{lemma-characterize-integral} again to find
a subalgebra $T' \subset T$ finite over $S'$ and
containing $t$. Lemma \ref{lemma-finite-transitive}
applied to $R \to S' \to T'$ shows that $T'$ is finite
over $R$. The integrality of $t$ over $R$
now follows from Lemma \ref{lemma-finite-is-integral}.
\end{proof}

\begin{lemma}
\label{lemma-integral-closure-is-ring}
Let $R \to S$ be a ring homomorphism.
The set
$$
S' = \{s \in S \mid s\text{ is integral over }R\}
$$
is an $R$-subalgebra of $S$.
\end{lemma}

\begin{proof}
This is clear from Lemmas \ref{lemma-characterize-integral}
and \ref{lemma-finite-is-integral}.
\end{proof}

\begin{lemma}
\label{lemma-finite-product-integral}
Let $R_i\to S_i$ be ring maps $i = 1, \ldots, n$.
Let $R$ and $S$ denote the product of the $R_i$ and $S_i$ respectively.
Then an element $s = (s_1, \ldots, s_n) \in S$ is integral over $R$
if and only if each $s_i$ is integral over $R_i$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-integral-closure}
Let $R \to S$ be a ring map.
The ring $S' \subset S$ of elements integral over
$R$, see Lemma \ref{lemma-integral-closure-is-ring},
is called the {\it integral closure} of $R$
in $S$. If $R \subset S$ we say that $R$ is
{\it integrally closed} in $S$ if $R = S'$.
\end{definition}

\noindent
In particular, we see that $R \to S$ is integral if and only
if the integral closure of $R$ in $S$ is all of $S$.

\begin{lemma}
\label{lemma-finite-product-integral-closure}
Let $R_i\to S_i$ be ring maps $i = 1, \ldots, n$.
Denote the integral closure of $R_i$ in $S_i$ by $S'_i$.
Further let $R$ and $S$ denote the product of the $R_i$ and $S_i$ respectively.
Then the integral closure of $R$ in $S$
is the product of the $S'_i$. In particular $R \to S$ is
integrally closed if and only if each $R_i \to S_i$ is integrally closed.
\end{lemma}

\begin{proof}
This follows immediately from Lemma \ref{lemma-finite-product-integral}.
\end{proof}

\begin{lemma}
\label{lemma-integral-closure-localize}
Integral closure commutes with localization: If $A \to B$ is a ring
map, and $S \subset A$ is a multiplicative subset, then the integral
closure of $S^{-1}A$ in $S^{-1}B$ is $S^{-1}B'$, where $B' \subset B$
is the integral closure of $A$ in $B$.
\end{lemma}

\begin{proof}
Since localization is exact we see that $S^{-1}B' \subset S^{-1}B$.
Suppose $x \in B'$ and $f \in S$. Then
$x^d + \sum_{i = 1, \ldots, d} a_i x^{d - i} = 0$
in $B$ for some $a_i \in A$. Hence also
$$
(x/f)^d + \sum\nolimits_{i = 1, \ldots, d} a_i/f^i (x/f)^{d - i} = 0
$$
in $S^{-1}B$. In this way we see that $S^{-1}B'$ is contained in
the integral closure of $S^{-1}A$ in $S^{-1}B$. Conversely, suppose
that $x/f \in S^{-1}B$ is integral over $S^{-1}A$. Then we have
$$
(x/f)^d + \sum\nolimits_{i = 1, \ldots, d} (a_i/f_i) (x/f)^{d - i} = 0
$$
in $S^{-1}B$ for some $a_i \in A$ and $f_i \in S$. This means that
$$
(f'f_1 \ldots f_d x)^d +
\sum\nolimits_{i = 1, \ldots, d}
f^i(f')^if_1^i \ldots f_i^{i - 1} \ldots f_d^i a_i
(f'f_1 \ldots f_dx)^{d - i} = 0
$$
for a suitable $f' \in S$. Hence $f'f_1\ldots f_dx \in B'$ and thus
$x/f \in S^{-1}B'$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-integral-closure-stalks}
\begin{slogan}
An element of an algebra over a ring is integral over the ring
if and only if it is locally integral at every prime ideal of the ring.
\end{slogan}
Let $\varphi : R \to S$ be a ring map.
Let $x \in S$. The following are equivalent:
\begin{enumerate}
\item $x$ is integral over $R$, and
\item for every prime ideal $\mathfrak p \subset R$ the element
$x \in S_{\mathfrak p}$ is integral over $R_{\mathfrak p}$.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2). Assume (2). Consider the $R$-algebra
$S' \subset S$ generated by $\varphi(R)$ and $x$. Let $\mathfrak p$ be
a prime ideal of $R$. Then we know that
$x^d + \sum_{i = 1, \ldots, d} \varphi(a_i) x^{d - i} = 0$
in $S_{\mathfrak p}$ for some $a_i \in R_{\mathfrak p}$. Hence we see,
by looking at which denominators occur, that
for some $f \in R$, $f \not \in \mathfrak p$ we have
$a_i \in R_f$ and
$x^d + \sum_{i = 1, \ldots, d} \varphi(a_i) x^{d - i} = 0$
in $S_f$. This implies that $S'_f$ is finite over $R_f$.
Since $\mathfrak p$ was arbitrary and $\Spec(R)$ is quasi-compact
(Lemma \ref{lemma-quasi-compact}) we can find finitely many elements
$f_1, \ldots, f_n \in R$
which generate the unit ideal of $R$ such that $S'_{f_i}$ is finite
over $R_{f_i}$. Hence we conclude from Lemma \ref{lemma-cover} that
$S'$ is finite over $R$. Hence $x$ is integral over $R$ by
Lemma \ref{lemma-characterize-integral}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-integral}
\begin{slogan}
Integrality and finiteness are preserved under base change.
\end{slogan}
Let $R \to S$ and $R \to R'$ be ring maps.
Set $S' = R' \otimes_R S$.
\begin{enumerate}
\item If $R \to S$ is integral so is $R' \to S'$.
\item If $R \to S$ is finite so is $R' \to S'$.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove (1).
Let $s_i \in S$ be generators for $S$ over $R$.
Each of these satisfies a monic polynomial equation $P_i$
over $R$. Hence the elements $1 \otimes s_i \in S'$ generate
$S'$ over $R'$ and satisfy the corresponding polynomial
$P_i'$ over $R'$. Since these elements generate $S'$ over $R'$
we see that $S'$ is integral over $R'$.
Proof of (2) omitted.
\end{proof}

\begin{lemma}
\label{lemma-integral-local}
Let $R \to S$ be a ring map.
Let $f_1, \ldots, f_n \in R$ generate the unit ideal.
\begin{enumerate}
\item If each $R_{f_i} \to S_{f_i}$ is integral, so is $R \to S$.
\item If each $R_{f_i} \to S_{f_i}$ is finite, so is $R \to S$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1).
Let $s \in S$. Consider the ideal $I \subset R[x]$ of
polynomials $P$ such that $P(s) = 0$. Let $J \subset R$
denote the ideal (!) of leading coefficients of elements of $I$.
By assumption and clearing denominators
we see that $f_i^{n_i} \in J$ for all $i$
and certain $n_i \geq 0$. Hence $J$ contains $1$ and we see
$s$ is integral over $R$. Proof of (2) omitted.
\end{proof}

\begin{lemma}
\label{lemma-integral-permanence}
Let $A \to B \to C$ be ring maps.
\begin{enumerate}
\item If $A \to C$ is integral so is $B \to C$.
\item If $A \to C$ is finite so is $B \to C$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-integral-closure-transitive}
Let $A \to B \to C$ be ring maps.
Let $B'$ be the integral closure of $A$ in $B$,
let $C'$ be the integral closure of $B'$ in $C$. Then
$C'$ is the integral closure of $A$ in $C$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-integral-overring-surjective}
Suppose that $R \to S$ is an integral
ring extension with $R \subset S$.
Then $\varphi : \Spec(S) \to \Spec(R)$
is surjective.
\end{lemma}

\begin{proof}
Let $\mathfrak p \subset R$ be a prime ideal.
We have to show $\mathfrak pS_{\mathfrak p} \not = S_{\mathfrak p}$, see
Lemma \ref{lemma-in-image}.
The localization $R_{\mathfrak p} \to S_{\mathfrak p}$ is injective
(as localization is exact) and integral by
Lemma \ref{lemma-integral-closure-localize} or
\ref{lemma-base-change-integral}.
Hence we may replace $R$, $S$ by $R_{\mathfrak p}$, $S_{\mathfrak p}$ and
we may assume $R$ is local with maximal ideal $\mathfrak m$ and
it suffices to show that $\mathfrak mS \not = S$.
Suppose $1 = \sum f_i s_i$ with $f_i \in \mathfrak m$
and $s_i \in S$ in order to get a contradiction.
Let $R \subset S' \subset S$
be such that $R \to S'$ is finite and $s_i \in S'$, see
Lemma \ref{lemma-characterize-integral}.
The equation $1 = \sum f_i s_i$ implies that
the finite $R$-module $S'$ satisfies $S' = \mathfrak m S'$. Hence by
Nakayama's Lemma \ref{lemma-NAK}
we see $S' = 0$. Contradiction.
\end{proof}

\begin{lemma}
\label{lemma-integral-under-field}
Let $R$ be a ring. Let $K$ be a field.
If $R \subset K$ and $K$ is integral over $R$,
then $R$ is a field and $K$ is an algebraic extension.
If $R \subset K$ and $K$ is finite over $R$,
then $R$ is a field and $K$ is a finite algebraic extension.
\end{lemma}

\begin{proof}
Assume that $R \subset K$ is integral.
By Lemma \ref{lemma-integral-overring-surjective} we see that
$\Spec(R)$ has $1$ point. Since clearly $R$ is a domain we see
that $R = R_{(0)}$ is a field (Lemma \ref{lemma-minimal-prime-reduced-ring}).
The other assertions are immediate from this.
\end{proof}

\begin{lemma}
\label{lemma-integral-over-field}
Let $k$ be a field. Let $S$ be a $k$-algebra over $k$.
\begin{enumerate}
\item If $S$ is a domain and finite dimensional over $k$,
then $S$ is a field.
\item If $S$ is integral over $k$ and a domain,
then $S$ is a field.
\item If $S$ is integral over $k$ then every prime of
$S$ is a maximal ideal (see
Lemma \ref{lemma-ring-with-only-minimal-primes}
for more consequences).
\end{enumerate}
\end{lemma}

\begin{proof}
The statement on primes follows from the statement
``integral $+$ domain $\Rightarrow$ field''.
Let $S$ integral over $k$ and assume $S$ is a domain,
Take $s \in S$. By Lemma
\ref{lemma-characterize-integral} we may find a
finite dimensional $k$-subalgebra $k \subset S' \subset S$
containing $s$. Hence $S$ is a field if we can prove the
first statement. Assume $S$ finite dimensional
over $k$ and a domain. Pick $s\in S$.
Since $S$ is a domain the multiplication
map $s : S \to S$ is surjective by dimension
reasons. Hence there exists an element $s_1 \in S$
such that $ss_1 = 1$. So $S$ is a field.
\end{proof}

\begin{lemma}
\label{lemma-integral-no-inclusion}
Suppose $R \to S$ is integral.
Let $\mathfrak q, \mathfrak q' \in \Spec(S)$
be distinct primes
having the same image in $\Spec(R)$.
Then neither $\mathfrak q \subset \mathfrak q'$
nor $\mathfrak q' \subset \mathfrak q$.
\end{lemma}

\begin{proof}
Let $\mathfrak p \subset R$ be the image.
By Remark \ref{remark-fundamental-diagram}
the primes $\mathfrak q, \mathfrak q'$
correspond to ideals in
$S \otimes_R \kappa(\mathfrak p)$.
Thus the lemma follows from Lemma \ref{lemma-integral-over-field}.
\end{proof}

\begin{lemma}
\label{lemma-finite-finite-fibres}
Suppose $R \to S$ is finite.
Then the fibres of $\Spec(S) \to \Spec(R)$ are finite.
\end{lemma}

\begin{proof}
By the discussion in
Remark \ref{remark-fundamental-diagram}
the fibres are the spectra of the rings $S \otimes_R \kappa(\mathfrak p)$.
As $R \to S$ is finite, these fibre rings are finite over
$\kappa(\mathfrak p)$ hence Noetherian by
Lemma \ref{lemma-Noetherian-permanence}.
By
Lemma \ref{lemma-integral-no-inclusion}
every prime of $S \otimes_R \kappa(\mathfrak p)$ is a minimal
prime. Hence by
Lemma \ref{lemma-Noetherian-irreducible-components}
there are at most finitely many.
\end{proof}

\begin{lemma}
\label{lemma-integral-going-up}
Let $R \to S$ be a ring map such that
$S$ is integral over $R$.
Let $\mathfrak p \subset \mathfrak p' \subset R$
be primes. Let $\mathfrak q$ be a prime of $S$ mapping
to $\mathfrak p$. Then there exists a prime $\mathfrak q'$
with $\mathfrak q \subset \mathfrak q'$
mapping to $\mathfrak p'$.
\end{lemma}

\begin{proof}
We may replace $R$ by $R/\mathfrak p$ and $S$ by $S/\mathfrak q$.
This reduces us to the situation of having an integral
extension of domains $R \subset S$ and a prime $\mathfrak p' \subset R$.
By Lemma \ref{lemma-integral-overring-surjective} we win.
\end{proof}

\noindent
The property expressed in the lemma above is called
the ``going up property'' for the ring map $R \to S$,
see Definition \ref{definition-going-up-down}.

\begin{lemma}
\label{lemma-finite-finitely-presented-extension}
Let $R \to S$ be a finite and finitely presented ring map.
Let $M$ be an $S$-module.
Then $M$ is finitely presented as an $R$-module if and only if
$M$ is finitely presented as an $S$-module.
\end{lemma}

\begin{proof}
One of the implications follows from
Lemma \ref{lemma-finitely-presented-over-subring}.
To see the other assume that $M$ is finitely presented as an $S$-module.
Pick a presentation
$$
S^{\oplus m} \longrightarrow
S^{\oplus n} \longrightarrow
M \longrightarrow 0
$$
As $S$ is finite as an $R$-module, the kernel of
$S^{\oplus n} \to M$ is a finite $R$-module. Thus from
Lemma \ref{lemma-extension}
we see that it suffices to prove that $S$ is finitely presented as an
$R$-module.

\medskip\noindent
Pick $y_1, \ldots, y_n \in S$ such that $y_1, \ldots, y_n$ generate $S$
as an $R$-module. By Lemma \ref{lemma-characterize-integral-element}
each $y_i$ is integral over $R$. Choose monic polynomials
$P_i(x) \in R[x]$ with $P_i(y_i) = 0$. Consider the ring
$$
S' = R[x_1, \ldots, x_n]/(P_1(x_1), \ldots, P_n(x_n))
$$
Then we see that $S$ is of finite presentation as an $S'$-algebra
by Lemma \ref{lemma-compose-finite-type}. Since $S' \to S$ is surjective,
the kernel $J = \Ker(S' \to S)$ is finitely generated as an ideal by
Lemma \ref{lemma-finite-presentation-independent}. Hence $J$ is a finite
$S'$-module (immediate from the definitions).
Thus $S = \Coker(J \to S')$ is  of finite presentation as an $S'$-module
by Lemma \ref{lemma-extension}.
Hence, arguing as in the first paragraph, it suffices to show that $S'$ is
of finite presentation as an $R$-module. Actually, $S'$ is free as an
$R$-module with basis the monomials $x_1^{e_1} \ldots x_n^{e_n}$
for $0 \leq e_i < \deg(P_i)$. Namely, write $R \to S'$ as the composition
$$
R \to R[x_1]/(P_1(x_1)) \to R[x_1, x_2]/(P_1(x_1), P_2(x_2)) \to
\ldots \to S'
$$
This shows that the $i$th ring in this sequence is free as a module over the
$(i - 1)$st one with basis $1, x_i, \ldots, x_i^{\deg(P_i) - 1}$. The result
follows easily from this by induction. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-silly-normal}
Let $R$ be a ring. Let $x, y \in R$ be nonzerodivisors.
Let $R[x/y] \subset R_{xy}$ be the $R$-subalgebra generated
by $x/y$, and similarly for the subalgebras $R[y/x]$ and $R[x/y, y/x]$.
If $R$ is integrally closed in $R_x$ or $R_y$, then the sequence
$$
0 \to R \xrightarrow{(-1, 1)} R[x/y] \oplus R[y/x] \xrightarrow{(1, 1)}
R[x/y, y/x] \to 0
$$
is a short exact sequence of $R$-modules.
\end{lemma}

\begin{proof}
Since $x/y \cdot y/x = 1$ it is clear that the map
$R[x/y] \oplus R[y/x] \to R[x/y, y/x]$ is surjective.
Let $\alpha \in R[x/y] \cap R[y/x]$. To show exactness in the middle
we have to prove that $\alpha \in R$. By assumption we may write
$$
\alpha = a_0 + a_1 x/y + \ldots + a_n (x/y)^n =
b_0 + b_1 y/x + \ldots + b_m(y/x)^m
$$
for some $n, m \geq 0$ and $a_i, b_j \in R$.
Pick some $N > \max(n, m)$.
Consider the finite $R$-submodule $M$ of $R_{xy}$ generated by the elements
$$
(x/y)^N, (x/y)^{N - 1}, \ldots, x/y, 1, y/x, \ldots, (y/x)^{N - 1}, (y/x)^N
$$
We claim that $\alpha M \subset M$. Namely, it is clear that
$(x/y)^i (b_0 + b_1 y/x + \ldots + b_m(y/x)^m) \in M$ for
$0 \leq i \leq N$ and that
$(y/x)^i (a_0 + a_1 x/y + \ldots + a_n(x/y)^n) \in M$ for
$0 \leq i \leq N$. Hence $\alpha$ is integral over $R$ by
Lemma \ref{lemma-characterize-integral-element}. Note that
$\alpha \in R_x$, so if $R$ is integrally closed in $R_x$
then $\alpha \in R$ as desired.
\end{proof}










\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
