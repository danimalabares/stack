\input{preamble}

\begin{document}

\title{Algebraic Geometry}
\maketitle

\phantomsection
\label{section-phantom}
\hfill
\href{http://github.com/danimalabares/stack}{github.com/danimalabares/stack}

\tableofcontents

\section{Sheaves}
\label{section-sheaves}

For a definition of presheaf,
see Categories, Definition \ref{categories-definition-presheaf}.

\begin{definition}
\label{definition-sheaf}
Let $X$ be a topological space.
\begin{enumerate}
\item A {\it sheaf $\mathcal{F}$ of sets on $X$} is a presheaf
of sets which satisfies the following additional property: Given
any open covering $U = \bigcup_{i \in I} U_i$ and any collection
of sections $s_i \in \mathcal{F}(U_i)$, $i \in I$ such that
$\forall i, j\in I$
$$
s_i|_{U_i \cap U_j} = s_j|_{U_i \cap U_j}
$$
there exists a unique section $s \in \mathcal{F}(U)$ such that
$s_i = s|_{U_i}$ for all $i \in I$.
\item A {\it morphism of sheaves of sets} is simply a
morphism of presheaves of sets.
\item The category of sheaves of sets on $X$ is denoted
$\Sh(X)$.
\end{enumerate}
\end{definition}


\medskip\noindent
Let $X$ be a topological space. Let $x \in X$ be a point.
Let $\mathcal{F}$ be a presheaf of sets on $X$.
The {\it stalk of $\mathcal{F}$ at $x$} is the set
$$
\mathcal{F}_x
=
\colim_{x\in U} \mathcal{F}(U)
$$
where the colimit is over the set of open neighbourhoods
$U$ of $x$ in $X$. The set of open neighbourhoods is
partially ordered by (reverse) inclusion:
We say $U \geq U' \Leftrightarrow U \subset U'$.
The transition maps in the system are
given by the restriction maps of $\mathcal{F}$.
See Categories, Section \ref{categories-section-posets-limits}
for notation and terminology regarding (co)limits over systems.
Note that the colimit is a directed colimit.
Thus it is easy to describe $\mathcal{F}_x$. Namely,
$$
\mathcal{F}_x
=
\{
(U, s)
\mid
x\in U, s\in \mathcal{F}(U)
\}/\sim
$$
with equivalence relation given by $(U, s) \sim (U', s')$ if and only if
there exists an open $U'' \subset U \cap U'$ with $x \in U''$ and
$s|_{U''} = s'|_{U''}$. Given a pair $(U, s)$ we sometimes denote
$s_x$ the element of $\mathcal{F}_x$ corresponding to the equivalence
class of $(U, x)$. We sometimes use the phrase
``image of $s$ in $\mathcal{F}_x$'' to denote $s_x$.
For example, given two pairs $(U, s)$ and $(U', s')$ we sometimes
say ``$s$ is equal to $s'$ in $\mathcal{F}_x$'' to indicate
that $s_x = s'_x$. Other authors use the terminology
``germ of $s$ at $x$''.

\section{Abelian sheaves}
\label{section-abelian-sheaves}

The following may be used to define the ideal
sheaf of a variety:

\begin{lemma}
\label{lemma-sheaves-valued-on-groups-have-kernels}
Let $X$ be a topological space and
$\mathcal{F}$ and $\mathcal{G}$ be sheaves over $X$
with values on $\mathit{Grp}$.
For every morphism of sheaves
$f:\mathcal{F}\to \mathcal{G}$,
\begin{align*}
\Ker f: \mathit{Open}_X^{\text{op}} &\longrightarrow \mathit{Sets} \\
U &\longmapsto \Ker f(U)\\
(i:V \to U)&\longmapsto 
\substack{
\Ker f(i):\Ker f(U) \to \Ker f(V)\\
x \mapsto x}
\end{align*}
is a sheaf over $X$.
\end{lemma}

\begin{proof}
First observe that the correspondence
on morphisms is well-defined. Indeed, 
$\Ker f(U)\subset \mathcal{F}(U) \subset \mathcal{F}(V)$ 
when $V \subset U$, and we just apply $f(U)$ 
to notice that $\Ker f(V) \subset \Ker f(U)$.

To see this is a presheaf notice it is obvious
that the identity is mapped to the identity
by definition of the correspondence of morphisms.
It is also obvious that composition is preserved.

To see it is a sheaf consider an open
cover $U_i$ of $U$, and elements $x_i \in \Ker f(U_i)$.
Then use the property of $\mathcal{F}$ being
a sheaf to reconstruct an element $x \in \mathcal{F}(U)$,
whose image under $f$ will be mapped to the
identity element of $\mathcal{G}(U)$ because
it does so in every point of the cover of $U$.
Thus $x$ is in $\Ker f(U)$ as desired.
\end{proof}

\medskip\noindent
More formally,

\begin{definition}
\label{definition-abelian-presheaves}
Let $X$ be a topological space.
\begin{enumerate}
\item A {\it presheaf of abelian groups on $X$} or an
{\it abelian presheaf over $X$}
is a presheaf of sets $\mathcal{F}$ such that for each open
$U \subset X$ the set $\mathcal{F}(U)$ is endowed with
the structure of an abelian group, and such that all restriction
maps $\rho^U_V$ are homomorphisms of abelian groups, see
Lemma \ref{lemma-abelian-presheaves} above.
\item A {\it morphism of abelian presheaves over $X$}
$\varphi : \mathcal{F} \to \mathcal{G}$ is a morphism of presheaves
of sets which induces
a homomorphism of abelian groups $\mathcal{F}(U) \to \mathcal{G}(U)$
for every open $U \subset X$.
\item The category of presheaves of abelian groups on $X$ is denoted
$\textit{PAb}(X)$.
\end{enumerate}
\end{definition}

\medskip\noindent
\begin{definition}
\label{definition-abelian-sheaf}
Let $X$ be a topological space.
\begin{enumerate}
\item An {\it abelian sheaf on $X$} or
{\it sheaf of abelian groups on $X$}
is an abelian presheaf on $X$ such that the underlying presheaf of
sets is a sheaf.
\item The category of sheaves of abelian groups
is denoted $\textit{Ab}(X)$.
\end{enumerate}
\end{definition}

\noindent
Let $X$ be a topological space.
In the case of an abelian presheaf $\mathcal{F}$ the sheaf
condition with regards to an open covering $U = \bigcup U_i$
is often expressed by saying that the complex of abelian groups
$$
0 \to \mathcal{F}(U)
\to \prod\nolimits_i \mathcal{F}(U_i)
\to \prod\nolimits_{(i_0, i_1)} \mathcal{F}(U_{i_0} \cap U_{i_1})
$$
is exact. The first map is the usual one, whereas the second
maps the element $(s_i)_{i \in I}$ to the element
$$
(
s_{i_0}|_{U_{i_0} \cap U_{i_1}} -
s_{i_1}|_{U_{i_0} \cap U_{i_1}}
)_{(i_0, i_1)}
\in \prod\nolimits_{(i_0, i_1)} \mathcal{F}(U_{i_0} \cap U_{i_1})
$$

In fact, the notion of kernel of a sheaf
is not really defined as I did in the beginning of this section,
but in the next one, along with several other
important things.

\section{The abelian category of sheaves of modules}
\label{section-kernels}

\noindent
I guess that the reason to introduce
coherent sheaves is not the search for an
abelian category, after all.
Looks like the pathologies avoided
by the definition of coherence are not
so obvious---something like ``wildly infinitely generated''.

\medskip\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space, see
Sheaves, Definition \ref{sheaves-definition-ringed-space}.
Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}_X$-modules, see
Sheaves, Definition \ref{sheaves-definition-sheaf-modules}.
Let $\varphi, \psi : \mathcal{F} \to \mathcal{G}$
be morphisms of sheaves of $\mathcal{O}_X$-modules.
We define $\varphi + \psi : \mathcal{F} \to \mathcal{G}$
to be the map which on each open $U \subset X$ is the
sum of the maps induced by $\varphi$, $\psi$. This is
clearly again a map of sheaves of $\mathcal{O}_X$-modules.
It is also clear that composition of maps of
$\mathcal{O}_X$-modules is bilinear with respect to this
addition. Thus $\textit{Mod}(\mathcal{O}_X)$ is a pre-additive
category, see Homology, Definition \ref{homology-definition-preadditive}.

\medskip\noindent
We will denote $0$ the sheaf of $\mathcal{O}_X$-modules
which has constant value $\{0\}$ for all open $U \subset X$.
Clearly this is both a final and an initial object of
$\textit{Mod}(\mathcal{O}_X)$. Given a morphism
of $\mathcal{O}_X$-modules $\varphi : \mathcal{F} \to \mathcal{G}$
the following are equivalent:
(a) $\varphi$ is zero, (b) $\varphi$ factors through $0$,
(c) $\varphi$ is zero on sections over each open $U$, and
(d) $\varphi_x = 0$ for all $x \in X$. See
Sheaves, Lemma \ref{sheaves-lemma-points-exactness}.

\medskip\noindent
Moreover, given a pair
$\mathcal{F}$, $\mathcal{G}$ of sheaves of $\mathcal{O}_X$-modules
we may define the direct sum as
$$
\mathcal{F} \oplus \mathcal{G} = \mathcal{F} \times \mathcal{G}
$$
with obvious maps $(i, j, p, q)$ as in Homology, Definition
\ref{homology-definition-direct-sum}. Thus $\textit{Mod}(\mathcal{O}_X)$
is an additive category, see
Homology, Definition \ref{homology-definition-additive-category}.

\medskip\noindent
Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a morphism
of $\mathcal{O}_X$-modules. We may define $\Ker(\varphi)$
to be the subsheaf of $\mathcal{F}$ with sections
$$
\Ker(\varphi)(U) =
\{ s \in \mathcal{F}(U) \mid \varphi(s) = 0 \text{ in } \mathcal{G}(U)\}
$$
for all open $U \subset X$. It is easy to see that this is indeed
a kernel in the category of $\mathcal{O}_X$-modules. In other words,
a morphism $\alpha : \mathcal{H} \to \mathcal{F}$ factors
through $\Ker(\varphi)$ if and only if $\varphi \circ \alpha = 0$.
Moreover, on the level of stalks we have
$\Ker(\varphi)_x = \Ker(\varphi_x)$.

\medskip\noindent
On the other hand, we define
$\Coker(\varphi)$ as the sheaf of $\mathcal{O}_X$-modules
associated to the presheaf of $\mathcal{O}_X$-modules defined
by the rule
$$
U
\longmapsto
\Coker(\mathcal{F}(U)\to \mathcal{G}(U)) =
\mathcal{G}(U)/\varphi(\mathcal{F}(U)).
$$
Since taking stalks commutes with taking sheafification, see
Sheaves, Lemma \ref{sheaves-lemma-stalk-sheafification} we
see that $\Coker(\varphi)_x = \Coker(\varphi_x)$.
Thus the map $\mathcal{G} \to \Coker(\varphi)$ is surjective
(as a map of sheaves of sets),
see Sheaves, Section \ref{sheaves-section-exactness-points}.
To show that this is a cokernel, note that if
$\beta : \mathcal{G} \to \mathcal{H}$ is a morphism of $\mathcal{O}_X$-modules
such that $\beta \circ \varphi$ is zero, then you get for every
open $U \subset X$ a map induced by $\beta$ from
$\mathcal{G}(U)/\varphi(\mathcal{F}(U))$ into $\mathcal{H}(U)$.
By the universal property of sheafification (see
Sheaves, Lemma \ref{sheaves-lemma-sheafification-presheaf-modules})
we obtain a canonical map $\Coker(\varphi) \to \mathcal{H}$
such that the original $\beta$ is equal to
the composition
$\mathcal{G} \to \Coker(\varphi) \to \mathcal{H}$.
The morphism $\Coker(\varphi) \to \mathcal{H}$ is unique
because of the surjectivity mentioned above.

\begin{lemma}
\label{lemma-abelian}
Let $(X, \mathcal{O}_X)$ be a ringed space. The category
$\textit{Mod}(\mathcal{O}_X)$ is an abelian category. Moreover
a complex
$$
\mathcal{F} \to \mathcal{G} \to \mathcal{H}
$$
is exact at $\mathcal{G}$ if and only if for all $x \in X$ the
complex
$$
\mathcal{F}_x \to \mathcal{G}_x \to \mathcal{H}_x
$$
is exact at $\mathcal{G}_x$.
\end{lemma}

\begin{proof}
By Homology, Definition \ref{homology-definition-abelian-category}
we have to show that image and coimage agree. By Sheaves,
Lemma \ref{sheaves-lemma-points-exactness} it is enough to show
that image and coimage have the same stalk at every $x \in X$.
By the constructions of kernels and cokernels above these stalks
are the coimage and image in the categories of $\mathcal{O}_{X, x}$-modules.
Thus we get the result from the fact that the category of modules
over a ring is abelian.
\end{proof}

\noindent
Actually the category $\textit{Mod}(\mathcal{O}_X)$ has many more properties.
Here are two constructions we can do.
\begin{enumerate}
\item Given any set $I$ and for each $i \in I$ a $\mathcal{O}_X$-module
we can form the product
$$
\prod\nolimits_{i \in I} \mathcal{F}_i
$$
which is the sheaf that associates to each open $U$ the
product of the modules $\mathcal{F}_i(U)$. This is also the
categorical product, as in
Categories, Definition \ref{categories-definition-product}.
\item Given any set $I$ and for each $i \in I$ a $\mathcal{O}_X$-module
we can form the direct sum
$$
\bigoplus\nolimits_{i \in I} \mathcal{F}_i
$$
which is the {\it sheafification} of the presheaf
that associates to each open $U$ the
direct sum of the modules $\mathcal{F}_i(U)$.
This is also the categorical coproduct, as in
Categories, Definition \ref{categories-definition-coproduct}.
To see this you use the universal property of sheafification.
\end{enumerate}
Using these we conclude that all limits and colimits exist in
$\textit{Mod}(\mathcal{O}_X)$.

\begin{lemma}
\label{lemma-limits-colimits}
Let $(X, \mathcal{O}_X)$ be a ringed space.
\begin{enumerate}
\item All limits exist in $\textit{Mod}(\mathcal{O}_X)$.
Limits are the same as the corresponding limits of presheaves of
$\mathcal{O}_X$-modules (i.e., commute with taking
sections over opens).
\item All colimits exist in $\textit{Mod}(\mathcal{O}_X)$.
Colimits are the sheafification of the corresponding colimit in
the category of presheaves. Taking colimits commutes with taking
stalks.
\item Filtered colimits are exact.
\item Finite direct sums are the same as the corresponding
finite direct sums of presheaves of $\mathcal{O}_X$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
As $\textit{Mod}(\mathcal{O}_X)$ is abelian (Lemma \ref{lemma-abelian})
it has all finite limits and colimits
(Homology, Lemma \ref{homology-lemma-colimit-abelian-category}).
Thus the existence of limits and colimits and their description follows from
the existence of products and coproducts and their description
(see discussion above) and
Categories, Lemmas \ref{categories-lemma-limits-products-equalizers} and
\ref{categories-lemma-colimits-coproducts-coequalizers}.
Since sheafification commutes with taking stalks we see that
colimits commute with taking stalks. Part (3) signifies that given
a system $0 \to \mathcal{F}_i \to \mathcal{G}_i \to \mathcal{H}_i \to 0$
of exact sequences of $\mathcal{O}_X$-modules over a directed set $I$
the sequence $0 \to \colim \mathcal{F}_i \to \colim \mathcal{G}_i \to
\colim \mathcal{H}_i \to 0$ is exact as well. Since we can check
exactness on stalks (Lemma \ref{lemma-abelian}) this follows from the case
of modules which is
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}.
We omit the proof of (4).
\end{proof}

\noindent
The existence of limits and colimits
allows us to consider exactness properties of
functors defined on the category of $\mathcal{O}$-modules
in terms of limits and colimits, as in
Categories, Section \ref{categories-section-exact-functor}.
See Homology, Lemma \ref{homology-lemma-exact-functor} for a
description of exactness
properties in terms of short exact sequences.

\begin{lemma}
\label{lemma-exactness-pushforward-pullback}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
be a morphism of ringed spaces.
\begin{enumerate}
\item The functor
$f_* : \textit{Mod}(\mathcal{O}_X) \to \textit{Mod}(\mathcal{O}_Y)$
is left exact. In fact it commutes with all limits.
\item The functor
$f^* : \textit{Mod}(\mathcal{O}_Y) \to \textit{Mod}(\mathcal{O}_X)$
is right exact. In fact it commutes with all colimits.
\item Pullback $f^{-1} : \textit{Ab}(Y) \to \textit{Ab}(X)$
on abelian sheaves is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (1) and (2) hold because $(f^*, f_*)$ is an adjoint pair
of functors, see
Sheaves, Lemma \ref{sheaves-lemma-adjoint-pullback-pushforward-modules}
and
Categories, Section \ref{categories-section-adjoint}.
Part (3) holds because exactness can be checked on stalks
(Lemma \ref{lemma-abelian})
and the description of stalks of the pullback, see
Sheaves, Lemma \ref{sheaves-lemma-pullback-abelian-stalk}.
\end{proof}

\begin{lemma}
\label{lemma-j-shriek-exact}
Let $j : U \to X$ be an open immersion of topological spaces.
The functor $j_! : \textit{Ab}(U) \to \textit{Ab}(X)$
is exact.
\end{lemma}

\begin{proof}
Follows from the description of stalks
given in Sheaves, Lemma \ref{sheaves-lemma-j-shriek-abelian}.
\end{proof}

\begin{lemma}
\label{lemma-section-direct-sum-quasi-compact}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $I$ be a set. For $i \in I$, let $\mathcal{F}_i$
be a sheaf of $\mathcal{O}_X$-modules.
For $U \subset X$ quasi-compact open the map
$$
\bigoplus\nolimits_{i \in I} \mathcal{F}_i(U)
\longrightarrow
\left(\bigoplus\nolimits_{i \in I} \mathcal{F}_i\right)(U)
$$
is bijective.
\end{lemma}

\begin{proof}
If $s$ is an element of the right hand side, then
there exists an open covering $U = \bigcup_{j \in J} U_j$
such that $s|_{U_j}$ is a finite sum
$\sum_{i \in I_j} s_{ji}$ with $s_{ji} \in \mathcal{F}_i(U_j)$.
Because $U$ is quasi-compact we may assume that the
covering is finite, i.e., that $J$ is finite.
Then $I' = \bigcup_{j \in J} I_j$ is a finite subset of
$I$. Clearly, $s$ is a section of the subsheaf
$\bigoplus_{i \in I'} \mathcal{F}_i$. The result follows
from the fact that for a finite direct sum sheafification
is not needed, see Lemma \ref{lemma-limits-colimits} above.
\end{proof}






\section{Tensor product of sheaves}
\label{section-tensor product of sheaves}

Here's my unexpected encounter with the definition of tensor product of sheaves.
It's not the ``fiber is tensor product of fibers'' construction, but actually
just some notion of ``change of ring'' sheaf that ends up being adjoint to
some ``restriction'' sheaf. The setting is a mapping of presheaves {\it of
rings} over a space $X$â€¦ (I think the usual definition is this one taking
$\mathcal{O}_1$ as the other presheaf we want to tensor).

Immediately after introducing this notion there's the definition of sheaf, then
stalks, abelian sheaves, some other notions like an ``algebraic structure'' and
then tensor product will be defined after sheafification---because the following
definition is in general not a sheaf.

Furthermore, I add that Vakil leaves it as an exercise to define the tensor
product of two $\mathcal{O}_X$ modules (with a hint of defining the presheaf
tensor product and sheafifying), which makes me think that after all it {\it is}
just the intuitive definition. Before diving in, also by Vakil (Exercise 26.K):
the stalk of the tensor product is the tensor product of the stalks.

\medskip\noindent

Suppose that $\mathcal{O}_1 \to \mathcal{O}_2$ is a
morphism of presheaves of rings on $X$. In this case,
if $\mathcal{F}$ is a presheaf of $\mathcal{O}_2$-modules
then we can think of $\mathcal{F}$ as a presheaf of
$\mathcal{O}_1$-modules by using the composition
$$
\mathcal{O}_1 \times \mathcal{F}
\to
\mathcal{O}_2 \times \mathcal{F}
\to
\mathcal{F}.
$$
We sometimes denote this by $\mathcal{F}_{\mathcal{O}_1}$
to indicate the restriction of rings. We call this
the {\it restriction of $\mathcal{F}$}. We obtain the
restriction functor
$$
\textit{PMod}(\mathcal{O}_2)
\longrightarrow
\textit{PMod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a presheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$
we can construct a presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
by the rule
$$
\left(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}\right)(U)
=
\mathcal{O}_2(U) \otimes_{\mathcal{O}_1(U)} \mathcal{G}(U)
$$
The index $p$ stands for ``presheaf'' and not ``point''.
This presheaf is called the tensor product presheaf. We obtain
the {\it change of rings} functor
$$
\textit{PMod}(\mathcal{O}_1)
\longrightarrow
\textit{PMod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict-presheaves}
With $X$, $\mathcal{O}_1$, $\mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\Hom_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\Hom_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors
are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from the fact that for a ring map
$A \to B$ the restriction functor and the change
of ring functor are adjoint to each other.
\end{proof}

\medskip\noindent
Tipologia dos feixes.

\begin{definition}
\label{definition-tipologia-dos-feixes}
A sheaf of $\mathcal{A}$-modules $\mathcal{F}$ over a sheaf of rings 
$\mathcal{A}$ (on a topological space $X$) is called
\begin{itemize}
\item 
\end{itemize}
\end{definition}

\section{Locally ringed spaces}
\label{section-locally-ringed-spaces}

\noindent
Recall that we defined ringed spaces
in Sheaves, Section \ref{sheaves-section-ringed-spaces}.
Briefly, a ringed space is a pair $(X, \mathcal{O}_X)$ consisting
of a topological space $X$ and a sheaf of rings $\mathcal{O}_X$.
A morphism of ringed spaces $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
is given by a continuous map $f : X \to Y$ and an $f$-map of sheaves
of rings $f^\sharp : \mathcal{O}_Y \to \mathcal{O}_X$. You can
think of $f^\sharp$ as a map $\mathcal{O}_Y \to f_*\mathcal{O}_X$, see
Sheaves, Definition \ref{sheaves-definition-f-map} and
Lemma \ref{sheaves-lemma-f-map}.

\medskip\noindent
A good geometric example of this to keep in mind is
$\mathcal{C}^\infty$-manifolds and morphisms of
$\mathcal{C}^\infty$-manifolds. Namely, if $M$ is a
$\mathcal{C}^\infty$-manifold, then the sheaf $\mathcal{C}^\infty_M$
of smooth functions is a sheaf of rings on $M$. And any
map $f : M \to N$ of manifolds is smooth if and only if
for every local section $h$ of $\mathcal{C}^\infty_N$
the composition $h \circ f$ is a local section of $\mathcal{C}^\infty_M$.
Thus a smooth map $f$ gives rise in a natural way to a morphism
of ringed spaces
$$
f : (M , \mathcal{C}^\infty_M) \longrightarrow (N, \mathcal{C}^\infty_N)
$$
see Sheaves, Example \ref{sheaves-example-continuous-map-ringed}.
It is instructive to consider what happens to stalks. Namely, let
$m \in M$ with image $f(m) = n \in N$. Recall that the stalk
$\mathcal{C}^\infty_{M, m}$ is the ring of germs of smooth
functions at $m$, see
Sheaves, Example \ref{sheaves-example-germs-functions}.
The algebra of germs of functions on $(M, m)$ is a local ring with maximal
ideal the functions which vanish at $m$.
Similarly for $\mathcal{C}^\infty_{N, n}$. The map on stalks
$f^\sharp : \mathcal{C}^\infty_{N, n} \to \mathcal{C}^\infty_{M, m}$
maps the maximal ideal into the maximal ideal, simply
because $f(m) = n$.

\medskip\noindent
In algebraic geometry we study schemes. On a scheme the sheaf of rings
is not determined by an intrinsic property of the space.
The spectrum of a ring $R$
(see Algebra, Section \ref{algebra-section-spectrum-ring}) endowed
with a sheaf of rings constructed out of $R$ (see below),
will be our basic building block. It will turn out that
the stalks of $\mathcal{O}$ on $\Spec(R)$ are the local
rings of $R$ at its primes. There are two reasons to introduce
locally ringed spaces in this setting: (1) There is in general
no mechanism that assigns to a continuous map of spectra a
map of the corresponding rings. This is why we add as an extra datum
the map $f^\sharp$. (2) If we consider morphisms
of these spectra in the category of ringed spaces, then the
maps on stalks may not be local homomorphisms. Since our
geometric intuition says it should we introduce locally ringed spaces
as follows.

\begin{definition}
\label{definition-locally-ringed-space}
Locally ringed spaces.
\begin{enumerate}
\item A {\it locally ringed space $(X, \mathcal{O}_X)$}
is a pair consisting of a
topological space $X$ and a sheaf of rings $\mathcal{O}_X$ all of whose stalks
are local rings.
\item Given a locally ringed space $(X, \mathcal{O}_X)$ we say that
$\mathcal{O}_{X, x}$ is the {\it local ring of $X$ at $x$}.
We denote $\mathfrak{m}_{X, x}$ or simply $\mathfrak{m}_x$
the maximal ideal of $\mathcal{O}_{X, x}$. Moreover, the
{\it residue field of $X$ at $x$} is the residue field
$\kappa(x) = \mathcal{O}_{X, x}/\mathfrak{m}_x$.
\item A {\it morphism of locally ringed spaces}
$(f, f^\sharp) : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
is a morphism of ringed spaces such that for all $x \in X$
the induced ring map $\mathcal{O}_{Y, f(x)} \to \mathcal{O}_{X, x}$ is a
local ring map.
\end{enumerate}
\end{definition}

\noindent
We will usually suppress the sheaf of rings $\mathcal{O}_X$
in the notation when discussing locally ringed spaces. We will
simply refer to ``the locally ringed space $X$''.
We will by abuse of notation think of $X$ also as
the underlying topological space. Finally we will denote
the corresponding sheaf of rings
$\mathcal{O}_X$ as the {\it structure sheaf of $X$}.
In addition, it is customary to denote the maximal ideal
of the local ring $\mathcal{O}_{X, x}$ by
$\mathfrak{m}_{X, x}$ or simply $\mathfrak{m}_x$.
We will say ``let $f : X \to Y$ be a morphism of locally ringed
spaces'' thereby suppressing the structure sheaves even further.
In this case, we will by abuse of notation think of $f : X\to Y$
also as the underlying continuous map of topological spaces.
The $f$-map corresponding to $f$ will customarily
be denoted $f^\sharp$. The condition that $f$ is a morphism
of locally ringed spaces can then be expressed by saying that
for every $x\in X$ the map on stalks
$$
f^\sharp_x : \mathcal{O}_{Y, f(x)} \longrightarrow \mathcal{O}_{X, x}
$$
maps the maximal ideal $\mathfrak m_{Y, f(x)}$ into
$\mathfrak m_{X, x}$.

\medskip\noindent
Let us use these notational conventions to show that the
collection of locally ringed spaces and morphisms of locally
ringed spaces forms a category. In order to see this we have
to show that the composition of morphisms of locally ringed
spaces is a morphism of locally ringed spaces. OK, so let
$f : X \to Y$ and $g : Y \to Z$ be morphism of locally
ringed spaces. The composition of $f$ and $g$ is defined in
Sheaves, Definition \ref{sheaves-definition-composition-maps-ringed-spaces}.
Let $x \in X$. By
Sheaves, Lemma \ref{sheaves-lemma-compose-f-maps-stalks}
the composition
$$
\mathcal{O}_{Z, g(f(x))}
\xrightarrow{g^\sharp}
\mathcal{O}_{Y, f(x)}
\xrightarrow{f^\sharp}
\mathcal{O}_{X, x}
$$
is the associated map on stalks for the morphism $g \circ f$.
The result follows since a composition of local ring
homomorphisms is a local ring homomorphism.

\medskip\noindent
A pleasing feature of the definition is the fact that the functor
$$
\textit{Locally ringed spaces}
\longrightarrow
\textit{Ringed spaces}
$$
reflects isomorphisms (plus more).
Here is a less abstract statement.

\begin{lemma}
\label{lemma-isomorphism-locally-ringed}
\begin{slogan}
An isomorphism of ringed spaces between locally ringed spaces is an
isomorphism of locally ringed spaces.
\end{slogan}
Let $X$, $Y$ be locally ringed spaces.
If $f : X \to Y$ is an isomorphism of
ringed spaces, then $f$ is an isomorphism
of locally ringed spaces.
\end{lemma}

\begin{proof}
This follows trivially from the corresponding fact in algebra:
Suppose $A$, $B$ are local rings. Any isomorphism of rings
$A \to B$ is a local ring isomorphism.
\end{proof}












\section{Open immersions of locally ringed spaces}
\label{section-open-immersion}

\begin{definition}
\label{definition-immersion-locally-ringed-spaces}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
We say that $f$ is an {\it open immersion} if
$f$ is a homeomorphism of $X$ onto an open subset
of $Y$, and the map $f^{-1}\mathcal{O}_Y \to \mathcal{O}_X$
is an isomorphism.
\end{definition}

\noindent
The following construction is parallel to
Sheaves, Definition \ref{sheaves-definition-restriction} (3).

\begin{example}
\label{example-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
Let $\mathcal{O}_U = \mathcal{O}_X|_U$
be the restriction of $\mathcal{O}_X$ to $U$.
For $u \in U$ the stalk $\mathcal{O}_{U, u}$
is equal to the stalk $\mathcal{O}_{X, u}$, and hence is a
local ring. Thus $(U, \mathcal{O}_U)$ is a locally ringed
space and the morphism $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$
is an open immersion.
\end{example}

\begin{definition}
\label{definition-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
The locally ringed space $(U, \mathcal{O}_U)$
of Example \ref{example-open-subspace} above
is the {\it open subspace of $X$ associated to $U$}.
\end{definition}

\begin{lemma}
\label{lemma-open-immersion}
Let $f : X \to Y$ be an open immersion of
locally ringed spaces. Let $j : V = f(X) \to Y$
be the open subspace of $Y$ associated to the image of $f$.
There is a unique isomorphism $f' : X \cong V$ of
locally ringed spaces such that $f = j \circ f'$.
\end{lemma}

\begin{proof}
Let $f'$ be the homeomorphism between $X$ and $V$ induced by $f$. Then
$f = j \circ f'$ as maps of topological spaces. Since there
is an isomorphism of sheaves
$f^\sharp : f^{-1}(\mathcal{O}_Y) \to \mathcal{O}_X$, there is an isomorphism
of rings
$f^\sharp : \Gamma(U, f^{-1}(\mathcal{O}_Y)) \to \Gamma(U, \mathcal{O}_X)$
for each open subset $U \subset X$. Since
$\mathcal{O}_V = j^{-1}\mathcal{O}_Y$ and $f^{-1} = f'^{-1} j^{-1}$
(Sheaves, Lemma \ref{sheaves-lemma-pullback-composition}) we
see that $f^{-1}\mathcal{O}_Y = f'^{-1}\mathcal{O}_V$, hence
$\Gamma(U, f'^{-1}(\mathcal{O}_V)) \to \Gamma(U, f^{-1}(\mathcal{O}_Y))$
is an isomorphism
for every $U \subset X$ open. By composing these we get an isomorphism of rings
$$
\Gamma(U, f'^{-1}(\mathcal{O}_V)) \to \Gamma(U, \mathcal{O}_X)
$$
for each open subset $U \subset X$, and therefore an isomorphism of sheaves
$f^{-1}(\mathcal{O}_V) \to \mathcal{O}_X$. In other words, we have an
isomorphism $f'^{\sharp} : f'^{-1}(\mathcal{O}_V) \to \mathcal{O}_X$ and
therefore an isomorphism of locally ringed spaces
$(f', f'^{\sharp}) : (X, \mathcal{O}_X) \to (V, \mathcal{O}_V)$
(use Lemma \ref{lemma-isomorphism-locally-ringed}).
Note that $f = j \circ f'$ as morphisms of locally ringed spaces
by construction.

\medskip\noindent
Suppose we have another morphism
$f'' : (X, \mathcal{O}_X) \to (V, \mathcal{O}_V)$ such that $f = j \circ f''$.
At any point $x \in X$, we have $j(f'(x)) = j(f''(x))$ from which it follows
that $f'(x) = f''(x)$ since $j$ is the inclusion map; therefore $f'$ and $f''$
are the same as morphisms of topological spaces. On structure sheaves,
for each open subset $U \subset X$ we have a commutative diagram
$$
\xymatrix @R=5em{
\Gamma(U, f^{-1}(\mathcal{O}_Y)) \ar[d]_\cong\ar[r]^\cong &
\Gamma(U, \mathcal{O}_X) \\
\Gamma(U, f'^{-1}(\mathcal{O}_V)) \ar@/^/[ru]^{f'^\sharp}
\ar@/_/[ru]_{f''^\sharp} &
}
$$
from which we see that $f'^\sharp$ and $f''^\sharp$ define
the same morphism of sheaves.
\end{proof}

\noindent
From now on we do not distinguish between open subsets
and their associated subspaces.

\begin{lemma}
\label{lemma-restrict-map-to-opens}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $U \subset X$, and $V \subset Y$ be open subsets.
Suppose that $f(U) \subset V$. There exists a unique
morphism of locally ringed spaces $f|_U : U \to V$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
U \ar[d]_{f|_U} \ar[r] & X \ar[d]^f \\
V \ar[r] & Y
}
$$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
In the following we will use without further mention the following
fact which follows from the lemma above. Given any morphism
$f : Y \to X$ of locally ringed spaces, and any open subset
$U \subset X$ such that $f(Y) \subset U$, then there exists
a unique morphism of locally ringed spaces $Y \to U$ such that
the composition $Y \to U \to X$ is equal to $f$. In fact, we will
even by abuse of notation write $f : Y \to U$ since this rarely
gives rise to confusion.









\section{Closed immersions of locally ringed spaces}
\label{section-closed-immersion}

\noindent
We follow our conventions introduced in
Modules, Definition \ref{modules-definition-closed-immersion}.

\begin{definition}
\label{definition-closed-immersion-locally-ringed-spaces}
Let $i : Z \to X$ be a morphism of locally ringed spaces.
We say that $i$ is a {\it closed immersion} if:
\begin{enumerate}
\item The map $i$ is a homeomorphism of $Z$ onto a closed subset of $X$.
\item The map $\mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective;
let $\mathcal{I}$ denote the kernel.
\item The $\mathcal{O}_X$-module $\mathcal{I}$
is locally generated by sections.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-closed-local-target}
Let $f : Z \to X$ be a morphism of locally ringed spaces.
In order for $f$ to be a closed immersion it suffices
that there exists an open covering $X = \bigcup U_i$ such
that each $f : f^{-1}U_i \to U_i$ is a closed immersion.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{example}
\label{example-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf
of ideals which is locally generated by sections as a sheaf
of $\mathcal{O}_X$-modules. Let $Z$ be the support of
the sheaf of rings $\mathcal{O}_X/\mathcal{I}$.
This is a closed subset of $X$, by
Modules, Lemma \ref{modules-lemma-support-sheaf-rings-closed}.
Denote $i : Z \to X$ the inclusion map.
By Modules, Lemma \ref{modules-lemma-i-star-exact}
there is a unique sheaf of rings $\mathcal{O}_Z$ on $Z$
with $i_*\mathcal{O}_Z = \mathcal{O}_X/\mathcal{I}$.
For any $z \in Z$ the stalk $\mathcal{O}_{Z, z}$
is equal to a quotient $\mathcal{O}_{X, i(z)}/\mathcal{I}_{i(z)}$
of a local ring and nonzero, hence a local ring.
Thus $i : (Z, \mathcal{O}_Z) \to (X, \mathcal{O}_X)$ is
a closed immersion of locally ringed spaces.
\end{example}

\begin{definition}
\label{definition-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I}$ be a sheaf of ideals on $X$
which is locally generated by sections.
The locally ringed space $(Z, \mathcal{O}_Z)$
of Example \ref{example-closed-subspace} above
is the {\it closed subspace of $X$ associated to
the sheaf of ideals $\mathcal{I}$}.
\end{definition}

\begin{lemma}
\label{lemma-closed-immersion}
Let $f : X \to Y$ be a closed immersion of
locally ringed spaces. Let $\mathcal{I}$ be the
kernel of the map $\mathcal{O}_Y \to f_*\mathcal{O}_X$.
Let $i : Z \to Y$ be the closed subspace of $Y$
associated to $\mathcal{I}$.
There is a unique isomorphism $f' : X \cong Z$ of
locally ringed spaces such that $f = i \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-characterize-closed-subspace}
Let $X$, $Y$ be locally ringed spaces. Let
$\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals locally generated
by sections. Let $i : Z \to X$ be the associated closed subspace.
A morphism $f : Y \to X$ factors through $Z$ if and only if the map
$f^*\mathcal{I} \to f^*\mathcal{O}_X = \mathcal{O}_Y$
is zero. If this is the case the morphism $g : Y \to Z$
such that $f = i \circ g$ is unique.
\end{lemma}

\begin{proof}
Clearly if $f$ factors as $Y \to Z \to X$ then the map
$f^*\mathcal{I} \to \mathcal{O}_Y$ is zero. Conversely
suppose that $f^*\mathcal{I} \to \mathcal{O}_Y$ is zero.
Pick any $y \in Y$, and consider the ring map
$f^\sharp_y : \mathcal{O}_{X, f(y)} \to \mathcal{O}_{Y, y}$.
Since the composition
$\mathcal{I}_{f(y)} \to \mathcal{O}_{X, f(y)} \to \mathcal{O}_{Y, y}$
is zero by assumption and since $f^\sharp_y(1) = 1$
we see that $1 \not \in \mathcal{I}_{f(y)}$, i.e.,
$\mathcal{I}_{f(y)} \not = \mathcal{O}_{X, f(y)}$. We conclude that
$f(Y) \subset Z = \text{Supp}(\mathcal{O}_X/\mathcal{I})$.
Hence $f = i \circ g$ where $g : Y \to Z$ is continuous.
Consider the map $f^\sharp : \mathcal{O}_X \to f_*\mathcal{O}_Y$.
The assumption $f^*\mathcal{I} \to \mathcal{O}_Y$ is zero implies that
the composition $\mathcal{I} \to \mathcal{O}_X \to f_*\mathcal{O}_Y$ is
zero by adjointness of $f_*$ and $f^*$.
In other words, we obtain a morphism of sheaves of rings
$\overline{f^\sharp} : \mathcal{O}_X/\mathcal{I} \to f_*\mathcal{O}_Y$.
Note that $f_*\mathcal{O}_Y = i_*g_*\mathcal{O}_Y$ and
that $\mathcal{O}_X/\mathcal{I} = i_*\mathcal{O}_Z$.
By Sheaves, Lemma \ref{sheaves-lemma-equivalence-categories-closed-structures}
we obtain a unique morphism of sheaves of rings
$g^\sharp : \mathcal{O}_Z \to g_*\mathcal{O}_Y$ whose pushforward
under $i$ is $\overline{f^\sharp}$. We omit the verification that
$(g, g^\sharp)$ defines a morphism of locally ringed spaces
and that $f = i \circ g$ as a morphism of locally ringed spaces.
The uniqueness of $(g, g^\sharp)$ was pointed out above.
\end{proof}

\begin{lemma}
\label{lemma-restrict-map-to-closed}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $\mathcal{I} \subset \mathcal{O}_Y$ be a sheaf of
ideals which is locally generated by sections.
Let $i : Z \to Y$ be the closed subspace associated to the
sheaf of ideals $\mathcal{I}$.
Let $\mathcal{J}$ be the image of the map
$f^*\mathcal{I} \to f^*\mathcal{O}_Y = \mathcal{O}_X$.
Then this ideal is locally generated by sections.
Moreover, let $i' : Z' \to X$ be the associated closed
subspace of $X$. There exists a unique
morphism of locally ringed spaces $f' : Z' \to Z$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
Z' \ar[d]_{f'} \ar[r]_{i'} & X \ar[d]^f \\
Z \ar[r]^{i} & Y
}
$$
Moreover, this diagram is a fibre square in the category of
locally ringed spaces.
\end{lemma}

\begin{proof}
The ideal $\mathcal{J}$ is locally generated by sections
by Modules, Lemma \ref{modules-lemma-pullback-locally-generated}.
The rest of the lemma follows from the characterization,
in Lemma \ref{lemma-characterize-closed-subspace} above,
of what it means for a morphism to factor through a closed
subspace.
\end{proof}




\medskip\noindent
Let me finish with a proof that haunted my
second semester of PhD:

\begin{lemma}
\label{lemma-ideal-sheaf-is-line-bundle-schemes}
The ideal sheaf of an irreducible codimension-1 closed subscheme of a smooth
scheme is a line bundle.
\end{lemma}

\begin{proof}
Since $Y$ is codimension-1 irreducible, the ideal sheaf at every affine chart is
a codimension-1 prime ideal. This means that there aren't any nontrivial prime
ideals of $\mathcal{I}_Y(\Spec A):=I$. Let $f\in I$.
Since $X$ is smooth, $O_X\Spec A=A$ is a UFD (why?). Then there exists an
irreducible element $g\in I$ such that $gh=f$. The ideal generated by $g$ is
prime (again because $A$ is a UFD) 
and contained in $I$, so that $I$ is principal. This shows that
$\mathcal{I}_Y$ is locally principal, i.e. it is a line bundle.
\end{proof}












\section{The spectrum of a ring}
\label{section-spectrum-ring}

\noindent
We arbitrarily decide that the spectrum of a ring as a topological space
is part of the algebra chapter, whereas an affine scheme is part of the
chapter on schemes.

\begin{definition}
\label{definition-spectrum-ring}
Let $R$ be a ring.
\begin{enumerate}
\item The {\it spectrum} of $R$ is the set of prime ideals of $R$.
It is usually denoted $\Spec(R)$.
\item Given a subset $T \subset R$ we let $V(T) \subset \Spec(R)$
be the set of primes containing $T$, i.e., $V(T) = \{ \mathfrak p \in
\Spec(R) \mid \forall f\in T, f\in \mathfrak p\}$.
\item Given an element $f \in R$ we let $D(f) \subset \Spec(R)$
be the set of primes not containing $f$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-Zariski-topology}
Let $R$ be a ring.
\begin{enumerate}
\item The spectrum of a ring $R$ is empty if and only if $R$
is the zero ring.
\item Every nonzero ring has a maximal ideal.
\item Every nonzero ring has a minimal prime ideal.
\item Given an ideal $I \subset R$ and a prime ideal
$I \subset \mathfrak p$ there exists a prime
$I \subset \mathfrak q \subset \mathfrak p$ such
that $\mathfrak q$ is minimal over $I$.
\item If $T \subset R$, and if $(T)$ is the ideal generated by
$T$ in $R$, then $V((T)) = V(T)$.
\item If $I$ is an ideal and $\sqrt{I}$ is its radical,
see basic notion (\ref{item-radical-ideal}), then $V(I) = V(\sqrt{I})$.
\item Given an ideal $I$ of $R$ we have $\sqrt{I} =
\bigcap_{I \subset \mathfrak p} \mathfrak p$.
\item If $I$ is an ideal then $V(I) = \emptyset$ if and only
if $I$ is the unit ideal.
\item If $I$, $J$ are ideals of $R$ then $V(I) \cup V(J) =
V(I \cap J)$.
\item If $(I_a)_{a\in A}$ is a set of ideals of $R$ then
$\bigcap_{a\in A} V(I_a) = V(\bigcup_{a\in A} I_a)$.
\item If $f \in R$, then $D(f) \amalg V(f) = \Spec(R)$.
\item If $f \in R$ then $D(f) = \emptyset$ if and only if $f$
is nilpotent.
\item If $f = u f'$ for some unit $u \in R$, then $D(f) = D(f')$.
\item If $I \subset R$ is an ideal, and $\mathfrak p$ is a prime of
$R$ with $\mathfrak p \not\in V(I)$, then there exists an $f \in R$
such that $\mathfrak p \in D(f)$, and $D(f) \cap V(I) = \emptyset$.
\item If $f, g \in R$, then $D(fg) = D(f) \cap D(g)$.
\item If $f_i \in R$ for $i \in I$, then
$\bigcup_{i\in I} D(f_i)$ is the complement of $V(\{f_i \}_{i\in I})$
in $\Spec(R)$.
\item If $f \in R$ and $D(f) = \Spec(R)$, then $f$ is a unit.
\end{enumerate}
\end{lemma}

\begin{proof}
We address each part in the corresponding item below.
\begin{enumerate}
\item This is a direct consequence of (2) or (3).
\item Let $\mathfrak{A}$ be the set of all proper ideals of $R$. This set is
ordered by inclusion and is non-empty, since $(0) \in \mathfrak{A}$ is a proper
ideal. Let $A$ be a totally ordered subset of $\mathfrak A$.
Then $\bigcup_{I \in A} I$ is in
fact an ideal. Since 1 $\notin I$ for all $I \in A$, the union does not contain
1 and thus is proper. Hence $\bigcup_{I \in A} I$ is in $\mathfrak{A}$ and is
an upper bound for the set $A$. Thus by Zorn's lemma $\mathfrak{A}$ has a
maximal element, which is the sought-after maximal ideal.
\item Since $R$ is nonzero, it contains a maximal ideal which is a prime ideal.
Thus the set $\mathfrak{A}$ of all prime ideals of $R$ is nonempty.
$\mathfrak{A}$ is ordered by reverse-inclusion. Let $A$ be a totally ordered
subset of $\mathfrak{A}$. It's pretty clear that $J = \bigcap_{I \in A} I$ is
in fact an ideal. Not so clear, however, is that it is prime. Let $xy \in J$.
Then $xy \in I$ for all $I \in A$. Now let $B = \{I \in A | y \in I\}$. Let $K
= \bigcap_{I \in B} I$. Since $A$ is totally ordered, either $K = J$ (and we're
done, since then $y \in J$) or $K \supset J$ and for all $I \in A$ such that
$I$ is properly contained in $K$, we have $y \notin I$. But that means that for
all those $I, x \in I$, since they are prime. Hence $x \in J$. In either case,
$J$ is prime as desired. Hence by Zorn's lemma we get a maximal element which
in this case is a minimal prime ideal.
\item This is the same exact argument as (3) except you only consider prime
ideals contained in $\mathfrak{p}$ and containing $I$.
\item $(T)$ is the smallest ideal containing $T$. Hence if $T \subset I$, some
ideal, then $(T) \subset I$ as well. Hence if $I \in V(T)$, then $I \in V((T))$
as well. The other inclusion is obvious.
\item Since $I \subset \sqrt{I}, V(\sqrt{I}) \subset V(I)$. Now let
$\mathfrak{p} \in V(I)$. Let $x \in \sqrt{I}$. Then $x^n \in I$ for some $n$.
Hence $x^n \in \mathfrak{p}$. But since $\mathfrak{p}$ is prime, a boring
induction argument gets you that $x \in \mathfrak{p}$. Hence $\sqrt{I} \subset
\mathfrak{p}$ and $\mathfrak{p} \in V(\sqrt{I})$.
\item Let $f \in R \setminus \sqrt{I}$. Then $f^n \notin I$ for all $n$. Hence
$S = \{1, f, f^2, \ldots\}$ is a multiplicative subset, not containing $0$.
Take a
prime ideal $\bar{\mathfrak{p}} \subset S^{-1}R$ containing $S^{-1}I$. Then the
pull-back $\mathfrak{p}$ in $R$ of $\bar{\mathfrak{p}}$ is a prime ideal
containing $I$ that does not intersect $S$. This shows that $\bigcap_{I \subset
\mathfrak p} \mathfrak p \subset \sqrt{I}$. Now if $a \in \sqrt{I}$, then $a^n
\in I$ for some $n$. Hence if $I \subset \mathfrak{p}$, then $a^n \in
\mathfrak{p}$. But since $\mathfrak{p}$ is prime, we have $a \in \mathfrak{p}$.
Thus the equality is shown.
\item $I$ is not the unit ideal if and only if $I$
is contained in some maximal ideal (to
see this, apply (2) to the ring $R/I$) which is therefore prime.
\item If $\mathfrak{p} \in V(I) \cup V(J)$, then $I \subset \mathfrak{p}$ or $J
\subset \mathfrak{p}$ which means that $I \cap J \subset \mathfrak{p}$. Now if
$I \cap J \subset \mathfrak{p}$, then $IJ \subset \mathfrak{p}$ and hence
either $I$ of $J$ is in $\mathfrak{p}$, since $\mathfrak{p}$ is prime.
\item $\mathfrak{p} \in \bigcap_{a \in A} V(I_a) \Leftrightarrow
I_a \subset \mathfrak{p}, \forall a \in A \Leftrightarrow
\mathfrak{p} \in V(\bigcup_{a\in A} I_a)$
\item If $\mathfrak{p}$ is a prime ideal and $f \in R$, then either $f \in
\mathfrak{p}$ or $f \notin \mathfrak{p}$ (strictly) which is what the disjoint
union says.
\item If $a \in R$ is nilpotent, then $a^n = 0$ for some $n$. Hence $a^n \in
\mathfrak{p}$ for any prime ideal. Thus $a \in \mathfrak{p}$ as can be shown by
induction and $D(a) = \emptyset$. Now, as shown in (7), if $a \in R$ is not
nilpotent, then there is a prime ideal that does not contain it.
\item $f \in \mathfrak{p} \Leftrightarrow uf \in \mathfrak{p}$, since $u$ is
invertible.
\item If $\mathfrak{p} \notin V(I)$, then $\exists f \in I \setminus
\mathfrak{p}$. Then $f \notin \mathfrak{p}$ so $\mathfrak{p} \in D(f)$. Also if
$\mathfrak{q} \in D(f)$, then $f \notin \mathfrak{q}$ and thus $I$ is not
contained in $\mathfrak{q}$. Thus $D(f) \cap V(I) = \emptyset$.
\item If $fg \in \mathfrak{p}$, then $f \in \mathfrak{p}$ or $g \in
\mathfrak{p}$. Hence if $f \notin \mathfrak{p}$ and $g \notin \mathfrak{p}$,
then $fg \notin \mathfrak{p}$. Since $\mathfrak{p}$ is an ideal, if $fg \notin
\mathfrak{p}$, then $f \notin \mathfrak{p}$ and $g \notin \mathfrak{p}$.
\item $\mathfrak{p} \in \bigcup_{i \in I} D(f_i) \Leftrightarrow \exists i \in
I, f_i \notin \mathfrak{p} \Leftrightarrow \mathfrak{p} \in \Spec(R)
\setminus V(\{f_i\}_{i \in I})$
\item If $D(f) = \Spec(R)$, then $V(f) = \emptyset$ and
hence $fR = R$, so $f$ is a unit.
\end{enumerate}
\end{proof}

\noindent
The lemma implies that the subsets $V(T)$ from
Definition \ref{definition-spectrum-ring} form the closed
subsets of a topology on $\Spec(R)$. And it also shows that
the sets $D(f)$ are open and form a basis for this
topology.

\begin{definition}
\label{definition-Zariski-topology}
Let $R$ be a ring.
The topology on $\Spec(R)$ whose closed sets are the
sets $V(T)$ is called the {\it Zariski} topology. The open
subsets $D(f)$ are called the {\it standard opens} of $\Spec(R)$.
\end{definition}

\noindent
It should be clear from context whether we consider $\Spec(R)$
just as a set or as a topological space.

\begin{lemma}
\label{lemma-spec-functorial}
\begin{slogan}
Functoriality of the spectrum
\end{slogan}
Suppose that $\varphi : R \to R'$ is a ring homomorphism.
The induced map
$$
\Spec(\varphi) : \Spec(R') \longrightarrow \Spec(R),
\quad
\mathfrak p' \longmapsto \varphi^{-1}(\mathfrak p')
$$
is continuous for the Zariski topologies. In fact, for any
element $f \in R$ we have
$\Spec(\varphi)^{-1}(D(f)) = D(\varphi(f))$.
\end{lemma}

\begin{proof}
It is basic notion (\ref{item-inverse-image-prime}) that
$\mathfrak p := \varphi^{-1}(\mathfrak p')$
is indeed a prime ideal of $R$. The last assertion
of the lemma follows directly from the definitions,
and implies the first.
\end{proof}

\noindent
If $\varphi' : R' \to R''$ is a second ring homomorphism
then the composition
$$
\Spec(R'')
\longrightarrow
\Spec(R')
\longrightarrow
\Spec(R)
$$
equals $\Spec(\varphi' \circ \varphi)$. In other
words, $\Spec$ is a contravariant functor from the
category of rings to the category of topological spaces.

\begin{lemma}
\label{lemma-spec-localization}
Let $R$ be a ring. Let $S \subset R$ be a multiplicative subset.
The map $R \to S^{-1}R$ induces via the functoriality of $\Spec$
a homeomorphism
$$
\Spec(S^{-1}R)
\longrightarrow
\{\mathfrak p \in \Spec(R) \mid S \cap \mathfrak p = \emptyset \}
$$
where the topology on the right hand side is that induced from the
Zariski topology on $\Spec(R)$. The inverse map is given
by $\mathfrak p \mapsto S^{-1}\mathfrak p = \mathfrak p(S^{-1}R)$.
\end{lemma}

\begin{proof}
Denote the right hand side of the arrow of the lemma by $D$.
Choose a prime $\mathfrak p' \subset S^{-1}R$ and let $\mathfrak p$
the inverse image of $\mathfrak p'$ in $R$. Since $\mathfrak p'$
does not contain $1$ we see that $\mathfrak p$ does not contain
any element of $S$. Hence $\mathfrak p \in D$ and we see that
the image is contained in $D$. Let $\mathfrak p \in D$.
By assumption the image $\overline{S}$ does not contain $0$.
By basic notion (\ref{item-localization-zero})
$\overline{S}^{-1}(R/\mathfrak p)$ is not the zero ring.
By basic notion (\ref{item-localize-ideal}) we see
$S^{-1}R / S^{-1}\mathfrak p = \overline{S}^{-1}(R/\mathfrak p)$
is a domain, and hence $S^{-1}\mathfrak p$ is a prime.
The equality of rings also shows that the inverse image of
$S^{-1}\mathfrak p$ in $R$ is equal to $\mathfrak p$,
because $R/\mathfrak p \to \overline{S}^{-1}(R/\mathfrak p)$
is injective by basic notion (\ref{item-localize-nonzerodivisors}).
This proves that the map $\Spec(S^{-1}R) \to \Spec(R)$
is bijective onto $D$ with inverse as given.
It is continuous by Lemma \ref{lemma-spec-functorial}.
Finally, let $D(g) \subset \Spec(S^{-1}R)$ be a standard
open. Write $g = h/s$ for some $h\in R$ and $s\in S$.
Since $g$ and $h/1$ differ by a unit we have $D(g) =
D(h/1)$ in $\Spec(S^{-1}R)$.
Hence by Lemma \ref{lemma-spec-functorial} and the bijectivity
above the image of $D(g) = D(h/1)$ is $D \cap D(h)$.
This proves the map is open as well.
\end{proof}

\begin{lemma}
\label{lemma-standard-open}
Let $R$ be a ring. Let $f \in R$.
The map $R \to R_f$ induces via the functoriality of
$\Spec$ a homeomorphism
$$
\Spec(R_f) \longrightarrow D(f) \subset \Spec(R).
$$
The inverse is given by $\mathfrak p \mapsto \mathfrak p \cdot R_f$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-spec-localization}.
\end{proof}

\noindent
It is not the case that every ``affine open'' of a
spectrum is a standard open. See
Example \ref{example-affine-open-not-standard}.

\begin{lemma}
\label{lemma-spec-closed}
Let $R$ be a ring. Let $I \subset R$ be an ideal.
The map $R \to R/I$ induces via the functoriality of
$\Spec$ a homeomorphism
$$
\Spec(R/I) \longrightarrow V(I) \subset \Spec(R).
$$
The inverse is given by $\mathfrak p \mapsto \mathfrak p / I$.
\end{lemma}

\begin{proof}
It is immediate that the image is contained in $V(I)$.
On the other hand, if $\mathfrak p \in V(I)$
then $\mathfrak p \supset I$ and we may consider
the ideal $\mathfrak p /I \subset R/I$. Using
basic notion (\ref{item-isomorphism-theorem}) we see that
$(R/I)/(\mathfrak p/I) = R/\mathfrak p$ is a domain
and hence $\mathfrak p/I$ is a prime ideal. From this
it is immediately clear that the image of $D(f + I)$
is $D(f) \cap V(I)$, and hence the map is a homeomorphism.
\end{proof}



\begin{lemma}
\label{lemma-quasi-compact}
\begin{slogan}
The spectrum of a ring is quasi-compact
\end{slogan}
Let $R$ be a ring. The space $\Spec(R)$ is quasi-compact.
\end{lemma}

\begin{proof}
It suffices to prove that any covering of $\Spec(R)$
by standard opens can be refined by a finite covering.
Thus suppose that $\Spec(R) = \cup D(f_i)$
for a set of elements $\{f_i\}_{i\in I}$ of $R$. This means that
$\cap V(f_i) = \emptyset$. According to Lemma
\ref{lemma-Zariski-topology} this means that
$V(\{f_i \}) = \emptyset$. According to the
same lemma this means that the ideal generated
by the $f_i$ is the unit ideal of $R$. This means
that we can write $1$ as a {\it finite} sum:
$1 = \sum_{i \in J} r_i f_i$ with $J \subset I$ finite.
And then it follows that $\Spec(R)
= \cup_{i \in J} D(f_i)$.
\end{proof}

\begin{lemma}
\label{lemma-topology-spec}
Let $R$ be a ring.
The topology on $X = \Spec(R)$ has the following properties:
\begin{enumerate}
\item $X$ is quasi-compact,
\item $X$ has a basis for the topology consisting of quasi-compact opens, and
\item the intersection of any two quasi-compact opens is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
The spectrum of a ring is quasi-compact, see
Lemma \ref{lemma-quasi-compact}.
It has a basis for the topology consisting of the standard opens
$D(f) = \Spec(R_f)$
(Lemma \ref{lemma-standard-open})
which are quasi-compact by the first remark.
The intersection of two standard opens is quasi-compact
as $D(f) \cap D(g) = D(fg)$. Given any two quasi-compact opens
$U, V \subset X$ we may write $U = D(f_1) \cup \ldots \cup D(f_n)$
and $V = D(g_1) \cup \ldots \cup D(g_m)$. Then
$U \cap V = \bigcup D(f_ig_j)$ which is quasi-compact.
\end{proof}








\section{Affine schemes}
\label{section-affine-schemes}

\noindent
Let $R$ be a ring. Consider the topological space $\Spec(R)$
associated to $R$, see Algebra, Section \ref{algebra-section-spectrum-ring}.
We will endow this space with a sheaf of rings $\mathcal{O}_{\Spec(R)}$
and the resulting pair $(\Spec(R), \mathcal{O}_{\Spec(R)})$
will be an affine scheme.

\medskip\noindent
Recall that $\Spec(R)$ has a basis of open sets $D(f)$,
$f \in R$ which we call standard opens, see Algebra,
Definition \ref{algebra-definition-Zariski-topology}.
In addition, the intersection of two standard opens is another:
$D(f) \cap D(g) = D(fg)$, $f, g\in R$.

\begin{lemma}
\label{lemma-standard-open}
Let $R$ be a ring. Let $f \in R$.
\begin{enumerate}
\item If $g\in R$ and $D(g) \subset D(f)$, then
\begin{enumerate}
\item $f$ is invertible in $R_g$,
\item $g^e = af$ for some $e \geq 1$ and $a \in R$,
\item there is a canonical ring map $R_f \to R_g$, and
\item there is a canonical $R_f$-module map
$M_f \to M_g$ for any $R$-module $M$.
\end{enumerate}
\item Any open covering of $D(f)$ can be refined to a finite
open covering of the form $D(f) = \bigcup_{i = 1}^n D(g_i)$.
\item If $g_1, \ldots, g_n \in R$, then $D(f) \subset \bigcup D(g_i)$
if and only if $g_1, \ldots, g_n$ generate the unit ideal in $R_f$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $D(g) = \Spec(R_g)$ (see
Algebra, Lemma \ref{algebra-lemma-standard-open}).
Thus (a) holds because $f$
maps to an element of $R_g$ which is not
contained in any prime ideal, and hence invertible,
see Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
Write the inverse of $f$ in $R_g$ as $a/g^d$.
This means $g^d - af$ is annihilated by a power of $g$, whence (b).
For (c), the map $R_f \to R_g$ exists by (a) from the universal property
of localization, or we can define it by mapping $b/f^n$
to $a^nb/g^{ne}$. The equality $M_f = M \otimes_R R_f$
can be used to obtain the map on modules, or
we can define $M_f \to M_g$ by mapping
$x/f^n$ to $a^nx/g^{ne}$.

\medskip\noindent
Recall that $D(f)$ is quasi-compact, see
Algebra, Lemma \ref{algebra-lemma-qc-open}.
Hence the second statement follows directly
from the fact that the standard opens form
a basis for the topology.

\medskip\noindent
The third statement follows directly from
Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
\end{proof}

\noindent
In Sheaves, Section \ref{sheaves-section-bases} we defined
the notion of a sheaf on a basis, and we showed that it is
essentially equivalent to the notion of a sheaf on the space,
see Sheaves, Lemmas \ref{sheaves-lemma-extend-off-basis} and
\ref{sheaves-lemma-extend-off-basis-structures}. Moreover,
we showed in
Sheaves, Lemma \ref{sheaves-lemma-cofinal-systems-coverings-standard-case}
that it is sufficient to check the sheaf
condition on a cofinal system of open coverings for each
standard open. By the lemma above it suffices to check
on the finite coverings by standard opens.

\begin{definition}
\label{definition-standard-covering}
Let $R$ be a ring.
\begin{enumerate}
\item A {\it standard open covering} of $\Spec(R)$
is a covering $\Spec(R) = \bigcup_{i = 1}^n D(f_i)$,
where $f_1, \ldots, f_n \in R$.
\item Suppose that $D(f) \subset \Spec(R)$ is a standard
open. A {\it standard open covering} of $D(f)$
is a covering $D(f) = \bigcup_{i = 1}^n D(g_i)$,
where $g_1, \ldots, g_n \in R$.
\end{enumerate}
\end{definition}

\noindent
Let $R$ be a ring. Let $M$ be an $R$-module. We will define
a presheaf $\widetilde M$ on the basis of standard opens.
Suppose that $U \subset \Spec(R)$ is a standard open.
If $f, g \in R$ are such that $D(f) = D(g)$, then
by Lemma \ref{lemma-standard-open} above there are canonical
maps $M_f \to M_g$ and $M_g \to M_f$ which are mutually inverse.
Hence we may choose any $f$ such that $U = D(f)$
and define
$$
\widetilde M(U) = M_f.
$$
Note that if $D(g) \subset D(f)$, then by
Lemma \ref{lemma-standard-open} above we have
a canonical map
$$
\widetilde M(D(f)) = M_f \longrightarrow M_g = \widetilde M(D(g)).
$$
Clearly, this defines a presheaf of abelian groups on the basis
of standard opens. If $M = R$, then $\widetilde R$ is a presheaf
of rings on the basis of standard opens.

\medskip\noindent
Let us compute the stalk of $\widetilde M$ at a point $x \in \Spec(R)$.
Suppose that $x$ corresponds to the prime $\mathfrak p \subset R$.
By definition of the stalk we see that
$$
\widetilde M_x = \colim_{f\in R, f\not\in \mathfrak p} M_f
$$
Here the set $\{f \in R, f \not \in \mathfrak p\}$ is preordered by
the rule $f \geq f' \Leftrightarrow D(f) \subset D(f')$.
If $f_1, f_2 \in R \setminus \mathfrak p$, then we have
$f_1f_2 \geq f_1$ in this ordering. Hence by
Algebra, Lemma \ref{algebra-lemma-localization-colimit}
we conclude that
$$
\widetilde M_x = M_{\mathfrak p}.
$$

\medskip\noindent
Next, we check the sheaf condition for the standard open coverings.
If $D(f) = \bigcup_{i = 1}^n D(g_i)$, then the sheaf condition
for this covering is equivalent with the exactness of the
sequence
$$
0 \to M_f \to \bigoplus M_{g_i} \to \bigoplus M_{g_ig_j}.
$$
Note that $D(g_i) = D(fg_i)$, and hence we can rewrite this
sequence as the sequence
$$
0 \to M_f \to \bigoplus M_{fg_i} \to \bigoplus M_{fg_ig_j}.
$$
In addition, by Lemma \ref{lemma-standard-open} above
we see that $g_1, \ldots, g_n$ generate the unit ideal
in $R_f$. Thus we may apply
Algebra, Lemma \ref{algebra-lemma-cover-module}
to the module $M_f$ over $R_f$ and the elements $g_1, \ldots, g_n$.
We conclude that the sequence is exact. By the remarks
made above, we see that $\widetilde M$ is a sheaf
on the basis of standard opens.

\medskip\noindent
Thus we conclude from the material in
Sheaves, Section \ref{sheaves-section-bases}
that there exists a
unique sheaf of rings $\mathcal{O}_{\Spec(R)}$
which agrees with $\widetilde R$ on the standard opens.
Note that by our computation of stalks above, the
stalks of this sheaf of rings are all local rings.

\medskip\noindent
Similarly, for any $R$-module $M$ there exists
a unique sheaf of $\mathcal{O}_{\Spec(R)}$-modules
$\mathcal{F}$ which agrees with $\widetilde M$ on the
standard opens, see
Sheaves, Lemma \ref{sheaves-lemma-extend-off-basis-module}.

\begin{definition}
\label{definition-structure-sheaf}
Let $R$ be a ring.
\begin{enumerate}
\item The {\it structure sheaf $\mathcal{O}_{\Spec(R)}$ of the
spectrum of $R$} is the unique sheaf of rings $\mathcal{O}_{\Spec(R)}$
which agrees with $\widetilde R$ on the basis of standard opens.
\item The locally ringed space
$(\Spec(R), \mathcal{O}_{\Spec(R)})$ is called
the {\it spectrum} of $R$ and denoted $\Spec(R)$.
\item The sheaf of $\mathcal{O}_{\Spec(R)}$-modules
extending $\widetilde M$ to all opens of $\Spec(R)$
is called the sheaf of $\mathcal{O}_{\Spec(R)}$-modules
associated to $M$. This sheaf is denoted $\widetilde M$ as
well.
\end{enumerate}
\end{definition}

\noindent
We summarize the results obtained so far.

\begin{lemma}
\label{lemma-spec-sheaves}
Let $R$ be a ring. Let $M$ be an $R$-module. Let $\widetilde M$
be the sheaf of $\mathcal{O}_{\Spec(R)}$-modules
associated to $M$.
\begin{enumerate}
\item We have $\Gamma(\Spec(R), \mathcal{O}_{\Spec(R)}) = R$.
\item We have $\Gamma(\Spec(R), \widetilde M) = M$ as an $R$-module.
\item For every $f \in R$ we have
$\Gamma(D(f), \mathcal{O}_{\Spec(R)}) = R_f$.
\item For every $f\in R$ we have $\Gamma(D(f), \widetilde M) = M_f$
as an $R_f$-module.
\item Whenever $D(g) \subset D(f)$ the restriction mappings
on $\mathcal{O}_{\Spec(R)}$ and $\widetilde M$
are the maps
$R_f \to R_g$ and $M_f \to M_g$ from Lemma
\ref{lemma-standard-open}.
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \Spec(R)$
be the corresponding point. We have
$\mathcal{O}_{\Spec(R), x} = R_{\mathfrak p}$.
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \Spec(R)$
be the corresponding point. We have $\widetilde M_x = M_{\mathfrak p}$
as an $R_{\mathfrak p}$-module.
\end{enumerate}
Moreover, all these identifications are functorial in the $R$
module $M$. In particular, the functor $M \mapsto \widetilde M$
is an exact functor from the category of $R$-modules
to the category of $\mathcal{O}_{\Spec(R)}$-modules.
\end{lemma}

\begin{proof}
Assertions (1) - (7) are clear from the discussion above.
The exactness of the functor $M \mapsto \widetilde M$
follows from the fact that the functor $M \mapsto M_{\mathfrak p}$
is exact and the fact that exactness of short exact sequences
may be checked on stalks, see
Modules, Lemma \ref{modules-lemma-abelian}.
\end{proof}

\begin{definition}
\label{definition-affine-scheme}
An {\it affine scheme} is a locally ringed space isomorphic
as a locally ringed space to $\Spec(R)$ for some ring $R$.
A {\it morphism of affine schemes} is a morphism in the category
of locally ringed spaces.
\end{definition}

\noindent
It turns out that affine schemes play a special role
among all locally ringed spaces, which is what the next
section is about.


















\section{The category of affine schemes}
\label{section-category-affine-schemes}

\noindent
This might be a cornerstone of AG.
The point is that once we take affine charts,
we re in the affine category. And this category turns
out to be equivalent to the category of rings. /o/
See below for some important properties of the correspondence;
namely fibred products and tensor product counterparts.

\noindent
Note that if $Y$ is an affine scheme, then its
points are in canonical $1-1$ bijection with
prime ideals in $\Gamma(Y, \mathcal{O}_Y)$.

\begin{lemma}
\label{lemma-morphism-into-affine-where-point-goes}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
Let $f \in \Mor(X, Y)$ be a morphism
of locally ringed spaces. Given a point $x \in X$
consider the ring maps
$$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{f^\sharp}
\Gamma(X, \mathcal{O}_X) \to \mathcal{O}_{X, x}
$$
Let $\mathfrak p \subset \Gamma(Y, \mathcal{O}_Y)$ denote
the inverse image of $\mathfrak m_x$. Let $y \in Y$ be the
corresponding point. Then $f(x) = y$.
\end{lemma}

\begin{proof}
Consider the commutative diagram
$$
\xymatrix{
\Gamma(X, \mathcal{O}_X) \ar[r] &
\mathcal{O}_{X, x} \\
\Gamma(Y, \mathcal{O}_Y) \ar[r] \ar[u] &
\mathcal{O}_{Y, f(x)} \ar[u]
}
$$
(see the discussion of $f$-maps below
Sheaves, Definition \ref{sheaves-definition-f-map}).
Since the right vertical arrow is local
we see that $\mathfrak m_{f(x)}$ is the
inverse image of $\mathfrak m_x$. The result
follows.
\end{proof}

\begin{lemma}
\label{lemma-f-open}
Let $X$ be a locally ringed space.
Let $f \in \Gamma(X, \mathcal{O}_X)$.
The set
$$
D(f) = \{x \in X \mid \text{image }f \not\in \mathfrak m_x\}
$$
is open. Moreover $f|_{D(f)}$ has an inverse.
\end{lemma}

\begin{proof}
This is a special case of Modules, Lemma \ref{modules-lemma-s-open}, but
we also give a direct proof.
Suppose that $U \subset X$ and $V \subset X$ are
two open subsets such that $f|_U$ has an inverse
$g$ and $f|_V$ has an inverse $h$. Then clearly
$g|_{U\cap V} = h|_{U\cap V}$. Thus it suffices
to show that $f$ is invertible in an open neighbourhood
of any $x \in D(f)$. This is clear because
$f \not \in \mathfrak m_x$ implies that $f \in \mathcal{O}_{X, x}$
has an inverse $g \in \mathcal{O}_{X, x}$ which means there
is some open neighbourhood $x \in U \subset X$ so
that $g \in \mathcal{O}_X(U)$ and $g\cdot f|_U = 1$.
\end{proof}

\begin{lemma}
\label{lemma-f-open-affine}
In Lemma \ref{lemma-f-open} above, if $X$ is an affine scheme,
then the open $D(f)$ agrees with the standard open $D(f)$
defined previously (in
Algebra, Definition \ref{algebra-definition-spectrum-ring}).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-morphism-into-affine}
\begin{reference}
A reference for this fact is \cite[II, Err 1, Prop. 1.8.1]{EGA}
where it is attributed to J. Tate.
\end{reference}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
The map
$$
\Mor(X, Y)
\longrightarrow
\Hom(\Gamma(Y, \mathcal{O}_Y), \Gamma(X, \mathcal{O}_X))
$$
which maps $f$ to $f^\sharp$ (on global sections) is bijective.
\end{lemma}

\begin{proof}
Since $Y$ is affine we have
$(Y, \mathcal{O}_Y) \cong (\Spec(R), \mathcal{O}_{\Spec(R)})$
for some ring $R$.
During the proof we will use facts about $Y$ and
its structure sheaf which are direct consequences of things
we know about the spectrum of a ring, see e.g.\ Lemma
\ref{lemma-spec-sheaves}.

\medskip\noindent
Motivated by the lemmas above we construct the inverse map.
Let $\psi_Y : \Gamma(Y, \mathcal{O}_Y) \to \Gamma(X, \mathcal{O}_X)$
be a ring map. First, we define the corresponding map of
spaces
$$
\Psi : X \longrightarrow Y
$$
by the rule of
Lemma \ref{lemma-morphism-into-affine-where-point-goes}.
In other words, given $x \in X$ we define $\Psi(x)$
to be the point of $Y$ corresponding to the prime
in $\Gamma(Y, \mathcal{O}_Y)$ which is the inverse
image of $\mathfrak m_x$ under the composition
$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{\psi_Y}
\Gamma(X, \mathcal{O}_X) \to
\mathcal{O}_{X, x}
$.

\medskip\noindent
We claim that the map $\Psi : X \to Y$ is continuous.
The standard opens $D(g)$, for $g \in \Gamma(Y, \mathcal{O}_Y)$
are a basis for the topology of $Y$. Thus it suffices to prove
that $\Psi^{-1}(D(g))$ is open. By construction of $\Psi$
the inverse image $\Psi^{-1}(D(g))$ is exactly the set
$D(\psi_Y(g)) \subset X$ which is open by Lemma \ref{lemma-f-open}.
Hence $\Psi$ is continuous.

\medskip\noindent
Next we construct a $\Psi$-map of sheaves from
$\mathcal{O}_Y$ to $\mathcal{O}_X$. By
Sheaves, Lemma \ref{sheaves-lemma-f-map-basis-below-structures}
it suffices to define ring maps
$\psi_{D(g)} : \Gamma(D(g), \mathcal{O}_Y) \to
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)$
compatible with restriction maps.
We have a canonical isomorphism
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$,
because $Y$ is an affine scheme.
Because $\psi_Y(g)$ is invertible on $D(\psi_Y(g))$
we see that there is a canonical map
$$
\Gamma(Y, \mathcal{O}_Y)_g
\longrightarrow
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)
=
\Gamma(D(\psi_Y(g)), \mathcal{O}_X)
$$
extending the map $\psi_Y$
by the universal property of localization.
Note that there is no choice but to take the canonical map here!
And we take this, combined
with the canonical identification
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$, to
be $\psi_{D(g)}$. This is compatible with localization since the
restriction mapping on the affine schemes are defined in terms
of the universal properties of localization also, see
Lemmas \ref{lemma-spec-sheaves} and \ref{lemma-standard-open}.

\medskip\noindent
Thus we have defined a morphism of ringed spaces
$(\Psi, \psi) : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
recovering $\psi_Y$ on global sections. To see that it is
a morphism of locally ringed spaces we have to show that
the induced maps on local rings
$$
\psi_x : \mathcal{O}_{Y, \Psi(x)} \longrightarrow \mathcal{O}_{X, x}
$$
are local. This follows immediately from the commutative diagram
of the proof of Lemma \ref{lemma-morphism-into-affine-where-point-goes}
and the definition of $\Psi$.

\medskip\noindent
Finally, we have to show that the constructions
$(\Psi, \psi) \mapsto \psi_Y$ and the construction
$\psi_Y \mapsto (\Psi, \psi)$ are inverse to each other.
Clearly, $\psi_Y \mapsto (\Psi, \psi) \mapsto \psi_Y$.
Hence the only thing to prove is that given $\psi_Y$
there is at most one pair $(\Psi, \psi)$ giving rise
to it. The uniqueness of $\Psi$ was shown in Lemma
\ref{lemma-morphism-into-affine-where-point-goes} and
given the uniqueness of $\Psi$ the uniqueness of the
map $\psi$ was pointed out during the course of the proof
above.
\end{proof}

\begin{lemma}
\label{lemma-category-affine-schemes}
The category of affine schemes is equivalent to the opposite of the
category of rings. The equivalence is given by the functor that associates
to an affine scheme the global sections of its structure sheaf.
\end{lemma}

\begin{proof}
This is now clear from Definition \ref{definition-affine-scheme}
and Lemma \ref{lemma-morphism-into-affine}.
\end{proof}

\begin{lemma}
\label{lemma-standard-open-affine}
Let $Y$ be an affine scheme.
Let $f \in \Gamma(Y, \mathcal{O}_Y)$.
The open subspace $D(f)$ is an affine scheme.
\end{lemma}

\begin{proof}
We may assume that $Y = \Spec(R)$ and $f \in R$.
Consider the morphism of affine schemes
$\phi : U = \Spec(R_f) \to \Spec(R) = Y$ induced by the ring
map $R \to R_f$. By Algebra, Lemma \ref{algebra-lemma-standard-open}
we know that it is a homeomorphism onto $D(f)$.
On the other hand, the map $\phi^{-1}\mathcal{O}_Y \to \mathcal{O}_U$
is an isomorphism on stalks, hence an isomorphism. Thus we see
that $\phi$ is an open immersion. We conclude that $D(f)$
is isomorphic to $U$ by Lemma \ref{lemma-open-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-fibre-product-affine-schemes}
The category of affine schemes has finite products, and fibre products.
In other words, it has finite limits. Moreover, the products
and fibre products in the category of affine schemes
are the same as in the category of locally ringed spaces.
In a formula, we have (in the category of locally ringed spaces)
$$
\Spec(R) \times \Spec(S) =
\Spec(R \otimes_{\mathbf{Z}} S)
$$
and given ring maps $R \to A$, $R \to B$ we have
$$
\Spec(A) \times_{\Spec(R)} \Spec(B)
=
\Spec(A \otimes_R B).
$$
\end{lemma}

\begin{proof}
This is just an application of Lemma \ref{lemma-morphism-into-affine}.
First of all, by that lemma, the affine scheme
$\Spec(\mathbf{Z})$ is the final object in the category
of locally ringed spaces. Thus the first displayed formula
follows from the second. To prove the second note that
for any locally ringed space $X$ we have
\begin{eqnarray*}
\Mor(X, \Spec(A \otimes_R B))
& = &
\Hom(A \otimes_R B, \mathcal{O}_X(X)) \\
& = &
\Hom(A, \mathcal{O}_X(X))
\times_{\Hom(R, \mathcal{O}_X(X))}
\Hom(B, \mathcal{O}_X(X)) \\
& = &
\Mor(X, \Spec(A))
\times_{\Mor(X, \Spec(R))}
\Mor(X, \Spec(B))
\end{eqnarray*}
which proves the formula.
See Categories, Section \ref{categories-section-fibre-products} for the
relevant definitions.
\end{proof}

\begin{lemma}
\label{lemma-disjoint-union-affines}
Let $X$ be a locally ringed space.
Assume $X = U \amalg V$ with $U$ and $V$ open and
such that $U$, $V$ are affine schemes. Then $X$ is an affine scheme.
\end{lemma}

\begin{proof}
Set $R = \Gamma(X, \mathcal{O}_X)$.
Note that $R = \mathcal{O}_X(U) \times \mathcal{O}_X(V)$
by the sheaf property. By Lemma \ref{lemma-morphism-into-affine}
there is a canonical morphism of locally ringed spaces
$X \to \Spec(R)$. By Algebra, Lemma \ref{algebra-lemma-spec-product}
we see that as a topological space
$\Spec(\mathcal{O}_X(U)) \amalg \Spec(\mathcal{O}_X(V)) =
\Spec(R)$
with the maps coming from the ring homomorphisms
$R \to \mathcal{O}_X(U)$ and $R \to \mathcal{O}_X(V)$.
This of course means that $\Spec(R)$ is the coproduct
in the category of locally ringed spaces as well.
By assumption the morphism $X \to \Spec(R)$ induces an isomorphism
of $\Spec(\mathcal{O}_X(U))$ with $U$ and similarly
for $V$. Hence $X \to \Spec(R)$ is an isomorphism.
\end{proof}















\section{Quasi-coherent sheaves on affines}
\label{section-quasi-coherent-affine}

\noindent
Recall that we have defined the abstract notion of a quasi-coherent
sheaf in Modules, Definition \ref{modules-definition-quasi-coherent}.
In this section we show that any quasi-coherent sheaf on an affine
scheme $\Spec(R)$ corresponds to the sheaf $\widetilde M$ associated to
an $R$-module $M$.

\begin{lemma}
\label{lemma-compare-constructions}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme. Let $M$ be an $R$-module. There exists a canonical
isomorphism between the sheaf $\widetilde M$ associated to the $R$-module
$M$ (Definition \ref{definition-structure-sheaf}) and the sheaf
$\mathcal{F}_M$ associated to the $R$-module $M$
(Modules, Definition \ref{modules-definition-sheaf-associated}).
This isomorphism is functorial in $M$. In particular,
the sheaves $\widetilde M$ are quasi-coherent. Moreover, they
are characterized by the following mapping property
$$
\Hom_{\mathcal{O}_X}(\widetilde M, \mathcal{F})
=
\Hom_R(M, \Gamma(X, \mathcal{F}))
$$
for any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$.
Here a map $\alpha : \widetilde M \to \mathcal{F}$ corresponds
to its effect on global sections.
\end{lemma}

\begin{proof}
By Modules, Lemma \ref{modules-lemma-construct-quasi-coherent-sheaves}
we have a morphism $\mathcal{F}_M \to \widetilde M$ corresponding
to the map $M \to \Gamma(X, \widetilde M) = M$. Let $x \in X$
correspond to the prime $\mathfrak p \subset R$.
The induced map on stalks are the maps
$\mathcal{O}_{X, x} \otimes_R M \to M_{\mathfrak p}$
which are isomorphisms because
$R_{\mathfrak p} \otimes_R M = M_{\mathfrak p}$.
Hence the map $\mathcal{F}_M \to \widetilde M$ is an isomorphism.
The mapping property follows from the mapping property of
the sheaves $\mathcal{F}_M$.
\end{proof}

\begin{lemma}
\label{lemma-widetilde-constructions}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme. There are canonical isomorphisms
\begin{enumerate}
\item
$
\widetilde{M \otimes_R N}
\cong
\widetilde M \otimes_{\mathcal{O}_X} \widetilde N
$,
see Modules, Section \ref{modules-section-tensor-product}.
\item
$
\widetilde{\text{T}^n(M)}
\cong
\text{T}^n(\widetilde M)
$,
$
\widetilde{\text{Sym}^n(M)}
\cong
\text{Sym}^n(\widetilde M)
$, and
$
\widetilde{\wedge^n(M)}
\cong
\wedge^n(\widetilde M)
$,
see
Modules, Section \ref{modules-section-symmetric-exterior}.
\item if $M$ is a finitely presented $R$-module, then
$
\SheafHom_{\mathcal{O}_X}(\widetilde M, \widetilde N)
\cong
\widetilde{\Hom_R(M,  N)}
$,
see
Modules, Section \ref{modules-section-internal-hom}.
\end{enumerate}
\end{lemma}

\begin{proof}[First proof]
Using Lemma \ref{lemma-compare-constructions} and
Modules, Lemma \ref{modules-lemma-construct-quasi-coherent-sheaves}
we see that the functor $M \mapsto \widetilde M$ can be viewed
as $\pi^*$ for a morphism $\pi$ of ringed spaces.
And pulling back modules commutes with tensor constructions by
Modules, Lemmas \ref{modules-lemma-tensor-product-pullback}
and \ref{modules-lemma-pullback-tensor-algebra}.
The morphism $\pi : (X, \mathcal{O}_X) \to (\{*\}, R)$ is
flat for example because the stalks of $\mathcal{O}_X$ are
localizations of $R$ (Lemma \ref{lemma-spec-sheaves})
and hence flat over $R$. Thus pullback by $\pi$ commutes
with internal hom if the first module is finitely presented by
Modules, Lemma \ref{modules-lemma-pullback-internal-hom}.
\end{proof}

\begin{proof}[Second proof]
Proof of (1). By Lemma \ref{lemma-compare-constructions} to give a map
$\widetilde{M \otimes_R N}$ into
$\widetilde M \otimes_{\mathcal{O}_X} \widetilde N$
we have to give a map on global sections
$M \otimes_R N \to
\Gamma(X, \widetilde M \otimes_{\mathcal{O}_X} \widetilde N)$
which exists by definition of the tensor product of sheaves
of modules. To see that this map is an isomorphism it
suffices to check that it is an isomorphism on stalks.
And this follows from the description of the stalks
of $\widetilde{M}$ (either in Lemma \ref{lemma-spec-sheaves} or in
Modules, Lemma \ref{modules-lemma-construct-quasi-coherent-sheaves}),
the fact that tensor product commutes with localization
(Algebra, Lemma \ref{algebra-lemma-tensor-product-localization}) and
Modules, Lemma \ref{modules-lemma-stalk-tensor-product}.

\medskip\noindent
Proof of (2). This is similar to the proof of (1), using
Algebra, Lemma \ref{algebra-lemma-tensor-algebra-localization} and
Modules, Lemma \ref{modules-lemma-stalk-tensor-algebra}.

\medskip\noindent
Proof of (3). Since the construction $M \mapsto \widetilde{M}$ is functorial
there is an $R$-linear map
$\Hom_R(M, N) \to \Hom_{\mathcal{O}_X}(\widetilde{M}, \widetilde{N})$.
The target of this map is the global sections of
$\SheafHom_{\mathcal{O}_X}(\widetilde M, \widetilde N)$.
Hence by Lemma \ref{lemma-compare-constructions} we obtain a map
of $\mathcal{O}_X$-modules $\widetilde{\Hom_R(M,  N)} \to
\SheafHom_{\mathcal{O}_X}(\widetilde M, \widetilde N)$.
We check that this is an isomorphism by comparing stalks.
If $M$ is finitely presented as an $R$-module
then $\widetilde M$ has a global finite presentation as an
$\mathcal{O}_X$-module. Hence we conclude using
Algebra, Lemma \ref{algebra-lemma-hom-from-finitely-presented} and
Modules, Lemma \ref{modules-lemma-stalk-internal-hom}.
\end{proof}

\begin{proof}[Third proof of part (1)]
For any $\mathcal{O}_X$-module $\mathcal{F}$
we have the following isomorphisms functorial in $M$, $N$, and $\mathcal{F}$
\begin{align*}
\Hom_{\mathcal{O}_X}(\widetilde{M} \otimes _{\mathcal{O} _X} \widetilde{N},
\mathcal{F})
& =
\Hom_{\mathcal{O}_X}(\widetilde{M},
\SheafHom_{\mathcal{O} _X} (\widetilde{N}, \mathcal{F})) \\
& =
\Hom_R(M, \Gamma(X,
\SheafHom_{\mathcal{O}_X}(\widetilde{N}, \mathcal{F}))) \\
& =
\Hom_R(M, \Hom_{\mathcal{O}_X}(\widetilde{N}, \mathcal{F})) \\
& =
\Hom_R(M, \Hom_R(N, \Gamma(X,\mathcal{F}))) \\
& =
\Hom_R(M \otimes_R N, \Gamma(X, \mathcal{F})) \\
& =
\Hom_{\mathcal{O}_X}(\widetilde{M \otimes_R N}, \mathcal{F})
\end{align*}
The first equality is Modules, Lemma \ref{modules-lemma-internal-hom}.
The second equality is the universal property of $\widetilde{M}$, see
Lemma \ref{lemma-compare-constructions}. The third equality holds by
definition of $\SheafHom$. The fourth equality is the universal property
of $\widetilde{N}$. Then fifth equality is
Algebra, Lemma \ref{algebra-lemma-hom-from-tensor-product}.
The final equality is the universal property of
$\widetilde{M \otimes_R N}$.
By the Yoneda lemma (Categories, Lemma \ref{categories-lemma-yoneda})
we obtain (1).
\end{proof}

\begin{lemma}
\label{lemma-widetilde-pullback}
Let
$(X, \mathcal{O}_X) = (\Spec(S), \mathcal{O}_{\Spec(S)})$,
$(Y, \mathcal{O}_Y) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be affine schemes.
Let $\psi : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a
morphism of affine schemes, corresponding to the ring map
$\psi^\sharp : R \to S$ (see Lemma \ref{lemma-category-affine-schemes}).
\begin{enumerate}
\item We have $\psi^* \widetilde M = \widetilde{S \otimes_R M}$
functorially in the $R$-module $M$.
\item We have $\psi_* \widetilde N = \widetilde{N_R}$ functorially
in the $S$-module $N$.
\end{enumerate}
\end{lemma}

\begin{proof}
The first assertion follows from the identification in
Lemma \ref{lemma-compare-constructions}
and the result of Modules, Lemma \ref{modules-lemma-restrict-quasi-coherent}.
The second assertion follows from the fact
that $\psi^{-1}(D(f)) = D(\psi^\sharp(f))$ and hence
$$
\psi_* \widetilde N(D(f)) = \widetilde N(D(\psi^\sharp(f))) =
N_{\psi^\sharp(f)} = (N_R)_f = \widetilde{N_R}(D(f))
$$
as desired.
\end{proof}

\noindent
Lemma \ref{lemma-widetilde-pullback} above says in particular
that if you restrict
the sheaf $\widetilde M$ to a standard affine open subspace
$D(f)$, then you get $\widetilde{M_f}$. We will use this from
now on without further mention.

\begin{lemma}
\label{lemma-quasi-coherent-affine}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme. Let $\mathcal{F}$ be a
quasi-coherent $\mathcal{O}_X$-module. Then
$\mathcal{F}$ is isomorphic to the sheaf associated to
the $R$-module $\Gamma(X, \mathcal{F})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Since every standard open $D(f)$ is quasi-compact we see that
$X$ is locally quasi-compact, i.e., every point has a fundamental
system of quasi-compact neighbourhoods, see Topology,
Definition \ref{topology-definition-locally-quasi-compact}.
Hence by Modules, Lemma \ref{modules-lemma-quasi-coherent-module}
for every prime $\mathfrak p \subset R$ corresponding to $x \in X$
there exists an open neighbourhood $x \in U \subset X$ such that
$\mathcal{F}|_U$ is isomorphic to the quasi-coherent
sheaf associated to some $\mathcal{O}_X(U)$-module $M$.
In other words, we get an open covering by $U$'s with this property.
By Lemma \ref{lemma-standard-open} for example we can refine this
covering to  a standard open covering.
Thus we get a covering $\Spec(R) = \bigcup D(f_i)$
and $R_{f_i}$-modules $M_i$ and isomorphisms
$\varphi_i : \mathcal{F}|_{D(f_i)} \to \mathcal{F}_{M_i}$
for some $R_{f_i}$-module $M_i$. On the overlaps
we get isomorphisms
$$
\xymatrix{
\mathcal{F}_{M_i}|_{D(f_if_j)}
\ar[rr]^{\varphi_i^{-1}|_{D(f_if_j)}}
& &
\mathcal{F}|_{D(f_if_j)}
\ar[rr]^{\varphi_j|_{D(f_if_j)}}
& &
\mathcal{F}_{M_j}|_{D(f_if_j)}.
}
$$
Let us denote these $\psi_{ij}$. It is clear that
we have the cocycle condition
$$
\psi_{jk}|_{D(f_if_jf_k)}
\circ
\psi_{ij}|_{D(f_if_jf_k)}
=
\psi_{ik}|_{D(f_if_jf_k)}
$$
on triple overlaps.

\medskip\noindent
Recall that each of the open subspaces $D(f_i)$, $D(f_if_j)$,
$D(f_if_jf_k)$ is an affine scheme. Hence the sheaves $\mathcal{F}_{M_i}$
are isomorphic to the sheaves $\widetilde M_i$ by Lemma
\ref{lemma-compare-constructions} above. In particular we see that
$\mathcal{F}_{M_i}(D(f_if_j)) = (M_i)_{f_j}$, etc.
Also by Lemma \ref{lemma-compare-constructions} above we see
that $\psi_{ij}$ corresponds to a unique $R_{f_if_j}$-module isomorphism
$$
\psi_{ij} : (M_i)_{f_j} \longrightarrow (M_j)_{f_i}
$$
namely, the effect of $\psi_{ij}$ on sections over $D(f_if_j)$.
Moreover these then satisfy the cocycle condition that
$$
\xymatrix{
(M_i)_{f_jf_k}
\ar[rd]_{\psi_{ij}}
\ar[rr]^{\psi_{ik}}
& &
(M_k)_{f_if_j} \\
&
(M_j)_{f_if_k} \ar[ru]_{\psi_{jk}}
}
$$
commutes (for any triple $i, j, k$).

\medskip\noindent
Now Algebra, Lemma \ref{algebra-lemma-glue-modules}
shows that there exist an $R$-module $M$ such that
$M_i = M_{f_i}$ compatible with the morphisms $\psi_{ij}$.
Consider $\mathcal{F}_M = \widetilde M$. At this point it is
a formality to show that $\widetilde M$ is isomorphic to
the quasi-coherent sheaf $\mathcal{F}$ we started out with.
Namely, the sheaves $\mathcal{F}$ and $\widetilde M$ give
rise to isomorphic sets of glueing data of sheaves of $\mathcal{O}_X$-modules
with respect to the covering $X = \bigcup D(f_i)$, see
Sheaves, Section \ref{sheaves-section-glueing-sheaves}
and in particular Lemma \ref{sheaves-lemma-mapping-property-glue}.
Explicitly, in the current situation, this boils down to
the following argument: Let us construct an $R$-module map
$$
M \longrightarrow \Gamma(X, \mathcal{F}).
$$
Namely, given $m \in M$ we get $m_i = m/1 \in M_{f_i} = M_i$
by construction of $M$. By construction of $M_i$ this corresponds
to a section $s_i \in \mathcal{F}(U_i)$. (Namely, $\varphi^{-1}_i(m_i)$.)
We claim that $s_i|_{D(f_if_j)} = s_j|_{D(f_if_j)}$. This is
true because, by construction of $M$, we have $\psi_{ij}(m_i) = m_j$,
and by the construction of the $\psi_{ij}$. By the sheaf condition of
$\mathcal{F}$ this collection of sections gives rise to a unique
section $s$ of $\mathcal{F}$ over $X$. We leave it to the reader
to show that $m \mapsto s$ is a $R$-module map.
By Lemma \ref{lemma-compare-constructions} we obtain an associated
$\mathcal{O}_X$-module map
$$
\widetilde M \longrightarrow \mathcal{F}.
$$
By construction this map reduces to the isomorphisms
$\varphi_i^{-1}$ on each $D(f_i)$ and hence is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-quasi-coherent}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme.
The functors $M \mapsto \widetilde M$ and
$\mathcal{F} \mapsto \Gamma(X, \mathcal{F})$ define quasi-inverse
equivalences of categories
$$
\xymatrix{
\QCoh(\mathcal{O}_X)
\ar@<1ex>[r]
&
\text{Mod}_R
\ar@<1ex>[l]
}
$$
between the category of quasi-coherent $\mathcal{O}_X$-modules
and the category of $R$-modules.
\end{lemma}

\begin{proof}
See Lemmas \ref{lemma-compare-constructions}
and \ref{lemma-quasi-coherent-affine} above.
\end{proof}

\noindent
From now on we will not distinguish between quasi-coherent
sheaves on affine schemes and sheaves of the form $\widetilde M$.

\begin{lemma}
\label{lemma-kernel-cokernel-quasi-coherent}
Let $X = \Spec(R)$ be an affine scheme.
Kernels and cokernels of maps of quasi-coherent
$\mathcal{O}_X$-modules are quasi-coherent.
\end{lemma}

\begin{proof}
This follows from the exactness of the functor $\widetilde{\ }$
since by Lemma \ref{lemma-compare-constructions} we know that any map
$\psi : \widetilde{M} \to \widetilde{N}$ comes from
an $R$-module map $\varphi : M \to N$. (So we have
$\Ker(\psi) = \widetilde{\Ker(\varphi)}$ and
$\Coker(\psi) = \widetilde{\Coker(\varphi)}$.)
\end{proof}

\begin{lemma}
\label{lemma-colimit-quasi-coherent}
Let $X = \Spec(R)$ be an affine scheme.
The direct sum of an arbitrary collection of quasi-coherent sheaves
on $X$ is quasi-coherent. The same holds for colimits.
\end{lemma}

\begin{proof}
Suppose $\mathcal{F}_i$, $i \in I$ is a collection of quasi-coherent
sheaves on $X$. By Lemma \ref{lemma-equivalence-quasi-coherent}
above we can write $\mathcal{F}_i = \widetilde{M_i}$ for some $R$-module
$M_i$. Set $M = \bigoplus M_i$. Consider the sheaf $\widetilde{M}$.
For each standard open $D(f)$ we have
$$
\widetilde{M}(D(f)) = M_f =
\left(\bigoplus M_i\right)_f =
\bigoplus M_{i, f}.
$$
Hence we see that the quasi-coherent $\mathcal{O}_X$-module
$\widetilde{M}$ is the direct sum of the sheaves $\mathcal{F}_i$.
A similar argument works for general colimits.
\end{proof}

\begin{lemma}
\label{lemma-extension-quasi-coherent}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme. Suppose that
$$
0 \to
\mathcal{F}_1 \to
\mathcal{F}_2 \to
\mathcal{F}_3 \to
0
$$
is a short exact sequence of sheaves of $\mathcal{O}_X$-modules.
If two out of three are quasi-coherent then so is the third.
\end{lemma}

\begin{proof}
This is clear in case both $\mathcal{F}_1$ and $\mathcal{F}_2$ are
quasi-coherent because the functor $M \mapsto \widetilde M$
is exact, see Lemma \ref{lemma-spec-sheaves}.
Similarly in case both $\mathcal{F}_2$ and $\mathcal{F}_3$ are
quasi-coherent. Now, suppose that $\mathcal{F}_1 = \widetilde M_1$ and
$\mathcal{F}_3 = \widetilde M_3$ are quasi-coherent.
Set $M_2 = \Gamma(X, \mathcal{F}_2)$. We claim it suffices to show that
the sequence
$$
0 \to M_1 \to M_2 \to M_3 \to 0
$$
is exact. Namely, if this is the case, then (by using the mapping
property of Lemma \ref{lemma-compare-constructions}) we get a commutative
diagram
$$
\xymatrix{
0 \ar[r] &
\widetilde M_1 \ar[r] \ar[d] &
\widetilde M_2 \ar[r] \ar[d] &
\widetilde M_3 \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\mathcal{F}_1 \ar[r] &
\mathcal{F}_2 \ar[r] &
\mathcal{F}_3 \ar[r] &
0
}
$$
and we win by the snake lemma.

\medskip\noindent
The ``correct'' argument here would be to show first
that $H^1(X, \mathcal{F}) = 0$ for any quasi-coherent sheaf $\mathcal{F}$.
This is actually not all that hard, but it is perhaps better to postpone
this till later. Instead we use a small trick.

\medskip\noindent
Pick $m \in M_3 = \Gamma(X, \mathcal{F}_3)$.
Consider the following set
$$
I = \{ f \in R \mid \text{the element }fm\text{ comes from }M_2\}.
$$
Clearly this is an ideal. It suffices to show $1 \in I$.
Hence it suffices to show that for any prime $\mathfrak p$
there exists an $f \in I$, $f \not\in \mathfrak p$.
Let $x \in X$ be the point corresponding to $\mathfrak p$.
Because surjectivity can be checked on stalks
there exists an open neighbourhood $U$ of $x$ such that
$m|_U$ comes from a local section $s \in \mathcal{F}_2(U)$.
In fact we may assume that $U = D(f)$ is a standard open,
i.e., $f \in R$, $f \not \in \mathfrak p$. We will show
that for some $N \gg 0$ we have $f^N \in I$, which
will finish the proof.

\medskip\noindent
Take any point $z \in V(f)$, say corresponding to the
prime $\mathfrak q \subset R$. We can also find a $g \in R$,
$g \not \in \mathfrak q$ such that $m|_{D(g)}$ lifts
to some $s' \in \mathcal{F}_2(D(g))$.
Consider the difference $s|_{D(fg)} - s'|_{D(fg)}$.
This is an element $m'$ of $\mathcal{F}_1(D(fg)) = (M_1)_{fg}$.
For some integer $n = n(z)$ the element $f^n m'$ comes
from some $m'_1 \in (M_1)_g$. We see that
$f^n s$ extends to a section $\sigma$ of $\mathcal{F}_2$ on $D(f) \cup D(g)$
because it agrees with the restriction of
$f^n s' + m'_1$ on $D(f) \cap D(g) = D(fg)$.
Moreover, $\sigma$ maps to the restriction of $f^n m$
to $D(f) \cup D(g)$.

\medskip\noindent
Since $V(f)$ is quasi-compact, there exists a finite list
of elements $g_1, \ldots, g_m \in R$ such that
$V(f) \subset \bigcup D(g_j)$, an integer $n > 0$ and sections
$\sigma_j \in \mathcal{F}_2(D(f) \cup D(g_j))$ such that
$\sigma_j|_{D(f)} = f^n s$ and $\sigma_j$ maps to the section
$f^nm|_{D(f) \cup D(g_j)}$ of $\mathcal{F}_3$.
Consider the differences
$$
\sigma_j|_{D(f) \cup D(g_jg_k)}
-
\sigma_k|_{D(f) \cup D(g_jg_k)}.
$$
These correspond to sections of $\mathcal{F}_1$
over $D(f) \cup D(g_jg_k)$ which are zero
on $D(f)$. In particular their images in
$\mathcal{F}_1(D(g_jg_k)) = (M_1)_{g_jg_k}$
are zero in $(M_1)_{g_jg_kf}$.
Thus some high power of $f$ kills each and every one of these.
In other words, the elements $f^N \sigma_j$, for some $N \gg 0$
satisfy the glueing condition of the sheaf property and
give rise to a section $\sigma $ of $\mathcal{F}_2$
over $\bigcup (D(f) \cup D(g_j)) = X$ as desired.
\end{proof}







\section{Closed subspaces of affine schemes}
\label{section-closed-in-affine}

\begin{example}
\label{example-closed-immersion-affines}
Let $R$ be a ring.
Let $I \subset R$ be an ideal.
Consider the morphism of affine schemes
$i : Z = \Spec(R/I) \to \Spec(R) = X$.
By Algebra, Lemma \ref{algebra-lemma-spec-closed}
this is a homeomorphism of $Z$ onto a closed
subset of $X$. Moreover, if $I \subset \mathfrak p \subset R$
is a prime corresponding to a point $x = i(z)$, $x \in X$,
$z \in Z$, then on stalks we get the map
$$
\mathcal{O}_{X, x} = R_{\mathfrak p}
\longrightarrow
R_{\mathfrak p}/IR_{\mathfrak p} = \mathcal{O}_{Z, z}
$$
Thus we see that $i$ is a closed immersion of locally ringed spaces,
see Definition \ref{definition-closed-immersion-locally-ringed-spaces}.
Clearly, this is (isomorphic) to the closed subspace associated
to the quasi-coherent sheaf of ideals $\widetilde I$, as in
Example \ref{example-closed-subspace}.
\end{example}

\begin{lemma}
\label{lemma-closed-immersion-affine-case}
\begin{slogan}
For affine schemes, closed immersions correspond to ideals.
\end{slogan}
Let $(X, \mathcal{O}_X) = (\Spec(R), \mathcal{O}_{\Spec(R)})$
be an affine scheme. Let $i : Z \to X$ be any closed immersion
of locally ringed spaces. Then there exists a unique ideal
$I \subset R$ such that the morphism $i : Z \to X$ can be identified
with the closed immersion $\Spec(R/I) \to \Spec(R)$
constructed in Example \ref{example-closed-immersion-affines} above.
\end{lemma}

\begin{proof}
This is kind of silly! Namely, by Lemma \ref{lemma-closed-immersion}
we can identify $Z \to X$ with the closed subspace associated to
a sheaf of ideals $\mathcal{I} \subset \mathcal{O}_X$ as in
Definition \ref{definition-closed-subspace} and
Example \ref{example-closed-subspace}.
By our conventions this sheaf of ideals is locally generated
by sections as a sheaf of $\mathcal{O}_X$-modules.
Hence the quotient sheaf $\mathcal{O}_X / \mathcal{I}$
is locally on $X$ the cokernel
of a map $\bigoplus_{j \in J} \mathcal{O}_U \to \mathcal{O}_U$.
Thus by definition, $\mathcal{O}_X / \mathcal{I}$ is quasi-coherent.
By our results in Section \ref{section-quasi-coherent-affine}
it is of the form $\widetilde S$ for some $R$-module $S$.
Moreover, since $\mathcal{O}_X = \widetilde R \to \widetilde S$
is surjective we see by Lemma \ref{lemma-extension-quasi-coherent}
that also $\mathcal{I}$ is quasi-coherent, say $\mathcal{I} = \widetilde I$.
Of course $I \subset R$ and $S = R/I$ and everything is clear.
\end{proof}













\section{Schemes}
\label{section-schemes}

\begin{definition}
\label{definition-scheme}
\begin{history}
In \cite{EGA1} what we call a scheme was called a ``pre-sch\'ema'' and the
name ``sch\'ema'' was reserved for what is a separated scheme in the
Stacks project. In the second edition \cite{EGA1-second} the terminology
was changed to the terminology that is now standard. However, one may
occasionally encounter the terminology ``prescheme'', for example in
\cite{Murre-lectures}.
\end{history}
A {\it scheme} is a locally ringed space with the property that
every point has an open neighbourhood which is an affine scheme.
A {\it morphism of schemes} is a morphism of locally
ringed spaces. The category of schemes will be denoted
$\Sch$.
\end{definition}

\noindent
Let $X$ be a scheme.
We will use the following (very slight) abuse of language.
We will say $U \subset X$ is an {\it affine open}, or an {\it open affine}
if the open subspace $U$ is an affine scheme. We will often
write $U = \Spec(R)$ to indicate that $U$ is isomorphic
to $\Spec(R)$ and moreover that we will identify (temporarily)
$U$ and $\Spec(R)$.

\begin{lemma}
\label{lemma-open-subspace-scheme}
Let $X$ be a scheme. Let $j : U \to X$ be an open immersion
of locally ringed spaces. Then $U$ is a scheme. In particular,
any open subspace of $X$ is a scheme.
\end{lemma}

\begin{proof}
Let $U \subset X$. Let $u \in U$.
Pick an affine open neighbourhood $u \in V \subset X$.
Because standard opens of $V$ form a basis of the topology
on $V$ we see that there exists a $f\in \mathcal{O}_V(V)$
such that $u \in D(f) \subset U$. And $D(f)$ is an affine scheme
by Lemma \ref{lemma-standard-open-affine}. This proves that every point
of $U$ has an open neighbourhood which is affine.
\end{proof}

\noindent
Clearly the lemma (or its proof) shows that any scheme
$X$ has a basis (see Topology, Section \ref{topology-section-bases})
for the topology consisting of affine opens.

\begin{example}
\label{example-not-affine}
Let $k$ be a field.
An example of a scheme which is not affine is
given by the open subspace
$U = \Spec(k[x, y]) \setminus \{ (x, y)\}$
of the affine scheme $X =\Spec(k[x, y])$.
It is covered by two affines, namely $D(x) = \Spec(k[x, y, 1/x])$
and $D(y) = \Spec(k[x, y, 1/y])$ whose intersection is
$D(xy) = \Spec(k[x, y, 1/xy])$. By the sheaf property
for $\mathcal{O}_U$ there is an exact sequence
$$
0 \to
\Gamma(U, \mathcal{O}_U) \to
k[x, y, 1/x] \times k[x, y, 1/y] \to
k[x, y, 1/xy]
$$
We conclude that the map $k[x, y] \to \Gamma(U, \mathcal{O}_U)$
(coming from the morphism $U \to X$) is an isomorphism.
Therefore $U$ cannot be affine since if it was then by
Lemma \ref{lemma-category-affine-schemes} we would have $U \cong X$.
\end{example}











\section{Immersions of schemes}
\label{section-immersions}

\noindent
In Lemma \ref{lemma-open-subspace-scheme} we saw that any open subspace
of a scheme is a scheme. Below we will prove that the same holds for
a closed subspace of a scheme.

\medskip\noindent
Note that the notion of a quasi-coherent sheaf of $\mathcal{O}_X$-modules
is defined for any ringed space $X$ in particular when $X$ is a scheme.
By our efforts in Section \ref{section-quasi-coherent-affine} we
know that such a sheaf is on any affine open $U \subset X$
of the form $\widetilde M$ for some $\mathcal{O}_X(U)$-module $M$.

\begin{lemma}
\label{lemma-closed-subspace-scheme}
Let $X$ be a scheme. Let $i : Z \to X$ be a closed immersion
of locally ringed spaces.
\begin{enumerate}
\item The locally ringed space $Z$ is a scheme,
\item the kernel $\mathcal{I}$ of the map
$\mathcal{O}_X \to i_*\mathcal{O}_Z$ is a quasi-coherent
sheaf of ideals,
\item for any affine open $U = \Spec(R)$ of $X$
the morphism $i^{-1}(U) \to U$ can be identified with
$\Spec(R/I) \to \Spec(R)$ for some ideal $I \subset R$, and
\item we have $\mathcal{I}|_U = \widetilde I$.
\end{enumerate}
In particular, any sheaf of ideals locally generated by sections
is a quasi-coherent sheaf of ideals (and vice versa),
and any closed subspace of $X$ is a scheme.
\end{lemma}

\begin{proof}
Let $i : Z \to X$ be a closed immersion.
Let $z \in Z$ be a point. Choose any affine open
neighbourhood $i(z) \in U \subset X$. Say $U = \Spec(R)$.
By Lemma \ref{lemma-closed-immersion-affine-case} we know
that $i^{-1}(U) \to U$ can be identified with the morphism
of affine schemes $\Spec(R/I) \to \Spec(R)$.
First of all this implies that $z \in i^{-1}(U) \subset Z$ is an
affine neighbourhood of $z$. Thus $Z$ is a scheme. Second
this implies that $\mathcal{I}|_U$ is $\widetilde I$.
In other words for every point $x \in i(Z)$ there exists an
open neighbourhood such that $\mathcal{I}$ is quasi-coherent in
that neighbourhood. Note that $\mathcal{I}|_{X \setminus i(Z)}
\cong \mathcal{O}_{X \setminus i(Z)}$. Thus the restriction
of the sheaf of ideals is quasi-coherent on $X \setminus i(Z)$
also. We conclude that $\mathcal{I}$ is quasi-coherent.
\end{proof}

\begin{definition}
\label{definition-immersion}
Let $X$ be a scheme.
\begin{enumerate}
\item A morphism of schemes is called an {\it open immersion}
if it is an open immersion of locally ringed spaces (see
Definition \ref{definition-immersion-locally-ringed-spaces}).
\item An {\it open subscheme} of $X$ is an open subspace of $X$
in the sense of Definition \ref{definition-open-subspace}; an open subscheme
of $X$ is a scheme by Lemma \ref{lemma-open-subspace-scheme}.
\item A morphism of schemes is called a {\it closed immersion}
if it is a closed immersion of locally ringed spaces (see
Definition \ref{definition-closed-immersion-locally-ringed-spaces}).
\item A {\it closed subscheme} of $X$ is a closed subspace of $X$
in the sense of Definition \ref{definition-closed-subspace}; a closed subscheme
is a scheme by Lemma \ref{lemma-closed-subspace-scheme}.
\item A morphism of schemes $f : X \to Y$ is called an {\it immersion},
or a {\it locally closed immersion} if it can be factored as
$j \circ i$ where $i$ is a closed immersion and $j$ is an open
immersion.
\end{enumerate}
\end{definition}

\noindent
It follows from the lemmas in Sections \ref{section-open-immersion} and
\ref{section-closed-immersion} that any open (resp.\ closed) immersion of
schemes is isomorphic to the inclusion of an open (resp.\ closed) subscheme
of the target.

\medskip\noindent
Our definition of a closed immersion is halfway between Hartshorne
and EGA. Hartshorne defines a closed immersion as a morphism $f : X \to Y$ of
schemes which induces a homeomorphism of $X$ onto a closed subset of
$Y$ such that $f^\# : \mathcal{O}_Y \to f_*\mathcal{O}_X$ is surjective, see
\cite[Page 85]{H}. We will show this is equivalent to our notion in
Lemma \ref{lemma-characterize-closed-immersions}. In \cite{EGA},
Grothendieck and Dieudonn\'e first define closed subschemes
via the construction of Example \ref{example-closed-subspace}
using quasi-coherent sheaves of ideals and then define a closed immersion
as a morphism $f : X \to Y$ which induces an isomorphism with a
closed subscheme. It follows from Lemma \ref{lemma-closed-subspace-scheme}
that this agrees with our notion.

\medskip\noindent
Pedagogically speaking the definition above is a disaster/nightmare.
In teaching this material to students, we have found it often
convenient to define a closed immersion as an affine morphism
$f : X \to Y$ of schemes such that $f^\# : \mathcal{O}_Y \to f_*\mathcal{O}_X$
is surjective. Namely, it turns out that the notion of an affine
morphism (Morphisms, Section \ref{morphisms-section-affine})
is quite natural and easy to understand.

\medskip\noindent
For more information on closed immersions we suggest the reader visit
Morphisms, Sections \ref{morphisms-section-closed-immersions} and
\ref{morphisms-section-closed-immersions-quasi-coherent}.

\medskip\noindent
We will discuss locally closed subschemes and immersions
at the end of this section.

\begin{remark}
\label{remark-not-reverse-open-closed}
If $f : X \to Y$ is an immersion of schemes, then it is in general
not possible to factor $f$ as an open immersion followed
by a closed immersion. See Morphisms, Example \ref{morphisms-example-thibaut}.
\end{remark}

\begin{lemma}
\label{lemma-immersion-when-closed}
Let $f : Y \to X$ be an immersion of schemes. Then $f$ is a closed
immersion if and only if $f(Y) \subset X$ is a closed subset.
\end{lemma}

\begin{proof}
If $f$ is a closed immersion then $f(Y)$ is closed by definition.
Conversely, suppose that $f(Y)$ is closed. By definition
there exists an open subscheme $U \subset X$ such that $f$ is the composition
of a closed immersion $i : Y \to U$ and the open immersion
$j : U \to X$. Let $\mathcal{I} \subset \mathcal{O}_U$ be the
quasi-coherent sheaf of ideals associated to the closed immersion
$i$. Note that
$\mathcal{I}|_{U \setminus i(Y)}
= \mathcal{O}_{U \setminus i(Y)}
= \mathcal{O}_{X \setminus i(Y)}|_{U \setminus i(Y)}$.
Thus we may glue (see Sheaves, Section \ref{sheaves-section-glueing-sheaves})
$\mathcal{I}$ and $\mathcal{O}_{X \setminus i(Y)}$ to a sheaf of
ideals $\mathcal{J} \subset \mathcal{O}_X$. Since every
point of $X$ has a neighbourhood where $\mathcal{J}$ is
quasi-coherent, we see that $\mathcal{J}$ is quasi-coherent
(in particular locally generated by sections).
By construction $\mathcal{O}_X/\mathcal{J}$ is supported
on $U$ and, restricted there, equal to $\mathcal{O}_U/\mathcal{I}$.
Thus we see that the closed subspaces associated to $\mathcal{I}$
and $\mathcal{J}$ are canonically isomorphic, see
Example \ref{example-closed-subspace}.
In particular the closed subspace of $U$ associated to $\mathcal{I}$
is isomorphic to a closed subspace of $X$.
Since $Y \to U$ is identified with the closed subspace
associated to $\mathcal{I}$, see Lemma \ref{lemma-closed-immersion},
we conclude that $Y \to U \to X$
is a closed immersion.
\end{proof}

\noindent
Let $f : Y \to X$ be an immersion.
Let $Z = \overline{f(Y)} \setminus f(Y)$ which is a closed subset of $X$.
Let $U = X \setminus Z$.
The lemma implies that $U$ is the biggest open subspace of $X$
such that $f : Y \to X$ factors through a closed immersion into $U$.
We define a {\it locally closed subscheme of $X$} as a pair
$(Z, U)$ consisting of a closed subscheme $Z$ of an open subscheme $U$
of $X$ such that in addition $\overline{Z} \cup U = X$. We usually
just say ``let $Z$ be a locally closed subscheme of $X$'' since we may
recover $U$ from the morphism $Z \to X$. The above
then shows that any immersion $f : Y \to X$ factors uniquely
as $Y \to Z \to X$ where $Z$ is a locally closed subspace of $X$
and $Y \to Z$ is an isomorphism.

\medskip\noindent
The interest of this is that the collection of locally closed subschemes
of $X$ forms a set. We may define a partial ordering on this set,
which we call inclusion for obvious reasons. To be explicit, if
$Z \to X$ and $Z' \to X$ are two locally closed subschemes of $X$, then
we say that {\it $Z$ is contained in $Z'$} simply if the morphism
$Z \to X$ factors through $Z'$. If it does, then of course $Z$ is identified
with a unique locally closed subscheme of $Z'$, and so on.

\medskip\noindent
For more information on immersions, we refer the reader to
Morphisms, Section \ref{morphisms-section-immersions}.










\section{Base change in algebraic geometry}
\label{section-base-change}

\noindent
One motivation for the introduction of the language of schemes
is that it gives a very precise notion of what it means to
define a variety over a particular field. For example a variety
$X$ over $\mathbf{Q}$ is synonymous
(Varieties, Definition \ref{varieties-definition-variety})
with $X \to \Spec(\mathbf{Q})$ which is of finite type,
separated, irreducible and reduced\footnote{Of course algebraic
geometers still quibble over whether one should require $X$ to be
geometrically irreducible over $\mathbf{Q}$.}. In any case, the idea
is more generally to work with schemes over a given {\it base scheme},
often denoted $S$. We use the language: ``let $X$ be a scheme over $S$''
to mean simply that $X$ comes equipped with a morphism $X \to S$.
In diagrams we will try to picture the {\it structure morphism}
$X \to S$ as a downward arrow from $X$ to $S$.
We are often more interested in the properties of $X$ relative
to $S$ rather than the internal geometry of $X$.
For example, we would like to know things about the fibres of $X \to S$,
what happens to $X$ after base change, and so on.

\medskip\noindent
We introduce some of the language that is customarily used.
Of course this language is just a special case of thinking
about the category of objects over a given object in a category,
see Categories, Example \ref{categories-example-category-over-X}.

\begin{definition}
\label{definition-base-change}
Let $S$ be a scheme.
\begin{enumerate}
\item We say $X$ is a {\it scheme over $S$} to mean that $X$
comes equipped with a morphism of schemes $X \to S$.
The morphism $X \to S$ is sometimes called the
{\it structure morphism}.
\item If $R$ is a ring we say
$X$ is a {\it scheme over $R$} instead of
$X$ is a scheme over $\Spec(R)$.
\item A {\it morphism $f : X \to Y$ of schemes over $S$}
is a morphism of schemes such that the composition
$X \to Y \to S$ of $f$ with the structure morphism of $Y$ is
equal to the structure morphism of $X$.
\item We denote $\Mor_S(X, Y)$ the set of all morphisms
from $X$ to $Y$ over $S$.
\item Let $X$ be a scheme over $S$. Let $S' \to S$ be a
morphism of schemes. The {\it base change} of $X$
is the scheme $X_{S'} = S' \times_S X$ over $S'$.
\item Let $f : X \to Y$ be a morphism of schemes over $S$. Let $S' \to S$
be a morphism of schemes. The {\it base change} of $f$ is
the induced morphism $f' : X_{S'} \to Y_{S'}$ (namely the
morphism $\text{id}_{S'} \times_{\text{id}_S} f$).
\item Let $R$ be a ring. Let $X$ be a scheme over $R$.
Let $R \to R'$ be a ring map. The {\it base change} $X_{R'}$
is the scheme $\Spec(R') \times_{\Spec(R)} X$
over $R'$.
\end{enumerate}
\end{definition}

\noindent
Here is a typical result.

\begin{lemma}
\label{lemma-base-change-immersion}
Let $S$ be a scheme. Let $f : X \to Y$ be an
immersion (resp.\ closed immersion, resp. open immersion)
of schemes over $S$. Then any base change of $f$ is an
immersion (resp.\ closed immersion, resp. open immersion).
\end{lemma}

\begin{proof}
We can think of the base change of $f$ via the morphism
$S' \to S$ as the top left vertical arrow in the following
commutative diagram:
$$
\xymatrix{
X_{S'} \ar[r] \ar[d] & X \ar[d] \ar@/^4ex/[dd] \\
Y_{S'} \ar[r] \ar[d] & Y \ar[d] \\
S' \ar[r] & S
}
$$
The diagram implies $X_{S'} \cong Y_{S'} \times_Y X$,
and the lemma follows from Lemma \ref{lemma-fibre-product-immersion}.
\end{proof}

\noindent
In fact this type of result is so typical that there is a
piece of language to express it. Here it is.

\begin{definition}
\label{definition-preserved-by-base-change}
Properties and base change.
\begin{enumerate}
\item Let $\mathcal{P}$ be a property of schemes over a base.
We say that $\mathcal{P}$ is {\it preserved under arbitrary base change},
or simply that $\mathcal{P}$ is {\it preserved under base change}
if whenever $X/S$
has $\mathcal{P}$, any base change $X_{S'}/S'$ has $\mathcal{P}$.
\item Let $\mathcal{P}$ be a property of morphisms of schemes over a base.
We say that $\mathcal{P}$ is {\it preserved under arbitrary base change},
or simply that {\it preserved under base change} if whenever
$f : X \to Y$ over $S$ has $\mathcal{P}$, any base change
$f' : X_{S'} \to Y_{S'}$ over $S'$ has $\mathcal{P}$.
\end{enumerate}
\end{definition}

\noindent
At this point we can say that ``being a closed immersion'' is
preserved under arbitrary base change.

\begin{definition}
\label{definition-fibre}
Let $f : X \to S$ be a morphism of schemes.
Let $s \in S$ be a point.
The {\it scheme theoretic fibre $X_s$ of $f$ over $s$},
or simply the {\it fibre of $f$ over $s$},
is the scheme fitting in the following fibre product diagram
$$
\xymatrix{
X_s = \Spec(\kappa(s)) \times_S X \ar[r] \ar[d] &
X \ar[d] \\
\Spec(\kappa(s)) \ar[r] &
S
}
$$
We think of the fibre $X_s$ always as a scheme over $\kappa(s)$.
\end{definition}

\begin{lemma}
\label{lemma-fibre-topological}
Let $f : X \to S$ be a morphism of schemes.
Consider the diagrams
$$
\xymatrix{
X_s \ar[r] \ar[d] &
X \ar[d] &
\Spec(\mathcal{O}_{S, s}) \times_S X \ar[r] \ar[d] &
X \ar[d]
\\
\Spec(\kappa(s)) \ar[r] &
S &
\Spec(\mathcal{O}_{S, s}) \ar[r] &
S
}
$$
In both cases the top horizontal arrow is a homeomorphism
onto its image.
\end{lemma}

\begin{proof}
Choose an open affine $U \subset S$ that contains $s$.
The bottom horizontal morphisms factor through $U$, see
Lemma \ref{lemma-morphism-from-spec-local-ring} for example.
Thus we may assume that $S$ is affine. If $X$ is also affine, then
the result follows from
Algebra, Remark \ref{algebra-remark-fundamental-diagram}.
In the general case the result follows by covering $X$ by open affines.
\end{proof}








\section{Proj of a graded ring}
\label{section-proj}

\medskip\noindent
This section may be taken as the preamble to
the question: what is projective space anyway?
Yes, projective space is Proj of a graded ring $S$.
And yes, projective space is a scheme.
So in particular it's locally affine.

\noindent
In this section we construct Proj of a graded ring
following \cite[II, Section 2]{EGA}.

\medskip\noindent
Let $S$ be a graded ring. Consider the topological space $\text{Proj}(S)$
associated to $S$, see Algebra, Section \ref{algebra-section-proj}.
We will endow this space with a sheaf of rings $\mathcal{O}_{\text{Proj}(S)}$
such that the resulting pair $(\text{Proj}(S), \mathcal{O}_{\text{Proj}(S)})$
will be a scheme.

\medskip\noindent
Recall that $\text{Proj}(S)$ has a basis of open sets $D_{+}(f)$,
$f \in S_d$, $d \geq 1$ which we call {\it standard opens}, see Algebra,
Section \ref{algebra-section-proj}. This terminology will always
imply that $f$ is homogeneous of positive degree even if we forget to
mention it. In addition, the intersection of two standard opens is another:
$D_{+}(f) \cap D_{+}(g) = D_{+}(fg)$, for $f, g \in S$ homogeneous of positive
degree.

\begin{lemma}
\label{lemma-standard-open}
Let $S$ be a graded ring. Let $f \in S$ homogeneous of positive degree.
\begin{enumerate}
\item If $g\in S$ homogeneous of positive degree
and $D_{+}(g) \subset D_{+}(f)$, then
\begin{enumerate}
\item $f$ is invertible in $S_g$, and
$f^{\deg(g)}/g^{\deg(f)}$ is invertible in $S_{(g)}$,
\item $g^e = af$ for some $e \geq 1$ and $a \in S$ homogeneous,
\item there is a canonical $S$-algebra map $S_f \to S_g$,
\item there is a canonical $S_0$-algebra map $S_{(f)} \to S_{(g)}$
compatible with the map $S_f \to S_g$,
\item the map $S_{(f)} \to S_{(g)}$ induces an isomorphism
$$
(S_{(f)})_{g^{\deg(f)}/f^{\deg(g)}} \cong S_{(g)},
$$
\item these maps induce a commutative diagram of
topological spaces
$$
\xymatrix{
D_{+}(g) \ar[d] &
\{\mathbf{Z}\text{-graded primes of }S_g\} \ar[l] \ar[r] \ar[d] &
\Spec(S_{(g)}) \ar[d] \\
D_{+}(f) &
\{\mathbf{Z}\text{-graded primes of }S_f\} \ar[l] \ar[r] &
\Spec(S_{(f)})
}
$$
where the horizontal maps are homeomorphisms and the vertical maps
are open immersions,
\item there are compatible canonical $S_f$ and $S_{(f)}$-module
maps $M_f \to M_g$ and $M_{(f)} \to M_{(g)}$ for any graded $S$-module $M$,
and
\item the map $M_{(f)} \to M_{(g)}$ induces an isomorphism
$$
(M_{(f)})_{g^{\deg(f)}/f^{\deg(g)}} \cong M_{(g)}.
$$
\end{enumerate}
\item Any open covering of $D_{+}(f)$ can be refined to a finite
open covering of the form $D_{+}(f) = \bigcup_{i = 1}^n D_{+}(g_i)$.
\item Let $g_1, \ldots, g_n \in S$ be homogeneous of positive degree.
Then $D_{+}(f) \subset \bigcup D_{+}(g_i)$
if and only if
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$
generate the unit ideal in $S_{(f)}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $D_{+}(g) = \Spec(S_{(g)})$ with identification
given by the ring maps $S \to S_g \leftarrow S_{(g)}$, see
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
Thus $f^{\deg(g)}/g^{\deg(f)}$ is an element of $S_{(g)}$ which is not
contained in any prime ideal, and hence invertible,
see Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
We conclude that (a) holds.
Write the inverse of $f$ in $S_g$ as $a/g^d$.
We may replace $a$ by its homogeneous part of degree $d\deg(g) - \deg(f)$.
This means $g^d - af$ is annihilated by a power of $g$, whence
$g^e = af$ for some $a \in S$ homogeneous of degree $e\deg(g) - \deg(f)$.
This proves (b).
For (c), the map $S_f \to S_g$ exists by (a) from the universal property
of localization, or we can define it by mapping $b/f^n$
to $a^nb/g^{ne}$. This clearly induces a map of the subrings
$S_{(f)} \to S_{(g)}$ of degree zero elements as well.
We can similarly define $M_f \to M_g$ and $M_{(f)} \to M_{(g)}$ by mapping
$x/f^n$ to $a^nx/g^{ne}$. The statements writing $S_{(g)}$
resp.\ $M_{(g)}$ as principal localizations of $S_{(f)}$ resp.\ $M_{(f)}$
are clear from the formulas above. The maps in the commutative diagram
of topological spaces correspond to the ring maps given above. The
horizontal arrows are homeomorphisms by
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
The vertical arrows are open immersions since the left
one is the inclusion of an open subset.

\medskip\noindent
The open $D_{+}(f)$ is quasi-compact because it is homeomorphic
to $\Spec(S_{(f)})$, see  Algebra, Lemma \ref{algebra-lemma-quasi-compact}.
Hence the second statement follows directly
from the fact that the standard opens form
a basis for the topology.

\medskip\noindent
The third statement follows directly from
Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
\end{proof}

\noindent
In Sheaves, Section \ref{sheaves-section-bases} we defined
the notion of a sheaf on a basis, and we showed that it is
essentially equivalent to the notion of a sheaf on the space,
see Sheaves, Lemmas \ref{sheaves-lemma-extend-off-basis} and
\ref{sheaves-lemma-extend-off-basis-structures}. Moreover,
we showed in
Sheaves, Lemma \ref{sheaves-lemma-cofinal-systems-coverings-standard-case}
that it is sufficient to check the sheaf
condition on a cofinal system of open coverings for each
standard open. By the lemma above it suffices to check
on the finite coverings by standard opens.

\begin{definition}
\label{definition-standard-covering}
Let $S$ be a graded ring.
Suppose that $D_{+}(f) \subset \text{Proj}(S)$ is a standard
open. A {\it standard open covering} of $D_{+}(f)$
is a covering $D_{+}(f) = \bigcup_{i = 1}^n D_{+}(g_i)$,
where $g_1, \ldots, g_n \in S$ are homogeneous of positive degree.
\end{definition}

\noindent
Let $S$ be a graded ring. Let $M$ be a graded $S$-module. We will define
a presheaf $\widetilde M$ on the basis of standard opens.
Suppose that $U \subset \text{Proj}(S)$ is a standard open.
If $f, g \in S$ are homogeneous of positive degree
such that $D_{+}(f) = D_{+}(g)$, then
by Lemma \ref{lemma-standard-open} above there are canonical
maps $M_{(f)} \to M_{(g)}$ and $M_{(g)} \to M_{(f)}$ which are
mutually inverse. Hence we may choose any $f$ such that $U = D_{+}(f)$
and define
$$
\widetilde M(U) = M_{(f)}.
$$
Note that if $D_{+}(g) \subset D_{+}(f)$, then by
Lemma \ref{lemma-standard-open} above we have
a canonical map
$$
\widetilde M(D_{+}(f)) = M_{(f)} \longrightarrow
M_{(g)} = \widetilde M(D_{+}(g)).
$$
Clearly, this defines a presheaf of abelian groups on the basis
of standard opens. If $M = S$, then $\widetilde S$ is a presheaf
of rings on the basis of standard opens. And for general $M$ we
see that $\widetilde M$ is a presheaf of $\widetilde S$-modules
on the basis of standard opens.

\medskip\noindent
Let us compute the stalk of $\widetilde M$ at a point
$x \in \text{Proj}(S)$.
Suppose that $x$ corresponds to the homogeneous prime
ideal $\mathfrak p \subset S$.
By definition of the stalk we see that
$$
\widetilde M_x
=
\colim_{f\in S_d, d > 0, f\not\in \mathfrak p} M_{(f)}
$$
Here the set $\{f \in S_d, d > 0, f \not \in \mathfrak p\}$ is preordered by
the rule $f \geq f' \Leftrightarrow D_{+}(f) \subset D_{+}(f')$.
If $f_1, f_2 \in S \setminus \mathfrak p$ are homogeneous of positive
degree, then we have
$f_1f_2 \geq f_1$ in this ordering. In
Algebra, Section \ref{algebra-section-proj}
we defined $M_{(\mathfrak p)}$ as the module whose elements are fractions
$x/f$ with $x, f$ homogeneous, $\deg(x) = \deg(f)$, $f \not \in \mathfrak p$.
Since $\mathfrak p \in \text{Proj}(S)$ there exists at least
one $f_0 \in S$ homogeneous of positive degree with $f_0 \not\in \mathfrak p$.
Hence $x/f = f_0x/ff_0$ and we see that we may always assume
the denominator of an element in $M_{(\mathfrak p)}$ has positive degree.
From these remarks it follows easily that
$$
\widetilde M_x = M_{(\mathfrak p)}.
$$

\medskip\noindent
Next, we check the sheaf condition for the standard open coverings.
If $D_{+}(f) = \bigcup_{i = 1}^n D_{+}(g_i)$, then the sheaf condition
for this covering is equivalent with the exactness of the
sequence
$$
0 \to M_{(f)} \to \bigoplus M_{(g_i)} \to \bigoplus M_{(g_ig_j)}.
$$
Note that $D_{+}(g_i) = D_{+}(fg_i)$, and hence we can rewrite this
sequence as the sequence
$$
0 \to M_{(f)} \to \bigoplus M_{(fg_i)} \to \bigoplus M_{(fg_ig_j)}.
$$
By Lemma \ref{lemma-standard-open} we see that
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$
generate the unit ideal in $S_{(f)}$, and that the modules
$M_{(fg_i)}$, $M_{(fg_ig_j)}$ are the principal localizations
of the $S_{(f)}$-module $M_{(f)}$ at these elements and their products.
Thus we may apply Algebra, Lemma \ref{algebra-lemma-cover-module}
to the module $M_{(f)}$ over $S_{(f)}$ and the elements
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$.
We conclude that the sequence is exact. By the remarks
made above, we see that $\widetilde M$ is a sheaf
on the basis of standard opens.

\medskip\noindent
Thus we conclude from the material in
Sheaves, Section \ref{sheaves-section-bases}
that there exists a
unique sheaf of rings $\mathcal{O}_{\text{Proj}(S)}$
which agrees with $\widetilde S$ on the standard opens.
Note that by our computation of stalks above and
Algebra, Lemma \ref{algebra-lemma-proj-prime} the
stalks of this sheaf of rings are all local rings.

\medskip\noindent
Similarly, for any graded $S$-module $M$ there exists
a unique sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
$\mathcal{F}$ which agrees with $\widetilde M$ on the
standard opens, see
Sheaves, Lemma \ref{sheaves-lemma-extend-off-basis-module}.

\begin{definition}
\label{definition-structure-sheaf}
Let $S$ be a graded ring.
\begin{enumerate}
\item The {\it structure sheaf $\mathcal{O}_{\text{Proj}(S)}$ of the
homogeneous spectrum of $S$} is the unique sheaf of rings
$\mathcal{O}_{\text{Proj}(S)}$
which agrees with $\widetilde S$ on the basis of standard opens.
\item The locally ringed space
$(\text{Proj}(S), \mathcal{O}_{\text{Proj}(S)})$ is called
the {\it homogeneous spectrum} of $S$ and denoted $\text{Proj}(S)$.
\item The sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
extending $\widetilde M$ to all opens of $\text{Proj}(S)$
is called the sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
associated to $M$. This sheaf is denoted $\widetilde M$ as
well.
\end{enumerate}
\end{definition}

\noindent
We summarize the results obtained so far.

\begin{lemma}
\label{lemma-proj-sheaves}
Let $S$ be a graded ring. Let $M$ be a graded $S$-module.
Let $\widetilde M$ be the sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
associated to $M$.
\begin{enumerate}
\item For every $f \in S$ homogeneous of positive degree we have
$$
\Gamma(D_{+}(f), \mathcal{O}_{\text{Proj}(S)}) = S_{(f)}.
$$
\item For every $f\in S$ homogeneous of positive degree
we have $\Gamma(D_{+}(f), \widetilde M) = M_{(f)}$
as an $S_{(f)}$-module.
\item Whenever $D_{+}(g) \subset D_{+}(f)$ the restriction mappings
on $\mathcal{O}_{\text{Proj}(S)}$ and $\widetilde M$
are the maps
$S_{(f)} \to S_{(g)}$ and $M_{(f)} \to M_{(g)}$ from Lemma
\ref{lemma-standard-open}.
\item Let $\mathfrak p$ be a homogeneous prime of $S$ not containing
$S_{+}$, and let $x \in \text{Proj}(S)$
be the corresponding point. We have
$\mathcal{O}_{\text{Proj}(S), x} = S_{(\mathfrak p)}$.
\item Let $\mathfrak p$ be a homogeneous prime of $S$ not containing
$S_{+}$, and let $x \in \text{Proj}(S)$
be the corresponding point. We have $\mathcal{F}_x = M_{(\mathfrak p)}$
as an $S_{(\mathfrak p)}$-module.
\item
\label{item-map}
There is a canonical ring map
$
S_0 \longrightarrow \Gamma(\text{Proj}(S), \widetilde S)
$
and a canonical $S_0$-module map
$
M_0 \longrightarrow \Gamma(\text{Proj}(S), \widetilde M)
$
compatible with the descriptions of sections over standard opens
and stalks above.
\end{enumerate}
Moreover, all these identifications are functorial in the graded
$S$-module $M$. In particular, the functor $M \mapsto \widetilde M$
is an exact functor from the category of graded $S$-modules
to the category of $\mathcal{O}_{\text{Proj}(S)}$-modules.
\end{lemma}

\begin{proof}
Assertions (1) - (5) are clear from the discussion above.
We see (6) since there are canonical maps $M_0 \to M_{(f)}$,
$x \mapsto x/1$ compatible with the restriction maps
described in (3). The exactness of the functor $M \mapsto \widetilde M$
follows from the fact that the functor $M \mapsto M_{(\mathfrak p)}$
is exact (see Algebra, Lemma \ref{algebra-lemma-proj-prime})
and the fact that exactness of short exact sequences
may be checked on stalks, see
Modules, Lemma \ref{modules-lemma-abelian}.
\end{proof}

\begin{remark}
\label{remark-global-sections-not-isomorphism}
The map from $M_0$ to the global sections of $\widetilde M$
is generally far from being an isomorphism. A trivial
example is to take $S = k[x, y, z]$ with $1 = \deg(x) = \deg(y) = \deg(z)$
(or any number of variables) and to take $M = S/(x^{100}, y^{100}, z^{100})$.
It is easy to see that $\widetilde M = 0$, but $M_0 = k$.
\end{remark}

\begin{lemma}
\label{lemma-standard-open-proj}
Let $S$ be a graded ring. Let $f \in S$ be homogeneous of positive degree.
Suppose that $D(g) \subset \Spec(S_{(f)})$ is a standard open.
Then there exists an $h \in S$ homogeneous of positive degree such that
$D(g)$ corresponds to $D_{+}(h) \subset D_{+}(f)$ via the homeomorphism
of Algebra, Lemma \ref{algebra-lemma-topology-proj}. In fact we can
take $h$ such that $g = h/f^n$ for some $n$.
\end{lemma}

\begin{proof}
Write $g = h/f^n$ for some $h$ homogeneous of positive degree
and some $n \geq 1$. If $D_{+}(h)$ is not contained in
$D_{+}(f)$ then we replace $h$ by $hf$ and $n$ by $n + 1$.
Then $h$ has the required shape and $D_{+}(h) \subset D_{+}(f)$
corresponds to $D(g) \subset \Spec(S_{(f)})$.
\end{proof}

\begin{lemma}
\label{lemma-proj-scheme}
Let $S$ be a graded ring.
The locally ringed space $\text{Proj}(S)$ is a scheme.
The standard opens $D_{+}(f)$ are affine opens.
For any graded $S$-module $M$ the sheaf
$\widetilde M$ is a quasi-coherent sheaf of
$\mathcal{O}_{\text{Proj}(S)}$-modules.
\end{lemma}

\begin{proof}
Consider a standard open $D_{+}(f) \subset \text{Proj}(S)$.
By Lemmas \ref{lemma-standard-open} and \ref{lemma-proj-sheaves}
we have $\Gamma(D_{+}(f), \mathcal{O}_{\text{Proj}(S)}) = S_{(f)}$, and
we have a homeomorphism $\varphi : D_{+}(f) \to \Spec(S_{(f)})$.
For any standard open $D(g) \subset \Spec(S_{(f)})$ we may
pick an $h \in S_{+}$ as in Lemma \ref{lemma-standard-open-proj}.
Then $\varphi^{-1}(D(g)) = D_{+}(h)$, and by
Lemmas \ref{lemma-proj-sheaves} and \ref{lemma-standard-open} we see
$$
\Gamma(D_{+}(h), \mathcal{O}_{\text{Proj}(S)})
=
S_{(h)}
=
(S_{(f)})_{h^{\deg(f)}/f^{\deg(h)}}
=
(S_{(f)})_g
=
\Gamma(D(g), \mathcal{O}_{\Spec(S_{(f)})}).
$$
Thus the restriction of $\mathcal{O}_{\text{Proj}(S)}$ to
$D_{+}(f)$ corresponds via the homeomorphism $\varphi$
exactly to the sheaf $\mathcal{O}_{\Spec(S_{(f)})}$
as defined in Schemes, Section \ref{schemes-section-affine-schemes}.
We conclude that $D_{+}(f)$ is an affine scheme isomorphic to
$\Spec(S_{(f)})$ via $\varphi$ and
hence that $\text{Proj}(S)$ is a scheme.

\medskip\noindent
In exactly the same way we show that $\widetilde M$ is a
quasi-coherent sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules.
Namely, the argument above will show that
$$
\widetilde M|_{D_{+}(f)} \cong \varphi^*\left(\widetilde{M_{(f)}}\right)
$$
which shows that $\widetilde M$ is quasi-coherent.
\end{proof}

\begin{lemma}
\label{lemma-proj-separated}
Let $S$ be a graded ring.
The scheme $\text{Proj}(S)$ is separated.
\end{lemma}

\begin{proof}
We have to show that the canonical morphism
$\text{Proj}(S) \to \Spec(\mathbf{Z})$
is separated.
We will use Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
Thus it suffices to show given any pair of standard opens
$D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \cap D_{+}(g) = D_{+}(fg)$
is affine (clear) and that the ring map
$$
S_{(f)} \otimes_{\mathbf{Z}} S_{(g)} \longrightarrow S_{(fg)}
$$
is surjective. Any element $s$ in $S_{(fg)}$ is of
the form $s = h/(f^ng^m)$ with $h \in S$ homogeneous of degree
$n\deg(f) + m\deg(g)$. We may multiply $h$ by a suitable
monomial $f^ig^j$ and assume that $n = n' \deg(g)$, and
$m = m' \deg(f)$. Then we can rewrite $s$ as
$s = h/f^{(n' + m')\deg(g)} \cdot f^{m'\deg(g)}/g^{m'\deg(f)}$.
So $s$ is indeed in the image of the displayed arrow.
\end{proof}

\begin{lemma}
\label{lemma-proj-quasi-compact}
Let $S$ be a graded ring.
The scheme $\text{Proj}(S)$ is quasi-compact if and only
if there exist finitely many homogeneous elements
$f_1, \ldots, f_n \in S_{+}$ such that
$S_{+} \subset \sqrt{(f_1, \ldots, f_n)}$. In this case
$\text{Proj}(S) = D_+(f_1) \cup \ldots \cup D_+(f_n)$.
\end{lemma}

\begin{proof}
Given such a collection of elements the standard affine opens
$D_{+}(f_i)$ cover $\text{Proj}(S)$ by
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
Conversely, if $\text{Proj}(S)$ is quasi-compact, then we
may cover it by finitely many standard opens
$D_{+}(f_i)$, $i = 1, \ldots, n$ and we see that
$S_{+} \subset \sqrt{(f_1, \ldots, f_n)}$ by the
lemma referenced above.
\end{proof}

\begin{lemma}
\label{lemma-structure-morphism-proj}
Let $S$ be a graded ring. The scheme $\text{Proj}(S)$ has a canonical morphism
towards the affine scheme $\Spec(S_0)$, agreeing with the map on
topological spaces coming from
Algebra, Definition \ref{algebra-definition-proj}.
\end{lemma}

\begin{proof}
We saw above that our construction of $\widetilde S$,
resp.\ $\widetilde M$ gives a sheaf of $S_0$-algebras, resp.\ $S_0$-modules.
Hence we get a morphism by
Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.
This morphism, when restricted to $D_{+}(f)$ comes from the
canonical ring map $S_0 \to S_{(f)}$. The maps
$S \to S_f$, $S_{(f)} \to S_f$ are $S_0$-algebra maps, see
Lemma \ref{lemma-standard-open}.
Hence if the homogeneous prime $\mathfrak p \subset S$
corresponds to the $\mathbf{Z}$-graded prime $\mathfrak p' \subset S_f$
and the (usual) prime $\mathfrak p'' \subset S_{(f)}$, then
each of these has the same inverse image in $S_0$.
\end{proof}

\begin{lemma}
\label{lemma-proj-valuative-criterion}
Let $S$ be a graded ring. If $S$ is finitely generated as
an algebra over $S_0$, then
the morphism $\text{Proj}(S) \to \Spec(S_0)$ satisfies
the existence and uniqueness parts of the valuative criterion,
see Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{lemma}

\begin{proof}
The uniqueness part follows from the fact that $\text{Proj}(S)$ is
separated (Lemma \ref{lemma-proj-separated} and
Schemes, Lemma \ref{schemes-lemma-separated-implies-valuative}).
Choose $x_i \in S_{+}$ homogeneous, $i = 1, \ldots, n$
which generate $S$ over $S_0$. Let $d_i = \deg(x_i)$ and
set $d = \text{lcm}\{d_i\}$. Suppose we are given a diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & \text{Proj}(S) \ar[d] \\
\Spec(A) \ar[r] & \Spec(S_0)
}
$$
as in Schemes, Definition \ref{schemes-definition-valuative-criterion}.
Denote $v : K^* \to \Gamma$ the valuation of $A$, see
Algebra, Definition \ref{algebra-definition-value-group}.
We may choose an $f \in S_{+}$ homogeneous such that
$\Spec(K)$ maps into $D_{+}(f)$. Then we get a commutative
diagram of ring maps
$$
\xymatrix{
K & S_{(f)} \ar[l]^{\varphi} \\
A \ar[u] & S_0 \ar[l] \ar[u]
}
$$
After renumbering we may assume that $\varphi(x_i^{\deg(f)}/f^{d_i})$
is nonzero for $i = 1, \ldots, r$ and zero for $i = r + 1, \ldots, n$.
Since the open sets $D_{+}(x_i)$ cover $\text{Proj}(S)$ we see that $r \geq 1$.
Let $i_0 \in \{1, \ldots, r\}$ be an index minimizing
$\gamma_i = (d/d_i)v(\varphi(x_i^{\deg(f)}/f^{d_i}))$ in $\Gamma$.
For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$.
The ring map $\varphi$ factors though a map $\varphi' : S_{(fx_0)} \to K$
which gives a ring map $S_{(x_0)} \to S_{(fx_0)} \to K$.
The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements
$x_1^{e_1} \ldots x_n^{e_n}/x_0^{e_0}$, where $\sum e_i d_i = e_0 d_0$.
If $e_i > 0$ for some $i > r$, then
$\varphi'(x_1^{e_1} \ldots x_n^{e_n}/x_0^{e_0}) = 0$.
If $e_i = 0$ for $i > r$, then we have
\begin{align*}
d \deg(f) v(\varphi'(x_1^{e_1} \ldots x_r^{e_r}/x_0^{e_0}))
& =
d v(\varphi'(x_1^{e_1 \deg(f)} \ldots x_r^{e_r \deg(f)}/x_0^{e_0 \deg(f)})) \\
& =
d \sum e_i v(\varphi'(x_i^{\deg(f)}/f^{d_i}))
- e_0 v(\varphi'(x_0^{\deg(f)}/f^{d_0})) \\
& =
\sum e_i d_i \gamma_i - e_0 d_0 \gamma_0 \\
& \geq
\sum e_i d_i \gamma_0 - e_0 d_0 \gamma_0 = 0
\end{align*}
because $\gamma_0$ is minimal among the $\gamma_i$.
This implies that $S_{(x_0)}$ maps into $A$ via $\varphi'$.
The corresponding morphism of schemes
$\Spec(A) \to \Spec(S_{(x_0)}) = D_{+}(x_0)
\subset \text{Proj}(S)$ provides the morphism fitting into
the first commutative diagram of this proof.
\end{proof}

\noindent
We saw in the proof of Lemma \ref{lemma-proj-valuative-criterion}
that, under the hypotheses of that lemma, the morphism
$\text{Proj}(S) \to \Spec(S_0)$ is quasi-compact as well. Hence (by
Schemes, Proposition \ref{schemes-proposition-characterize-universally-closed})
we see that $\text{Proj}(S) \to \Spec(S_0)$ is universally closed in
the situation of the lemma. We give several examples showing these results
do not hold without some assumption on the graded ring $S$.

\begin{example}
\label{example-not-existence-valuative-big-proj}
Let $\mathbf{C}[X_1, X_2, X_3, \ldots]$ be the graded $\mathbf{C}$-algebra
with each $X_i$ in degree $1$. Consider the ring map
$$
\mathbf{C}[X_1, X_2, X_3, \ldots]
\longrightarrow
\mathbf{C}[t^\alpha ; \alpha \in \mathbf{Q}_{\geq 0}]
$$
which maps $X_i$ to $t^{1/i}$. The right hand side becomes a valuation ring
$A$ upon localization at the ideal $\mathfrak m = (t^\alpha ; \alpha > 0)$.
Let $K$ be the fraction field of $A$. The above gives a morphism
$\Spec(K) \to \text{Proj}(\mathbf{C}[X_1, X_2, X_3, \ldots])$ which does not
extend to a morphism defined on all of $\Spec(A)$.
The reason is that the image of $\Spec(A)$ would be contained
in one of the $D_{+}(X_i)$ but then $X_{i + 1}/X_i$ would map
to an element of $A$ which it doesn't since it maps to
$t^{1/(i + 1) - 1/i}$.
\end{example}

\begin{example}
\label{example-not-existence-valuative-small-proj}
Let $R = \mathbf{C}[t]$ and
$$
S = R[X_1, X_2, X_3, \ldots]/(X_i^2 - tX_{i + 1}).
$$
The grading is such that $R = S_0$ and $\deg(X_i) = 2^{i - 1}$.
Note that if $\mathfrak p \in \text{Proj}(S)$ then
$t \not \in \mathfrak p$ (otherwise $\mathfrak p$ has to contain
all of the $X_i$ which is not allowed for an element of
the homogeneous spectrum). Thus we see that
$D_{+}(X_i) = D_{+}(X_{i + 1})$ for all $i$. Hence
$\text{Proj}(S)$ is quasi-compact; in fact it is affine
since it is equal to $D_{+}(X_1)$. It is easy to see that
the image of $\text{Proj}(S) \to \Spec(R)$ is
$D(t)$. Hence the morphism $\text{Proj}(S) \to \Spec(R)$
is not closed. Thus the valuative criterion cannot apply because
it would imply that the morphism is closed (see
Schemes, Proposition \ref{schemes-proposition-characterize-universally-closed}
).
\end{example}

\begin{example}
\label{example-trivial-proj}
Let $A$ be a ring.
Let $S = A[T]$ as a graded $A$ algebra with $T$ in degree $1$.
Then the canonical morphism $\text{Proj}(S) \to \Spec(A)$
(see Lemma \ref{lemma-structure-morphism-proj})
is an isomorphism.
\end{example}

\begin{example}
\label{example-open-subset-proj}
Let $X = \Spec(A)$ be an affine scheme, and let $U \subset X$
be an open subscheme.  Grade $A[T]$ by setting $\deg T = 1$.  Define $S$
to be the subring of $A[T]$ generated by $A$ and all $fT^i$, where $i \ge 0$
and where $f \in A$ is such that $D(f) \subset U$.  We claim that $S$
is a graded ring with $S_0 = A$ such that $\text{Proj}(S) \cong U$,
and this isomorphism identifies the canonical morphism
$\text{Proj}(S) \to \Spec(A)$ of Lemma \ref{lemma-structure-morphism-proj}
with the inclusion $U \subset X$.

\medskip\noindent
Suppose $\mathfrak p \in \text{Proj}(S)$ is such that every $fT \in S_1$
is in $\mathfrak p$.  Then every generator $fT^i$ with $i \ge 1$
is in $\mathfrak p$ because $(fT^i)^2 = (fT)(fT^{2i-1}) \in \mathfrak p$
and $\mathfrak p$ is radical.  But then $\mathfrak p \supset S_+$, which
is impossible. Consequently $\text{Proj}(S)$ is covered by the standard
open affine subsets $\{D_+(fT)\}_{fT \in S_1}$.

\medskip\noindent
Observe that, if $fT \in S_1$, then the inclusion $S \subset A[T]$
induces a graded isomorphism of $S[(fT)^{-1}]$ with $A[T, T^{-1}, f^{-1}]$.
Hence the standard open subset $D_+(fT) \cong \Spec(S_{(fT)})$
is isomorphic to $\Spec(A[T, T^{-1}, f^{-1}]_0) = \Spec(A[f^{-1}])$.
It is clear that this isomorphism is a restriction of the canonical morphism
$\text{Proj}(S) \to \Spec(A)$.  If in addition $gT \in S_1$, then
$S[(fT)^{-1}, (gT)^{-1}] \cong A[T, T^{-1}, f^{-1}, g^{-1}]$
as graded rings, so $D_+(fT) \cap D_+(gT) \cong \Spec(A[f^{-1}, g^{-1}])$.
Therefore $\text{Proj}(S)$ is the union of open subschemes $D_+(fT)$
which are isomorphic to the open subschemes $D(f) \subset X$
under the canonical morphism, and these open subschemes intersect
in $\text{Proj}(S)$ in the same way they do in $X$.
We conclude that the canonical morphism is an isomorphism of
$\text{Proj}(S)$ with the union of all $D(f) \subset U$, which is $U$.
\end{example}





















\section{Projective space}
\label{section-projective-space}

\noindent
I have skipped lots of sections 
between the former and this one.

\noindent
Projective space is one of the fundamental objects studied in
algebraic geometry. In this section we just give its construction
as $\text{Proj}$ of a polynomial ring. Later we will discover many
of its beautiful properties.

\begin{lemma}
\label{lemma-projective-space}
Let $S = \mathbf{Z}[T_0, \ldots, T_n]$ with $\deg(T_i) = 1$.
The scheme
$$
\mathbf{P}^n_{\mathbf{Z}} = \text{Proj}(S)
$$
represents the functor which associates to a scheme $Y$ the pairs
$(\mathcal{L}, (s_0, \ldots, s_n))$ where
\begin{enumerate}
\item $\mathcal{L}$ is an invertible $\mathcal{O}_Y$-module, and
\item $s_0, \ldots, s_n$ are global sections of $\mathcal{L}$
which generate $\mathcal{L}$
\end{enumerate}
up to the following equivalence:
$(\mathcal{L}, (s_0, \ldots, s_n)) \sim
(\mathcal{N}, (t_0, \ldots, t_n))$ $\Leftrightarrow$ there exists
an isomorphism $\beta : \mathcal{L} \to \mathcal{N}$
with $\beta(s_i) = t_i$ for $i = 0, \ldots, n$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-apply} above.
Namely, for any graded ring $A$ we have
\begin{eqnarray*}
\Mor_{graded rings}(\mathbf{Z}[T_0, \ldots, T_n], A)
& = &
A_1 \times \ldots \times A_1 \\
\psi & \mapsto & (\psi(T_0), \ldots, \psi(T_n))
\end{eqnarray*}
and the degree $1$ part of $\Gamma_*(Y, \mathcal{L})$ is
just $\Gamma(Y, \mathcal{L})$.
\end{proof}

\begin{definition}
\label{definition-projective-space}
The scheme
$\mathbf{P}^n_{\mathbf{Z}} = \text{Proj}(\mathbf{Z}[T_0, \ldots, T_n])$
is called {\it projective $n$-space over $\mathbf{Z}$}.
Its base change $\mathbf{P}^n_S$ to a scheme $S$ is called
{\it projective $n$-space over $S$}. If $R$ is a ring the base change
to $\Spec(R)$ is denoted $\mathbf{P}^n_R$ and called
{\it projective $n$-space over $R$}.
\end{definition}

\noindent
Given a scheme $Y$ over $S$
and a pair $(\mathcal{L}, (s_0, \ldots, s_n))$ as in
Lemma \ref{lemma-projective-space}
the induced morphism to $\mathbf{P}^n_S$ is denoted
$$
\varphi_{(\mathcal{L}, (s_0, \ldots, s_n))} :
Y \longrightarrow \mathbf{P}^n_S
$$
This makes sense since the pair defines a morphism into
$\mathbf{P}^n_{\mathbf{Z}}$ and we already have the structure
morphism into $S$ so combined we get a morphism into
$\mathbf{P}^n_S = \mathbf{P}^n_{\mathbf{Z}} \times S$.
Note that this is the $S$-morphism characterized by
$$
\mathcal{L} =
\varphi_{(\mathcal{L}, (s_0, \ldots, s_n))}^*\mathcal{O}_{\mathbf{P}^n_R}(1)
\quad
\text{and}
\quad
s_i = \varphi_{(\mathcal{L}, (s_0, \ldots, s_n))}^*T_i
$$
where we think of $T_i$ as a global section of
$\mathcal{O}_{\mathbf{P}^n_S}(1)$ via (\ref{equation-global-sections}).

\begin{lemma}
\label{lemma-standard-covering-projective-space}
Projective $n$-space over $\mathbf{Z}$ is covered by
$n + 1$ standard opens
$$
\mathbf{P}^n_{\mathbf{Z}} =
\bigcup\nolimits_{i = 0, \ldots, n} D_{+}(T_i)
$$
where each $D_{+}(T_i)$ is isomorphic to $\mathbf{A}^n_{\mathbf{Z}}$
affine $n$-space over $\mathbf{Z}$.
\end{lemma}

\begin{proof}
This is true because
$\mathbf{Z}[T_0, \ldots, T_n]_{+} = (T_0, \ldots, T_n)$ and
since
$$
\Spec
\left(
\mathbf{Z}
\left[\frac{T_0}{T_i}, \ldots, \frac{T_n}{T_i}
\right]
\right)
\cong
\mathbf{A}^n_{\mathbf{Z}}
$$
in an obvious way.
\end{proof}

\begin{lemma}
\label{lemma-projective-space-separated}
Let $S$ be a scheme.
The structure morphism $\mathbf{P}^n_S \to S$ is
\begin{enumerate}
\item separated,
\item quasi-compact,
\item satisfies the existence and uniqueness parts of the valuative criterion,
and
\item universally closed.
\end{enumerate}
\end{lemma}

\begin{proof}
All these properties are stable under base change (this is clear for the
last two and for the other two see
Schemes, Lemmas
\ref{schemes-lemma-separated-permanence} and
\ref{schemes-lemma-quasi-compact-preserved-base-change}).
Hence it suffices to prove them for the morphism
$\mathbf{P}^n_{\mathbf{Z}} \to \Spec(\mathbf{Z})$.
Separatedness is Lemma \ref{lemma-proj-separated}. Quasi-compactness follows
from Lemma \ref{lemma-standard-covering-projective-space}.
Existence and uniqueness of the valuative criterion follow from
Lemma \ref{lemma-proj-valuative-criterion}.
Universally closed follows from the above and
Schemes, Proposition \ref{schemes-proposition-characterize-universally-closed}.
\end{proof}

\begin{remark}
\label{remark-missing-finite-type}
What's missing in the list of properties above? Well to be sure the property
of being of finite type. The reason we do not list this here is that we have
not yet defined the notion of finite type at this point. (Another property
which is missing is ``smoothness''. And I'm sure there are many more you can
think of.)
\end{remark}

\begin{lemma}[Segre embedding]
\label{lemma-segre-embedding}
Let $S$ be a scheme. There exists a closed immersion
$$
\mathbf{P}^n_S \times_S \mathbf{P}^m_S
\longrightarrow
\mathbf{P}^{nm + n + m}_S
$$
called the {\it Segre embedding}.
\end{lemma}

\begin{proof}
It suffices to prove this when $S = \Spec(\mathbf{Z})$.
Hence we will drop the index $S$ and work in the absolute setting.
Write $\mathbf{P}^n = \text{Proj}(\mathbf{Z}[X_0, \ldots, X_n])$,
$\mathbf{P}^m = \text{Proj}(\mathbf{Z}[Y_0, \ldots, Y_m])$,
and
$\mathbf{P}^{nm + n + m} =
\text{Proj}(\mathbf{Z}[Z_0, \ldots, Z_{nm + n + m}])$.
In order to map into $\mathbf{P}^{nm + n + m}$ we have to
write down an invertible sheaf $\mathcal{L}$ on the left hand
side and $(n + 1)(m + 1)$ sections $s_i$ which generate it.
See Lemma \ref{lemma-projective-space}.
The invertible sheaf we take is
$$
\mathcal{L} =
\text{pr}_1^*\mathcal{O}_{\mathbf{P}^n}(1)
\otimes
\text{pr}_2^*\mathcal{O}_{\mathbf{P}^m}(1)
$$
The sections we take are
$$
s_0 = X_0Y_0, \ s_1 = X_1Y_0, \ldots, \ s_n = X_nY_0,
\ s_{n + 1} = X_0Y_1, \ldots, \ s_{nm + n + m} = X_nY_m.
$$
These generate $\mathcal{L}$ since the sections $X_i$ generate
$\mathcal{O}_{\mathbf{P}^n}(1)$ and the sections $Y_j$ generate
$\mathcal{O}_{\mathbf{P}^m}(1)$. The induced morphism
$\varphi$ has the property that
$$
\varphi^{-1}(D_{+}(Z_{i + (n + 1)j})) = D_{+}(X_i) \times D_{+}(Y_j).
$$
Hence it is an affine morphism. The corresponding ring map in case
$(i, j) = (0, 0)$ is the map
$$
\mathbf{Z}[Z_1/Z_0, \ldots, Z_{nm + n + m}/Z_0]
\longrightarrow
\mathbf{Z}[X_1/X_0, \ldots, X_n/X_0, Y_1/Y_0, \ldots, Y_n/Y_0]
$$
which maps $Z_i/Z_0$ to the element $X_i/X_0$ for $i \leq n$ and
the element $Z_{(n + 1)j}/Z_0$ to the element $Y_j/Y_0$. Hence it
is surjective. A similar argument works for the other affine
open subsets. Hence the morphism $\varphi$ is a closed immersion
(see Schemes, Lemma \ref{schemes-lemma-closed-local-target} and
Example \ref{schemes-example-closed-immersion-affines}.)
\end{proof}

\noindent
The following two lemmas are special cases of more general results later, but
perhaps it makes sense to prove these directly here now.

\begin{lemma}
\label{lemma-closed-in-projective-space}
Let $R$ be a ring. Let $Z \subset \mathbf{P}^n_R$ be a closed subscheme.
Let
$$
I_d = \Ker\left(
R[T_0, \ldots, T_n]_d
\longrightarrow
\Gamma(Z, \mathcal{O}_{\mathbf{P}^n_R}(d)|_Z)\right)
$$
Then $I = \bigoplus I_d \subset R[T_0, \ldots, T_n]$ is
a graded ideal and $Z = \text{Proj}(R[T_0, \ldots, T_n]/I)$.
\end{lemma}

\begin{proof}
It is clear that $I$ is a graded ideal.
Set $Z' = \text{Proj}(R[T_0, \ldots, T_n]/I)$.
By Lemma \ref{lemma-surjective-graded-rings-generated-degree-1-map-proj}
we see that $Z'$ is a closed subscheme of $\mathbf{P}^n_R$.
To see the equality $Z = Z'$
it suffices to check on an standard affine open
$D_{+}(T_i)$. By renumbering the homogeneous coordinates we
may assume $i = 0$. Say $Z \cap D_{+}(T_0)$, resp.\ $Z' \cap D_{+}(T_0)$
is cut out by the ideal $J$, resp.\ $J'$ of $R[T_1/T_0, \ldots, T_n/T_0]$.
Then $J'$ is the ideal generated by the elements $F/T_0^{\deg(F)}$ where
$F \in I$ is homogeneous.
Suppose the degree of $F \in I$ is $d$. Since $F$ vanishes as a section
of $\mathcal{O}_{\mathbf{P}^n_R}(d)$ restricted to $Z$ we see that
$F/T_0^d$ is an element of $J$. Thus $J' \subset J$.

\medskip\noindent
Conversely, suppose that $f \in J$. If $f$ has total degree
$d$ in $T_1/T_0, \ldots, T_n/T_0$, then we can write
$f = F/T_0^d$ for some $F \in R[T_0, \ldots, T_n]_d$.
Pick $i \in \{1, \ldots, n\}$. Then $Z \cap D_{+}(T_i)$ is
cut out by some ideal $J_i \subset R[T_0/T_i, \ldots, T_n/T_i]$.
Moreover,
$$
J \cdot
R\left[
\frac{T_1}{T_0}, \ldots, \frac{T_n}{T_0},
\frac{T_0}{T_i}, \ldots, \frac{T_n}{T_i}
\right]
=
J_i \cdot
R\left[
\frac{T_1}{T_0}, \ldots, \frac{T_n}{T_0},
\frac{T_0}{T_i}, \ldots, \frac{T_n}{T_i}
\right]
$$
The left hand side is the localization of $J$ with respect to the
element $T_i/T_0$ and the right hand side is the localization of $J_i$
with respect to the element $T_0/T_i$. It follows that
$T_0^{d_i}F/T_i^{d + d_i}$ is an element of $J_i$ for some $d_i$
sufficiently large. This proves that $T_0^{\max(d_i)}F$ is an
element of $I$, because its restriction to each standard affine
open $D_{+}(T_i)$ vanishes on the closed subscheme
$Z \cap D_{+}(T_i)$. Hence $f \in J'$ and we conclude $J \subset J'$
as desired.
\end{proof}

\noindent
The following lemma is a special case of the more general
Properties, Lemmas \ref{properties-lemma-ample-quasi-coherent} or
\ref{properties-lemma-proj-quasi-coherent}.

\begin{lemma}
\label{lemma-quasi-coherent-projective-space}
Let $R$ be a ring.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $\mathbf{P}^n_R$.
For $d \geq 0$ set
$$
M_d
=
\Gamma(\mathbf{P}^n_R,
\mathcal{F} \otimes_{\mathcal{O}_{\mathbf{P}^n_R}}
\mathcal{O}_{\mathbf{P}^n_R}(d))
=
\Gamma(\mathbf{P}^n_R, \mathcal{F}(d))
$$
Then $M = \bigoplus_{d \geq 0} M_d$ is a graded $R[T_0, \ldots, R_n]$-module
and there is a canonical isomorphism $\mathcal{F} = \widetilde{M}$.
\end{lemma}

\begin{proof}
The multiplication maps
$$
R[T_0, \ldots, R_n]_e \times M_d \longrightarrow M_{d + e}
$$
come from the natural isomorphisms
$$
\mathcal{O}_{\mathbf{P}^n_R}(e)
\otimes_{\mathcal{O}_{\mathbf{P}^n_R}}
\mathcal{F}(d)
\longrightarrow
\mathcal{F}(e + d)
$$
see Equation (\ref{equation-global-sections-module}). Let us construct the
map $c : \widetilde{M} \to \mathcal{F}$. On each of the standard affines
$U_i = D_{+}(T_i)$ we see that $\Gamma(U_i, \widetilde{M}) = (M[1/T_i])_0$
where the subscript ${}_0$ means degree $0$ part. An element of this
can be written as $m/T_i^d$ with $m \in M_d$. Since $T_i$ is a generator
of $\mathcal{O}(1)$ over $U_i$ we can always write
$m|_{U_i} = m_i \otimes T_i^d$ where $m_i \in \Gamma(U_i, \mathcal{F})$
is a unique section. Thus a natural guess is $c(m/T_i^d) = m_i$.
A small argument, which is omitted here, shows that this gives a
well defined map $c : \widetilde{M} \to \mathcal{F}$ if we can
show that
$$
(T_i/T_j)^d m_i|_{U_i \cap U_j} = m_j|_{U_i \cap U_j}
$$
in $M[1/T_iT_j]$.
But this is clear since on the overlap the generators $T_i$ and
$T_j$ of $\mathcal{O}(1)$ differ by the invertible function $T_i/T_j$.

\medskip\noindent
Injectivity of $c$. We may check for injectivity over the affine opens
$U_i$. Let $i \in \{0, \ldots, n\}$
and let $s$ be an element $s = m/T_i^d \in \Gamma(U_i, \widetilde{M})$
such that $c(m/T_i^d) = 0$. By the description of $c$ above this means that
$m_i = 0$, hence $m|_{U_i} = 0$. Hence $T_i^em = 0$ in $M$ for some
$e$. Hence $s = m/T_i^d = T_i^e/T_i^{e + d} = 0$ as desired.

\medskip\noindent
Surjectivity of $c$. We may check for surjectivity over the affine opens
$U_i$. By renumbering it suffices to check it over $U_0$.
Let $s \in \mathcal{F}(U_0)$.
Let us write $\mathcal{F}|_{U_i} = \widetilde{N_i}$ for some
$R[T_0/T_i, \ldots, T_0/T_i]$-module $N_i$, which is possible because
$\mathcal{F}$ is quasi-coherent. So $s$ corresponds to an element
$x \in N_0$. Then we have that
$$
(N_i)_{T_j/T_i} \cong (N_j)_{T_i/T_j}
$$
(where the subscripts mean ``principal localization at'')
as modules over the ring
$$
R\left[
\frac{T_0}{T_i}, \ldots, \frac{T_n}{T_i},
\frac{T_0}{T_j}, \ldots, \frac{T_n}{T_j}
\right].
$$
This means that for some large integer $d$ there exist elements
$s_i \in N_i$, $i = 1, \ldots, n$ such that
$$
s = (T_i/T_0)^d s_i
$$
on $U_0 \cap U_i$. Next, we look at the difference
$$
t_{ij} = s_i - (T_j/T_i)^d s_j
$$
on $U_i \cap U_j$, $0 < i < j$. By our choice of $s_i$ we know that
$t_{ij}|_{U_0 \cap U_i \cap U_j} = 0$. Hence there exists a large integer
$e$ such that $(T_0/T_i)^et_{ij} = 0$. Set $s_i' = (T_0/T_i)^es_i$,
and $s_0' = s$. Then we will have
$$
s_a' = (T_b/T_a)^{e + d} s_b'
$$
on $U_a \cap U_b$ for all $a, b$. This is exactly the condition that the
elements $s'_a$ glue to a global section
$m \in \Gamma(\mathbf{P}^n_R, \mathcal{F}(e + d))$.
And moreover $c(m/T_0^{e + d}) = s$ by construction. Hence $c$ is
surjective and we win.
\end{proof}

\begin{lemma}
\label{lemma-globally-generated-omega-twist-1}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible sheaf
and let $s_0, \ldots, s_n$ be global sections of $\mathcal{L}$
which generate it. Let $\mathcal{F}$ be the kernel of the induced
map $\mathcal{O}_X^{\oplus n + 1} \to \mathcal{L}$.
Then $\mathcal{F} \otimes \mathcal{L}$ is globally generated.
\end{lemma}

\begin{proof}
In fact the result is true if $X$ is any locally ringed space.
The sheaf $\mathcal{F}$ is a finite locally free $\mathcal{O}_X$-module
of rank $n$. The elements
$$
s_{ij} = (0, \ldots, 0, s_j, 0, \ldots, 0, -s_i, 0, \ldots, 0)
\in \Gamma(X, \mathcal{L}^{\oplus n + 1})
$$
with $s_j$ in the $i$th spot and $-s_i$ in the $j$th spot map to zero
in $\mathcal{L}^{\otimes 2}$. Hence
$s_{ij} \in \Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L})$.
A local computation shows that these sections generate
$\mathcal{F} \otimes \mathcal{L}$.

\medskip\noindent
Alternative proof. Consider the morphism
$\varphi : X \to \mathbf{P}^n_\mathbf{Z}$ associated to
the pair $(\mathcal{L}, (s_0, \ldots, s_n))$. Since the pullback
of $\mathcal{O}(1)$ is $\mathcal{L}$ and since the pullback
of $T_i$ is $s_i$, it suffices to prove the lemma in the
case of $\mathbf{P}^n_\mathbf{Z}$. In this case the sheaf
$\mathcal{F}$ corresponds to the graded $S = \mathbf{Z}[T_0, \ldots, T_n]$
module $M$ which fits into the short exact sequence
$$
0 \to M \to S^{\oplus n + 1} \to S(1) \to 0
$$
where the second map is given by $T_0, \ldots, T_n$. In this
case the statement above translates into the statement that
the elements
$$
T_{ij} = (0, \ldots, 0, T_j, 0, \ldots, 0, -T_i, 0, \ldots, 0)
\in M(1)_0
$$
generate the graded module $M(1)$ over $S$. We omit the details.
\end{proof}


\section{Quasi-coherent sheaves on Proj}
\label{section-quasi-coherent-proj}

\noindent
Let $S$ be a graded ring. Let $M$ be a graded $S$-module.
We saw in Lemma \ref{lemma-proj-sheaves} how to construct a quasi-coherent
sheaf of modules $\widetilde{M}$ on $\text{Proj}(S)$ and a map
\begin{equation}
\label{equation-map-global-sections}
M_0 \longrightarrow \Gamma(\text{Proj}(S), \widetilde{M})
\end{equation}
of the degree $0$ part of $M$ to the global sections of $\widetilde{M}$.
The degree $0$ part of the $n$th twist $M(n)$ of the graded module $M$ (see
Algebra, Section \ref{algebra-section-graded})
is equal to $M_n$. Hence we can get maps
\begin{equation}
\label{equation-map-global-sections-degree-n}
M_n \longrightarrow \Gamma(\text{Proj}(S), \widetilde{M(n)}).
\end{equation}
We would like to be able to perform this operation for any quasi-coherent
sheaf $\mathcal{F}$ on $\text{Proj}(S)$. We will do this by tensoring
with the $n$th twist of the structure sheaf, see
Definition \ref{definition-twist}. In order to relate the two notions
we will use the following lemma.

\begin{lemma}
\label{lemma-widetilde-tensor}
Let $S$ be a graded ring.
Let $(X, \mathcal{O}_X) = (\text{Proj}(S), \mathcal{O}_{\text{Proj}(S)})$
be the scheme of Lemma \ref{lemma-proj-scheme}.
Let $f \in S_{+}$ be homogeneous. Let $x \in X$ be a point
corresponding to the homogeneous prime $\mathfrak p \subset S$.
Let $M$, $N$ be graded $S$-modules.
There is a canonical map of $\mathcal{O}_{\text{Proj}(S)}$-modules
$$
\widetilde M \otimes_{\mathcal{O}_X} \widetilde N
\longrightarrow
\widetilde{M \otimes_S N}
$$
which induces the canonical map
$
M_{(f)} \otimes_{S_{(f)}} N_{(f)}
\to
(M \otimes_S N)_{(f)}
$
on sections over $D_{+}(f)$ and the canonical map
$
M_{(\mathfrak p)} \otimes_{S_{(\mathfrak p)}} N_{(\mathfrak p)}
\to
(M \otimes_S N)_{(\mathfrak p)}
$
on stalks at $x$. Moreover, the following diagram
$$
\xymatrix{
M_0 \otimes_{S_0} N_0 \ar[r] \ar[d] &
(M \otimes_S N)_0 \ar[d] \\
\Gamma(X, \widetilde M \otimes_{\mathcal{O}_X} \widetilde N) \ar[r] &
\Gamma(X, \widetilde{M \otimes_S N})
}
$$
is commutative where the vertical maps are given by
(\ref{equation-map-global-sections}).
\end{lemma}

\begin{proof}
To construct a morphism as displayed is the same as constructing
a $\mathcal{O}_X$-bilinear map
$$
\widetilde M \times \widetilde N
\longrightarrow
\widetilde{M \otimes_S N}
$$
see Modules, Section \ref{modules-section-tensor-product}.
It suffices to define this on sections over the opens $D_{+}(f)$
compatible with restriction mappings. On $D_{+}(f)$ we use the
$S_{(f)}$-bilinear map
$M_{(f)} \times N_{(f)} \to (M \otimes_S N)_{(f)}$,
$(x/f^n, y/f^m) \mapsto (x \otimes y)/f^{n + m}$. Details omitted.
\end{proof}

\begin{remark}
\label{remark-not-isomorphism}
In general the map constructed in Lemma \ref{lemma-widetilde-tensor}
above is not an isomorphism. Here is an example. Let $k$
be a field. Let $S = k[x, y, z]$ with $k$ in degree $0$ and
$\deg(x) = 1$, $\deg(y) = 2$, $\deg(z) = 3$.
Let $M = S(1)$ and $N = S(2)$, see
Algebra, Section \ref{algebra-section-graded}
for notation. Then $M \otimes_S N = S(3)$.
Note that
\begin{eqnarray*}
S_z
& = &
k[x, y, z, 1/z] \\
S_{(z)}
& = &
k[x^3/z, xy/z, y^3/z^2]
\cong
k[u, v, w]/(uw - v^3) \\
M_{(z)} & = & S_{(z)} \cdot x + S_{(z)} \cdot y^2/z \subset S_z \\
N_{(z)} & = & S_{(z)} \cdot y + S_{(z)} \cdot x^2 \subset S_z \\
S(3)_{(z)} & = & S_{(z)} \cdot z \subset S_z
\end{eqnarray*}
Consider the maximal ideal $\mathfrak m = (u, v, w) \subset S_{(z)}$.
It is not hard to see that both $M_{(z)}/\mathfrak mM_{(z)}$
and $N_{(z)}/\mathfrak mN_{(z)}$ have dimension $2$ over
$\kappa(\mathfrak m)$. But
$S(3)_{(z)}/\mathfrak mS(3)_{(z)}$ has dimension $1$.
Thus the map $M_{(z)} \otimes N_{(z)} \to S(3)_{(z)}$ is not
an isomorphism.
\end{remark}









\section{Invertible sheaves on Proj}
\label{section-invertible-on-proj}

\noindent
Here's the construction of the twisted
sheaves $\mathcal{O}_X(n)$.
The point is that there is a good way
to pass from an $S$-module $M$ to an
$\mathcal{O}_X$-module, called $\widetilde{M}$.
So basically you just define the twists
by $M(d)_n=M_{n+d}$ and apply that construction.

Pick an element of degree $d$.
Then think of the module generated by this element.
The least degree piece of such a module
is the degree $d$ piece of the original module,
that is we have $M(-d)$.

\medskip\noindent
Recall from Algebra, Section \ref{algebra-section-graded}
the construction of the twisted module $M(n)$ associated
to a graded module over a graded ring.

\begin{definition}
\label{definition-twist}
Let $S$ be a graded ring. Let $X = \text{Proj}(S)$.
\begin{enumerate}
\item We define $\mathcal{O}_X(n) = \widetilde{S(n)}$.
This is called the $n$th
{\it twist of the structure sheaf of $\text{Proj}(S)$}.
\item For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we set
$\mathcal{F}(n) = \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{O}_X(n)$.
\end{enumerate}
\end{definition}

\noindent
We are going to use Lemma \ref{lemma-widetilde-tensor}
to construct some canonical maps.
Since $S(n) \otimes_S S(m) = S(n + m)$ we see that there
are canonical maps
\begin{equation}
\label{equation-multiply}
\mathcal{O}_X(n) \otimes_{\mathcal{O}_X} \mathcal{O}_X(m)
\longrightarrow
\mathcal{O}_X(n + m).
\end{equation}
These maps are not isomorphisms in general, see the example in
Remark \ref{remark-not-isomorphism}. The same example shows
that $\mathcal{O}_X(n)$ is {\it not} an invertible sheaf on $X$ in
general. Tensoring with an arbitrary $\mathcal{O}_X$-module $\mathcal{F}$
we get maps
\begin{equation}
\label{equation-multiply-on-sheaf}
\mathcal{O}_X(n) \otimes_{\mathcal{O}_X} \mathcal{F}(m)
\longrightarrow
\mathcal{F}(n + m).
\end{equation}
The maps (\ref{equation-map-global-sections-degree-n})
on global sections give a map of graded rings
\begin{equation}
\label{equation-global-sections}
S \longrightarrow \bigoplus\nolimits_{n \geq 0} \Gamma(X, \mathcal{O}_X(n)).
\end{equation}
And for an arbitrary $\mathcal{O}_X$-module $\mathcal{F}$ the maps
(\ref{equation-multiply-on-sheaf}) give a graded module structure
\begin{equation}
\label{equation-global-sections-module}
\bigoplus\nolimits_{n \geq 0} \Gamma(X, \mathcal{O}_X(n))
\times
\bigoplus\nolimits_{m \in \mathbf{Z}} \Gamma(X, \mathcal{F}(m))
\longrightarrow
\bigoplus\nolimits_{m \in \mathbf{Z}} \Gamma(X, \mathcal{F}(m))
\end{equation}
and via (\ref{equation-global-sections}) also a $S$-module structure.
More generally, given any graded $S$-module
$M$ we have $M(n) = M \otimes_S S(n)$. Hence we get maps
\begin{equation}
\label{equation-multiply-more-generally}
\widetilde M(n)
=
\widetilde M
\otimes_{\mathcal{O}_X}
\mathcal{O}_X(n)
\longrightarrow
\widetilde{M(n)}.
\end{equation}
On global sections (\ref{equation-map-global-sections-degree-n})
defines a map of graded $S$-modules
\begin{equation}
\label{equation-global-sections-more-generally}
M \longrightarrow
\bigoplus\nolimits_{n \in \mathbf{Z}} \Gamma(X, \widetilde{M(n)}).
\end{equation}
Here is an important fact which follows basically immediately from the
definitions.

\begin{lemma}
\label{lemma-when-invertible}
Let $S$ be a graded ring. Set $X = \text{Proj}(S)$.
Let $f \in S$ be homogeneous of degree $d > 0$.
The sheaves $\mathcal{O}_X(nd)|_{D_{+}(f)}$ are invertible,
and in fact trivial for all $n \in \mathbf{Z}$
(see Modules, Definition \ref{modules-definition-invertible}).
The maps (\ref{equation-multiply}) restricted to $D_{+}(f)$
$$
\mathcal{O}_X(nd)|_{D_{+}(f)} \otimes_{\mathcal{O}_{D_{+}(f)}}
\mathcal{O}_X(m)|_{D_{+}(f)}
\longrightarrow
\mathcal{O}_X(nd + m)|_{D_{+}(f)},
$$
the maps (\ref{equation-multiply-on-sheaf}) restricted to $D_+(f)$
$$
\mathcal{O}_X(nd)|_{D_{+}(f)} \otimes_{\mathcal{O}_{D_{+}(f)}}
\mathcal{F}(m)|_{D_{+}(f)}
\longrightarrow
\mathcal{F}(nd + m)|_{D_{+}(f)},
$$
and the maps (\ref{equation-multiply-more-generally})
restricted to $D_{+}(f)$
$$
\widetilde M(nd)|_{D_{+}(f)}
=
\widetilde M|_{D_{+}(f)}
\otimes_{\mathcal{O}_{D_{+}(f)}}
\mathcal{O}_X(nd)|_{D_{+}(f)}
\longrightarrow
\widetilde{M(nd)}|_{D_{+}(f)}
$$
are isomorphisms for all $n, m \in \mathbf{Z}$.
\end{lemma}

\begin{proof}
The (not graded) $S$-module maps $S \to S(nd)$, and $M \to M(nd)$, given by
$x \mapsto f^n x$ become isomorphisms after inverting $f$. The first shows that
$S_{(f)} \cong S(nd)_{(f)}$ which gives an isomorphism
$\mathcal{O}_{D_{+}(f)} \cong \mathcal{O}_X(nd)|_{D_{+}(f)}$.
The second shows that the map
$S(nd)_{(f)} \otimes_{S_{(f)}} M_{(f)} \to M(nd)_{(f)}$
is an isomorphism. The case of the map (\ref{equation-multiply-on-sheaf})
is a consequence of the case of the map (\ref{equation-multiply}).
\end{proof}

\begin{lemma}
\label{lemma-apply-modules}
Let $S$ be a graded ring. Let $M$ be a graded $S$-module.
Set $X = \text{Proj}(S)$. Assume $X$ is covered by the standard
opens $D_+(f)$ with $f \in S_1$, e.g., if $S$ is generated by $S_1$
over $S_0$. Then the sheaves $\mathcal{O}_X(n)$
are invertible and the maps
(\ref{equation-multiply}), (\ref{equation-multiply-on-sheaf}), and
(\ref{equation-multiply-more-generally}) are isomorphisms.
In particular, these maps induce isomorphisms
$$
\mathcal{O}_X(1)^{\otimes n} \cong
\mathcal{O}_X(n)
\quad
\text{and}
\quad
\widetilde{M} \otimes_{\mathcal{O}_X} \mathcal{O}_X(n) =
\widetilde{M}(n) \cong \widetilde{M(n)}
$$
Thus (\ref{equation-map-global-sections-degree-n}) becomes a map
\begin{equation}
\label{equation-map-global-sections-degree-n-simplified}
M_n \longrightarrow \Gamma(X, \widetilde{M}(n))
\end{equation}
and (\ref{equation-global-sections-more-generally}) becomes a map
\begin{equation}
\label{equation-global-sections-more-generally-simplified}
M \longrightarrow
\bigoplus\nolimits_{n \in \mathbf{Z}} \Gamma(X, \widetilde{M}(n)).
\end{equation}
\end{lemma}

\begin{proof}
Under the assumptions of the lemma $X$ is covered by the
open subsets $D_{+}(f)$ with $f \in S_1$ and the
lemma is a consequence of Lemma \ref{lemma-when-invertible} above.
\end{proof}

\begin{lemma}
\label{lemma-where-invertible}
Let $S$ be a graded ring. Set $X = \text{Proj}(S)$. Fix $d \geq 1$ an
integer. The following open subsets of $X$ are equal:
\begin{enumerate}
\item The largest open subset $W = W_d \subset X$ such that
each $\mathcal{O}_X(dn)|_W$ is invertible and all the
multiplication maps
$\mathcal{O}_X(nd)|_W \otimes_{\mathcal{O}_W} \mathcal{O}_X(md)|_W
\to \mathcal{O}_X(nd + md)|_W$
(see \ref{equation-multiply}) are isomorphisms.
\item The union of the open subsets $D_{+}(fg)$ with
$f, g \in S$ homogeneous and $\deg(f) = \deg(g) + d$.
\end{enumerate}
Moreover, all the maps
$\widetilde M(nd)|_W = \widetilde M|_W \otimes_{\mathcal{O}_W}
\mathcal{O}_X(nd)|_W \to \widetilde{M(nd)}|_W$
(see \ref{equation-multiply-more-generally}) are isomorphisms.
\end{lemma}

\begin{proof}
If $x \in D_{+}(fg)$ with $\deg(f) = \deg(g) + d$ then
on $D_{+}(fg)$ the sheaves $\mathcal{O}_X(dn)$
are generated by the element $(f/g)^n = f^{2n}/(fg)^n$. This implies $x$
is in the open subset $W$ defined in (1) by arguing as in the
proof of Lemma \ref{lemma-when-invertible}.

\medskip\noindent
Conversely, suppose that $\mathcal{O}_X(d)$ is free of rank 1
in an open neighbourhood $V$ of $x \in X$ and all the
multiplication maps
$\mathcal{O}_X(nd)|_V \otimes_{\mathcal{O}_V} \mathcal{O}_X(md)|_V
\to \mathcal{O}_X(nd + md)|_V$ are isomorphisms.
We may choose $h \in S_{+}$ homogeneous such that $x \in D_{+}(h) \subset V$.
By the definition of the twists of the structure sheaf we conclude there
exists an element $s$ of $(S_h)_d$ such that $s^n$ is a basis of $(S_h)_{nd}$
as a module over $S_{(h)}$ for all $n \in \mathbf{Z}$.
We may write
$s = f/h^m$ for some $m \geq 1$ and $f \in S_{d + m \deg(h)}$.
Set $g = h^m$ so $s = f/g$. Note that $x \in D_{+}(g)$ by construction.
Note that $g^d \in (S_h)_{d\deg(g)}$.
By assumption we can write this as a multiple of
$s^{\deg(g)} = f^{\deg(g)}/g^{\deg(g)}$, say
$g^d = a/g^e \cdot f^{\deg(g)}/g^{\deg(g)}$.
Then we conclude that $g^{d + e + \deg(g)} = a f^{\deg(g)}$
and hence also $x \in D_{+}(f)$. So $x$ is an element of the set defined
in (2).

\medskip\noindent
The existence of the generating section $s = f/g$ over
the affine open $D_{+}(fg)$ whose
powers freely generate the sheaves of modules
$\mathcal{O}_X(nd)$ easily implies that the multiplication maps
$\widetilde M(nd)|_W = \widetilde M|_W \otimes_{\mathcal{O}_W}
\mathcal{O}_X(nd)|_W \to \widetilde{M(nd)}|_W$
(see \ref{equation-multiply-more-generally})
are isomorphisms. Compare with the proof of Lemma \ref{lemma-when-invertible}.
\end{proof}

\noindent
Recall from Modules, Lemma \ref{modules-lemma-s-open}
that given an invertible sheaf $\mathcal{L}$ on a locally ringed
space $X$, and given a global section $s$ of $\mathcal{L}$
the set $X_s = \{x \in X \mid s \not \in \mathfrak m_x\mathcal{L}_x\}$
is open.

\begin{lemma}
\label{lemma-principal-open}
Let $S$ be a graded ring. Set $X = \text{Proj}(S)$. Fix $d \geq 1$ an
integer. Let $W = W_d \subset X$ be the open subscheme defined in
Lemma \ref{lemma-where-invertible}. Let $n \geq 1$ and $f \in S_{nd}$.
Denote $s \in \Gamma(W, \mathcal{O}_W(nd))$ the section which is
the image of $f$ via (\ref{equation-global-sections}) restricted to $W$. Then
$$
W_s = D_{+}(f) \cap W.
$$
\end{lemma}

\begin{proof}
Let $D_{+}(ab) \subset W$ be a standard affine open with
$a, b \in S$ homogeneous and $\deg(a) = \deg(b) + d$.
Note that $D_{+}(ab) \cap D_{+}(f) = D_{+}(abf)$.
On the other hand the restriction of $s$ to $D_{+}(ab)$
corresponds to the element $f/1 = b^nf/a^n (a/b)^n \in (S_{ab})_{nd}$.
We have seen in the proof of Lemma \ref{lemma-where-invertible} that
$(a/b)^n$ is a generator for $\mathcal{O}_W(nd)$ over $D_{+}(ab)$.
We conclude that $W_s \cap D_{+}(ab)$ is the principal open
associated to $b^nf/a^n \in \mathcal{O}_X(D_{+}(ab))$.
Thus the result of the lemma is clear.
\end{proof}

\noindent
The following lemma states the properties that we will later use to
characterize schemes with an ample invertible sheaf.

\begin{lemma}
\label{lemma-ample-on-proj}
Let $S$ be a graded ring.
Let $X = \text{Proj}(S)$.
Let $Y \subset X$ be a quasi-compact open subscheme.
Denote $\mathcal{O}_Y(n)$ the restriction of
$\mathcal{O}_X(n)$ to $Y$.
There exists an integer $d \geq 1$ such that
\begin{enumerate}
\item the subscheme $Y$ is contained in the open $W_d$ defined
in Lemma \ref{lemma-where-invertible},
\item the sheaf $\mathcal{O}_Y(dn)$ is invertible for all $n \in \mathbf{Z}$,
\item all the maps
$\mathcal{O}_Y(nd) \otimes_{\mathcal{O}_Y} \mathcal{O}_Y(m)
\longrightarrow
\mathcal{O}_Y(nd + m)$
of Equation (\ref{equation-multiply}) are isomorphisms,
\item all the maps
$\widetilde M(nd)|_Y = \widetilde M|_Y \otimes_{\mathcal{O}_Y}
\mathcal{O}_X(nd)|_Y \to \widetilde{M(nd)}|_Y$
(see \ref{equation-multiply-more-generally}) are isomorphisms,
\item given $f \in S_{nd}$ denote $s \in \Gamma(Y, \mathcal{O}_Y(nd))$
the image of $f$ via (\ref{equation-global-sections})
restricted to $Y$, then $D_{+}(f) \cap Y = Y_s$,
\item a basis for the topology on $Y$ is given
by the collection of opens $Y_s$, where $s \in \Gamma(Y, \mathcal{O}_Y(nd))$,
$n \geq 1$, and
\item a basis for the topology of $Y$ is given
by those opens $Y_s \subset Y$, for
$s \in \Gamma(Y, \mathcal{O}_Y(nd))$, $n \geq 1$ which are affine.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $Y$ is quasi-compact there exist finitely many homogeneous
$f_i \in S_{+}$, $i = 1, \ldots, n$ such that the standard opens
$D_{+}(f_i)$ give an open covering of $Y$. Let $d_i = \deg(f_i)$ and set
$d = d_1 \ldots d_n$. Note that $D_{+}(f_i) = D_{+}(f_i^{d/d_i})$
and hence we see immediately that $Y \subset W_d$, by characterization
(2) in Lemma \ref{lemma-where-invertible} or
by (1) using Lemma \ref{lemma-when-invertible}.
Note that (1) implies (2), (3) and (4) by Lemma \ref{lemma-where-invertible}.
(Note that (3) is a special case of (4).)
Assertion (5) follows from Lemma \ref{lemma-principal-open}.
Assertions (6) and (7) follow because the open subsets $D_{+}(f)$
form a basis for the topology of $X$ and are affine.
\end{proof}

\begin{lemma}
\label{lemma-comparison-proj-quasi-coherent}
Let $S$ be a graded ring. Set $X = \text{Proj}(S)$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Set $M = \bigoplus_{n \in \mathbf{Z}} \Gamma(X, \mathcal{F}(n))$ as
a graded $S$-module, using
(\ref{equation-global-sections-module}) and (\ref{equation-global-sections}).
Then there is a canonical $\mathcal{O}_X$-module map
$$
\widetilde{M} \longrightarrow \mathcal{F}
$$
functorial in $\mathcal{F}$ such that the induced map
$M_0 \to \Gamma(X, \mathcal{F})$ is the identity.
\end{lemma}

\begin{proof}
Let $f \in S$ be homogeneous of degree $d > 0$. Recall that
$\widetilde{M}|_{D_{+}(f)}$ corresponds to the
$S_{(f)}$-module $M_{(f)}$ by Lemma \ref{lemma-proj-sheaves}.
Thus we can define a canonical map
$$
M_{(f)} \longrightarrow \Gamma(D_+(f), \mathcal{F}),\quad
m/f^n \longmapsto m|_{D_+(f)} \otimes f|_{D_+(f)}^{-n}
$$
which makes sense because $f|_{D_+(f)}$ is a trivializing
section of the invertible sheaf $\mathcal{O}_X(d)|_{D_+(f)}$, see
Lemma \ref{lemma-when-invertible} and its proof.
Since $\widetilde{M}$ is quasi-coherent, this leads to a canonical
map
$$
\widetilde{M}|_{D_+(f)} \longrightarrow \mathcal{F}|_{D_+(f)}
$$
via Schemes, Lemma \ref{schemes-lemma-compare-constructions}.
We obtain a global map if we prove that the displayed maps glue on overlaps.
Proof of this is omitted. We also omit the proof of the final statement.
\end{proof}
















\section{Functoriality of Proj}
\label{section-functoriality-proj}

\noindent
This is reminiscent of the olden days.
The point is that Proj is covariant,
i.e. for rings  $S' \subset S$ we have
$\text{Proj}S \subset \text{Proj}S$
(under the right conditions,
which is the point of this section),
meaning that, indeed,
{\bf Projs are projective schemes}.

\noindent
A graded ring map $\psi : A \to B$ does not always give rise to a morphism of
associated projective homogeneous spectra. The reason is that
the inverse image $\psi^{-1}(\mathfrak q)$
of a homogeneous prime $\mathfrak q \subset B$ may
contain the irrelevant prime $A_{+}$ even if $\mathfrak q$ does not
contain $B_{+}$.
The correct result is stated as follows.

\begin{lemma}
\label{lemma-morphism-proj}
Let $A$, $B$ be two graded rings.
Set $X = \text{Proj}(A)$ and $Y = \text{Proj}(B)$.
Let $\psi : A \to B$ be a graded ring map.
Set
$$
U(\psi)
=
\bigcup\nolimits_{f \in A_{+}\ \text{homogeneous}} D_{+}(\psi(f))
\subset Y.
$$
Then there is a canonical morphism of schemes
$$
r_\psi :
U(\psi)
\longrightarrow
X
$$
and a map of $\mathbf{Z}$-graded $\mathcal{O}_{U(\psi)}$-algebras
$$
\theta = \theta_\psi :
r_\psi^*\left(
\bigoplus\nolimits_{d \in \mathbf{Z}} \mathcal{O}_X(d)
\right)
\longrightarrow
\bigoplus\nolimits_{d \in \mathbf{Z}} \mathcal{O}_{U(\psi)}(d).
$$
The triple $(U(\psi), r_\psi, \theta)$ is
characterized by the following properties:
\begin{enumerate}
\item For every $d \geq 0$ the diagram
$$
\xymatrix{
A_d \ar[d] \ar[rr]_{\psi} & &
B_d \ar[d] \\
\Gamma(X, \mathcal{O}_X(d)) \ar[r]^-\theta &
\Gamma(U(\psi), \mathcal{O}_Y(d)) &
\Gamma(Y, \mathcal{O}_Y(d)) \ar[l]
}
$$
is commutative.
\item For any $f \in A_{+}$ homogeneous
we have $r_\psi^{-1}(D_{+}(f)) = D_{+}(\psi(f))$ and
the restriction of $r_\psi$ to $D_{+}(\psi(f))$
corresponds to the ring map
$A_{(f)} \to B_{(\psi(f))}$ induced by $\psi$.
\end{enumerate}
\end{lemma}

\begin{proof}
Clearly condition (2) uniquely determines the morphism of schemes
and the open subset $U(\psi)$. Pick $f \in A_d$ with $d \geq 1$.
Note that
$\mathcal{O}_X(n)|_{D_{+}(f)}$ corresponds to the
$A_{(f)}$-module $(A_f)_n$ and that
$\mathcal{O}_Y(n)|_{D_{+}(\psi(f))}$ corresponds to the
$B_{(\psi(f))}$-module $(B_{\psi(f)})_n$. In other words $\theta$
when restricted to $D_{+}(\psi(f))$ corresponds to a map of
$\mathbf{Z}$-graded $B_{(\psi(f))}$-algebras
$$
A_f \otimes_{A_{(f)}} B_{(\psi(f))}
\longrightarrow
B_{\psi(f)}
$$
Condition (1) determines the images of all elements of $A$.
Since $f$ is an invertible element which is mapped to $\psi(f)$
we see that $1/f^m$ is mapped to $1/\psi(f)^m$. It easily follows
from this that $\theta$ is uniquely determined, namely it is
given by the rule
$$
a/f^m \otimes b/\psi(f)^e \longmapsto \psi(a)b/\psi(f)^{m + e}.
$$
To show existence we remark that the proof of uniqueness above gave
a well defined prescription for the morphism $r$ and the map $\theta$
when restricted to every standard open of the form
$D_{+}(\psi(f)) \subset U(\psi)$ into $D_{+}(f)$.
Call these $r_f$ and $\theta_f$.
Hence we only need to verify that if $D_{+}(f) \subset D_{+}(g)$
for some $f, g \in A_{+}$ homogeneous, then the restriction of
$r_g$ to $D_{+}(\psi(f))$ matches $r_f$. This is clear from the
formulas given for $r$ and $\theta$ above.
\end{proof}

\begin{lemma}
\label{lemma-morphism-proj-transitive}
Let $A$, $B$, and $C$ be graded rings.
Set $X = \text{Proj}(A)$, $Y = \text{Proj}(B)$ and $Z = \text{Proj}(C)$.
Let $\varphi : A \to B$, $\psi : B \to C$ be graded ring maps.
Then we have
$$
U(\psi \circ \varphi) = r_\psi^{-1}(U(\varphi))
\quad
\text{and}
\quad
r_{\psi \circ \varphi}
=
r_\varphi \circ r_\psi|_{U(\psi \circ \varphi)}.
$$
In addition we have
$$
\theta_\psi \circ r_\psi^*\theta_\varphi
=
\theta_{\psi \circ \varphi}
$$
with obvious notation.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-surjective-graded-rings-map-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-proj} above.
Assume $A_d \to B_d$ is surjective for all $d \gg 0$. Then
\begin{enumerate}
\item $U(\psi) = Y$,
\item $r_\psi : Y \to X$ is a closed immersion, and
\item the maps $\theta : r_\psi^*\mathcal{O}_X(n) \to \mathcal{O}_Y(n)$
are surjective but not isomorphisms in general (even if $A \to B$ is
surjective).
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from the definition of $U(\psi)$ and the fact that
$D_{+}(f) = D_{+}(f^n)$ for any $n > 0$. For $f \in A_{+}$ homogeneous
we see that $A_{(f)} \to B_{(\psi(f))}$ is surjective because
any element of $B_{(\psi(f))}$ can be represented by a fraction
$b/\psi(f)^n$ with $n$ arbitrarily large (which forces the degree of
$b \in B$ to be large). This proves (2).
The same argument shows the map
$$
A_f \to B_{\psi(f)}
$$
is surjective which proves the surjectivity of $\theta$.
For an example where this map is not an isomorphism
consider the graded ring $A = k[x, y]$ where $k$ is a field
and $\deg(x) = 1$, $\deg(y) = 2$. Set $I = (x)$, so that
$B = k[y]$. Note that $\mathcal{O}_Y(1) = 0$ in this case.
But it is easy to see that $r_\psi^*\mathcal{O}_X(1)$
is not zero. (There are less silly examples.)
\end{proof}

\begin{lemma}
\label{lemma-eventual-iso-graded-rings-map-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-proj} above.
Assume $A_d \to B_d$ is an isomorphism for all $d \gg 0$. Then
\begin{enumerate}
\item $U(\psi) = Y$,
\item $r_\psi : Y \to X$ is an isomorphism, and
\item the maps $\theta : r_\psi^*\mathcal{O}_X(n) \to \mathcal{O}_Y(n)$
are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
We have (1) by Lemma \ref{lemma-surjective-graded-rings-map-proj}.
Let $f \in A_{+}$ be homogeneous. The assumption on $\psi$ implies that
$A_f \to B_f$ is an isomorphism (details omitted). Thus it is clear that
$r_\psi$ and $\theta$ restrict to isomorphisms over $D_{+}(f)$.
The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-surjective-graded-rings-generated-degree-1-map-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-proj} above.
Assume $A_d \to B_d$ is surjective for $d \gg 0$ and that $A$ is generated
by $A_1$ over $A_0$. Then
\begin{enumerate}
\item $U(\psi) = Y$,
\item $r_\psi : Y \to X$ is a closed immersion, and
\item the maps $\theta : r_\psi^*\mathcal{O}_X(n) \to \mathcal{O}_Y(n)$
are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemmas \ref{lemma-eventual-iso-graded-rings-map-proj} and
\ref{lemma-morphism-proj-transitive}
we may replace $B$ by the image of $A \to B$
without changing $X$ or the sheaves $\mathcal{O}_X(n)$.
Thus we may assume that $A \to B$ is surjective. By
Lemma \ref{lemma-surjective-graded-rings-map-proj} we get (1) and (2)
and surjectivity in (3).
By Lemma \ref{lemma-apply-modules} we see that both
$\mathcal{O}_X(n)$ and $\mathcal{O}_Y(n)$
are invertible. Hence $\theta$ is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-base-change-map-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-proj} above.
Assume there exists a ring map $R \to A_0$ and a ring map
$R \to R'$ such that $B = R' \otimes_R A$. Then
\begin{enumerate}
\item $U(\psi) = Y$,
\item the diagram
$$
\xymatrix{
Y = \text{Proj}(B) \ar[r]_{r_\psi} \ar[d] &
\text{Proj}(A) = X \ar[d] \\
\Spec(R') \ar[r] &
\Spec(R)
}
$$
is a fibre product square, and
\item the maps $\theta : r_\psi^*\mathcal{O}_X(n) \to \mathcal{O}_Y(n)$
are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows immediately by looking at what happens over the standard
opens $D_{+}(f)$ for $f \in A_{+}$.
\end{proof}

\begin{lemma}
\label{lemma-localization-map-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-proj} above.
Assume there exists a $g \in A_0$ such that $\psi$ induces an
isomorphism $A_g \to B$. Then
$U(\psi) = Y$, $r_\psi : Y \to X$ is an open immersion
which induces an isomorphism of $Y$ with the inverse image
of $D(g) \subset \Spec(A_0)$. Moreover the map $\theta$
is an isomorphism.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-base-change-map-proj} above.
\end{proof}

\begin{lemma}
\label{lemma-d-uple}
Let $S$ be a graded ring. Let $d \geq 1$. Set $S' = S^{(d)}$ with notation
as in Algebra, Section \ref{algebra-section-graded}. Set
$X = \text{Proj}(S)$ and $X' = \text{Proj}(S')$. There is a canonical
isomorphism $i : X \to X'$ of schemes such that
\begin{enumerate}
\item for any graded $S$-module $M$ setting $M' = M^{(d)}$,
we have a canonical isomorphism $\widetilde{M} \to i^*\widetilde{M'}$,
\item we have canonical isomorphisms
$\mathcal{O}_{X}(nd) \to i^*\mathcal{O}_{X'}(n)$
\end{enumerate}
and these isomorphisms are compatible with the multiplication maps
of Lemma \ref{lemma-widetilde-tensor} and hence with the maps
(\ref{equation-multiply}),
(\ref{equation-multiply-on-sheaf}),
(\ref{equation-global-sections}),
(\ref{equation-global-sections-module}),
(\ref{equation-multiply-more-generally}), and
(\ref{equation-global-sections-more-generally}) (see proof for precise
statements.
\end{lemma}

\begin{proof}
The injective ring map $S' \to S$ (which is not a homomorphism of graded rings
due to our conventions), induces a map $j : \Spec(S) \to \Spec(S')$.
Given a graded prime ideal $\mathfrak p \subset S$ we see that
$\mathfrak p' = j(\mathfrak p) = S' \cap \mathfrak p$
is a graded prime ideal of $S'$.
Moreover, if $f \in S_+$ is homogeneous and $f \not \in \mathfrak p$, then
$f^d \in S'_+$ and $f^d \not \in \mathfrak p'$. Conversely, if
$\mathfrak p' \subset S'$ is a graded prime ideal not containing some
homogeneous element $f \in S'_+$, then
$\mathfrak p = \{g \in S \mid g^d \in \mathfrak p'\}$ is a
graded prime ideal of $S$ not containing $f$ whose image under $j$
is $\mathfrak p'$. To see that $\mathfrak p$ is an ideal, note
that if $g, h \in \mathfrak p$, then
$(g + h)^{2d} \in \mathfrak p'$ by the binomial formula
and hence $g + h \in \mathfrak p'$ as $\mathfrak p'$ is a prime.
In this way we see that $j$ induces a homeomorphism $i : X \to X'$.
Moreover, given $f \in S_+$ homogeneous, then we have
$S_{(f)} \cong S'_{(f^d)}$. Since these isomorphisms are compatible
with the restrictions mappings of
Lemma \ref{lemma-standard-open}, we see that there exists an
isomorphism $i^\sharp : i^{-1}\mathcal{O}_{X'} \to \mathcal{O}_X$ of
structure sheaves on $X$ and $X'$, hence $i$ is an isomorphism
of schemes.

\medskip\noindent
Let $M$ be a graded $S$-module. Given $f \in S_+$ homogeneous, we have
$M_{(f)} \cong M'_{(f^d)}$, hence in exactly the same manner as above
we obtain the isomorphism in (1). The isomorphisms in (2) are a special
case of (1) for $M = S(nd)$ which gives $M' = S'(n)$. Let $M$ and $N$
be graded $S$-modules. Then we have
$$
M' \otimes_{S'} N' =
(M \otimes_S N)^{(d)} =
(M \otimes_S N)'
$$
as can be verified directly from the definitions. Having said this
the compatibility with the multiplication maps of
Lemma \ref{lemma-widetilde-tensor} is the commutativity of the diagram
$$
\xymatrix{
\widetilde M \otimes_{\mathcal{O}_X} \widetilde N
\ar[d]_{(1) \otimes (1)} \ar[r] &
\widetilde{M \otimes_S N} \ar[d]^{(1)} \\
i^*(\widetilde{M'} \otimes_{\mathcal{O}_{X'}} \widetilde{N'}) \ar[r] &
i^*(\widetilde{M' \otimes_{S'} N'})
}
$$
This can be seen by looking at the construction of the maps
over the open $D_+(f) = D_+(f^d)$ where the top horizontal
arrow is given by the map
$M_{(f)} \times N_{(f)} \to (M \otimes_S N)_{(f)}$
and the lower horizontal arrow by the map
$M'_{(f^d)} \times N'_{(f^d)} \to (M' \otimes_{S'} N')_{(f^d)}$.
Since these maps agree via the identifications
$M_{(f)} = M'_{(f^d)}$, etc, we get the desired compatibility.
We omit the proof of the other compatibilities.
\end{proof}













\section{Dominant morphisms}
\label{section-dominant}

\noindent
The definition of a morphism of schemes being dominant is a little
different from what you might expect if you are used to the notion
of a dominant morphism of varieties.

\begin{definition}
\label{definition-dominant}
A morphism $f : X \to S$ of schemes is called {\it dominant} if the
image of $f$ is a dense subset of $S$.
\end{definition}

\section{Morphisms of finite type}
\label{section-finite-type}

\noindent
Recall that a ring map $R \to A$ is said to be of finite type if
$A$ is isomorphic to a quotient of $R[x_1, \ldots, x_n]$ as an $R$-algebra, see
Algebra, Definition \ref{algebra-definition-finite-type}.

\begin{definition}
\label{definition-finite-type}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is of {\it finite type at $x \in X$} if
there exists an affine open neighbourhood $\Spec(A) = U \subset X$
of $x$ and an affine open $\Spec(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is of finite type.
\item We say that $f$ is {\it locally of finite type} if it is
of finite type at every point of $X$.
\item We say that $f$ is of {\it finite type} if it is locally of
finite type and quasi-compact.
\end{enumerate}
\end{definition}

\section{Flat morphisms}
\label{section-flat-morphisms}

\noindent
The essential technical property
for for defining flatness
is the preservation of exact sequences.
Right-exactness is true in general;
it follows from currying in category
of commutative rings.
But the functor $-\otimes_R N$ does not
preserve injectivity of maps---
that's the point of flatness.

\begin{lemma}[Internal Hom for R-modules]
\label{lemma-hom-from-tensor-product}
For any three $R$-modules $M, N, P$,
$$
\Hom_R(M \otimes_R N, P) \cong \Hom_R(M, \Hom_R(N, P))
$$
\end{lemma}

\begin{proof}
An $R$-linear map $\hat{f}\in \Hom_R(M \otimes_R N, P)$ corresponds to an
$R$-bilinear map $f : M \times N \to P$. For
each $x\in M$ the mapping $y\mapsto f(x, y)$ is $R$-linear by the universal
property. Thus $f$ corresponds to a
map $\phi_f : M \to \Hom_R(N, P)$. This map is $R$-linear since
$$
\phi_f(ax + y)(z) =
f(ax + y, z) = af(x, z)+f(y, z) =
(a\phi_f(x)+\phi_f(y))(z),
$$
for all $a \in R$, $x \in M$, $y \in M$ and
$z \in N$. Conversely, any
$f \in \Hom_R(M, \Hom_R(N, P))$ defines an $R$-bilinear
map $M \times N \to P$, namely $(x, y)\mapsto f(x)(y)$.
So this is a natural one-to-one correspondence between the
two modules
$\Hom_R(M \otimes_R N, P)$ and $\Hom_R(M, \Hom_R(N, P))$.
\end{proof}

\begin{lemma}[Tensor product is right exact]
\label{lemma-tensor-product-exact}
Let
\begin{align*}
M_1\xrightarrow{f} M_2\xrightarrow{g} M_3 \to 0
\end{align*}
be an exact sequence of $R$-modules and homomorphisms, and let $N$ be any
$R$-module. Then the sequence
\begin{equation}
\label{equation-2ndex}
M_1\otimes N\xrightarrow{f \otimes 1} M_2\otimes N \xrightarrow{g \otimes 1}
M_3\otimes N \to 0
\end{equation}
is exact. In other words, the functor $- \otimes_R N$ is
{\it right exact}, in the sense that tensoring
each term in the original right exact sequence preserves the exactness.
\end{lemma}

\begin{proof}
For every $R$-module $P$
we apply the functor $\Hom(-, \Hom(N, P))$ to the first exact
sequence. We obtain
$$
0 \to
\Hom(M_3, \Hom(N, P)) \to
\Hom(M_2, \Hom(N, P)) \to
\Hom(M_1, \Hom(N, P))
$$
which is exact by Lemma \ref{lemma-hom-exact} (1).
By Lemma \ref{lemma-hom-from-tensor-product} this becomes the sequence
$$
0 \to \Hom(M_3 \otimes N, P) \to
\Hom(M_2 \otimes N, P) \to \Hom(M_1 \otimes N, P)
$$
which is therefore also exact. Then using
Lemma \ref{lemma-hom-exact} (1) again, we arrive at the desired exact sequence.
\end{proof}

\begin{remark}
\label{remark-tensor-product-not-exact}
However, tensor product does NOT preserve exact sequences in general.
In other words, if $M_1 \to M_2 \to M_3$ is
exact, then it is not necessarily true that
$M_1 \otimes N \to M_2 \otimes N \to M_3 \otimes N$
is exact for arbitrary $R$-module $N$.
\end{remark}

\begin{example}
\label{example-tensor-product-not-exact}
Consider the injective map $2 : \mathbf{Z}\to \mathbf{Z}$
viewed as a map of $\mathbf{Z}$-modules.
Let $N = \mathbf{Z}/2$. Then the induced map
$\mathbf{Z} \otimes \mathbf{Z}/2 \to \mathbf{Z} \otimes \mathbf{Z}/2$
is NOT injective. This is because for
$x \otimes y\in \mathbf{Z} \otimes \mathbf{Z}/2$,
$$
(2 \otimes 1)(x \otimes y) = 2x \otimes y = x \otimes 2y = x \otimes 0 = 0
$$
Therefore the induced map is the zero map while $\mathbf{Z} \otimes N\neq 0$.
\end{example}

\begin{definition}
\label{definition-flat-module}
For $R$-modules $N$, if the
functor $-\otimes_R N$ is exact, i.e. tensoring
with $N$ preserves all exact
sequences, then $N$ is said to be {\it flat} $R$-module.
We will discuss this later in Section \ref{section-flat}.
\end{definition}

\medskip\noindent
Epiphany:
in the category of commutative rings
pushout is tensor product.
So think of $\Spec $ as a functor
from $\mathit{CRing}^{\text{op}}$ to $\Sch$,
then pushout goes to pullback,
and what's an example of a pullback?
Fibre!
So, the coordinate ring of a fiber
is essentially given by the residue field
at the point that parametrizes it!
(tensored with the coordinate ring
of the deformation space).

There is a lot of information on Stacks Project about flatness.
It looks like the heart of the concept is 
captured in the commutative-algebraic notion of preserving
exact sequences:

\begin{definition}
\label{definition-flat}
Let $R$ be a ring.
\begin{enumerate}
\item An $R$-module $M$ is called {\it flat} if whenever
$N_1 \to N_2 \to N_3$ is an exact sequence of $R$-modules
the sequence $M \otimes_R N_1 \to M \otimes_R N_2 \to M \otimes_R N_3$
is exact as well.
\item An $R$-module $M$ is called {\it faithfully flat} if the
complex of $R$-modules
$N_1 \to N_2 \to N_3$ is exact if and only if
the sequence $M \otimes_R N_1 \to M \otimes_R N_2 \to M \otimes_R N_3$
is exact.
\item A ring map $R \to S$ is called {\it flat} if
$S$ is flat as an $R$-module.
\item A ring map $R \to S$ is called {\it faithfully flat} if
$S$ is faithfully flat as an $R$-module.
\end{enumerate}
\end{definition}

\medskip\noindent
Recall that a module $M$ over a ring $R$ is {\it flat} if the functor
$-\otimes_R M : \text{Mod}_R \to \text{Mod}_R$ is exact. A ring map
$R \to A$ is said to be {\it flat} if $A$ is flat as an $R$-module.

\section{Singularities}
\label{section-singularities}

As in \cite{sea},
a Noetherian local ring $A$ is {\it regular} 
if $\dim A = \dim_k\mathfrak{m}/\mathfrak{m}^2$.
The stalk $\mathcal{O}_{X,p}$ is
always local
so we say that $p$ is {\it regular} 
if its stalk is regular.

\section{Invertible modules (line bundles)}
\label{section-invertible}

\noindent
Similarly to the case of modules over rings
(More on Algebra, Section \ref{more-algebra-section-picard})
we have the following definition.

\begin{definition}
\label{definition-invertible}
Let $(X, \mathcal{O}_X)$ be a ringed space. An
{\it invertible $\mathcal{O}_X$-module} is a sheaf
of $\mathcal{O}_X$-modules $\mathcal{L}$ such that
the functor
$$
\textit{Mod}(\mathcal{O}_X) \longrightarrow \textit{Mod}(\mathcal{O}_X),\quad
\mathcal{F} \longmapsto \mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{F}
$$
is an equivalence of categories. We say that $\mathcal{L}$ is
{\it trivial} if it is isomorphic as an $\mathcal{O}_X$-module
to $\mathcal{O}_X$.
\end{definition}

\noindent
Lemma \ref{lemma-invertible-is-locally-free-rank-1}
below explains the relationship with locally free modules
of rank $1$.

\begin{lemma}
\label{lemma-invertible}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{L}$
be an $\mathcal{O}_X$-module. Equivalent are
\begin{enumerate}
\item $\mathcal{L}$ is invertible, and
\item there exists an $\mathcal{O}_X$-module $\mathcal{N}$
such that
$\mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N} \cong \mathcal{O}_X$.
\end{enumerate}
In this case $\mathcal{L}$ is locally a direct summand of a finite free
$\mathcal{O}_X$-module and the module $\mathcal{N}$ in (2) is isomorphic to
$\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Assume (1). Then the functor $- \otimes_{\mathcal{O}_X} \mathcal{L}$
is essentially surjective, hence there exists an $\mathcal{O}_X$-module
$\mathcal{N}$ as in (2). If (2) holds, then the functor
$- \otimes_{\mathcal{O}_X} \mathcal{N}$ is a quasi-inverse
to the functor $- \otimes_{\mathcal{O}_X} \mathcal{L}$ and
we see that (1) holds.

\medskip\noindent
Assume (1) and (2) hold. Denote
$\psi : \mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N} \to \mathcal{O}_X$
the given isomorphism. Let $x \in X$. Choose an open neighbourhood
$U$ an integer $n \geq 1$ and sections $s_i \in \mathcal{L}(U)$,
$t_i \in \mathcal{N}(U)$ such that $\psi(\sum s_i \otimes t_i) = 1$.
Consider the isomorphisms
$$
\mathcal{L}|_U \to
\mathcal{L}|_U \otimes_{\mathcal{O}_U}
\mathcal{L}|_U \otimes_{\mathcal{O}_U} \mathcal{N}|_U \to \mathcal{L}|_U
$$
where the first arrow sends $s$ to $\sum s_i \otimes s \otimes t_i$
and the second arrow sends $s \otimes s' \otimes t$ to $\psi(s' \otimes t)s$.
We conclude that $s \mapsto \sum \psi(s \otimes t_i)s_i$ is
an automorphism of $\mathcal{L}|_U$. This automorphism factors as
$$
\mathcal{L}|_U \to \mathcal{O}_U^{\oplus n} \to \mathcal{L}|_U
$$
where the first arrow is given by
$s \mapsto (\psi(s \otimes t_1), \ldots, \psi(s \otimes t_n))$
and the second arrow by $(a_1, \ldots, a_n) \mapsto \sum a_i s_i$.
In this way we conclude that $\mathcal{L}|_U$ is a direct summand
of a finite free $\mathcal{O}_U$-module.

\medskip\noindent
Assume (1) and (2) hold. Consider the evaluation map
$$
\mathcal{L} \otimes_{\mathcal{O}_X}
\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)
\longrightarrow \mathcal{O}_X
$$
To finish the proof of the lemma
we will show this is an isomorphism by checking it induces
isomorphisms on stalks. Let $x \in X$.
Since we know (by the previous paragraph)
that $\mathcal{L}$ is a finitely presented
$\mathcal{O}_X$-module
we can use Lemma \ref{lemma-stalk-internal-hom}
to see that it suffices to show that
$$
\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}}
\Hom_{\mathcal{O}_{X, x}}(\mathcal{L}_x, \mathcal{O}_{X, x})
\longrightarrow \mathcal{O}_{X, x}
$$
is an isomorphism. Since
$\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}} \mathcal{N}_x =
(\mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N})_x =
\mathcal{O}_{X, x}$ (Lemma \ref{lemma-stalk-tensor-product})
the desired result follows from
More on Algebra, Lemma \ref{more-algebra-lemma-invertible}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-invertible}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a
morphism of ringed spaces. The pullback $f^*\mathcal{L}$ of an
invertible $\mathcal{O}_Y$-module is invertible.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-invertible}
there exists an $\mathcal{O}_Y$-module $\mathcal{N}$ such that
$\mathcal{L} \otimes_{\mathcal{O}_Y} \mathcal{N} \cong \mathcal{O}_Y$.
Pulling back we get
$f^*\mathcal{L} \otimes_{\mathcal{O}_X} f^*\mathcal{N} \cong \mathcal{O}_X$
by Lemma \ref{lemma-tensor-product-pullback}.
Thus $f^*\mathcal{L}$ is invertible by Lemma \ref{lemma-invertible}.
\end{proof}

\begin{lemma}
\label{lemma-invertible-is-locally-free-rank-1}
Let $(X, \mathcal{O}_X)$ be a ringed space. Any locally free
$\mathcal{O}_X$-module of rank $1$ is invertible.
If all stalks $\mathcal{O}_{X, x}$ are local rings, then
the converse holds as well (but in general this is not the case).
\end{lemma}

\begin{proof}
The parenthetical statement follows by considering a one point
space $X$ with sheaf of rings $\mathcal{O}_X$ given by a ring $R$.
Then invertible $\mathcal{O}_X$-modules correspond to invertible
$R$-modules, hence as soon as $\Pic(R)$ is not the trivial group,
then we get an example.

\medskip\noindent
Assume $\mathcal{L}$ is locally free of rank $1$ and consider the
evaluation map
$$
\mathcal{L} \otimes_{\mathcal{O}_X}
\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)
\longrightarrow \mathcal{O}_X
$$
Looking over an open covering trivialization $\mathcal{L}$, we see
that this map is an isomorphism. Hence $\mathcal{L}$ is invertible
by Lemma \ref{lemma-invertible}.

\medskip\noindent
Assume all stalks $\mathcal{O}_{X, x}$ are local rings and $\mathcal{L}$
invertible. In the proof of Lemma \ref{lemma-invertible}
we have seen that $\mathcal{L}_x$ is an invertible
$\mathcal{O}_{X, x}$-module for all $x \in X$. Since
$\mathcal{O}_{X, x}$ is local, we see that
$\mathcal{L}_x \cong \mathcal{O}_{X, x}$
(More on Algebra, Section \ref{more-algebra-section-picard}).
Since $\mathcal{L}$ is of finite presentation by
Lemma \ref{lemma-invertible} we conclude that $\mathcal{L}$
is locally free of rank $1$ by
Lemma \ref{lemma-finite-presentation-stalk-free}.
\end{proof}

Now I introduce some of the properties of line bundles, Cartier divisors and so
on.

\begin{lemma}
\label{lemma-Cartier-effective-and-invertible-sheaf}
The ideal sheaf of an effective Cartier divisor (a subscheme locally defined by
the vanishing of a single function) is an invertible sheaf.
\end{lemma}

\begin{proof}
We just need to check that the generator of the ideal sheaf at any affine set is
not a zerodivisor. This follows from the ideal sheaf exact sequence, which
implies that multplication by the generator is injective:
 $$
\xymatrix{
0\ar[r]&I\cong A\ar[r]&A\ar[r]&A/I\ar[r]&0
}
$$
\end{proof}


\section{Ampleness}
\label{section-ampleness}

First is this lemma that comes from modules.tex. I think these sets $X_s$ are
the base points of the bundle. Because look: image of $s$ just means consider
the section $s$ of the line bundle as a germ near $x$. Now a line bundle is a
locally free rank-1 $\mathcal{O}_X$-module, so its sections, like $s$, may be
multiplied by germs of functions in the maximal ring $\mathfrak{m}_x$, i.e. the
functions that vanish at $x$. So $X_s$ is the vanishing locus of the section
$s$. If $s(x)\neq 0$, obviously $s
\not\in\mathfrak{m}_x\mathcal{L}_x$, so $x\in X_s$. Conversely, I would like to
show that if $s(x)=0$ then  $s\in\mathfrak{m}_x\mathcal{L}_x$ but I'm not sure
how. It's like: a vector field with a zero can be multiplied by a function that
vanishes at the point, sure, but what's this function?

\begin{lemma}
\label{lemma-s-open}
From modules.tex.
\begin{slogan}
A (local) trivialisation of a linebundle
is the same as a (local) nonvanishing section.
\end{slogan}
Let $X$ be a ringed space. Assume that each stalk $\mathcal{O}_{X, x}$
is a local ring with maximal ideal $\mathfrak m_x$.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
For any section $s \in \Gamma(X, \mathcal{L})$ the set
$$
X_s = \{x \in X \mid \text{image }s \not\in \mathfrak m_x\mathcal{L}_x\}
$$
is open in $X$. The map $s : \mathcal{O}_{X_s} \to \mathcal{L}|_{X_s}$
is an isomorphism, and there exists a section $s'$
of $\mathcal{L}^{\otimes -1}$ over $X_s$ such that $s' (s|_{X_s}) = 1$.
\end{lemma}

\begin{proof}
Suppose $x \in X_s$.
We have an isomorphism
$$
\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}} (\mathcal{L}^{\otimes -1})_x
\longrightarrow
\mathcal{O}_{X, x}
$$
by Lemma \ref{lemma-constructions-invertible}.
Both $\mathcal{L}_x$ and $(\mathcal{L}^{\otimes -1})_x$
are free $\mathcal{O}_{X, x}$-modules of rank $1$. We conclude
from Algebra, Nakayama's Lemma \ref{algebra-lemma-NAK} that
$s_x$ is a basis for $\mathcal{L}_x$. Hence there exists
a basis element $t_x \in (\mathcal{L}^{\otimes -1})_x$
such that $s_x \otimes t_x$ maps to $1$.
Choose an open neighbourhood $U$ of
$x$ such that $t_x$ comes from a section $t$
of $\mathcal{L}^{\otimes -1}$ over $U$ and such that
$s \otimes t$ maps to $1 \in \mathcal{O}_X(U)$.
Clearly, for every $x' \in U$ we see that $s$ generates
the module $\mathcal{L}_{x'}$. Hence $U \subset X_s$.
This proves that $X_s$ is open. Moreover, the section
$t$ constructed over $U$ above is unique, and hence
these glue to give the section $s'$ of the lemma.
\end{proof}

Recall from Modules, Lemma \ref{modules-lemma-s-open}
that given an invertible sheaf $\mathcal{L}$ on a locally ringed
space $X$, and given a global section $s$ of $\mathcal{L}$
the set $X_s = \{x \in X \mid s \not \in \mathfrak m_x\mathcal{L}_x\}$
is open. A general remark is that
$X_s \cap X_{s'} = X_{ss'}$, where $ss'$ denote
the section $s \otimes s' \in \Gamma(X, \mathcal{L} \otimes \mathcal{L}')$.

\begin{definition}
\label{definition-ample}
\begin{reference}
\cite[II Definition 4.5.3]{EGA}
\end{reference}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
We say $\mathcal{L}$ is {\it ample} if
\begin{enumerate}
\item $X$ is quasi-compact, and
\item for every $x \in X$ there exists an $n \geq 1$
and $s \in \Gamma(X, \mathcal{L}^{\otimes n})$ such
that $x \in X_s$ and $X_s$ is affine.
\end{enumerate}
\end{definition}

\begin{exercise}
\label{exercise-ample-bundle-on-K3}
Let $L$ be an ample bundle on a K3 surface $M$. Prove that
$\mathcal{L}^{\otimes 2}$ is globally generated (that is, for each $x\in M$
there exsits a section $h \in H^{0}(L^{\otimes 2})$ which does not vanish in
$x$).
\end{exercise}

\begin{proof}
This just asks that the $n$ in Definition \ref{definition-ample} is $2$ for all
$x\in X$. Because, again, $x\in X_s$ means that $s(x)\neq 0$ because if it was,
then we could somehow write $s$ as a product of a vanishing function on
$\mathfrak{m}_x$ and a local frame of $\Gamma(X,\mathcal{L})$. But I guess for
the exercise do this: a line bundle is {\it ample} if there is $n$ such that the
canonical embedding (cf Lemma \ref{lemma-map-into-proj}) is an embedding, i.e.
that $\mathcal{L}^{\otimes n}$ is {\it very ample}. (Interestingly, the notion
very ampleness is defined in morphisms.tex.)
\end{proof}

Now we pass to the part where ampleness gives you an {\bf open immersion} to
some projective space. Because, it's only very ampleness that gives an
embedding, right? (Actually I think here in stacks project there are no
embeddings but closed immersions.)

\begin{definition}
\label{definition-gamma-star}
From modules.tex. Let $(X, \mathcal{O}_X)$ be a ringed space.
Given an invertible sheaf $\mathcal{L}$ on $X$ we define
the {\it associated graded ring} to be
$$
\Gamma_*(X, \mathcal{L})
=
\bigoplus\nolimits_{n \geq 0} \Gamma(X, \mathcal{L}^{\otimes n})
$$
Given a sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we set
$$
\Gamma_*(X, \mathcal{L}, \mathcal{F})
=
\bigoplus\nolimits_{n \in \mathbf{Z}} \Gamma(X,
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
$$
which we think of as a graded $\Gamma_*(X, \mathcal{L})$-module.
\end{definition}

\begin{lemma}
\label{lemma-map-into-proj}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$ as a graded ring.
If every point of $X$ is contained in one of the
open subschemes $X_s$, for some $s \in S_{+}$ homogeneous, then
there is a canonical morphism of schemes
$$
f : X \longrightarrow Y = \text{Proj}(S),
$$
to the homogeneous spectrum of $S$ (see
Constructions, Section \ref{constructions-section-proj}).
This morphism has the following properties
\begin{enumerate}
\item $f^{-1}(D_{+}(s)) = X_s$ for any $s \in S_{+}$ homogeneous,
\item there are $\mathcal{O}_X$-module maps
$f^*\mathcal{O}_Y(n) \to \mathcal{L}^{\otimes n}$
compatible with multiplication maps, see
Constructions, Equation (\ref{constructions-equation-multiply}),
\item the composition
$S_n \to \Gamma(Y, \mathcal{O}_Y(n)) \to \Gamma(X, \mathcal{L}^{\otimes n})$
is the identity map, and
\item for every $x \in X$ there is an integer $d \geq 1$
and an open neighbourhood $U \subset X$ of $x$
such that $f^*\mathcal{O}_Y(dn)|_U \to \mathcal{L}^{\otimes dn}|_U$
is an isomorphism for all $n \in \mathbf{Z}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Denote $\psi : S \to \Gamma_*(X, \mathcal{L})$ the identity map.
We are going to use the triple
$(U(\psi), r_{\mathcal{L}, \psi}, \theta)$ of
Constructions, Lemma \ref{constructions-lemma-invertible-map-into-proj}.
By assumption the open subscheme $U(\psi)$ of equals $X$. Hence
$r_{\mathcal{L}, \psi} : U(\psi) \to Y$ is defined on all of $X$.
We set $f = r_{\mathcal{L}, \psi}$.
The maps in part (2) are the components of $\theta$.
Part (3) follows from condition (2) in the lemma cited above.
Part (1) follows from (3) combined with condition (1) in the lemma
cited above. Part (4) follows from the last statement in
Constructions, Lemma \ref{constructions-lemma-invertible-map-into-proj}
since the map $\alpha$ mentioned there is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-map-into-proj-quasi-compact}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$.
Assume (a) every point of $X$ is contained in one of the
open subschemes $X_s$, for some $s \in S_{+}$ homogeneous,
and (b) $X$ is quasi-compact. Then the canonical morphism of schemes
$f : X \longrightarrow \text{Proj}(S)$ of Lemma \ref{lemma-map-into-proj}
above is quasi-compact with dense image.
\end{lemma}

\begin{proof}
To prove $f$ is quasi-compact it suffices to show that $f^{-1}(D_{+}(s))$
is quasi-compact for any $s \in S_{+}$ homogeneous. Write
$X = \bigcup_{i = 1, \ldots, n} X_i$ as a finite union of
affine opens. By Lemma \ref{lemma-affine-cap-s-open} each intersection
$X_s \cap X_i$ is affine. Hence $X_s = \bigcup_{i = 1, \ldots, n} X_s \cap X_i$
is quasi-compact. Assume that the image of $f$ is not dense to get
a contradiction. Then, since the opens $D_+(s)$ with $s \in S_+$ homogeneous
form a basis for the topology on $\text{Proj}(S)$, we can find such
an $s$ with $D_+(s) \not = \emptyset$ and $f(X) \cap D_+(s) = \emptyset$.
By Lemma \ref{lemma-map-into-proj}
this means $X_s = \emptyset$. By Lemma \ref{lemma-invert-s-sections}
this means that a power $s^n$ is the zero section of
$\mathcal{L}^{\otimes n\deg(s)}$.
This in turn means that $D_+(s) = \emptyset$ which is the
desired contradiction.
\end{proof}

\begin{lemma}
\label{lemma-ample-immersion-into-proj}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$.
Assume $\mathcal{L}$ is ample. Then the canonical morphism of schemes
$f : X \longrightarrow \text{Proj}(S)$ of Lemma \ref{lemma-map-into-proj}
is an open immersion with dense image.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-affine-s-opens-cover-quasi-separated} we see
that $X$ is quasi-separated. Choose finitely many
$s_1, \ldots, s_n \in S_{+}$ homogeneous
such that $X_{s_i}$ are affine, and $X = \bigcup X_{s_i}$.
Say $s_i$ has degree $d_i$. The inverse image of
$D_{+}(s_i)$ under $f$ is $X_{s_i}$, see Lemma \ref{lemma-map-into-proj}.
By Lemma \ref{lemma-invert-s-sections} the ring map
$$
(S^{(d_i)})_{(s_i)} = \Gamma(D_{+}(s_i), \mathcal{O}_{\text{Proj}(S)})
\longrightarrow
\Gamma(X_{s_i}, \mathcal{O}_X)
$$
is an isomorphism. Hence $f$ induces an isomorphism
$X_{s_i} \to D_{+}(s_i)$. Thus $f$ is an isomorphism of $X$ onto the open
subscheme $\bigcup_{i = 1, \ldots, n} D_{+}(s_i)$ of $\text{Proj}(S)$.
The image is dense by Lemma \ref{lemma-map-into-proj-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-open-in-proj-ample}
Let $X$ be a scheme.
Let $S$ be a graded ring. Assume $X$ is quasi-compact,
and assume there exists an open immersion
$$
j : X \longrightarrow Y = \text{Proj}(S).
$$
Then $j^*\mathcal{O}_Y(d)$ is an invertible ample sheaf
for some $d > 0$.
\end{lemma}

\begin{proof}
This is Constructions, Lemma \ref{constructions-lemma-ample-on-proj}.
\end{proof}

\begin{proposition}
\label{proposition-characterize-ample}
Let $X$ be a quasi-compact scheme.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
Set $S = \Gamma_*(X, \mathcal{L})$.
The following are equivalent:
\begin{enumerate}
\item
\label{item-ample}
$\mathcal{L}$ is ample,
\item
\label{item-immersion}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
cover $X$ and the associated morphism $X \to \text{Proj}(S)$
is an open immersion,
\item
\label{item-s-basis}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
form a basis for the topology of $X$,
\item
\label{item-s-affine-basis}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
which are affine form a basis for the topology of $X$,
\item
\label{item-qc-gg}
for every quasi-coherent sheaf $\mathcal{F}$ on $X$
the sum of the images of the canonical maps
$$
\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
\otimes_{\mathbf{Z}} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
with $n \geq 1$ equals $\mathcal{F}$,
\item
\label{item-qc-i-gg}
same property as (\ref{item-qc-gg}) with $\mathcal{F}$
ranging over all quasi-coherent sheaves of ideals,
\item
\label{item-c-gg}
$X$ is quasi-separated and
for every quasi-coherent sheaf $\mathcal{F}$ of finite type on $X$
there exists an integer $n_0$ such that
$\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
is globally generated for all $n \geq n_0$,
\item
\label{item-c-q}
$X$ is quasi-separated and
for every quasi-coherent sheaf $\mathcal{F}$ of finite type on $X$
there exist integers $n > 0$, $k \geq 0$ such that
$\mathcal{F}$ is a quotient of a direct sum of $k$ copies of
$\mathcal{L}^{\otimes - n}$, and
\item
\label{item-c-i-q}
same as in (\ref{item-c-q}) with $\mathcal{F}$ ranging over all
sheaves of ideals of finite type on $X$.
\end{enumerate}
\end{proposition}

\begin{proof}
Lemma \ref{lemma-ample-immersion-into-proj} is
(\ref{item-ample}) $\Rightarrow$ (\ref{item-immersion}).
Lemmas \ref{lemma-ample-power-ample} and \ref{lemma-open-in-proj-ample}
provide the implication
(\ref{item-ample}) $\Leftarrow$ (\ref{item-immersion}).
The implications (\ref{item-immersion}) $\Rightarrow$
(\ref{item-s-affine-basis}) $\Rightarrow$ (\ref{item-s-basis})
are clear from Constructions, Section \ref{constructions-section-proj}.
Lemma \ref{lemma-affine-s-opens} is
(\ref{item-s-basis}) $\Rightarrow$ (\ref{item-ample}).
Thus we see that the first 4 conditions are all equivalent.

\medskip\noindent
Assume the equivalent conditions (1) -- (4).
Note that in particular $X$ is separated (as an open
subscheme of the separated scheme $\text{Proj}(S)$).
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Choose $s \in S_{+}$ homogeneous such that $X_s$ is affine.
We claim that any section $m \in \Gamma(X_s, \mathcal{F})$
is in the image of one of the maps displayed in
(\ref{item-qc-gg}) above. This will imply (\ref{item-qc-gg})
since these affines $X_s$ cover $X$.
Namely, by Lemma \ref{lemma-invert-s-sections} we may write
$m$ as the image of $m' \otimes s^{-n}$ for some
$n \geq 1$, some
$m' \in \Gamma(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})$.
This proves the claim.

\medskip\noindent
Clearly (\ref{item-qc-gg}) $\Rightarrow$ (\ref{item-qc-i-gg}).
Let us assume (\ref{item-qc-i-gg}) and prove $\mathcal{L}$ is
ample. Pick $x \in X$. Let $U \subset X$ be an affine open
which contains $x$. Set $Z = X \setminus U$. We may think of
$Z$ as a reduced closed subscheme, see
Schemes, Section \ref{schemes-section-reduced}.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the quasi-coherent
sheaf of ideals corresponding to the closed subscheme $Z$.
By assumption (\ref{item-qc-i-gg}), there exists an $n \geq 1$ and a section
$s \in \Gamma(X, \mathcal{I} \otimes \mathcal{L}^{\otimes n})$
such that $s$ does not vanish at $x$ (more precisely such that
$s \not \in \mathfrak m_x \mathcal{I}_x \otimes \mathcal{L}_x^{\otimes n}$).
We may think of $s$ as a section of $\mathcal{L}^{\otimes n}$.
Since it clearly vanishes along $Z$ we see that
$X_s \subset U$. Hence $X_s$ is affine, see
Lemma \ref{lemma-affine-cap-s-open}.
This proves that $\mathcal{L}$ is ample.
At this point we have proved that (1) -- (6) are equivalent.

\medskip\noindent
Assume the equivalent conditions (1) -- (6). In the following
we will use the fact that the tensor product of two sheaves of
modules which are globally generated is globally generated without
further mention (see
Modules, Lemma \ref{modules-lemma-tensor-product-globally-generated}).
By (1) we can find elements $s_i \in S_{d_i}$ with $d_i \geq 1$
such that $X = \bigcup_{i = 1, \ldots, n} X_{s_i}$.
Set $d = d_1\ldots d_n$. It follows that $\mathcal{L}^{\otimes d}$
is globally generated by
$$
s_1^{d/d_1}, \ldots, s_n^{d/d_n}.
$$
This means that if $\mathcal{L}^{\otimes j}$ is globally generated
then so is $\mathcal{L}^{\otimes j + dn}$ for all $n \geq 0$.
Fix a $j \in \{0, \ldots, d - 1\}$. For any point $x \in X$ there
exists an $n \geq 1$ and a global section $s$ of $\mathcal{L}^{j + dn}$
which does not vanish at $x$, as follows from (\ref{item-qc-gg}) applied
to $\mathcal{F} = \mathcal{L}^{\otimes j}$ and ample invertible
sheaf $\mathcal{L}^{\otimes d}$. Since $X$ is quasi-compact there
we may find a finite list of integers $n_i$ and global sections
$s_i$ of $\mathcal{L}^{\otimes j + dn_i}$ which do not vanish at any point
of $X$. Since $\mathcal{L}^{\otimes d}$ is globally generated this means that
$\mathcal{L}^{\otimes j + dn}$ is globally generated where $n = \max\{n_i\}$.
Since we proved this for every congruence class mod $d$ we
conclude that there exists an $n_0 = n_0(\mathcal{L})$ such that
$\mathcal{L}^{\otimes n}$ is globally generated for all $n \geq n_0$.
At this point we see that if $\mathcal{F}$ is globally generated then
so is $\mathcal{F} \otimes \mathcal{L}^{\otimes n}$ for all
$n \geq n_0$.

\medskip\noindent
We continue to assume the equivalent conditions (1) -- (6).
Let $\mathcal{F}$ be a quasi-coherent
sheaf of $\mathcal{O}_X$-modules of finite type.
Denote $\mathcal{F}_n \subset \mathcal{F}$ the image of the canonical
map of (\ref{item-qc-gg}). By construction
$\mathcal{F}_n \otimes \mathcal{L}^{\otimes n}$ is
globally generated. By (\ref{item-qc-gg}) we see
$\mathcal{F}$ is the sum of the subsheaves $\mathcal{F}_n$,
$n \geq 1$. By
Modules, Lemma \ref{modules-lemma-finite-type-quasi-compact-colimit}
we see that $\mathcal{F} = \sum_{n = 1, \ldots, N} \mathcal{F}_n$
for some $N \geq 1$. It follows that
$\mathcal{F} \otimes \mathcal{L}^{\otimes n}$ is globally
generated whenever $n \geq N + n_0(\mathcal{L})$ with $n_0(\mathcal{L})$
as above. We conclude that (1) -- (6) implies (\ref{item-c-gg}).

\medskip\noindent
Assume (\ref{item-c-gg}). Let $\mathcal{F}$ be a quasi-coherent
sheaf of $\mathcal{O}_X$-modules of finite type.
By (\ref{item-c-gg}) there exists an integer $n \geq 1$ such that
the canonical map
$$
\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
\otimes_{\mathbf{Z}} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
is surjective. Let $I$ be the set of finite subsets of
$\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})$
partially ordered by inclusion. Then $I$ is a directed partially ordered set.
For $i = \{s_1, \ldots, s_{r(i)}\}$ let $\mathcal{F}_i \subset \mathcal{F}$
be the image of the map
$$
\bigoplus\nolimits_{j = 1, \ldots, r(i)} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
which is multiplication by $s_j$ on the $j$th factor. The surjectivity above
implies that $\mathcal{F} = \colim_{i \in I} \mathcal{F}_i$.
Hence Modules, Lemma \ref{modules-lemma-finite-type-quasi-compact-colimit}
applies and we conclude that
$\mathcal{F} = \mathcal{F}_i$ for some $i$.
Hence we have proved (\ref{item-c-q}). In other words,
(\ref{item-c-gg}) $\Rightarrow$ (\ref{item-c-q}).

\medskip\noindent
The implication (\ref{item-c-q}) $\Rightarrow$ (\ref{item-c-i-q}) is trivial.

\medskip\noindent
Finally, assume (\ref{item-c-i-q}).
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf
of ideals. By Lemma \ref{lemma-quasi-coherent-colimit-finite-type}
(this is where we use the condition that $X$ be quasi-separated)
we see that $\mathcal{I} = \colim_\alpha I_\alpha$ with
each $I_\alpha$ quasi-coherent of finite type. Since by assumption each of
the $I_\alpha$ is a quotient of negative tensor powers of
$\mathcal{L}$ we conclude the same for $\mathcal{I}$ (but of course
without the finiteness or boundedness of the powers). Hence
we conclude that (\ref{item-c-i-q}) implies (\ref{item-qc-i-gg}).
This ends the proof of the proposition.
\end{proof}

The following proofs were used for Exercise 
\ref{complex-geometry-exercise-L-ample-implies-Lotimes2-globally-generated}.

\begin{lemma}
\label{lemma-divisor-has-sections-implies-deg-geq-0}
Let $D$ be a divisor on a complete, nonsingular curve $X$. 
If  $h^0(D)\neq 0$ then $\text{deg}D\geq0$.
\end{lemma}

\begin{proof}
If $D$ has sections, we can take the zero locus of any of its sections to
produce an effective divisor linearly equivalent to $D$. Since degree depends
only on linear equivalence and effective divisors have non negative degree.
\end{proof}

\begin{proposition}
\label{proposition-divisor-is-base-point-free-iff-dimension-condition}
\begin{reference}
\cite[IV, Proposition 3.1(a)]{hart}
\end{reference}
Let $D$ be a divisor on a complete, nonsingular curve $X$. 
Then the complete linear system has no base
points if and only if for every point $P\in X$,
$$
\dim|D-P|=\dim|D|-1
$$
\end{proposition}

\begin{proof}
To show that $D$ has no base points amounts to showing that not every section of
$D$. That is, that the injective map $0\to H^{0}(D-p)\to H^{0}(D)$ is not 
surjective.
\end{proof}

\begin{lemma}
\label{lemma-degree-of-divisor-geq-2g-implies-base-point-free}
\begin{reference}
\cite[IV, Corollary 3.2(a), Examples 1.3.3, 1.3.4]{hart}
\end{reference}
Let $D$ be a divisor on a curve $X$ of genus $g$. 
If $\text{deg}D\geq 2g$, then
$|D|$ has no base points.
\end{lemma}

\begin{proof}
First we prove that $\text{deg}D\geq 2g$ implies that $D$ and $D-P$ are  
{\it nonspecial}, i.e. that
$h^0(K-D)=0=h^0(K-(D-P))$. Then we apply Riemann-Roch to both $D$ and $D-P$ and
the fact that  $\text{deg}(D-P)=\text{deg}(D)-1$ to find that
$\dim|D-P|=\dim|D|-1$ and apply Proposition 
\ref{proposition-divisor-is-base-point-free-iff-dimension-condition}.

To prove that $D$ is nonspecial first apply Riemann-Roch to $K$ to obtain that
$\text{deg}K=2g-2$. Indeed, $h^0(0)=1$ and $h^0(K)=p_g$ by Serre duality on
$H^1(\mathcal{O}_X)$ recalling definition of genus as $h^1(\mathcal{O}_X)$. 
Then apply Riemann-Roch to both $D$ and  $K-D$ to prove
that $\text{deg}D>2g-2$ implies $\text{deg}(K-D)<0$; start with
$$
h^0(K-D)-h^0(K-(K-D))=-(h^0(D)-h^0(K-D))
$$
An analogous result will be valid for $D-P$ since its degree is also greater
than $2g-2$.

Then apply Lemma
\ref{lemma-divisor-has-sections-implies-deg-geq-0}.
\end{proof}

\section{Adjunction formulas}
\label{section-adjunction formulas}

There are several statements called adjunction formula
in different texts. All of them concern ``subvarieties'',
that is, closed embedded subschemes.

\begin{exercise}[Genus formula for a curve on a surface]
\label{exercise-genus-formula-for-curve-on-surface}
Let $C \to X$ be a closed embedded subscheme 
of dimension $1$ (as a topological space, i.e. pure dimension)
inside a smooth surface $X$.
Then $2p_a-2=(\mathcal{O}_X(C),\mathcal{O}_X(C))$.
\end{exercise}

\begin{proof}
Consider the ideal sheaf exact sequence
$$
\xymatrix{
0\ar[r]&\mathcal{O}_X(-C)\ar[r]&\mathcal{O}_X\ar[r]&\mathcal{O}_C\ar[r]&0
}
$$
This sequence splits since there is an obvious inverse morphism
to the inclusion $\mathcal{O}_X(-C)\to \mathcal{O}_X$, namely
mapping a function $f$ to 
Then $\mathcal{O}_X\cong \mathcal{O}_X(-C) \oplus \mathcal{O}_C$.
 $\chi(\mathcal{O}_X)=\chi$
\end{proof}

\section{Normalization}
\label{section-normalization}

\begin{definition}
\label{definition-normalization-X-in-Y}
Let $f : Y \to X$ be a quasi-compact and quasi-separated morphism of schemes.
Let $\mathcal{O}'$ be the integral closure of $\mathcal{O}_X$ in
$f_*\mathcal{O}_Y$. The {\it normalization of $X$ in $Y$} is the
scheme\footnote{The scheme $X'$ need not be normal, for example if
$Y = X$ and $f = \text{id}_X$, then $X' = X$.}
$$
\nu : X' = \underline{\Spec}_X(\mathcal{O}') \to X
$$
over $X$. It comes equipped with a natural factorization
$$
Y \xrightarrow{f'} X' \xrightarrow{\nu} X
$$
of the initial morphism $f$.
\end{definition}

\noindent
The factorization is the composition of the canonical morphism
$Y \to \underline{\Spec}_X(f_*\mathcal{O}_Y)$ (see
Constructions, Lemma
\ref{constructions-lemma-canonical-morphism})
and the morphism of relative spectra coming from the inclusion map
$\mathcal{O}' \to f_*\mathcal{O}_Y$. We can characterize the
normalization as follows.

\begin{lemma}
\label{lemma-characterize-normalization}
Let $f : Y \to X$ be a quasi-compact and quasi-separated morphism of schemes.
The factorization $f = \nu \circ f'$, where $\nu : X' \to X$ is the
normalization of $X$ in $Y$ is characterized by the following
two properties:
\begin{enumerate}
\item the morphism $\nu$ is integral, and
\item for any factorization $f = \pi \circ g$, with $\pi : Z \to X$
integral, there exists a commutative diagram
$$
\xymatrix{
Y \ar[d]_{f'} \ar[r]_g & Z \ar[d]^\pi \\
X' \ar[ru]^h \ar[r]^\nu & X
}
$$
for some unique morphism $h : X' \to Z$.
\end{enumerate}
Moreover, the morphism $f' : Y \to X'$ is dominant and in (2) the
morphism $h : X' \to Z$ is the normalization of $Z$ in $Y$.
\end{lemma}



\section{Reflexive sheaves}
\label{section-reflexive-sheaves}

\begin{slogan}
These are vector bundles except for a small locus.
\end{slogan}

\begin{definition}
\label{definition-reflexive}
Let $X$ be an integral locally Noetherian scheme. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module. The {\it reflexive hull}
of $\mathcal{F}$ is the $\mathcal{O}_X$-module
$$
\mathcal{F}^{**} = \SheafHom_{\mathcal{O}_X}(
\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{O}_X), \mathcal{O}_X)
$$
We say $\mathcal{F}$ is {\it reflexive} if the natural map
$j : \mathcal{F} \longrightarrow \mathcal{F}^{**}$
is an isomorphism.
\end{definition}

\begin{lemma}
\label{lemma-reflexive-torsion-free}
Let $X$ be an integral locally Noetherian scheme. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is reflexive, then $\mathcal{F}$ is torsion free.
\item The map $j : \mathcal{F} \longrightarrow \mathcal{F}^{**}$
is injective if and only if $\mathcal{F}$ is torsion free.
\end{enumerate}
\end{lemma}

\begin{remark}[Talk at IMPA, 11 June]\leavevmode
\label{remark-reflexive-talk}
Torsion could also be defined so that the sheaf can inject onto its dual. In
this talk we discussed the moduli space of reflexive/torsion-free sheaves, which
turned out to be parametrized by $c_1, c_2$ and $c_3$. This was denoted by 
$R(c_1,c_2,c_3)$. Actually I think it may have been Manolache that proved the
existence of this moduli space.


Alan Muniz

Nesta palestra discutiremos a classificaÃ§Ã£o de feixes reflexivos de posto dois e
seus espaÃ§os de mÃ³dulos. Apresentaremos algumas ferramentas bÃ¡sicas usadas na
construÃ§Ã£o e determinaÃ§Ã£o de tais feixes. Aplicaremos estas tÃ©cnicas para o caso
de feixes com segunda classe de Chern igual a quatro, obtido recentemente em
colaboraÃ§Ã£o com Marcos Jardim.
\end{remark}

\subsection{Distributions on manifolds}
\label{subsection-distributions-on-manifolds}

Here's the abstract from a talk by Marcos Jardim at Geometric Structures:

``I will revise the work done over the past 10 years with various collaborators
on distributions and foliations on 3-folds, especially on the projective space,
with a focus on properties of the tangent sheaf and singular scheme."

Here are two key ideas: if the distribution is codimension 1 we can write:
$$
\xymatrix{
0\ar[r]&F\ar[r]&TX\ar[r]^{\omega}&I_Z \otimes L\ar[r]&0
}
$$
where $L$ is a line bundle and $\omega \in H^{0}(\Omega_X \otimes L)$, and
$Z=\{p:\omega(p)=0\}$.

When codimension is 2 then $\mathcal{D}$ is given by a holomorphic vector field 
$\nu$: $T_p=\left<\nu(p)\right>$.

It can be encoded as an exact sequence
$$
\xymatrix{
	0\ar[r]&L\ar[r]^{\nu}&TX\ar[r]&N\ar[r]&0
}
$$
where $L$ is a line bundle and $\nu \in H^{0}(TX \otimes L^\vee)$;
  $Z=\{p | \nu(p) = 0\}$.

\begin{remark}
\label{remark-stauration}
Saturation means that $Z \subset X$ is a union of curves and points.
\end{remark}

And again, distributions are parametrized by Chern classes.

Two interesting open questions:
\begin{enumerate}
\item {\bf Conjeture.} if $\mathcal{D}$ is a codimension 1 foliation of degree
$d$ on $\mathbb{P}^3$, then $c_2(F)\leq d^2-d+1$ and bound is attained
by rational foliations of type $(1,d+1)$. (True for $d \leq 2$.)
\item {\bf Conjecture (with Pepe Seade).} $\mathcal{D}$ is a codimension 1 
foliation on a smooth projective 3-fold, then $\text{Sing}\mathcal{D}$ is connected.
\end{enumerate}

\begin{theorem}[Jardim-Muniz]
\label{theorem-jardim-muniz}
Conditions on Chern classes used to understand moduli space $R(c_1,c_2,c_3)$.
$c_2=4$ gives (?). For $c_3\leq 6$, possible ``spectrum" existsâ€¦
\end{theorem}

\section{Stability}
\label{section-stability}

{\bf Question.} What is stability?

\begin{enumerate}
\item Stable objects in an abelian category are the ``building blocks":
we can reconstruct the whole category from them.
\item  An abelian subcategory (hart) $\subset$ a triangulated
\item stability defined via stability function on $\mathcal{A}$.
\item Q. Can we reconstruct $\mathcal{T}$ from the semistable elements of
$\mathcal{A}$
\item {\bf Example.} $\mathcal{A}=\text{Coh}X$ is heart of $D^b(X)$
w/ funny function.
\item Stability condition is hart + stability function.
\item Bridgeland Stabl:= the stability conditions are a complex manifold
of complex codimension $\text{rk}\Lambda$:
$$
 \mathcal{Z}:\text{Stab}(\mathcal{T})
\longrightarrow \text{Hom}(\Lambda,\mathbb{C})
$$
\item There's a chamber structure; moduli space changes across chambers.
\item I think we typically think of vectors in $\text{Hom}(\Lambda,\mathbb{C})$ 
as Chern classes, to characterize the moduli spaces.
\item Existence: given a projective variety $X$, are there stability
conditions on $D^\text{b}(X)$? Yes for fano 3fold pic rk 1.
\item Moduli spaces: is $M_\sigma(v)$ a projective scheme? Cannot use
usual git techniques to study. A stack!
\item Picture: blue + black are walls. Q. What are $\beta$ and $\alpha$?
\item thm: bridgeland stable = gieseker stable ?
\item Q. slope stability = bridgeland stability? A. Not always.
\item DT/PT correspondance: only one wall between PT and G chambers
\medskip
\item Polynomial stability function. This is an asymptotic version of BS.
\item There are some $\rho$'s. Arrangements of $\rho_i$ are polynomial 
stability conditions on a threefold.
\item Pata-Thomas introduced stability for rank 1 objects.
Bayer compares the---wall. Q. Same for Bridge S---only one wall?
\item Recall Gieseker stability.
\medskip
\item Def. A {\it stable triple}: when
$\text{gcd}(\text{ch}_0,\text{ch}_2,\text{ch}_3)=1$, every PT stable object
comes from three conditions (missing).
\item What happens when you cross the blue wall? 
Both $\mathcal{G}$ and $\mathcal{T}$ are projective. What happens at the blue
wall?
\medskip
\item For $X$ smooth threefold with $\text{rk}\text{Pic}=1$, $\mathcal{G}(v)$,
$v=(r,0,0,-n)$, $\mathcal{G}(v)$ is a known sheaf object and
$\mathcal{T}=\emptyset$.
\item $X$ sm 3 rkpic1, Fake wall; $\mathcal{G}=\mathcal{T}$.
\item (Extra.) red circle is a wall for a weaker form of stability.
\end{enumerate}
\begin{definition}[Talk at impa]
\label{definition-slope-stability}
A rank-2 sheaf $\mathcal{F}$ is {\it semistable (stable)}if
$H^{0}(\mathcal{F}(t))=0$ for $-t \geq(>) \frac{c_1F}{2}$
\end{definition}

Compare with

\begin{definition}[moduli-curves.tex]
\label{definition-semistable}
Let $f : X \to S$ be a family of curves.
We say $f$ is a {\it semistable family of curves} if
\begin{enumerate}
\item $X \to S$ is a prestable family of curves, and
\item $X_s$ has genus $\geq 1$ and
does not have a rational tail for all $s \in S$.
\end{enumerate}
\end{definition}

\begin{itemize}
\item The twistor diagram.
$$
\xymatrix{
&  \ell_\infty \ar@{.>}[dr]\ar[dl]\\
\mathbb{C}P^{2} \ar@{^{(}->}[rr]& &
\mathbb{C}P^{3}\ar[dd]_{\substack{\text{twistor} \\ \text{map}}}\\ \\
\mathbb{C}^2\ar@{^{(}->}[u]
\mathbb{R}^4 \ar[u]\ar[rr]& &S^4
}
$$
\item Instantons are solutions to some Yang-Mills solution.
\item Expository paper of Donaldson arXiv:2205.08639
\item ADHM construction, 1978. The first appearance of Algebraic Geometry in
Mathematical Physics. See Hitchin-Kobayashi correspondence.
\item Donaldson: ``unashamedly computational''.
\item Expository paper by Simon.
\item Take bundle $(E,\nabla)$ with an anti-self dual (ADS) 
connection on $S^4$ and pullback to $\mathbb{C}P^{3}$ via the
twistor map
$$
\tau[x:y:z:w]=[x+jy:z+jw] \qquad \text{note: $\tau^{-1}(p)=\mathbb{C}P^{1}$}
$$
Then:
\begin{itemize}
\item Restriction to fibres are trivial.
\item Invariant under anti holomorphic involution (check this formula!) 
$[x:y:z:w] \mapsto [-y:x:-w:z]$.
\item $\mathcal{E}$ is also an instanton bundle.
\item Penrose Transform: $H^1(\mathcal{E}(-2)) \cong \Ker \Delta=0$ where
$\Delta$ is a Laplacian.
\item Definition of instanton sheaf on $\mathbb{P}^3$ via $c_1(E)=0$ and some
vanishing of cohomologies.
\item Passage from [differential equations? algebraic geometry?] 
to linear algebra: via {\it monads}. The point is that instanton sheaf is
equivalent to  ``$E$ being the cohomology of a linear monad''; theorem by Horps
in the 60's, and is the main tool used by ADHM. Indeed, ADHM equations come from
the cohomology sequences of the so-called monads.
\item Mathamatical inst bund:= locally free instanton sheaves.
\end{itemize}
\end{itemize}

\noindent
{\bf Properties.}
\begin{itemize}
\item The only instanton of rank 1 on $\mathbb{P}^3$ is the structure sheaf.
\item non-trivial rank 2 locally free instanton sheaf ois  $\mu_0stable$
\item double dual is locally free and also instanton
\item non-trivial rank 2 instanton sheaaf is Fieseker stable
therefore it makes sance fo define moduls space of instanton sheaves as an open
subset of $\mathcal{M}(c)=\mathcal{G}(k,0,2,0)$.
\end{itemize}

Then studied the irreducibility (Tikhomirov) and smoothness (Jardim-Verbitsky,
2014. Uses ``3rd hyperkÃ¤hler quotient'') of $\mathcal{I}(c)$, the moduli
space of rank 2 locally gree instanton sheaves of charge $c.$ But nobody likes
this results; want new proofs.

In contrast, $\mathcal{M}(c)$ of rank 2-instanton sheaves of charge $c$ is not
irreducible in general!
$\mathcal{M}(1)$ and $\mathcal{M}(2)$ are irreducible, $\mathcal{M}(3)$ has
exactly 2 irreducible components of dimension 21;
 $\mathcal{M}(4)$ has 4 irredicuble components: 
the locally free is irreducible, and the other 3 that intersect the closure of
the locally
free, $\overline{\mathcal{I}(c)}$. 3 components of dimension 29 and one of dimension 32

\begin{remark}
\label{remark-}
In general the $\mu$ moduli space is not projective, but the Gieseker is.
\end{remark}


\noindent
{\bf Is $\mathcal{M}(c)$ connected?} Use $\mathbb{C}^*$ action. True for $c \leq
4$; every component intersects $\overline{\mathcal{I}(c)}$ in this range!

\begin{definition}[Elementary transformation]
\label{definition-elementary-transformation}
$F$ of rank 2 locally free instanton, $Q$ of rank 0 instanton with 1 dimensional
sheaf $h^p Q(-2)$ for $p = 0,1$. So in this conditions if we have an epimorphism
 $$
F \overset{\varphi,\text{ surj}}{\to}\} Q
$$
we get that $\Ker \varphi$ is an instanton.
\end{definition}

So  we might be interested in
$$
E \hookrightarrow E^{* *}\xrightarrow{\text{surj.}} Q_E
$$
Let's have a look at $\mathcal{M}(3)=\overline{\mathcal{I}(3)}\cup
\overline{C(0,1,3}$. Consider a generic line bundle of degree 0 on a planar
cubic (cwhich is encoded in that we have intersection of something of cimension
1 and something of simension 3), $L inn \text{Pic}^0(C)$ so we have an
epimorphism
$$
\xymatrix{
0\ar[r]&E\ar[r]&\mathcal{O}_{\mathbb{P}^3}\oplus
\mathcal{O}_{\mathbb{P}^3}\ar[r]&(i_* L)\ar[r]&0
}
$$
yielding a bundle $E$ as previously outlined.

So we are studying the components via pushforwards of sheaves on complete
intersection curves inside $\mathbb{P}^3$ 

``when we do alementary transformation of rational (not rationl?) we get
something on the boundary of locally free.''

\medskip\noindent
{\bf Perverse instanton sheaves.} Like an instnaton sheaf in monad description
but with some restrictions on the cohomologies. This leads to definition of {\it
$0$-rimensional instanton}, a perverse instanton such that $\mathcal{H}^0=0$.

\medskip\noindent
{\bf Instantons and quivers.}

\medskip\noindent
{\bf Framed instantons.} Fix a line $j:L\to \mathbb{P}^3$ and $E$ a perverse
sheaf; a {\it framing} at $L$ is an isomorphis [missing].

Apply GIT to the ADHM data to construct a moduli space 
$$
\mathcal{P}(r,c)=\mathcal{V}(r,c)^{\text{st}}/\!/\text{GL}(V_c)
$$
and it will follow that $\mathbb{P}(?,?)$ is connected.

\medskip\noindent
Considerations on quaternionic spaces lead to generalization of what has been
discussed so far to higher dimensions. I.e. an {\it instanton sheaf} on
$\mathbb{P}^n$ isâ€¦ [other cohomological conditions]
sheaf

Why are instantons interesting? They are the simplest; may provide examples for
Bridgeland stability.

In Kuznetsov (2012) and Faenzi (2014) introduced {\it rank 2 instanton bundles
on Fano 3-folds}. An {\it instanton bundle} on $X$ is a $\mu$-stable â€¦ and some
Chern class is called the {\it charge}. An {\it
instanton sheaf} (introduced by Marcos-Gaia) is â€¦.

 ``Since we are imposing $\mu$-stability on the defintion we can consider the
moduli $\mathcal{I}_X(c) \subset \mathcal{G}_X(2,-r_X,c,0)$''.

There's also monad representations as an ingredient.


\medskip\noindent
Here are two questions that invite us to join the instanton fever:

\medskip\noindent
{\bf Task 1.} Construct rank 2-instanton sheaves that do not deform into locally
free ones, and obtain the new irreducible components of
$\mathcal{G}(2,-r_X,c,0)$.

\medskip\noindent
{\bf Task 2.} Nonlocally instanton sheaves that can be deformed into non-locally
free ones: the {\it instanton boundary}
$\overline{\mathcal{I}(c)}/\mathcal{I}(X)$[formula right?]


\medskip\noindent
{\bf Recipe to construct your own instanton.}
\begin{enumerate}
\item (Make a bunch of instantons.) Find an appropriate curve to 
use Serre correspondence to find some rank 2 instanton sheaf:
$$
\xymatrix{
0\ar[r]&\mathcal{O}_{\mathbb{P}^3}(-1)\ar[r]&\underbrace{E}_{\exists
}\ar[r]&\mathcal{I}_{\sqcup \text{lines}}\ar[r]&0
}
$$
where $E$ is a locally free instanton of charge = the number of lines $-1$.

\item (Is your family of instantons generic?) You look at the $\text{Ext}$s.
``Therefore, the family of instantons only defines a locally closed subset
within a generically smooth irreducible component of $\mathcal{G}$''.

\item ``Find suitable rank 0 intranton sheaves to perform an elementary
transformations on the examples obtained in Step 1.'' But they are non-locally
free.

\item Now I have my instantons, I know they are locally free: but how to prove
that the elementary transformations deform to locally free ones? Looks like
the challenge is to prove that the deformation is locally free.
\end{enumerate}

In the papers by the group there are several particular cases when the
deformations are locally free. But they don't have a general result that would
work for 3-folds.

\medskip\noindent
{\bf What you need to call a thing an instanton.}
\begin{itemize}
\item Minimal cohomology possible; try to kill as much cohomology as you can.
\item Fixing $c_1$ (which may determine other Chern classes).
\item Some stability condition like $\mu$-stability or quiver stability. Here is
an example that is not $\mu$-semistable: 
$T\mathbb{P}^3(-1)\oplus\Omega_{\mathbb{P}^3}(1)$
\item Whenever possible, look for a monadic representation. (The monadic
representation comes from ADHM --- the beginnings of this theory. And it's still
here!)
\end{itemize}

\section{Coherent sheaves}
\label{section-coherent-sheaves}

\begin{lemma}
\label{lemma-quasi-coherent-affine-cohomology-zero}
\begin{slogan}
Serre vanishing: Higher cohomology vanishes on affine schemes
for quasi-coherent modules.
\end{slogan}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
For any affine open $U \subset X$ we have
$H^p(U, \mathcal{F}) = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
We are going to apply
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}.
As our basis $\mathcal{B}$ for the topology of $X$ we are going to use
the affine opens of $X$.
As our set $\text{Cov}$ of open coverings we are going to use the standard
open coverings of affine opens of $X$.
Next we check that conditions (1), (2) and (3) of
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}
hold. Note that the intersection of standard opens in an affine is
another standard open. Hence property (1) holds.
The coverings form a cofinal system of open coverings of any element
of $\mathcal{B}$, see
Schemes, Lemma \ref{schemes-lemma-standard-open}.
Hence (2) holds.
Finally, condition (3) of the lemma follows from
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}.
\end{proof}

\section{Hilbert polynomial}
\label{section-Hilbert-polynomial}

\noindent
The following lemma will be made obsolete by the more general
Lemma \ref{lemma-numerical-polynomial-from-euler}.

\begin{lemma}
\label{lemma-hilbert-polynomial}
Let $k$ be a field. Let $n \geq 0$. Let $\mathcal{F}$ be a coherent sheaf
on $\mathbf{P}^n_k$. The function
$$
d \longmapsto \chi(\mathbf{P}^n_k, \mathcal{F}(d))
$$
is a polynomial.
\end{lemma}

\begin{proof}
We prove this by induction on $n$. If $n = 0$, then
$\mathbf{P}^n_k = \Spec(k)$ and $\mathcal{F}(d) = \mathcal{F}$.
Hence in this case the function is constant, i.e., a polynomial
of degree $0$. Assume $n > 0$. By
Lemma \ref{lemma-euler-characteristic-extend-base-field}
we may assume $k$ is infinite. Apply
Lemma \ref{lemma-exact-sequence-induction}.
Applying Lemma \ref{lemma-euler-characteristic-additive}
to the twisted sequences
$0 \to \mathcal{F}(d - 1) \to \mathcal{F}(d) \to i_*\mathcal{G}(d) \to 0$
we obtain
$$
\chi(\mathbf{P}^n_k, \mathcal{F}(d)) -
\chi(\mathbf{P}^n_k, \mathcal{F}(d - 1)) =
\chi(H, \mathcal{G}(d))
$$
See Remark \ref{remark-exact-sequence-induction-cohomology}.
Since $H \cong \mathbf{P}^{n - 1}_k$
by induction the right hand side is a polynomial.
The lemma is finished by noting that any function
$f : \mathbf{Z} \to \mathbf{Z}$ with the property that the map
$d \mapsto f(d) - f(d - 1)$ is a polynomial, is itself a polynomial.
We omit the proof of this fact (hint: compare with
Algebra, Lemma \ref{algebra-lemma-numerical-polynomial}).
\end{proof}

\begin{definition}
\label{definition-hilbert-polynomial}
Let $k$ be a field. Let $n \geq 0$. Let $\mathcal{F}$ be a coherent sheaf
on $\mathbf{P}^n_k$. The function
$d \mapsto \chi(\mathbf{P}^n_k, \mathcal{F}(d))$ is called the
{\it Hilbert polynomial} of $\mathcal{F}$.
\end{definition}

\noindent
The Hilbert polynomial has coefficients in $\mathbf{Q}$ and not
in general in $\mathbf{Z}$. For example the Hilbert polynomial
of $\mathcal{O}_{\mathbf{P}^n_k}$ is
$$
d \longmapsto {d + n \choose n} = \frac{d^n}{n!} + \ldots
$$
This follows from the following lemma and the fact that
$$
H^0(\mathbf{P}^n_k, \mathcal{O}_{\mathbf{P}^n_k}(d)) = k[T_0, \ldots, T_n]_d
$$
(degree $d$ part) whose dimension over $k$ is ${d + n \choose n}$.

\begin{lemma}
\label{lemma-hilbert-polynomial-H0}
Let $k$ be a field. Let $n \geq 0$. Let $\mathcal{F}$ be a coherent sheaf
on $\mathbf{P}^n_k$ with Hilbert polynomial $P \in \mathbf{Q}[t]$.
Then
$$
P(d) = \dim_k H^0(\mathbf{P}^n_k, \mathcal{F}(d))
$$
for all $d \gg 0$.
\end{lemma}

\begin{proof}
This follows from the vanishing of cohomology of high enough twists
of $\mathcal{F}$. See
Cohomology of Schemes,
Lemma \ref{coherent-lemma-coherent-projective}.
\end{proof}


\medskip\noindent
For completeness I include earlier notes
from \cite{har} on the matter.

The fact that $M$ is finitely generated is what makes the following two
definitions make sense.

\begin{definition}
\label{definition-Hilbert-function}
The {\it Hilbert function} of a finitely generated graded $S=k[x_0,\ldots,x_r]$ 
-module $M$ is
$$
H_M(d)=\dim_kM_d
$$
\end{definition}

\begin{definition}
\label{definition-sysygy}
Define $F_0$ to be the free $S$-module on the generators of $M$. Elements in the
 kernel $M_1$ of the inclusion are called {\it sysygies}. By Hilbert's basis
theorem, $M_1$ is also finitely generated, so we may choose a set of generators
and repeat this process.
\end{definition}

\begin{theorem}[Hilbert Syzygy Theorem]
\label{theorem-Hilbert-syzygy}
\begin{reference}
\cite[Theorem 1.1]{sys}
\end{reference}
Any finitely generated $S$-module $M$ has a finite graded free resolution
$$
\xymatrix{
0\ar[r]&F_m\ar[r]^{\varphi_m}&\ar[r]&F_{m-q}\ar[r]&\cdots\ar[r]&
F_1\ar[r]^{\varphi_1}&F_0
}
$$
Moreover, we may take $m\leq r+1$, the number of variables in $S$.
\end{theorem}

\begin{lemma}
\label{lemma-Hilbert-function}
Suppose that $S=k[x_0,\ldots,x_r]$ is a polynomial ring. If the graded
$S$-module $M$ has finite free resolution
$$
\xymatrix{
0\ar[r]&F_m\ar[r]^{\varphi_m}&F_{m-1}\ar\cdots[r]&F_1\ar[r]^{\varphi_1}&
\ar[r]&F_0
}
$$
with each $F_i$ a finitely generated free module,
$F_i=\bigoplus_{j}S(-a_{i,j})$, then
\begin{equation}
\label{equation-Hilbert-function}
H_M(d)=\sum_{i=0}(-1)^i\sum_{j}\binom{r+d-a_{i,j}}{r}
\end{equation}
\end{lemma}

\begin{lemma}
\label{lemma-Hilbert-function-becomes-polynomial}
There is a polynomial $P_M(d)$ called the {\it Hilbert polynomial} such that, if
$M$ has free resolution as above, then $P_M(d)=H_M(d)$ for 
$d\geq\text{max}_{i,j}\{a_{i,j}-r\}$.
\end{lemma}

\begin{proof}
When $d$ satisfies this bound then the binomial coefficients in Eq.
\ref{equation-Hilbert-function} are polynomials of degree $r$ in $d$.
\end{proof}

\begin{theorem}[Hilbert-Serre]
\label{theorem-Hilbert-Serre}
\begin{reference}
\cite[I, Theorem 7.5]{hart}
\end{reference}
Let $M$ be a finitely generated graded $S=k[x_0,\ldots,x_n]$. Then there exists
a unique polynomial $p_M$ such that $p_M(\ell)=\dim S_\ell$ for large enough
$\ell$.
\end{theorem}

\begin{definition}
\label{definition-Hilbert-polynomial}
\begin{reference}
\cite[I, p. 52]{har}
\end{reference}
The polynomial $P_M$ of Hilbert-Serre Theorem \cite{Hilbert-Serre} is the {\it
Hilbert polynomial} of the finitely generated $k[x_0,\ldots,x_n]$-module $M$.
\end{definition}

\begin{definition}
\label{definition-degree-of-projective-variety}
\begin{reference}
\cite[p. 52]{hart}
\end{reference}
If $Y\subset \mathbb{P}^n$ is an algebraic set of dimension $r$, we define the
{\it degree of $Y$} to be $r!$ times the leading coefficient of the Hilbert
polynomial of the homogeneous coordinate ring $S(Y)$.
\end{definition}

\begin{exercise}
\label{exercise-very-ample-bundle-self-intersection-is-degree-of-surface}
\begin{reference}
\cite[V, Exercise 1.2]{har}
\end{reference}
Let $H$ be a very ample divisor on the surface $X$, corresponding to a
projective embedding $X\subseteq\mathbb{P}^N$. If we write the Hilbert
polynomial of $X$ as $P(z)=\frac{1}{2}az^2+bz+c$, show that $a=H^2$,
$b=\frac{1}{2}H^2+1-\pi$, where $\pi$ is the genus of a nonsingular curve
representing $H$, and $c=1+p_a$.
\end{exercise}

\section{Nakai-Moishezon Criterion}
\label{section-Nakai-Moishezon-criterion}

\begin{theorem}[Nakai-Moishezon Criterion]
\label{theorem-Nakai-Moishezon-criterion}
\begin{reference}
\cite[V, Theorem 1.10]{hart}
\end{reference}
A divisor $D$ on the surface $X$ is ample if and only if $D^2>0$ and $D.C>0$ for
all irreducible curves $C$ in $X$.
\end{theorem}

\begin{proof}
The direct implication is easy: since $D$ is ample,  $mD$ is very ample for some
$m$, so that $m^2D^2$ is the self-intersection number of $mD$. By exercise
\ref{exercise-very-ample-bundle-self-intersection-is-degree-of-surface},
 $D^2$ is the leading coefficient of the Hilbert polynomial of $X$ as a 
subscheme of $\mathbb{P}^n$. This means that $D^2$ is twice the leading
coefficient of the Hilbert polynomial of a projective variety for large enough
$m$, so that it must be a positive number (it's the dimension of one of the
graded components of the coordinate ring of the surface).
\end{proof}

\section{Hilbert scheme}
\label{section-Hilbert-scheme}

{\bf Upshot \cite[p. 6]{HarrMorr}.} 
We wish to parametrize subschemes of a projective space (or
perhaps a more general scheme?). Since there are too many such subschemes we
restrict ourselves to schemes with a given Hilbert polynomial, since the latter
``encodes the most important numerical invariants of schemes''. The Hilbert
scheme is introduced via a theorem by Grothendieck 
as the object that represents the functor $\mathbf{Hilb}_{P,r}$ 
that maps a reduced scheme $B$ to the
set of proper flat families
$$
\xymatrix{
\mathcal{X}\ar@{^{(}->}[r]^i\ar[rd]&\mathbb{P}^r \times B \ar[d]^{\pi_B}\\
& B
}
$$
with $\mathcal{X}$ having Hilbert polynomial $P$.

\begin{theorem}[Grothendieck, '66]
\label{theorem-Grothendieck}
The functor $\mathbf{Hilb}_{P,r}$ is representable by a projective scheme
$\mathcal{H}_{P,r}$.
\end{theorem}

SEE Hilbert schemes of subschemes.

\section{Deformation theory}
\label{section-deformation-theory}

\noindent
I start by reading Stacks Project.

\medskip\noindent
The first notion is {\it thickening of ringed spaces},
which I ultimately think of as a closed subscheme
$(X,\mathcal{O}_X) \to (X',\mathcal{O}_{X'})$
with a nilpotent ideal sheaf,
which in an imprecise way means
that $\mathcal{I}_X^n=0$ for some $n$,
and in a precise way its given on sections.

\medskip\noindent
The following definition is from [lucas-defos], which in turn comes from
\cite{Sernesi-deformations}

\begin{definition}
\label{definition-deformation}
Let $X$ be an algebraic $\mathbb{C}$-scheme.
\begin{enumerate}
\item A {\it deformation} of $X$ is a Cartesian diagram $\xi$
$$
\xymatrix{
X\ar[r]\ar[d]&\mathcal{X}\ar[d]^{\pi}\\
\Spec \mathbb{C}\ar[r]^s&S
}
$$
where $\pi$ is a flat surjective morphism of algebraic $\mathbb{C}$-schemes and
$S$ is connected. (Recall that flatness accounts for ``continuity''.)
\item A {\it local deformation} of $X$ is a deformation $\xi$ where
$S=\Spec A$ for $A$ a noetherian local $\mathbb{C}$ algebra with residue
field $\mathbb{C}$.
\item An {\it infinitesimal deformation of $X$} is a local deformation with $A$
an artinian local $\mathbb{C}$-algebra with residue field $\mathbb{C}$. $X$ is
called {\it rigid} if all infinitesimal deformations are trivial.
\item An {\it inifinitesimal deformation of order $n$} is an infinitesimal
deformation when $S=\Spec (\mathbb{C}[t]/(t^{n+1})$.
\end{enumerate}
\end{definition}

{\bf Upshot.} An interpretation of the so-called {\it dual numbers}
$k[t]/(t^2)$ (see \cite{Hartshorne-deformation}) as the tangent space of
something is thinking of Taylor polynomials: after quotienting by $t^2$ we loose
the tails of the polynomials and are left with the first derivative information
only.

So what is the deformation space? Is it a moduli space of curves, that is,
points are curves obtained by deforming the curve? Or is it the fibration whose
fibers are curves and there is a central fiber that is the original curve?

There is the following interpretation in [continued-fractions] p. 39: the space
of first order deformation classes of $X$ is $D(\mathbb{C}[t]/(t^2)$. This is
said to ````represent'' the tangent space $\mathbb{T}^1_X$ of the hypothetical
deformation space of $X$''. (I put double quotations because the word
``represent'' is quoted in the original text.) Further, if $X$ is nonsingular
and compact, then $\mathbb{T}^1_X=H^{1}(X,T_X)$.

Which basically I interpret as: the dimension of the deformation space of a
smooth compact variety is $H^{1}(X,T_X)$.

\begin{example}
\label{example-moduli-space-of-nonsingular-Riemann-surfaces-of-genus-g}
\begin{reference}
\cite[Example 3.1]{continued-fractions}
\end{reference}
Fix $g \geq 2$. The dimension of the deformation space of a nonsingular
projective curve $X$ is $3g-3$. This is ``the dimension of the moduli space of
curves of genus $g$''.
 
We can compute this number by Riemann-Roch formula on the bundle $-K_X$. 
Indeed, since $X$ is a curve, $\Omega_X^1=K_X$ and thus $-K_X=T_X$. We get
\begin{align*}
h^0(-K)-h^0(K-(-K))&=\text{deg}(-K)-g+1\\
&=-2g+2-g+1\qquad \text{degree additive and $\text{deg}K=2g-2$}\\
&=-3g+3
\end{align*}
Now by Serre duality $h^0(K-(-K))=h^1(-K)=h^1(T_X)$, and it turns out that a
Riemann surface of genus $g \geq 2$ has no holomorphic vector fields, so that
$h^0(-K)=h^0(T_X)=0$.
\end{example}

\begin{exercise}
\label{exercise-deformations-of-curves-in-K3}
Let $C$ be a smooth genus $g$ curve which can be embedded in a K3 surface  $M$,
and $X$ the family of all deformations of $C$ in $M$.
\begin{enumerate}
\item Prove that $\dim X \leq  g$.
\item Let $\mathcal{X}_g$ be the space of all curves of genus $g$ (smooth?)
which can be possibly embedded to a K3 surface. Prove that each irreducible
component $Z$ of $\mathcal{X}_g$ satisfies $\dim_\mathbb{C} \leq  g+19$. Deduce
that there exists a compact complex curve which cannot be embedded in a K3
surface.
\end{enumerate}
\end{exercise}

\begin{exercise}
\label{exercise-}
Let $C$ be a smooth curve embedded in a K3 surface $X$. Show that the dimension
of the deformation space of $C$ is $\leq g$.
\end{exercise}

\begin{proof}
%\begin{enumerate}
%\item 
The deformation space of a variety is the space of isomorphism classes of
deformations as explained above. It turns out that there is a way to associate
1-cocyles of the tangent sheaf to deformations, so that in fact the deformation
space $\text{Def}_1$ is isomorphic to $H^{1}(X,\mathcal{T}_X)$ for any variety
$X$.

For our curve $C$ we thus know that the dimension of the space of deformations
(deformations not necessarily contained in $X$) is $h^1(\mathcal{T}_C)$.  The
family of deformations of $C$ that are contained in $X$ is the Hilbert space of
curves with fixed Hilbert polynomial $P(t)$ after quotienting by $\mathbb{C}s$,
where $s$ is the section whose vanishing locus is  $C$. 
This says that the number we are looking for is $h^{0}(X,\mathcal{O}(C))-1$.

Now I will show that $h^0(X,\mathcal{O}(C))=1+g$ (see 
\cite[Lemma 1.2.1, Remark 1.2.2]{huk}).

Consider the ideal sheaf exact sequence twisted by
$\mathcal{O}(C)$:
$$
\xymatrix{
0\ar[r]&\mathcal{O}_X\ar[r]&\mathcal{O}(C)\ar[r]
&\mathcal{O}_X(C) \otimes \mathcal{O}_C=\mathcal{O}(C)|_{C}\ar[r]&0
}
$$
By $X$ being a K3 we know that $H^{1}(\mathcal{O}_X)=0$, so that we have the
short exact sequence in cohomology
$$
\xymatrix{
0\ar[r]&H^{0}(\mathcal{O}_X)\ar[r]&H^{0}(\mathcal{O}(C))\ar[r]
&H^{0}(\mathcal{O}(C)|_{C})\ar[r]&0
}
$$
so that $h^0(\mathcal{O}(C))=1+h^1(\mathcal{O}(C)|_{C})$. 
A version of adjunction formula says
$\omega_C \cong (K_X \otimes\mathcal{O}(C)|_{C}$, and using that 
$K_X=\mathcal{O}_X$ we obtain $h^0(\mathcal{O}(C)|_{C})=h^0(\omega_C)=g$.

To 

\medskip\noindent
For the record I put other thoughts I went through in solving this exercise.

Recall from \cite[p. 146]{gri} that the normal bundle
$\mathcal{N}$ of a hypersurface of a smooth variety $X$ satisfies
$\mathcal{N}^\vee\cong\mathcal{O}_X(-C)|_{C}$. Taking duals we get that
$\mathcal{N}\cong\mathcal{O}_X(C)|_{C}$.

By adjunction formula $2g-2=(\mathcal{O}(C),\mathcal{O}(C))$. 
Applying Riemann-Roch
to $\mathcal{O}(C)$ (which is by definition the dual of the ideal sheaf of $C$,
which is a line bundle on $X$), we obtain that
$\chi(\mathcal{O}(C))=2+\frac{1}{2}(\mathcal{O}(C),\mathcal{O}(C))$. Then
$\chi(\mathcal{O}(C))=g+1$.

Now recall that $\chi(\mathcal{O}(C))=h^0(\mathcal{O}(C)
-h^1(\mathcal{O}(C))+h^2(\mathcal{O}(C))$. By Serre duality and $X$ being a K3
surface we see that $h^2(\mathcal{O}(C))\cong h^{0}(\mathcal{O}(-C))$, which is
the ideal sheaf of $C$. Any section of such a sheaf would vanish along $C$, and
since $X$ is compact we conclude there cannot be any such section.

Now we show that also $h^1(\mathcal{O}(C))=0$ to conclude that
$h^0(\mathcal{O}(C))=g+1$. 

We thus conclude that $h^0(\mathcal{O}(C))$




Since $C$ is smooth we can use the normal exact sequence
$$
\xymatrix{
0\ar[r]&\mathcal{T}_C\ar[r]&\mathcal{T}_X|_{C}\ar[r]&\mathcal{N}\ar[r]&0
}
$$
Taking Euler characteristic we see that
$\chi(\mathcal{T}_C)+\chi(\mathcal{N})=\chi(\mathcal{T}_X|_{C})$.


This means that we should be done once we compute $\chi(\mathcal{T}_X|_{C})$. 
For this we can use Riemman-Roch formula for coherent sheaves on a curve, which
tells us that
$$
\text{deg}(\mathcal{T}_X|_{C})=\chi(\mathcal{T}_X|_{C})
-\text{rk}(\mathcal{T}_X|_{C})\cdot\chi(\mathcal{O}_C)
$$
But of course we know that since $C$ is a curve, by Serre duality we get that
$\chi(\mathcal{O}_C)=1-g$. (Indeed:
$h^1(\mathcal{O}_C)=h^0(\Omega^1_C):=p_a(C)$.) And now the question is what is
the degree. Apparently this is just the first Chern class $c_1$ of the
restricted tangent bundle. So what is it? And what is $h^0(\mathcal{T}_C)$ if
the genus is 0 or 1, and that's it.

I
know that $h^0(\mathcal{T}_X)=0$ and $h^1(\mathcal{T}_X)=20$ by $X$ being a K3
surface, but I'm not sure what happens when we restrict to $C$.

If $g \geq 2$ we know that $h^0(\mathcal{T}_C)=0$, so that
$\boxed{\chi(\mathcal{T}_C)=h^1(\mathcal{T}_C)}$.
\bigskip
To compute the
latter Euler characteristic, which is given by definition by
$\chi(\mathcal{T}_X|_{C})=h^0(\mathcal{T}_X|_{C})-h^1(\mathcal{T}_X|_{C})$, we
first note that $h^0(\mathcal{T}_X|_{C})=0$, because this is the dimension of
the global holomorphic vector fields on $X$
restricted to $C$, which is constant along $C$ since $X$ is
smooth. And then this number is actually zero by Hodge numbers of a K3 surface.

and taking cohomology long exact sequence we obtain
$$
\xymatrix{
\cdots\ar[r]&H^{0}(T_X)\ar[r]&H^{0}(\mathcal{N})\ar[r]&H^{1}(T_C)\ar[r]&\\
H^{1}(T_X)\ar[r]&H^{1}(\mathcal{N})\ar[r]& \cdots
}
$$
\medskip\noindent
Or is it $h^1(\mathcal{N})$? See \cite{HarrMorr}. If this was the case, then we
can use adjunction formula as above to get that
$2g-2=(\mathcal{N},\mathcal{N})=\text{deg}_C \mathcal{N}$. Then we may find
$h^0(\mathcal{N})$ via Riemann-Roch:
$$
h^0(\mathcal{N})-h^0(K_C-\mathcal{N})=\text{deg}\mathcal{N}-g+1
$$
Note that $h^0(N_C-\mathcal{N})=h^1(-K_C+N+K_C)=h^1(\mathcal{N})$ via Serre
duality, and by Riemann-Roch on a surface as above we see that
$$
g+1=\chi(\mathcal{N})=h^0(\mathcal{N})-h^1(\mathcal{N})
\implies h^1(\mathcal{N})=-g-1+h^0(\mathcal{N})
$$
so that
\begin{align*}
h^0(\mathcal{N})-(-g-1+h^0(\mathcal{N}))&=\text{deg}\mathcal{N}-g+1\\
\implies \text{oops! I lost $h^0(\mathcal{N})$ in this operationâ€¦}
\end{align*}
Maybe if I just use normal exact sequence and realise that
$$
h^0(\mathcal{N})=h^0(\mathcal{T}_X|_{C})-h^0(\mathcal{T}_C)
$$
I know that $h^0(\mathcal{T}_C)=0$ for $g>1$, so the question is how to compute
the restricted holomorphic vector fields.
%\end{enumerate}
\end{proof}

\section{Continued fractions}
\label{section-continued-fractions}

Definition of HJ continued fraction. For $i>2$ they are in bijection with
$\mathbb{Q}_{>1}$.

The basic diagram of this course starts with a surface $S$ (eg. Hirzebruch
surface $S=\mathbb{F}_m$). Blowing up leads to $X$, and contracting Wahl chains
on $X$ leads to $W$, a normal projective surface that has only Wahl
singularities. Then we construct $\mathbb{Q}$-Gorenstein smoothings $W_t$.
(These  $\mathbb{Q}$-Gorenstein smoothings have Milnor number =0.)

Continued fractions have minimal models:
\begin{itemize}
\item $[1,1]$ means a 0 curve,  $\mathbb{P}^1$.
\item $[1]$ means a  $-1$ curve,  $\mathbb{P}^1$.
\item For $\frac{m}{q}\in\mathbb{Q}_{>1}$, the continued fraction
$[e_1,\ldots,e_r]$ means a chain, which is a sequence of lines that intersect
transversally with $-e_1,\ldots,-e_r$. This is mapped to $\frac{1}{m}(1,q)$.
\end{itemize}

\medskip\noindent

{\bf Third lecture.}

Here's some slogans/recap:
\begin{enumerate}
\item The most important cyclic quotient singularities (c.q.s.) are Wahl
$\frac{1}{n^2}(na-1)$. There is a model to deal with this kind o singularities
using continued fractions. This is very silly but what I picked up is that ``you
add a 2 in the end and add +1 to the first number'', so for example
$[4]\rightsquigarrow[5,2]\rightsquigarrow[6,2,2]$. But on the second step the
$[5,2]$ also goes to $[2,5,3]$ in a way I don't understand. This is called the
Wahl algorithm.
\item (See [KSB88]) There is a notion of $M$-resolution, which is a drawing of 
several curves $\Gamma_i$ intersecting at points $P_i$ that may be Wahl 
singularities or 
smooth points with the key property that $\Gamma_i\cdot K\geq 0$. We have
``toric boundary for $P_i$''. These $M$-resolutions are in 1-1 correspondence
with smoothings of $\frac{1}{m}(1,q)$, and in turn in 1-1 correspondence with
continued fractions $K\left(\frac{m}{m-q}\right)=\{k_1,\ldots,k_s]:
1\leq k_i\leq b_i\;\forall i\}$ where $\frac{m}{m-q}=[b_1,\ldots,b_s]$.
\end{enumerate}

\medskip\noindent

Today we consider the fibers to be $W_t=\mathbb{P}^2$ and
try to find $W$. Set $m_1,m_2,m_3\in\mathbb{Z}_{>0}$. Define
$$
\mathbb{P}(m_1,m_2,m_3):=
\mathbb{P}^2/(\mathbb{Z}/m_1\oplus\mathbb{Z}/m_2\oplus\mathbb{Z}/m_3)
=\mathbb{C}^3\setminus\{0\}/(\lambda\in\mathbb{C}^*\lambda(x,y,z)
=(\lambda^{m_1}x,\lambda^{m_2}y,\lambda^{m_3}z))
$$
For $\text{gdc}(d,m_i)=1$ we have
$\mathbb{P}(dm_1,dm_2,dm_3)=\mathbb{P}(m_1,m_2,m_3)$.

For a triangle $xyz=0$ given by three lines $\Gamma_i$ we have cqs singularities
of the kind $\frac{1}{m_1}(m_2,m_3)$. In this case
$K_W=-(m_1+m_2+m_3)\xi=-\Gamma_1-\Gamma_2-\Gamma_3$ for
$\xi^2=\frac{1}{m_1m_2m_3}$, and $\text{Cl}(W)=\mathbb{Z}\left<\xi\right>$.
Since these are Wahl singularities, we must have that the $m_i$ are squares,
i.e. $m_i=n_i^2$ for some $n_i$. We must have:
\begin{align*}
K_W^2=(m_1+m_2+m_3)^2\frac{1}{m_1m_2m_3}=9&=K^2_{\mathbb{P}^2}\\
\implies (n_1^2+n_2^2+n_3^2)-9n_1^2n_2^2n_3^2&=0\\
\implies (n_1^2+n_2^2+n_3^2-2n_1n_2n_3)\cdot(\text{positive factor})&=0\\
\implies n_1^2+n_2^2+n_3^2&=3n_1n_2n_3
\end{align*}
The last equation is known as {\it Markov equation}.

\begin{example}
\label{example-Hirzebruch-surface}
For $\mathbb{P}(1,1,4)=W$, a triangle with a Wahl singularity
$\frac{1}{4}(1,1)$ in one vertex. Blowing up gives the Hirzebruch surface
$\mathbb{F}_4$, so that a minimal resolution is the triangle. Compare with
[\href{https://arxiv.org/pdf/2504.19929}{Hacking-Prokhorov-2010}]. This example
satisfies the Markov equation for $n_1=1,n_2=1,n_3=2$.
\end{example}

\begin{theorem}[[HP2010]]
\label{theorem-HP2010}
If $\mathbb{P}^2\rightsquigarrow W$ with only log terminal singularities then
$W$ is a partial $\mathbb{Q}$-Gorenstein smoothing of $\mathbb{P}(a^2,b^2,c^2)$
where $a^2+b^2+c^2=3abc$.
\end{theorem}
By the Markov equation condition all the singularities must be Wahl. The triple
$(a,b,c)$ is called {\it Markov triple}. Any permutation of a Markov triple is
another Markov triple. Is $(a,b,c)$ is Markov then so is $(a,b,3ab-c)$. This
allows to construct a {\it Markov tree}. There is so-called Markov conjecture
(due to Frobenius) still unsolved.

\section{Stanley Reisner}
\label{section-}

Antes de introduzir matroides, Os conjuntos $f_s$, que sÃ£o os conjuntos de
tamanho $s$, eles tem um significado geomÃ©trico?



\section{Fano varieties}
\label{section-Fano-varieties}

\begin{definition}
\label{definition-Fano-variety}
A {\it Fano variety} is a projective variety with $-K_X$ ample.
\end{definition}

\begin{definition}
\label{definition-Fano-index}
$$
r(X):=\text{min}\{r:\frac{c_1(X)}{r}\in H^{2}(X,\mathbb{Z})\}
$$
\end{definition}

\begin{exercise}
\label{exercise-Fano-vanishing-higher-cohomology}
By Kodaira vanishing theorem \ref{theorem-Kodaira-vanishing}, 
you can show that the cohomology $H^{i}(X,L)$ for
a Fano variety $X$ vanishes. You just have to put $L=\mathcal{O}(k)$ with $k\geq
-r$, where $r$ is the Fano index.
\end{exercise}

\begin{exercise}
\label{exercise-Pic-H2-Fano}
Show that  $\text{Pic}(X)\cong H^{2}(X,\mathbb{Z})$ holds for Fano varieties.
\end{exercise}

\begin{remark}
\label{remark-derived-category-of-Fano-3-folds-with-vanishing-simplicial
-cohomology}
\begin{reference}
Marcos Jardim, CIMPA 2025 FlorianÃ³polis, Lecture 2.
\end{reference}
If $H^3(X,\mathbb{Z})=0$ of a Fano 3-fold, then its derived category is
generated by 4 elements.
\end{remark}


\section{Quivers}
\label{section-quivers}

\begin{definition}
\label{definition-quiver}
A {\it quiver} is a set of vertices $Q_0$, a set of arrows $Q_1$ equipped with
the maps of source $s$ and target $t$ that to each arrow they assign the point
that is source or target of the arrow.
\end{definition}

\begin{definition}
\label{definition-representation-of-quiver}
A {\it representation} of a quiver is a set of finite dimensional vector spaces
equipped with maps between them realising a given quiver (incompleteâ€¦).
\end{definition}

There is a notion of projective representation, which I missed to write. But it
is analogous to the injective representation:

\begin{definition}
\label{definition-injective-representation-of-quivers}
Given a quiver $Q$, the {\it injective representation} of $Q_0$ is given by, for
$i \in Q_0$,
$$
I(i)_j=\begin{cases}
k\qquad &i=j \\
k^{d'}\qquad &j \neq i
\end{cases}
$$
where $d'$ is the number of paths from $j$ to $i$.
\end{definition}

\section{Stacks}
\label{section-stacks}

My first definition of stack can be extracted
from

\begin{definition}
\label{definition-superstack}
A {\it superstack} is a stack over
the Ã©tale site $\text{SSch}$ of superschemes,
i.e. it is a category fibered in groupoids
over the category of superschemes,
the latter equipped with the 
Ã©tale topology, 
satisfying the descent condition.
\end{definition}

Here are some other definitions:

\begin{definition}
\label{definition-algebraic-stacks}
Let  $\mathfrak{X}$ be a stack over $\text{Sch}_{\text{Ã©t}}$.
An {\it algebraic space} is
such that there exists morphism
$\mathcal{U} \to \mathfrak{X}$
where $\mathcal{U}$ is a scheme, that is
schematic, Ã©tale and injective (check this one).

$\mathfrak{X} \to y$ is {\it representable} if
there exists a scheme $\mathcal{U}$ and a map
$\mathcal{U} \to y$ such that the 
fibered product
$$
\xymatrix{
\mathcal{U} \times_y \mathfrak{X}\ar[r]\ar[d]\ar@{}[dr]|-{\lrcorner}&\mathfrak{X}\ar[d]\\
\mathcal{U}\ar[r]&y
}
$$
is an algebraic space.

Finally, a  stack is {\it algebraic} (resp. {\it Deligne-Mumford})
is there exists a 
representable surjective morphism  $\mathcal{U} \to \mathfrak{X}$ 
that is smooth (resp. Ã©tale).

A {\it stable map} over a projective
variety $X$ is an element of the first
Chow group $\beta \in A_1$, where
 $(C,g)$ is an algebraic curve and
$f:C \to X$ with $[f(C)]=\beta$.
\end{definition}

\noindent
The curves that are points under this map
(contractible) are {\bf stable}.

\bibliography{my}
\bibliographystyle{amsalpha}




\end{document}
