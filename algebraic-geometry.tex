\input{preamble}

\begin{document}

\title{Algebraic Geometry}
\maketitle

\phantomsection
\label{section-phantom}
\hfill
\href{http://github.com/danimalabares/stack}{github.com/danimalabares/stack}

\tableofcontents

\section{Sheaves}
\label{section-sheaves}

Let $X$ be a topological space. Let $x \in X$ be a point.
Let $\mathcal{F}$ be a presheaf of sets on $X$.
The {\it stalk of $\mathcal{F}$ at $x$} is the set
$$
\mathcal{F}_x
=
\colim_{x\in U} \mathcal{F}(U)
$$
where the colimit is over the set of open neighbourhoods
$U$ of $x$ in $X$. The set of open neighbourhoods is
partially ordered by (reverse) inclusion:
We say $U \geq U' \Leftrightarrow U \subset U'$.
The transition maps in the system are
given by the restriction maps of $\mathcal{F}$.
See Categories, Section \ref{categories-section-posets-limits}
for notation and terminology regarding (co)limits over systems.
Note that the colimit is a directed colimit.
Thus it is easy to describe $\mathcal{F}_x$. Namely,
$$
\mathcal{F}_x
=
\{
(U, s)
\mid
x\in U, s\in \mathcal{F}(U)
\}/\sim
$$
with equivalence relation given by $(U, s) \sim (U', s')$ if and only if
there exists an open $U'' \subset U \cap U'$ with $x \in U''$ and
$s|_{U''} = s'|_{U''}$. Given a pair $(U, s)$ we sometimes denote
$s_x$ the element of $\mathcal{F}_x$ corresponding to the equivalence
class of $(U, x)$. We sometimes use the phrase
``image of $s$ in $\mathcal{F}_x$'' to denote $s_x$.
For example, given two pairs $(U, s)$ and $(U', s')$ we sometimes
say ``$s$ is equal to $s'$ in $\mathcal{F}_x$'' to indicate
that $s_x = s'_x$. Other authors use the terminology
``germ of $s$ at $x$''.

\bigskip\noindent

Here's my unexpected encounter with the definition of tensor product of sheaves.
It's not the ``fiber is tensor product of fibers'' construction, but actually
just some notion of ``change of ring'' sheaf that ends up being adjoint to
some ``restriction'' sheaf. The setting is a mapping of presheaves {\it of
rings} over a space $X$â€¦ (I think the usual definition is this one taking
$\mathcal{O}_1$ as the other presheaf we want to tensor).

Immediately after introducing this notion there's the definition of sheaf, then
stalks, abelian sheaves, some other notions like an ``algebraic structure'' and
then tensor product will be defined after sheafification---because the following
definition is in general not a sheaf.

Furthermore, I add that Vakil leaves it as an exercise to define the tensor
product of two $\mathcal{O}_X$ modules (with a hint of defining the presheaf
tensor product and sheafifying), which makes me think that after all it {\it is}
just the intuitive definition. Before diving in, also by Vakil (Exercise 26.K):
the stalk of the tensor product is the tensor product of the stalks.

\medskip\noindent

Suppose that $\mathcal{O}_1 \to \mathcal{O}_2$ is a
morphism of presheaves of rings on $X$. In this case,
if $\mathcal{F}$ is a presheaf of $\mathcal{O}_2$-modules
then we can think of $\mathcal{F}$ as a presheaf of
$\mathcal{O}_1$-modules by using the composition
$$
\mathcal{O}_1 \times \mathcal{F}
\to
\mathcal{O}_2 \times \mathcal{F}
\to
\mathcal{F}.
$$
We sometimes denote this by $\mathcal{F}_{\mathcal{O}_1}$
to indicate the restriction of rings. We call this
the {\it restriction of $\mathcal{F}$}. We obtain the
restriction functor
$$
\textit{PMod}(\mathcal{O}_2)
\longrightarrow
\textit{PMod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a presheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$
we can construct a presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
by the rule
$$
\left(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}\right)(U)
=
\mathcal{O}_2(U) \otimes_{\mathcal{O}_1(U)} \mathcal{G}(U)
$$
The index $p$ stands for ``presheaf'' and not ``point''.
This presheaf is called the tensor product presheaf. We obtain
the {\it change of rings} functor
$$
\textit{PMod}(\mathcal{O}_1)
\longrightarrow
\textit{PMod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict-presheaves}
With $X$, $\mathcal{O}_1$, $\mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\Hom_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\Hom_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors
are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from the fact that for a ring map
$A \to B$ the restriction functor and the change
of ring functor are adjoint to each other.
\end{proof}

\subsection{Tipologia dos feixes}
\label{subsection-tipologia-dos-feixes}

\begin{definition}
\label{definition-tipologia-dos-feixes}
A sheaf of $\mathcal{A}$-modules $\mathcal{F}$ over a sheaf of rings 
$\mathcal{A}$ (on a topological space $X$) is called
\begin{itemize}
\item 
\end{itemize}
\end{definition}


\section{Locally ringed spaces}
\label{section-locally-ringed-spaces}

\section{Invertible modules (line bundles)}
\label{section-invertible}

\noindent
Similarly to the case of modules over rings
(More on Algebra, Section \ref{more-algebra-section-picard})
we have the following definition.

\begin{definition}
\label{definition-invertible}
Let $(X, \mathcal{O}_X)$ be a ringed space. An
{\it invertible $\mathcal{O}_X$-module} is a sheaf
of $\mathcal{O}_X$-modules $\mathcal{L}$ such that
the functor
$$
\textit{Mod}(\mathcal{O}_X) \longrightarrow \textit{Mod}(\mathcal{O}_X),\quad
\mathcal{F} \longmapsto \mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{F}
$$
is an equivalence of categories. We say that $\mathcal{L}$ is
{\it trivial} if it is isomorphic as an $\mathcal{O}_X$-module
to $\mathcal{O}_X$.
\end{definition}

\noindent
Lemma \ref{lemma-invertible-is-locally-free-rank-1}
below explains the relationship with locally free modules
of rank $1$.

\begin{lemma}
\label{lemma-invertible}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{L}$
be an $\mathcal{O}_X$-module. Equivalent are
\begin{enumerate}
\item $\mathcal{L}$ is invertible, and
\item there exists an $\mathcal{O}_X$-module $\mathcal{N}$
such that
$\mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N} \cong \mathcal{O}_X$.
\end{enumerate}
In this case $\mathcal{L}$ is locally a direct summand of a finite free
$\mathcal{O}_X$-module and the module $\mathcal{N}$ in (2) is isomorphic to
$\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Assume (1). Then the functor $- \otimes_{\mathcal{O}_X} \mathcal{L}$
is essentially surjective, hence there exists an $\mathcal{O}_X$-module
$\mathcal{N}$ as in (2). If (2) holds, then the functor
$- \otimes_{\mathcal{O}_X} \mathcal{N}$ is a quasi-inverse
to the functor $- \otimes_{\mathcal{O}_X} \mathcal{L}$ and
we see that (1) holds.

\medskip\noindent
Assume (1) and (2) hold. Denote
$\psi : \mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N} \to \mathcal{O}_X$
the given isomorphism. Let $x \in X$. Choose an open neighbourhood
$U$ an integer $n \geq 1$ and sections $s_i \in \mathcal{L}(U)$,
$t_i \in \mathcal{N}(U)$ such that $\psi(\sum s_i \otimes t_i) = 1$.
Consider the isomorphisms
$$
\mathcal{L}|_U \to
\mathcal{L}|_U \otimes_{\mathcal{O}_U}
\mathcal{L}|_U \otimes_{\mathcal{O}_U} \mathcal{N}|_U \to \mathcal{L}|_U
$$
where the first arrow sends $s$ to $\sum s_i \otimes s \otimes t_i$
and the second arrow sends $s \otimes s' \otimes t$ to $\psi(s' \otimes t)s$.
We conclude that $s \mapsto \sum \psi(s \otimes t_i)s_i$ is
an automorphism of $\mathcal{L}|_U$. This automorphism factors as
$$
\mathcal{L}|_U \to \mathcal{O}_U^{\oplus n} \to \mathcal{L}|_U
$$
where the first arrow is given by
$s \mapsto (\psi(s \otimes t_1), \ldots, \psi(s \otimes t_n))$
and the second arrow by $(a_1, \ldots, a_n) \mapsto \sum a_i s_i$.
In this way we conclude that $\mathcal{L}|_U$ is a direct summand
of a finite free $\mathcal{O}_U$-module.

\medskip\noindent
Assume (1) and (2) hold. Consider the evaluation map
$$
\mathcal{L} \otimes_{\mathcal{O}_X}
\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)
\longrightarrow \mathcal{O}_X
$$
To finish the proof of the lemma
we will show this is an isomorphism by checking it induces
isomorphisms on stalks. Let $x \in X$.
Since we know (by the previous paragraph)
that $\mathcal{L}$ is a finitely presented
$\mathcal{O}_X$-module
we can use Lemma \ref{lemma-stalk-internal-hom}
to see that it suffices to show that
$$
\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}}
\Hom_{\mathcal{O}_{X, x}}(\mathcal{L}_x, \mathcal{O}_{X, x})
\longrightarrow \mathcal{O}_{X, x}
$$
is an isomorphism. Since
$\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}} \mathcal{N}_x =
(\mathcal{L} \otimes_{\mathcal{O}_X} \mathcal{N})_x =
\mathcal{O}_{X, x}$ (Lemma \ref{lemma-stalk-tensor-product})
the desired result follows from
More on Algebra, Lemma \ref{more-algebra-lemma-invertible}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-invertible}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a
morphism of ringed spaces. The pullback $f^*\mathcal{L}$ of an
invertible $\mathcal{O}_Y$-module is invertible.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-invertible}
there exists an $\mathcal{O}_Y$-module $\mathcal{N}$ such that
$\mathcal{L} \otimes_{\mathcal{O}_Y} \mathcal{N} \cong \mathcal{O}_Y$.
Pulling back we get
$f^*\mathcal{L} \otimes_{\mathcal{O}_X} f^*\mathcal{N} \cong \mathcal{O}_X$
by Lemma \ref{lemma-tensor-product-pullback}.
Thus $f^*\mathcal{L}$ is invertible by Lemma \ref{lemma-invertible}.
\end{proof}

\begin{lemma}
\label{lemma-invertible-is-locally-free-rank-1}
Let $(X, \mathcal{O}_X)$ be a ringed space. Any locally free
$\mathcal{O}_X$-module of rank $1$ is invertible.
If all stalks $\mathcal{O}_{X, x}$ are local rings, then
the converse holds as well (but in general this is not the case).
\end{lemma}

\begin{proof}
The parenthetical statement follows by considering a one point
space $X$ with sheaf of rings $\mathcal{O}_X$ given by a ring $R$.
Then invertible $\mathcal{O}_X$-modules correspond to invertible
$R$-modules, hence as soon as $\Pic(R)$ is not the trivial group,
then we get an example.

\medskip\noindent
Assume $\mathcal{L}$ is locally free of rank $1$ and consider the
evaluation map
$$
\mathcal{L} \otimes_{\mathcal{O}_X}
\SheafHom_{\mathcal{O}_X}(\mathcal{L}, \mathcal{O}_X)
\longrightarrow \mathcal{O}_X
$$
Looking over an open covering trivialization $\mathcal{L}$, we see
that this map is an isomorphism. Hence $\mathcal{L}$ is invertible
by Lemma \ref{lemma-invertible}.

\medskip\noindent
Assume all stalks $\mathcal{O}_{X, x}$ are local rings and $\mathcal{L}$
invertible. In the proof of Lemma \ref{lemma-invertible}
we have seen that $\mathcal{L}_x$ is an invertible
$\mathcal{O}_{X, x}$-module for all $x \in X$. Since
$\mathcal{O}_{X, x}$ is local, we see that
$\mathcal{L}_x \cong \mathcal{O}_{X, x}$
(More on Algebra, Section \ref{more-algebra-section-picard}).
Since $\mathcal{L}$ is of finite presentation by
Lemma \ref{lemma-invertible} we conclude that $\mathcal{L}$
is locally free of rank $1$ by
Lemma \ref{lemma-finite-presentation-stalk-free}.
\end{proof}

Now I introduce some of the properties of line bundles, Cartier divisors and so
on.

\begin{lemma}
\label{lemma-Cartier-effective-and-invertible-sheaf}
The ideal sheaf of an effective Cartier divisor (a subscheme locally defined by
the vanishing of a single function) is an invertible sheaf.
\end{lemma}

\begin{proof}
We just need to check that the generator of the ideal sheaf at any affine set is
not a zerodivisor. This follows from the ideal sheaf exact sequence, which
implies that multplication by the generator is injective:
 $$
\xymatrix{
0\ar[r]&I\cong A\ar[r]&A\ar[r]&A/I\ar[r]&0
}
$$
\end{proof}


\section{Ampleness}
\label{section-ampleness}

First is this lemma that comes from modules.tex. I think these sets $X_s$ are
the base points of the bundle. Because look: image of $s$ just means consider
the section $s$ of the line bundle as a germ near $x$. Now a line bundle is a
locally free rank-1 $\mathcal{O}_X$-module, so its sections, like $s$, may be
multiplied by germs of functions in the maximal ring $\mathfrak{m}_x$, i.e. the
functions that vanish at $x$. So $X_s$ is the vanishing locus of the section
$s$. If $s(x)\neq 0$, obviously $s
\not\in\mathfrak{m}_x\mathcal{L}_x$, so $x\in X_s$. Conversely, I would like to
show that if $s(x)=0$ then  $s\in\mathfrak{m}_x\mathcal{L}_x$ but I'm not sure
how. It's like: a vector field with a zero can be multiplied by a function that
vanishes at the point, sure, but what's this function?

\begin{lemma}
\label{lemma-s-open}
From modules.tex.
\begin{slogan}
A (local) trivialisation of a linebundle
is the same as a (local) nonvanishing section.
\end{slogan}
Let $X$ be a ringed space. Assume that each stalk $\mathcal{O}_{X, x}$
is a local ring with maximal ideal $\mathfrak m_x$.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
For any section $s \in \Gamma(X, \mathcal{L})$ the set
$$
X_s = \{x \in X \mid \text{image }s \not\in \mathfrak m_x\mathcal{L}_x\}
$$
is open in $X$. The map $s : \mathcal{O}_{X_s} \to \mathcal{L}|_{X_s}$
is an isomorphism, and there exists a section $s'$
of $\mathcal{L}^{\otimes -1}$ over $X_s$ such that $s' (s|_{X_s}) = 1$.
\end{lemma}

\begin{proof}
Suppose $x \in X_s$.
We have an isomorphism
$$
\mathcal{L}_x \otimes_{\mathcal{O}_{X, x}} (\mathcal{L}^{\otimes -1})_x
\longrightarrow
\mathcal{O}_{X, x}
$$
by Lemma \ref{lemma-constructions-invertible}.
Both $\mathcal{L}_x$ and $(\mathcal{L}^{\otimes -1})_x$
are free $\mathcal{O}_{X, x}$-modules of rank $1$. We conclude
from Algebra, Nakayama's Lemma \ref{algebra-lemma-NAK} that
$s_x$ is a basis for $\mathcal{L}_x$. Hence there exists
a basis element $t_x \in (\mathcal{L}^{\otimes -1})_x$
such that $s_x \otimes t_x$ maps to $1$.
Choose an open neighbourhood $U$ of
$x$ such that $t_x$ comes from a section $t$
of $\mathcal{L}^{\otimes -1}$ over $U$ and such that
$s \otimes t$ maps to $1 \in \mathcal{O}_X(U)$.
Clearly, for every $x' \in U$ we see that $s$ generates
the module $\mathcal{L}_{x'}$. Hence $U \subset X_s$.
This proves that $X_s$ is open. Moreover, the section
$t$ constructed over $U$ above is unique, and hence
these glue to give the section $s'$ of the lemma.
\end{proof}

Recall from Modules, Lemma \ref{modules-lemma-s-open}
that given an invertible sheaf $\mathcal{L}$ on a locally ringed
space $X$, and given a global section $s$ of $\mathcal{L}$
the set $X_s = \{x \in X \mid s \not \in \mathfrak m_x\mathcal{L}_x\}$
is open. A general remark is that
$X_s \cap X_{s'} = X_{ss'}$, where $ss'$ denote
the section $s \otimes s' \in \Gamma(X, \mathcal{L} \otimes \mathcal{L}')$.

\begin{definition}
\label{definition-ample}
\begin{reference}
\cite[II Definition 4.5.3]{EGA}
\end{reference}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
We say $\mathcal{L}$ is {\it ample} if
\begin{enumerate}
\item $X$ is quasi-compact, and
\item for every $x \in X$ there exists an $n \geq 1$
and $s \in \Gamma(X, \mathcal{L}^{\otimes n})$ such
that $x \in X_s$ and $X_s$ is affine.
\end{enumerate}
\end{definition}

\begin{exercise}
\label{exercise-ample-bundle-on-K3}
Let $L$ be an ample bundle on a K3 surface $M$. Prove that
$\mathcal{L}^{\otimes 2}$ is globally generated (that is, for each $x\in M$
there exsits a section $h \in H^{0}(L^{\otimes 2})$ which does not vanish in
$x$).
\end{exercise}

\begin{proof}
This just asks that the $n$ in Definition \ref{definition-ample} is $2$ for all
$x\in X$. Because, again, $x\in X_s$ means that $s(x)\neq 0$ because if it was,
then we could somehow write $s$ as a product of a vanishing function on
$\mathfrak{m}_x$ and a local frame of $\Gamma(X,\mathcal{L})$. But I guess for
the exercise do this: a line bundle is {\it ample} if there is $n$ such that the
canonical embedding (cf Lemma \ref{lemma-map-into-proj}) is an embedding, i.e.
that $\mathcal{L}^{\otimes n}$ is {\it very ample}. (Interestingly, the notion
very ampleness is defined in morphisms.tex.)
\end{proof}

Now we pass to the part where ampleness gives you an {\bf open immersion} to
some projective space. Because, it's only very ampleness that gives an
embedding, right? (Actually I think here in stacks project there are no
embeddings but closed immersions.)

\begin{definition}
\label{definition-gamma-star}
From modules.tex. Let $(X, \mathcal{O}_X)$ be a ringed space.
Given an invertible sheaf $\mathcal{L}$ on $X$ we define
the {\it associated graded ring} to be
$$
\Gamma_*(X, \mathcal{L})
=
\bigoplus\nolimits_{n \geq 0} \Gamma(X, \mathcal{L}^{\otimes n})
$$
Given a sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we set
$$
\Gamma_*(X, \mathcal{L}, \mathcal{F})
=
\bigoplus\nolimits_{n \in \mathbf{Z}} \Gamma(X,
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
$$
which we think of as a graded $\Gamma_*(X, \mathcal{L})$-module.
\end{definition}

\begin{lemma}
\label{lemma-map-into-proj}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$ as a graded ring.
If every point of $X$ is contained in one of the
open subschemes $X_s$, for some $s \in S_{+}$ homogeneous, then
there is a canonical morphism of schemes
$$
f : X \longrightarrow Y = \text{Proj}(S),
$$
to the homogeneous spectrum of $S$ (see
Constructions, Section \ref{constructions-section-proj}).
This morphism has the following properties
\begin{enumerate}
\item $f^{-1}(D_{+}(s)) = X_s$ for any $s \in S_{+}$ homogeneous,
\item there are $\mathcal{O}_X$-module maps
$f^*\mathcal{O}_Y(n) \to \mathcal{L}^{\otimes n}$
compatible with multiplication maps, see
Constructions, Equation (\ref{constructions-equation-multiply}),
\item the composition
$S_n \to \Gamma(Y, \mathcal{O}_Y(n)) \to \Gamma(X, \mathcal{L}^{\otimes n})$
is the identity map, and
\item for every $x \in X$ there is an integer $d \geq 1$
and an open neighbourhood $U \subset X$ of $x$
such that $f^*\mathcal{O}_Y(dn)|_U \to \mathcal{L}^{\otimes dn}|_U$
is an isomorphism for all $n \in \mathbf{Z}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Denote $\psi : S \to \Gamma_*(X, \mathcal{L})$ the identity map.
We are going to use the triple
$(U(\psi), r_{\mathcal{L}, \psi}, \theta)$ of
Constructions, Lemma \ref{constructions-lemma-invertible-map-into-proj}.
By assumption the open subscheme $U(\psi)$ of equals $X$. Hence
$r_{\mathcal{L}, \psi} : U(\psi) \to Y$ is defined on all of $X$.
We set $f = r_{\mathcal{L}, \psi}$.
The maps in part (2) are the components of $\theta$.
Part (3) follows from condition (2) in the lemma cited above.
Part (1) follows from (3) combined with condition (1) in the lemma
cited above. Part (4) follows from the last statement in
Constructions, Lemma \ref{constructions-lemma-invertible-map-into-proj}
since the map $\alpha$ mentioned there is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-map-into-proj-quasi-compact}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$.
Assume (a) every point of $X$ is contained in one of the
open subschemes $X_s$, for some $s \in S_{+}$ homogeneous,
and (b) $X$ is quasi-compact. Then the canonical morphism of schemes
$f : X \longrightarrow \text{Proj}(S)$ of Lemma \ref{lemma-map-into-proj}
above is quasi-compact with dense image.
\end{lemma}

\begin{proof}
To prove $f$ is quasi-compact it suffices to show that $f^{-1}(D_{+}(s))$
is quasi-compact for any $s \in S_{+}$ homogeneous. Write
$X = \bigcup_{i = 1, \ldots, n} X_i$ as a finite union of
affine opens. By Lemma \ref{lemma-affine-cap-s-open} each intersection
$X_s \cap X_i$ is affine. Hence $X_s = \bigcup_{i = 1, \ldots, n} X_s \cap X_i$
is quasi-compact. Assume that the image of $f$ is not dense to get
a contradiction. Then, since the opens $D_+(s)$ with $s \in S_+$ homogeneous
form a basis for the topology on $\text{Proj}(S)$, we can find such
an $s$ with $D_+(s) \not = \emptyset$ and $f(X) \cap D_+(s) = \emptyset$.
By Lemma \ref{lemma-map-into-proj}
this means $X_s = \emptyset$. By Lemma \ref{lemma-invert-s-sections}
this means that a power $s^n$ is the zero section of
$\mathcal{L}^{\otimes n\deg(s)}$.
This in turn means that $D_+(s) = \emptyset$ which is the
desired contradiction.
\end{proof}

\begin{lemma}
\label{lemma-ample-immersion-into-proj}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Set $S = \Gamma_*(X, \mathcal{L})$.
Assume $\mathcal{L}$ is ample. Then the canonical morphism of schemes
$f : X \longrightarrow \text{Proj}(S)$ of Lemma \ref{lemma-map-into-proj}
is an open immersion with dense image.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-affine-s-opens-cover-quasi-separated} we see
that $X$ is quasi-separated. Choose finitely many
$s_1, \ldots, s_n \in S_{+}$ homogeneous
such that $X_{s_i}$ are affine, and $X = \bigcup X_{s_i}$.
Say $s_i$ has degree $d_i$. The inverse image of
$D_{+}(s_i)$ under $f$ is $X_{s_i}$, see Lemma \ref{lemma-map-into-proj}.
By Lemma \ref{lemma-invert-s-sections} the ring map
$$
(S^{(d_i)})_{(s_i)} = \Gamma(D_{+}(s_i), \mathcal{O}_{\text{Proj}(S)})
\longrightarrow
\Gamma(X_{s_i}, \mathcal{O}_X)
$$
is an isomorphism. Hence $f$ induces an isomorphism
$X_{s_i} \to D_{+}(s_i)$. Thus $f$ is an isomorphism of $X$ onto the open
subscheme $\bigcup_{i = 1, \ldots, n} D_{+}(s_i)$ of $\text{Proj}(S)$.
The image is dense by Lemma \ref{lemma-map-into-proj-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-open-in-proj-ample}
Let $X$ be a scheme.
Let $S$ be a graded ring. Assume $X$ is quasi-compact,
and assume there exists an open immersion
$$
j : X \longrightarrow Y = \text{Proj}(S).
$$
Then $j^*\mathcal{O}_Y(d)$ is an invertible ample sheaf
for some $d > 0$.
\end{lemma}

\begin{proof}
This is Constructions, Lemma \ref{constructions-lemma-ample-on-proj}.
\end{proof}

\begin{proposition}
\label{proposition-characterize-ample}
Let $X$ be a quasi-compact scheme.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
Set $S = \Gamma_*(X, \mathcal{L})$.
The following are equivalent:
\begin{enumerate}
\item
\label{item-ample}
$\mathcal{L}$ is ample,
\item
\label{item-immersion}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
cover $X$ and the associated morphism $X \to \text{Proj}(S)$
is an open immersion,
\item
\label{item-s-basis}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
form a basis for the topology of $X$,
\item
\label{item-s-affine-basis}
the open sets $X_s$, with $s \in S_{+}$ homogeneous,
which are affine form a basis for the topology of $X$,
\item
\label{item-qc-gg}
for every quasi-coherent sheaf $\mathcal{F}$ on $X$
the sum of the images of the canonical maps
$$
\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
\otimes_{\mathbf{Z}} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
with $n \geq 1$ equals $\mathcal{F}$,
\item
\label{item-qc-i-gg}
same property as (\ref{item-qc-gg}) with $\mathcal{F}$
ranging over all quasi-coherent sheaves of ideals,
\item
\label{item-c-gg}
$X$ is quasi-separated and
for every quasi-coherent sheaf $\mathcal{F}$ of finite type on $X$
there exists an integer $n_0$ such that
$\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
is globally generated for all $n \geq n_0$,
\item
\label{item-c-q}
$X$ is quasi-separated and
for every quasi-coherent sheaf $\mathcal{F}$ of finite type on $X$
there exist integers $n > 0$, $k \geq 0$ such that
$\mathcal{F}$ is a quotient of a direct sum of $k$ copies of
$\mathcal{L}^{\otimes - n}$, and
\item
\label{item-c-i-q}
same as in (\ref{item-c-q}) with $\mathcal{F}$ ranging over all
sheaves of ideals of finite type on $X$.
\end{enumerate}
\end{proposition}

\begin{proof}
Lemma \ref{lemma-ample-immersion-into-proj} is
(\ref{item-ample}) $\Rightarrow$ (\ref{item-immersion}).
Lemmas \ref{lemma-ample-power-ample} and \ref{lemma-open-in-proj-ample}
provide the implication
(\ref{item-ample}) $\Leftarrow$ (\ref{item-immersion}).
The implications (\ref{item-immersion}) $\Rightarrow$
(\ref{item-s-affine-basis}) $\Rightarrow$ (\ref{item-s-basis})
are clear from Constructions, Section \ref{constructions-section-proj}.
Lemma \ref{lemma-affine-s-opens} is
(\ref{item-s-basis}) $\Rightarrow$ (\ref{item-ample}).
Thus we see that the first 4 conditions are all equivalent.

\medskip\noindent
Assume the equivalent conditions (1) -- (4).
Note that in particular $X$ is separated (as an open
subscheme of the separated scheme $\text{Proj}(S)$).
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Choose $s \in S_{+}$ homogeneous such that $X_s$ is affine.
We claim that any section $m \in \Gamma(X_s, \mathcal{F})$
is in the image of one of the maps displayed in
(\ref{item-qc-gg}) above. This will imply (\ref{item-qc-gg})
since these affines $X_s$ cover $X$.
Namely, by Lemma \ref{lemma-invert-s-sections} we may write
$m$ as the image of $m' \otimes s^{-n}$ for some
$n \geq 1$, some
$m' \in \Gamma(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})$.
This proves the claim.

\medskip\noindent
Clearly (\ref{item-qc-gg}) $\Rightarrow$ (\ref{item-qc-i-gg}).
Let us assume (\ref{item-qc-i-gg}) and prove $\mathcal{L}$ is
ample. Pick $x \in X$. Let $U \subset X$ be an affine open
which contains $x$. Set $Z = X \setminus U$. We may think of
$Z$ as a reduced closed subscheme, see
Schemes, Section \ref{schemes-section-reduced}.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the quasi-coherent
sheaf of ideals corresponding to the closed subscheme $Z$.
By assumption (\ref{item-qc-i-gg}), there exists an $n \geq 1$ and a section
$s \in \Gamma(X, \mathcal{I} \otimes \mathcal{L}^{\otimes n})$
such that $s$ does not vanish at $x$ (more precisely such that
$s \not \in \mathfrak m_x \mathcal{I}_x \otimes \mathcal{L}_x^{\otimes n}$).
We may think of $s$ as a section of $\mathcal{L}^{\otimes n}$.
Since it clearly vanishes along $Z$ we see that
$X_s \subset U$. Hence $X_s$ is affine, see
Lemma \ref{lemma-affine-cap-s-open}.
This proves that $\mathcal{L}$ is ample.
At this point we have proved that (1) -- (6) are equivalent.

\medskip\noindent
Assume the equivalent conditions (1) -- (6). In the following
we will use the fact that the tensor product of two sheaves of
modules which are globally generated is globally generated without
further mention (see
Modules, Lemma \ref{modules-lemma-tensor-product-globally-generated}).
By (1) we can find elements $s_i \in S_{d_i}$ with $d_i \geq 1$
such that $X = \bigcup_{i = 1, \ldots, n} X_{s_i}$.
Set $d = d_1\ldots d_n$. It follows that $\mathcal{L}^{\otimes d}$
is globally generated by
$$
s_1^{d/d_1}, \ldots, s_n^{d/d_n}.
$$
This means that if $\mathcal{L}^{\otimes j}$ is globally generated
then so is $\mathcal{L}^{\otimes j + dn}$ for all $n \geq 0$.
Fix a $j \in \{0, \ldots, d - 1\}$. For any point $x \in X$ there
exists an $n \geq 1$ and a global section $s$ of $\mathcal{L}^{j + dn}$
which does not vanish at $x$, as follows from (\ref{item-qc-gg}) applied
to $\mathcal{F} = \mathcal{L}^{\otimes j}$ and ample invertible
sheaf $\mathcal{L}^{\otimes d}$. Since $X$ is quasi-compact there
we may find a finite list of integers $n_i$ and global sections
$s_i$ of $\mathcal{L}^{\otimes j + dn_i}$ which do not vanish at any point
of $X$. Since $\mathcal{L}^{\otimes d}$ is globally generated this means that
$\mathcal{L}^{\otimes j + dn}$ is globally generated where $n = \max\{n_i\}$.
Since we proved this for every congruence class mod $d$ we
conclude that there exists an $n_0 = n_0(\mathcal{L})$ such that
$\mathcal{L}^{\otimes n}$ is globally generated for all $n \geq n_0$.
At this point we see that if $\mathcal{F}$ is globally generated then
so is $\mathcal{F} \otimes \mathcal{L}^{\otimes n}$ for all
$n \geq n_0$.

\medskip\noindent
We continue to assume the equivalent conditions (1) -- (6).
Let $\mathcal{F}$ be a quasi-coherent
sheaf of $\mathcal{O}_X$-modules of finite type.
Denote $\mathcal{F}_n \subset \mathcal{F}$ the image of the canonical
map of (\ref{item-qc-gg}). By construction
$\mathcal{F}_n \otimes \mathcal{L}^{\otimes n}$ is
globally generated. By (\ref{item-qc-gg}) we see
$\mathcal{F}$ is the sum of the subsheaves $\mathcal{F}_n$,
$n \geq 1$. By
Modules, Lemma \ref{modules-lemma-finite-type-quasi-compact-colimit}
we see that $\mathcal{F} = \sum_{n = 1, \ldots, N} \mathcal{F}_n$
for some $N \geq 1$. It follows that
$\mathcal{F} \otimes \mathcal{L}^{\otimes n}$ is globally
generated whenever $n \geq N + n_0(\mathcal{L})$ with $n_0(\mathcal{L})$
as above. We conclude that (1) -- (6) implies (\ref{item-c-gg}).

\medskip\noindent
Assume (\ref{item-c-gg}). Let $\mathcal{F}$ be a quasi-coherent
sheaf of $\mathcal{O}_X$-modules of finite type.
By (\ref{item-c-gg}) there exists an integer $n \geq 1$ such that
the canonical map
$$
\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
\otimes_{\mathbf{Z}} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
is surjective. Let $I$ be the set of finite subsets of
$\Gamma(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})$
partially ordered by inclusion. Then $I$ is a directed partially ordered set.
For $i = \{s_1, \ldots, s_{r(i)}\}$ let $\mathcal{F}_i \subset \mathcal{F}$
be the image of the map
$$
\bigoplus\nolimits_{j = 1, \ldots, r(i)} \mathcal{L}^{\otimes -n}
\longrightarrow
\mathcal{F}
$$
which is multiplication by $s_j$ on the $j$th factor. The surjectivity above
implies that $\mathcal{F} = \colim_{i \in I} \mathcal{F}_i$.
Hence Modules, Lemma \ref{modules-lemma-finite-type-quasi-compact-colimit}
applies and we conclude that
$\mathcal{F} = \mathcal{F}_i$ for some $i$.
Hence we have proved (\ref{item-c-q}). In other words,
(\ref{item-c-gg}) $\Rightarrow$ (\ref{item-c-q}).

\medskip\noindent
The implication (\ref{item-c-q}) $\Rightarrow$ (\ref{item-c-i-q}) is trivial.

\medskip\noindent
Finally, assume (\ref{item-c-i-q}).
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf
of ideals. By Lemma \ref{lemma-quasi-coherent-colimit-finite-type}
(this is where we use the condition that $X$ be quasi-separated)
we see that $\mathcal{I} = \colim_\alpha I_\alpha$ with
each $I_\alpha$ quasi-coherent of finite type. Since by assumption each of
the $I_\alpha$ is a quotient of negative tensor powers of
$\mathcal{L}$ we conclude the same for $\mathcal{I}$ (but of course
without the finiteness or boundedness of the powers). Hence
we conclude that (\ref{item-c-i-q}) implies (\ref{item-qc-i-gg}).
This ends the proof of the proposition.
\end{proof}

The following proofs were used for Exercise 
\ref{complex-geometry-exercise-L-ample-implies-Lotimes2-globally-generated}.

\begin{lemma}
\label{lemma-divisor-has-sections-implies-deg-geq-0}
Let $D$ be a divisor on a complete, nonsingular curve $X$. 
If  $h^0(D)\neq 0$ then $\text{deg}D\geq0$.
\end{lemma}

\begin{proof}
If $D$ has sections, we can take the zero locus of any of its sections to
produce an effective divisor linearly equivalent to $D$. Since degree depends
only on linear equivalence and effective divisors have non negative degree.
\end{proof}

\begin{proposition}
\label{proposition-divisor-is-base-point-free-iff-dimension-condition}
\begin{reference}
\cite[IV, Proposition 3.1(a)]{hart}
\end{reference}
Let $D$ be a divisor on a complete, nonsingular curve $X$. 
Then the complete linear system has no base
points if and only if for every point $P\in X$,
$$
\dim|D-P|=\dim|D|-1
$$
\end{proposition}

\begin{proof}
To show that $D$ has no base points amounts to showing that not every section of
$D$. That is, that the injective map $0\to H^{0}(D-p)\to H^{0}(D)$ is not 
surjective.
\end{proof}

\begin{lemma}
\label{lemma-degree-of-divisor-geq-2g-implies-base-point-free}
\begin{reference}
\cite[IV, Corollary 3.2(a), Examples 1.3.3, 1.3.4]{hart}
\end{reference}
Let $D$ be a divisor on a curve $X$ of genus $g$. 
If $\text{deg}D\geq 2g$, then
$|D|$ has no base points.
\end{lemma}

\begin{proof}
First we prove that $\text{deg}D\geq 2g$ implies that $D$ and $D-P$ are  
{\it nonspecial}, i.e. that
$h^0(K-D)=0=h^0(K-(D-P))$. Then we apply Riemann-Roch to both $D$ and $D-P$ and
the fact that  $\text{deg}(D-P)=\text{deg}(D)-1$ to find that
$\dim|D-P|=\dim|D|-1$ and apply Proposition 
\ref{proposition-divisor-is-base-point-free-iff-dimension-condition}.

To prove that $D$ is nonspecial first apply Riemann-Roch to $K$ to obtain that
$\text{deg}K=2g-2$. Indeed, $h^0(0)=1$ and $h^0(K)=p_g$ by Serre duality on
$H^1(\mathcal{O}_X)$ recalling definition of genus as $h^1(\mathcal{O}_X)$. 
Then apply Riemann-Roch to both $D$ and  $K-D$ to prove
that $\text{deg}D>2g-2$ implies $\text{deg}(K-D)<0$; start with
$$
h^0(K-D)-h^0(K-(K-D))=-(h^0(D)-h^0(K-D))
$$
An analogous result will be valid for $D-P$ since its degree is also greater
than $2g-2$.

Then apply Lemma
\ref{lemma-divisor-has-sections-implies-deg-geq-0}.
\end{proof}

\section{Closed immersions of locally ringed spaces}
\label{section-closed-immersion}

\noindent
We follow our conventions introduced in
Modules, Definition \ref{modules-definition-closed-immersion}.

\begin{definition}
\label{definition-closed-immersion-locally-ringed-spaces}
Let $i : Z \to X$ be a morphism of locally ringed spaces.
We say that $i$ is a {\it closed immersion} if:
\begin{enumerate}
\item The map $i$ is a homeomorphism of $Z$ onto a closed subset of $X$.
\item The map $\mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective;
let $\mathcal{I}$ denote the kernel.
\item The $\mathcal{O}_X$-module $\mathcal{I}$
is locally generated by sections.
\end{enumerate}
\end{definition}

\begin{definition}
\label{definition-closed-immersion-locally-ringed-spaces}
Let $i : Z \to X$ be a morphism of locally ringed spaces.
We say that $i$ is a {\it closed immersion} if:
\begin{enumerate}
\item The map $i$ is a homeomorphism of $Z$ onto a closed subset of $X$.
\item The map $\mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective;
let $\mathcal{I}$ denote the kernel.
\item The $\mathcal{O}_X$-module $\mathcal{I}$
is locally generated by sections.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-closed-local-target}
Let $f : Z \to X$ be a morphism of locally ringed spaces.
In order for $f$ to be a closed immersion it suffices
that there exists an open covering $X = \bigcup U_i$ such
that each $f : f^{-1}U_i \to U_i$ is a closed immersion.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{example}
\label{example-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf
of ideals which is locally generated by sections as a sheaf
of $\mathcal{O}_X$-modules. Let $Z$ be the support of
the sheaf of rings $\mathcal{O}_X/\mathcal{I}$.
This is a closed subset of $X$, by
Modules, Lemma \ref{modules-lemma-support-sheaf-rings-closed}.
Denote $i : Z \to X$ the inclusion map.
By Modules, Lemma \ref{modules-lemma-i-star-exact}
there is a unique sheaf of rings $\mathcal{O}_Z$ on $Z$
with $i_*\mathcal{O}_Z = \mathcal{O}_X/\mathcal{I}$.
For any $z \in Z$ the stalk $\mathcal{O}_{Z, z}$
is equal to a quotient $\mathcal{O}_{X, i(z)}/\mathcal{I}_{i(z)}$
of a local ring and nonzero, hence a local ring.
Thus $i : (Z, \mathcal{O}_Z) \to (X, \mathcal{O}_X)$ is
a closed immersion of locally ringed spaces.
\end{example}

\begin{definition}
\label{definition-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I}$ be a sheaf of ideals on $X$
which is locally generated by sections.
The locally ringed space $(Z, \mathcal{O}_Z)$
of Example \ref{example-closed-subspace} above
is the {\it closed subspace of $X$ associated to
the sheaf of ideals $\mathcal{I}$}.
\end{definition}

\begin{lemma}
\label{lemma-closed-immersion}
Let $f : X \to Y$ be a closed immersion of
locally ringed spaces. Let $\mathcal{I}$ be the
kernel of the map $\mathcal{O}_Y \to f_*\mathcal{O}_X$.
Let $i : Z \to Y$ be the closed subspace of $Y$
associated to $\mathcal{I}$.
There is a unique isomorphism $f' : X \cong Z$ of
locally ringed spaces such that $f = i \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-characterize-closed-subspace}
Let $X$, $Y$ be locally ringed spaces. Let
$\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals locally generated
by sections. Let $i : Z \to X$ be the associated closed subspace.
A morphism $f : Y \to X$ factors through $Z$ if and only if the map
$f^*\mathcal{I} \to f^*\mathcal{O}_X = \mathcal{O}_Y$
is zero. If this is the case the morphism $g : Y \to Z$
such that $f = i \circ g$ is unique.
\end{lemma}

\begin{proof}
Clearly if $f$ factors as $Y \to Z \to X$ then the map
$f^*\mathcal{I} \to \mathcal{O}_Y$ is zero. Conversely
suppose that $f^*\mathcal{I} \to \mathcal{O}_Y$ is zero.
Pick any $y \in Y$, and consider the ring map
$f^\sharp_y : \mathcal{O}_{X, f(y)} \to \mathcal{O}_{Y, y}$.
Since the composition
$\mathcal{I}_{f(y)} \to \mathcal{O}_{X, f(y)} \to \mathcal{O}_{Y, y}$
is zero by assumption and since $f^\sharp_y(1) = 1$
we see that $1 \not \in \mathcal{I}_{f(y)}$, i.e.,
$\mathcal{I}_{f(y)} \not = \mathcal{O}_{X, f(y)}$. We conclude that
$f(Y) \subset Z = \text{Supp}(\mathcal{O}_X/\mathcal{I})$.
Hence $f = i \circ g$ where $g : Y \to Z$ is continuous.
Consider the map $f^\sharp : \mathcal{O}_X \to f_*\mathcal{O}_Y$.
The assumption $f^*\mathcal{I} \to \mathcal{O}_Y$ is zero implies that
the composition $\mathcal{I} \to \mathcal{O}_X \to f_*\mathcal{O}_Y$ is
zero by adjointness of $f_*$ and $f^*$.
In other words, we obtain a morphism of sheaves of rings
$\overline{f^\sharp} : \mathcal{O}_X/\mathcal{I} \to f_*\mathcal{O}_Y$.
Note that $f_*\mathcal{O}_Y = i_*g_*\mathcal{O}_Y$ and
that $\mathcal{O}_X/\mathcal{I} = i_*\mathcal{O}_Z$.
By Sheaves, Lemma \ref{sheaves-lemma-equivalence-categories-closed-structures}
we obtain a unique morphism of sheaves of rings
$g^\sharp : \mathcal{O}_Z \to g_*\mathcal{O}_Y$ whose pushforward
under $i$ is $\overline{f^\sharp}$. We omit the verification that
$(g, g^\sharp)$ defines a morphism of locally ringed spaces
and that $f = i \circ g$ as a morphism of locally ringed spaces.
The uniqueness of $(g, g^\sharp)$ was pointed out above.
\end{proof}

\begin{lemma}
\label{lemma-restrict-map-to-closed}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $\mathcal{I} \subset \mathcal{O}_Y$ be a sheaf of
ideals which is locally generated by sections.
Let $i : Z \to Y$ be the closed subspace associated to the
sheaf of ideals $\mathcal{I}$.
Let $\mathcal{J}$ be the image of the map
$f^*\mathcal{I} \to f^*\mathcal{O}_Y = \mathcal{O}_X$.
Then this ideal is locally generated by sections.
Moreover, let $i' : Z' \to X$ be the associated closed
subspace of $X$. There exists a unique
morphism of locally ringed spaces $f' : Z' \to Z$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
Z' \ar[d]_{f'} \ar[r]_{i'} & X \ar[d]^f \\
Z \ar[r]^{i} & Y
}
$$
Moreover, this diagram is a fibre square in the category of
locally ringed spaces.
\end{lemma}

\begin{proof}
The ideal $\mathcal{J}$ is locally generated by sections
by Modules, Lemma \ref{modules-lemma-pullback-locally-generated}.
The rest of the lemma follows from the characterization,
in Lemma \ref{lemma-characterize-closed-subspace} above,
of what it means for a morphism to factor through a closed
subspace.
\end{proof}

\section{Dominant morphisms}
\label{section-dominant}

\noindent
The definition of a morphism of schemes being dominant is a little
different from what you might expect if you are used to the notion
of a dominant morphism of varieties.

\begin{definition}
\label{definition-dominant}
A morphism $f : X \to S$ of schemes is called {\it dominant} if the
image of $f$ is a dense subset of $S$.
\end{definition}

\section{Morphisms of finite type}
\label{section-finite-type}

\noindent
Recall that a ring map $R \to A$ is said to be of finite type if
$A$ is isomorphic to a quotient of $R[x_1, \ldots, x_n]$ as an $R$-algebra, see
Algebra, Definition \ref{algebra-definition-finite-type}.

\begin{definition}
\label{definition-finite-type}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is of {\it finite type at $x \in X$} if
there exists an affine open neighbourhood $\Spec(A) = U \subset X$
of $x$ and an affine open $\Spec(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is of finite type.
\item We say that $f$ is {\it locally of finite type} if it is
of finite type at every point of $X$.
\item We say that $f$ is of {\it finite type} if it is locally of
finite type and quasi-compact.
\end{enumerate}
\end{definition}

\section{Normalization}
\label{section-normalization}

\begin{definition}
\label{definition-normalization-X-in-Y}
Let $f : Y \to X$ be a quasi-compact and quasi-separated morphism of schemes.
Let $\mathcal{O}'$ be the integral closure of $\mathcal{O}_X$ in
$f_*\mathcal{O}_Y$. The {\it normalization of $X$ in $Y$} is the
scheme\footnote{The scheme $X'$ need not be normal, for example if
$Y = X$ and $f = \text{id}_X$, then $X' = X$.}
$$
\nu : X' = \underline{\Spec}_X(\mathcal{O}') \to X
$$
over $X$. It comes equipped with a natural factorization
$$
Y \xrightarrow{f'} X' \xrightarrow{\nu} X
$$
of the initial morphism $f$.
\end{definition}

\noindent
The factorization is the composition of the canonical morphism
$Y \to \underline{\Spec}_X(f_*\mathcal{O}_Y)$ (see
Constructions, Lemma
\ref{constructions-lemma-canonical-morphism})
and the morphism of relative spectra coming from the inclusion map
$\mathcal{O}' \to f_*\mathcal{O}_Y$. We can characterize the
normalization as follows.

\begin{lemma}
\label{lemma-characterize-normalization}
Let $f : Y \to X$ be a quasi-compact and quasi-separated morphism of schemes.
The factorization $f = \nu \circ f'$, where $\nu : X' \to X$ is the
normalization of $X$ in $Y$ is characterized by the following
two properties:
\begin{enumerate}
\item the morphism $\nu$ is integral, and
\item for any factorization $f = \pi \circ g$, with $\pi : Z \to X$
integral, there exists a commutative diagram
$$
\xymatrix{
Y \ar[d]_{f'} \ar[r]_g & Z \ar[d]^\pi \\
X' \ar[ru]^h \ar[r]^\nu & X
}
$$
for some unique morphism $h : X' \to Z$.
\end{enumerate}
Moreover, the morphism $f' : Y \to X'$ is dominant and in (2) the
morphism $h : X' \to Z$ is the normalization of $Z$ in $Y$.
\end{lemma}



\section{Reflexive sheaves}
\label{section-reflexive-sheaves}

\begin{slogan}
These are vector bundles except for a small locus.
\end{slogan}

\begin{definition}
\label{definition-reflexive}
Let $X$ be an integral locally Noetherian scheme. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module. The {\it reflexive hull}
of $\mathcal{F}$ is the $\mathcal{O}_X$-module
$$
\mathcal{F}^{**} = \SheafHom_{\mathcal{O}_X}(
\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{O}_X), \mathcal{O}_X)
$$
We say $\mathcal{F}$ is {\it reflexive} if the natural map
$j : \mathcal{F} \longrightarrow \mathcal{F}^{**}$
is an isomorphism.
\end{definition}

\begin{lemma}
\label{lemma-reflexive-torsion-free}
Let $X$ be an integral locally Noetherian scheme. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is reflexive, then $\mathcal{F}$ is torsion free.
\item The map $j : \mathcal{F} \longrightarrow \mathcal{F}^{**}$
is injective if and only if $\mathcal{F}$ is torsion free.
\end{enumerate}
\end{lemma}

\begin{remark}[Talk at IMPA, 11 June]\leavevmode
\label{remark-reflexive-talk}
Torsion could also be defined so that the sheaf can inject onto its dual. In
this talk we discussed the moduli space of reflexive/torsion-free sheaves, which
turned out to be parametrized by $c_1, c_2$ and $c_3$. This was denoted by 
$R(c_1,c_2,c_3)$. Actually I think it may have been Manolache that proved the
existence of this moduli space.


Alan Muniz

Nesta palestra discutiremos a classificaÃ§Ã£o de feixes reflexivos de posto dois e
seus espaÃ§os de mÃ³dulos. Apresentaremos algumas ferramentas bÃ¡sicas usadas na
construÃ§Ã£o e determinaÃ§Ã£o de tais feixes. Aplicaremos estas tÃ©cnicas para o caso
de feixes com segunda classe de Chern igual a quatro, obtido recentemente em
colaboraÃ§Ã£o com Marcos Jardim.
\end{remark}

\subsection{Distributions on manifolds}
\label{subsection-distributions-on-manifolds}

Here's the abstract from a talk by Marcos Jardim at Geometric Structures:

``I will revise the work done over the past 10 years with various collaborators
on distributions and foliations on 3-folds, especially on the projective space,
with a focus on properties of the tangent sheaf and singular scheme."

Here are two key ideas: if the distribution is codimension 1 we can write:
$$
\xymatrix{
0\ar[r]&F\ar[r]&TX\ar[r]^{\omega}&I_Z \otimes L\ar[r]&0
}
$$
where $L$ is a line bundle and $\omega \in H^{0}(\Omega_X \otimes L)$, and
$Z=\{p:\omega(p)=0\}$.

When codimension is 2 then $\mathcal{D}$ is given by a holomorphic vector field 
$\nu$: $T_p=\left<\nu(p)\right>$.

It can be encoded as an exact sequence
$$
\xymatrix{
	0\ar[r]&L\ar[r]^{\nu}&TX\ar[r]&N\ar[r]&0
}
$$
where $L$ is a line bundle and $\nu \in H^{0}(TX \otimes L^\vee)$;
  $Z=\{p | \nu(p) = 0\}$.

\begin{remark}
\label{remark-stauration}
Saturation means that $Z \subset X$ is a union of curves and points.
\end{remark}

And again, distributions are parametrized by Chern classes.

Two interesting open questions:
\begin{enumerate}
\item {\bf Conjeture.} if $\mathcal{D}$ is a codimension 1 foliation of degree
$d$ on $\mathbb{P}^3$, then $c_2(F)\leq d^2-d+1$ and bound is attained
by rational foliations of type $(1,d+1)$. (True for $d \leq 2$.)
\item {\bf Conjecture (with Pepe Seade).} $\mathcal{D}$ is a codimension 1 
foliation on a smooth projective 3-fold, then $\text{Sing}\mathcal{D}$ is connected.
\end{enumerate}

\begin{theorem}[Jardim-Muniz]
\label{theorem-jardim-muniz}
Conditions on Chern classes used to understand moduli space $R(c_1,c_2,c_3)$.
$c_2=4$ gives (?). For $c_3\leq 6$, possible ``spectrum" existsâ€¦
\end{theorem}

\section{Stability}
\label{section-stability}

{\bf Question.} What is stability?

\begin{enumerate}
\item Stable objects in an abelian category are the ``building blocks":
we can reconstruct the whole category from them.
\item  An abelian subcategory (hart) $\subset$ a triangulated
\item stability defined via stability function on $\mathcal{A}$.
\item Q. Can we reconstruct $\mathcal{T}$ from the semistable elements of
$\mathcal{A}$
\item {\bf Example.} $\mathcal{A}=\text{Coh}X$ is heart of $D^b(X)$
w/ funny function.
\item Stability condition is hart + stability function.
\item Bridgeland Stabl:= the stability conditions are a complex manifold
of complex codimension $\text{rk}\Lambda$:
$$
 \mathcal{Z}:\text{Stab}(\mathcal{T})
\longrightarrow \text{Hom}(\Lambda,\mathbb{C})
$$
\item There's a chamber structure; moduli space changes across chambers.
\item I think we typically think of vectors in $\text{Hom}(\Lambda,\mathbb{C})$ 
as Chern classes, to characterize the moduli spaces.
\item Existence: given a projective variety $X$, are there stability
conditions on $D^\text{b}(X)$? Yes for fano 3fold pic rk 1.
\item Moduli spaces: is $M_\sigma(v)$ a projective scheme? Cannot use
usual git techniques to study. A stack!
\item Picture: blue + black are walls. Q. What are $\beta$ and $\alpha$?
\item thm: bridgeland stable = gieseker stable ?
\item Q. slope stability = bridgeland stability? A. Not always.
\item DT/PT correspondance: only one wall between PT and G chambers
\medskip
\item Polynomial stability function. This is an asymptotic version of BS.
\item There are some $\rho$'s. Arrangements of $\rho_i$ are polynomial 
stability conditions on a threefold.
\item Pata-Thomas introduced stability for rank 1 objects.
Bayer compares the---wall. Q. Same for Bridge S---only one wall?
\item Recall Gieseker stability.
\medskip
\item Def. A {\it stable triple}: when
$\text{gcd}(\text{ch}_0,\text{ch}_2,\text{ch}_3)=1$, every PT stable object
comes from three conditions (missing).
\item What happens when you cross the blue wall? 
Both $\mathcal{G}$ and $\mathcal{T}$ are projective. What happens at the blue
wall?
\medskip
\item For $X$ smooth threefold with $\text{rk}\text{Pic}=1$, $\mathcal{G}(v)$,
$v=(r,0,0,-n)$, $\mathcal{G}(v)$ is a known sheaf object and
$\mathcal{T}=\emptyset$.
\item $X$ sm 3 rkpic1, Fake wall; $\mathcal{G}=\mathcal{T}$.
\item (Extra.) red circle is a wall for a weaker form of stability.
\end{enumerate}
\begin{definition}[Talk at impa]
\label{definition-slope-stability}
A rank-2 sheaf $\mathcal{F}$ is {\it semistable (stable)}if
$H^{0}(\mathcal{F}(t))=0$ for $-t \geq(>) \frac{c_1F}{2}$
\end{definition}

Compare with

\begin{definition}[moduli-curves.tex]
\label{definition-semistable}
Let $f : X \to S$ be a family of curves.
We say $f$ is a {\it semistable family of curves} if
\begin{enumerate}
\item $X \to S$ is a prestable family of curves, and
\item $X_s$ has genus $\geq 1$ and
does not have a rational tail for all $s \in S$.
\end{enumerate}
\end{definition}

\section{Coherent sheaves}
\label{section-coherent-sheaves}

\begin{lemma}
\label{lemma-quasi-coherent-affine-cohomology-zero}
\begin{slogan}
Serre vanishing: Higher cohomology vanishes on affine schemes
for quasi-coherent modules.
\end{slogan}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
For any affine open $U \subset X$ we have
$H^p(U, \mathcal{F}) = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
We are going to apply
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}.
As our basis $\mathcal{B}$ for the topology of $X$ we are going to use
the affine opens of $X$.
As our set $\text{Cov}$ of open coverings we are going to use the standard
open coverings of affine opens of $X$.
Next we check that conditions (1), (2) and (3) of
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}
hold. Note that the intersection of standard opens in an affine is
another standard open. Hence property (1) holds.
The coverings form a cofinal system of open coverings of any element
of $\mathcal{B}$, see
Schemes, Lemma \ref{schemes-lemma-standard-open}.
Hence (2) holds.
Finally, condition (3) of the lemma follows from
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}.
\end{proof}

\section{Hilbert polynomial}
\label{section-Hilbert-polynomial}

The fact that $M$ is finitely generated is what makes the following two
definitions make sense.

\begin{definition}
\label{definition-Hilbert-function}
The {\it Hilbert function} of a finitely generated graded $S=k[x_0,\ldots,x_r]$ 
-module $M$ is
$$
H_M(d)=\dim_kM_d
$$
\end{definition}

\begin{definition}
\label{definition-sysygy}
Define $F_0$ to be the free $S$-module on the generators of $M$. Elements in the
 kernel $M_1$ of the inclusion are called {\it sysygies}. By Hilbert's basis
theorem, $M_1$ is also finitely generated, so we may choose a set of generators
and repeat this process.
\end{definition}

\begin{theorem}[Hilbert Syzygy Theorem]
\label{theorem-Hilbert-syzygy}
\begin{reference}
\cite[Theorem 1.1]{sys}
\end{reference}
Any finitely generated $S$-module $M$ has a finite graded free resolution
$$
\xymatrix{
0\ar[r]&F_m\ar[r]^{\varphi_m}&\ar[r]&F_{m-q}\ar[r]&\cdots\ar[r]&
F_1\ar[r]^{\varphi_1}&F_0
}
$$
Moreover, we may take $m\leq r+1$, the number of variables in $S$.
\end{theorem}

\begin{lemma}
\label{lemma-Hilbert-function}
Suppose that $S=k[x_0,\ldots,x_r]$ is a polynomial ring. If the graded
$S$-module $M$ has finite free resolution
$$
\xymatrix{
0\ar[r]&F_m\ar[r]^{\varphi_m}&F_{m-1}\ar\cdots[r]&F_1\ar[r]^{\varphi_1}&
\ar[r]&F_0
}
$$
with each $F_i$ a finitely generated free module,
$F_i=\bigoplus_{j}S(-a_{i,j})$, then
\begin{equation}
\label{equation-Hilbert-function}
H_M(d)=\sum_{i=0}(-1)^i\sum_{j}\binom{r+d-a_{i,j}}{r}
\end{equation}
\end{lemma}

\begin{lemma}
\label{lemma-Hilbert-function-becomes-polynomial}
There is a polynomial $P_M(d)$ called the {\it Hilbert polynomial} such that, if
$M$ has free resolution as above, then $P_M(d)=H_M(d)$ for 
$d\geq\text{max}_{i,j}\{a_{i,j}-r\}$.
\end{lemma}

\begin{proof}
When $d$ satisfies this bound then the binomial coefficients in Eq.
\ref{equation-Hilbert-function} are polynomials of degree $r$ in $d$.
\end{proof}

\begin{theorem}[Hilbert-Serre]
\label{theorem-Hilbert-Serre}
\begin{reference}
\cite[I, Theorem 7.5]{hart}
\end{reference}
Let $M$ be a finitely generated graded $S=k[x_0,\ldots,x_n]$. Then there exists
a unique polynomial $p_M$ such that $p_M(\ell)=\dim S_\ell$ for large enough
$\ell$.
\end{theorem}

\begin{definition}
\label{definition-Hilbert-polynomial}
\begin{reference}
\cite[I, p. 52]{har}
\end{reference}
The polynomial $P_M$ of Hilbert-Serre Theorem \cite{Hilbert-Serre} is the {\it
Hilbert polynomial} of the finitely generated $k[x_0,\ldots,x_n]$-module $M$.
\end{definition}

\begin{definition}
\label{definition-degree-of-projective-variety}
\begin{reference}
\cite[p. 52]{hart}
\end{reference}
If $Y\subset \mathbb{P}^n$ is an algebraic set of dimension $r$, we define the
{\it degree of $Y$} to be $r!$ times the leading coefficient of the Hilbert
polynomial of the homogeneous coordinate ring $S(Y)$.
\end{definition}

\begin{exercise}
\label{exercise-very-ample-bundle-self-intersection-is-degree-of-surface}
\begin{reference}
\cite[V, Exercise 1.2]{har}
\end{reference}
Let $H$ be a very ample divisor on the surface $X$, corresponding to a
projective embedding $X\subseteq\mathbb{P}^N$. If we write the Hilbert
polynomial of $X$ as $P(z)=\frac{1}{2}az^2+bz+c$, show that $a=H^2$,
$b=\frac{1}{2}H^2+1-\pi$, where $\pi$ is the genus of a nonsingular curve
representing $H$, and $c=1+p_a$.
\end{exercise}

\section{Nakai-Moishezon Criterion}
\label{section-Nakai-Moishezon-criterion}

\begin{theorem}[Nakai-Moishezon Criterion]
\label{theorem-Nakai-Moishezon-criterion}
\begin{reference}
\cite[V, Theorem 1.10]{hart}
\end{reference}
A divisor $D$ on the surface $X$ is ample if and only if $D^2>0$ and $D.C>0$ for
all irreducible curves $C$ in $X$.
\end{theorem}

\begin{proof}
The direct implication is easy: since $D$ is ample,  $mD$ is very ample for some
$m$, so that $m^2D^2$ is the self-intersection number of $mD$. By exercise
\ref{exercise-very-ample-bundle-self-intersection-is-degree-of-surface},
 $D^2$ is the leading coefficient of the Hilbert polynomial of $X$ as a 
subscheme of $\mathbb{P}^n$. This means that $D^2$ is twice the leading
coefficient of the Hilbert polynomial of a projective variety for large enough
$m$, so that it must be a positive number (it's the dimension of one of the
graded components of the coordinate ring of the surface).
\end{proof}

\section{Deformation theory}
\label{section-deformation-theory}

The following definition is from [lucas-defos], which in turn comes from
\cite{Sernesi-deformations}

\begin{definition}
\label{definition-deformation}
Let $X$ be an algebraic $\mathbb{C}$-scheme.
\begin{enumerate}
\item A {\it deformation} of $X$ is a Cartesian diagram $\xi$
$$
\xymatrix{
X\ar[r]\ar[d]&\mathcal{X}\ar[d]^{\pi}\\
\text{Spec}\mathbb{C}\ar[r]^s&S
}
$$
where $\pi$ is a flat surjective morphism of algebraic $\mathbb{C}$-schemes and
$S$ is connected. (Recall that flatness accounts for ``continuity''.)
\item A {\it local deformation} of $X$ is a deformation $\xi$ where
$S=\text{Spec}A$ for $A$ a noetherian local $\mathbb{C}$ algebra with residue
field $\mathbb{C}$.
\item An {\it infinitesimal deformation of $X$} is a local deformation with $A$
an artinian local $\mathbb{C}$-algebra with residue field $\mathbb{C}$. $X$ is
called {\it rigid} if all infinitesimal deformations are trivial.
\item An {\it inifinitesimal deformation of order $n$} is an infinitesimal
deformation when $S=\text{Spec}(\mathbb{C}[t]/(t^{n+1})$.
\end{enumerate}
\end{definition}

{\bf Upshot.} An interpretation of the so-called {\it dual numbers}
$k[t]/(t^2)$ (see \cite{Hartshorne-deformation}) as the tangent space of
something is thinking of Taylor polynomials: after quotienting by $t^2$ we loose
the tails of the polynomials and are left with the first derivative information
only.

So what is the deformation space? Is it a moduli space of curves, that is,
points are curves obtained by deforming the curve? Or is it the fibration whose
fibers are curves and there is a central fiber that is the original curve?

There is the following interpretation in [continued-fractions] p. 39: the space
of first order deformation classes of $X$ is $D(\mathbb{C}[t]/(t^2)$. This is
said to ````represent'' the tangent space $\mathbb{T}^1_X$ of the hypothetical
deformation space of $X$''. (I put double quotations because the word
``represent'' is quoted in the original text.) Further, if $X$ is nonsingular
and compact, then $\mathbb{T}^1_X=H^{1}(X,T_X)$.

Which basically I interpret as: the dimension of the deformation space of a
smooth compact variety is $H^{1}(X,T_X)$.

\begin{example}
\label{example-moduli-space-of-nonsingular-Riemann-surfaces-of-genus-g}
\begin{reference}
\cite[Example 3.1]{continued-fractions}
\end{reference}
Fix $g \geq 2$. The dimension of the deformation space of a nonsingular
projective curve $X$ is $2g-2$. This is ``the dimension of the moduli space of
curves of genus $g$''.
 
We can compute this number by Riemann-Roch formula on the bundle $-K_X$. 
Indeed, since $X$ is a curve, $\Omega_X^1=K_X$ and thus $-K_X=T_X$. We get
\begin{align*}
h^0(-K)-h^0(K-(-K))&=\text{deg}(-K)-g+1\\
&=-2g+2-g+1\qquad \text{degree additive and $\text{deg}K=2g-2$}\\
&=-3g+3
\end{align*}
Now by Serre duality $h^0(K-(-K))=h^1(-K)=h^1(T_X)$, and it turns out that a
Riemann surface of genus $g \geq 2$ has no holomorphic vector fields, so that
$h^0(-K)=h^0(T_X)=0$.
\end{example}

An analogous computation may be used to solve

\begin{exercise}
\label{exercise-deformations-of-curves-in-K3}
Let $C$ be a smooth genus $g$ curve which can be embedded in a K3 surface  $M$,
and $X$ the family of all deformations of $C$ in $M$.
\begin{enumerate}
\item Prove that $\dim X \leq  g$.
\item Let $\mathcal{X}_g$ be the space of all curves of genus $g$ (smooth?)
which can be possibly embedded to a K3 surface. Prove that each irreducible
component $Z$ of $\mathcal{X}_g$ satisfies $\dim_\mathbb{C} \leq  g+19$. Deduce
that there exists a compact complex curve which cannot be embedded in a K3
surface.
\end{enumerate}
\end{exercise}

\begin{exercise}
\label{exercise-}
Let $C$ be a smooth curve embedded in a K3 surface $X$. Show that the dimension
of the deformation space of $C$ is $\leq g$.
\end{exercise}

\begin{proof}
%\begin{enumerate}
%\item 
It looks like the dimension of the deformation space is just 
$h^1(\mathcal{T}_C)$.

By
adjunction formula $2g-2=(\mathcal{O}(C),\mathcal{O}(C))$. Applying Riemann-Roch
to $\mathcal{O}(C)$ (which is by definition the dual of the ideal sheaf of $C$,
which is a line bundle on $X$), we obtain that
$\chi(\mathcal{O}(C))=2+\frac{1}{2}(\mathcal{O}(C),\mathcal{O}(C))$. Then
$\boxed{\chi(\mathcal{O}(C))=g+1}$. Now I want to compute $h^1(\mathcal{T}_C)$ from
$\chi(\mathcal{O}(C))$.
 
If $g \geq 2$ we know that $h^0(\mathcal{T}_C)=0$, so that
$\boxed{\chi(\mathcal{T}_C)=h^1(\mathcal{T}_C)}$.

Also recall from \cite[p. 146]{gri} that the normal bundle
$\mathcal{N}$ of a hypersurface of a smooth variety $X$ satisfies
$\mathcal{N}^\vee\cong\mathcal{O}_X(-C)|_{C}$. Taking duals we get that
$\mathcal{N}\cong\mathcal{O}_X(C)|_{C}$, so that 
$\boxed{\chi(\mathcal{N})=g+1}$.

Since $C$ is smooth we can use the normal exact sequence
$$
\xymatrix{
0\ar[r]&\mathcal{T}_C\ar[r]&\mathcal{T}_X|_{C}\ar[r]&\mathcal{N}\ar[r]&0
}
$$
Taking Euler characteristic we see that
$\chi(\mathcal{T}_C)+\chi(\mathcal{N})=\chi(\mathcal{T}_X|_{C})$. 
This means that we should be done once we compute $\chi(\mathcal{T}_X|_{C})$. I
know that $h^0(\mathcal{T}_X)=0$ and $h^1(\mathcal{T}_X)=20$ by $X$ being a K3
surface, but I'm not sure what happens when we restrict to $C$.

\bigskip
To compute the
latter Euler characteristic, which is given by definition by
$\chi(\mathcal{T}_X|_{C})=h^0(\mathcal{T}_X|_{C})-h^1(\mathcal{T}_X|_{C})$, we
first note that $h^0(\mathcal{T}_X|_{C})=0$, because this is the dimension of
the global holomorphic vector fields on $X$
restricted to $C$, which is constant along $C$ since $X$ is
smooth. And then this number is actually zero by Hodge numbers of a K3 surface.

and taking cohomology long exact sequence we obtain
$$
\xymatrix{
\cdots\ar[r]&H^{0}(T_X)\ar[r]&H^{0}(\mathcal{N})\ar[r]&H^{1}(T_C)\ar[r]&\\
H^{1}(T_X)\ar[r]&H^{1}(\mathcal{N})\ar[r]& \cdots
}
$$

%\end{enumerate}
\end{proof}

\section{Continued fractions}
\label{section-continued-fractions}

Definition of HJ continued fraction. For $i>2$ they are in bijection with
$\mathbb{Q}_{>1}$.

The basic diagram of this course starts with a surface $S$ (eg. Hirzebruch
surface $S=\mathbb{F}_m$). Blowing up leads to $X$, and contracting Wahl chains
on $X$ leads to $W$, a normal projective surface that has only Wahl
singularities. Then we construct $\mathbb{Q}$-Gorenstein smoothings $W_t$.
(These  $\mathbb{Q}$-Gorenstein smoothings have Milnor number =0.)

Continued fractions have minimal models:
\begin{itemize}
\item $[1,1]$ means a 0 curve,  $\mathbb{P}^1$.
\item $[1]$ means a  $-1$ curve,  $\mathbb{P}^1$.
\item For $\frac{m}{q}\in\mathbb{Q}_{>1}$, the continued fraction
$[e_1,\ldots,e_r]$ means a chain, which is a sequence of lines that intersect
transversally with $-e_1,\ldots,-e_r$. This is mapped to $\frac{1}{m}(1,q)$.
\end{itemize}

\medskip\noindent

{\bf Third lecture.}

Here's some slogans/recap:
\begin{enumerate}
\item The most important cyclic quotient singularities (c.q.s.) are Wahl
$\frac{1}{n^2}(na-1)$. There is a model to deal with this kind o singularities
using continued fractions. This is very silly but what I picked up is that ``you
add a 2 in the end and add +1 to the first number'', so for example
$[4]\rightsquigarrow[5,2]\rightsquigarrow[6,2,2]$. But on the second step the
$[5,2]$ also goes to $[2,5,3]$ in a way I don't understand. This is called the
Wahl algorithm.
\item (See [KSB88]) There is a notion of $M$-resolution, which is a drawing of 
several curves $\Gamma_i$ intersecting at points $P_i$ that may be Wahl 
singularities or 
smooth points with the key property that $\Gamma_i\cdot K\geq 0$. We have
``toric boundary for $P_i$''. These $M$-resolutions are in 1-1 correspondence
with smoothings of $\frac{1}{m}(1,q)$, and in turn in 1-1 correspondence with
continued fractions $K\left(\frac{m}{m-q}\right)=\{k_1,\ldots,k_s]:
1\leq k_i\leq b_i\;\forall i\}$ where $\frac{m}{m-q}=[b_1,\ldots,b_s]$.
\end{enumerate}

\medskip\noindent

Today we consider the fibers to be $W_t=\mathbb{P}^2$ and
try to find $W$. Set $m_1,m_2,m_3\in\mathbb{Z}_{>0}$. Define
$$
\mathbb{P}(m_1,m_2,m_3):=
\mathbb{P}^2/(\mathbb{Z}/m_1\oplus\mathbb{Z}/m_2\oplus\mathbb{Z}/m_3)
=\mathbb{C}^3\setminus\{0\}/(\lambda\in\mathbb{C}^*\lambda(x,y,z)
=(\lambda^{m_1}x,\lambda^{m_2}y,\lambda^{m_3}z))
$$
For $\text{gdc}(d,m_i)=1$ we have
$\mathbb{P}(dm_1,dm_2,dm_3)=\mathbb{P}(m_1,m_2,m_3)$.

For a triangle $xyz=0$ given by three lines $\Gamma_i$ we have cqs singularities
of the kind $\frac{1}{m_1}(m_2,m_3)$. In this case
$K_W=-(m_1+m_2+m_3)\xi=-\Gamma_1-\Gamma_2-\Gamma_3$ for
$\xi^2=\frac{1}{m_1m_2m_3}$, and $\text{Cl}(W)=\mathbb{Z}\left<\xi\right>$.
Since these are Wahl singularities, we must have that the $m_i$ are squares,
i.e. $m_i=n_i^2$ for some $n_i$. We must have:
\begin{align*}
K_W^2=(m_1+m_2+m_3)^2\frac{1}{m_1m_2m_3}=9&=K^2_{\mathbb{P}^2}\\
\implies (n_1^2+n_2^2+n_3^2)-9n_1^2n_2^2n_3^2&=0\\
\implies (n_1^2+n_2^2+n_3^2-2n_1n_2n_3)\cdot(\text{positive factor})&=0\\
\implies n_1^2+n_2^2+n_3^2&=3n_1n_2n_3
\end{align*}
The last equation is known as {\it Markov equation}.

\begin{example}
\label{example-Hirzebruch-surface}
For $\mathbb{P}(1,1,4)=W$, a triangle with a Wahl singularity
$\frac{1}{4}(1,1)$ in one vertex. Blowing up gives the Hirzebruch surface
$\mathbb{F}_4$, so that a minimal resolution is the triangle. Compare with
[\href{https://arxiv.org/pdf/2504.19929}{Hacking-Prokhorov-2010}]. This example
satisfies the Markov equation for $n_1=1,n_2=1,n_3=2$.
\end{example}

\begin{theorem}[[HP2010]]
\label{theorem-HP2010}
If $\mathbb{P}^2\rightsquigarrow W$ with only log terminal singularities then
$W$ is a partial $\mathbb{Q}$-Gorenstein smoothing of $\mathbb{P}(a^2,b^2,c^2)$
where $a^2+b^2+c^2=3abc$.
\end{theorem}
By the Markov equation condition all the singularities must be Wahl. The triple
$(a,b,c)$ is called {\it Markov triple}. Any permutation of a Markov triple is
another Markov triple. Is $(a,b,c)$ is Markov then so is $(a,b,3ab-c)$. This
allows to construct a {\it Markov tree}. There is so-called Markov conjecture
(due to Frobenius) still unsolved.

\section{Stanley Reisner}
\label{section-}

Antes de introduzir matroides, Os conjuntos $f_s$, que sÃ£o os conjuntos de
tamanho $s$, eles tem um significado geomÃ©trico?



\section{Fano varieties}
\label{section-Fano-varieties}

\begin{definition}
\label{definition-Fano-variety}
A {\it Fano variety} is a projective variety with $-K_X$ ample.
\end{definition}

\begin{definition}
\label{definition-Fano-index}
$$
r(X):=\text{min}\{r:\frac{c_1(X)}{r}\in H^{2}(X,\mathbb{Z})\}
$$
\end{definition}

\begin{exercise}
\label{exercise-Fano-vanishing-higher-cohomology}
By Kodaira vanishing theorem \ref{theorem-Kodaira-vanishing}, 
you can show that the cohomology $H^{i}(X,L)$ for
a Fano variety $X$ vanishes. You just have to put $L=\mathcal{O}(k)$ with $k\geq
-r$, where $r$ is the Fano index.
\end{exercise}

\begin{exercise}
\label{exercise-Pic-H2-Fano}
Show that  $\text{Pic}(X)\cong H^{2}(X,\mathbb{Z})$ holds for Fano varieties.
\end{exercise}

\section{Moduli spaces of sheaves}
\label{section-moduli-spaces-of-sheaves}

The goal is the following. $X$ smooth projective variety over $\mathbb{C}$. We
want to define a moduli space of sheaves up to some kind of isomorphism. Also
give some discrete invariants. And give structure of scheme which ``respects
limits''.

{\bf Functor of points.} For a given scheme $X$, the set
$\text{Hom}(\text{Spec}\mathbb{C},X)$ is the set of points of $X$ (why?). This motivates
defining a functor $h_X:\text{Sch}\to \text{Sets}$ by $h_X(S)=\text{Hom}(S,X)$,
and morphisms are just mapped via composition.

And there's more: given a morphism of schemes $\varphi:X\to Y$ we can produce a
(natural transformation?) $h_\varphi:h_X \to h_Y$.

\begin{slogan}
Schemes are functors.
\end{slogan}

\begin{definition}
\label{definition-representable-functor-by-scheme}
A functor $F$ is called {\it representable (by a scheme)} if there is a scheme
$X$ such that $F\cong h_X$ and we say $X$ is a {\it fine moduli space for $X$}.
\end{definition}

\begin{remark}
\label{remark-uniqueness-of-representable-functor}
If $X$ exists it is unique.
\end{remark}

\begin{example}
\label{example-quotient-sheaf}
$X$ scheme,
$$
\text{Quot}_X:(\text{Sch})\to (\text{Sets})
$$
$$
\text{Quot}_X(S)=\{
\mathcal{O}_{X \times S}^{\oplus n}\to\mathcal{F}
:\mathcal{F} \text{ is a flat sheaf}\}\Big/ \sim
$$
and morphisms are mapped by pullback.
\end{example}

I think here flat accounts for a continuously varying family of copies of $X$
over $S$, i.e. the product $X \times S$.

\begin{theorem}
\label{theorem-Quot-is-represented}
$\text{Quot}_X$ is represented by a projective scheme.
\end{theorem}

Almost all examples of moduli spaces are quotients.

\medskip\noindent

The one example of a moduli space everybody knows isâ€¦

\begin{example}[Projective space is a quotient]
\label{example-projective-space-is-a-quotient}
Take $X=$ point, and then
$$
F(S)=\{\mathcal{O}_S^{\oplus n+1}\to \mathcal{L}\}\cong h_{\mathbb{P}^n}
$$
where $\mathcal{L}$ is a line bundle on $S$.
\end{example}

\begin{definition}
\label{definition-universal-family}
If $F$ is represented by a scheme $X$ and $\eta:F(S)\to h_X(S)$ in part we have
a bijection
\begin{align*}
F(X) &\longrightarrow h_X(X):=\text{Hom}(X,X) \\
U &\longmapsto \text{id}
\end{align*}
\end{definition}

\bigskip\noindent

Again, flat means continuously varying. Consider first
$$
\mathcal{M}(S)=\{\mathcal{F}\text{a fheaf on $X\times S$ flat over }S\}/\sim
$$
and
$$
\mathcal{M}(f:T \to S)=f^*
$$
and equivalence is given by: $\mathcal{F}\sim \mathcal{G}$ iff there exists a
line bundle $\mathcal{L}$ on $S$ such that 
$\mathcal{F}\cong \mathcal{G}\otimes\pi^*S$.

{\bf Problem.} $X:=\mathbb{P}^1$ and rank 2 sheaves on $\mathbb{P}^1$. In this
case [â€¦]

{\bf Fact.} Fine moduli spaces are rare.

\begin{definition}
\label{definition-coarse-moduli-space}
A {\it coarse moduli space} of  $X$ is a scheme $X$ with a natural
transformation $\eta:F \to h_X$ such that
\begin{itemize}
\item $\eta_{\eta \times \mathbb{C}}:F(hec \mathbb{C}) \to h_X(hec \mathbb{C}$
is hij.
\item For all $Y$ and $F \to h_T$ we have [$F \to h_Y$, $F\to h_X$, $\exists !
h_X \to h_Y$.
\end{itemize}
\end{definition}

{\bf Summary.}
\begin{enumerate}
\item Schemes are functors.
\item The best moduli spaces are represented functors, they are called fine.
These have universal families, and all [all what?] are pullbacks of from the
universal family.
\end{enumerate}

\subsection*{Discrete data}
\label{subsection-discrete-data}

$X$ projective and $H$ an ample divisor on $X$. The {\it Hilbert polynomial} is
$$
P(\mathcal{F},m):=\chi(\mathcal{F}\otimes \mathcal{O}(m))
$$.

{\bf Fact.} $P(\mathcal{F},m)=\sum_{i=0}^{\dim
X}\alpha_i(\mathcal{F})\frac{m^i}{i!}$.

The {\it rank of $\mathcal{F}$} is
$\text{rk}(\mathcal{F}):=\frac{\alpha_d(\mathcal{F})}{\alpha_d(\mathcal{O}_X)}$.
And $\alpha_d(\mathcal{O}_X)$ is the {\it degree} of $\mathfrak{X}$ w.r.t
$\mathcal{O}(1)$.

The {\it reduced Hilbert polynomial} is
$P(\mathcal{F},m):=\frac{P(\mathcal{F},m)}{\alpha_d(\mathcal{F})}$. The {\it
slope} of $\mathcal{F}$ is
$\mu_H(\mathcal{F}):=\frac{c_1(\mathcal{F})H^{d-1}}{\text{rk}\mathcal{F}}$.

Example (curve of genus $g$ using Rieman-Roch).

\begin{definition}
\label{definition-Gieseker-and-mu-stability}
$\mathcal{F}$ is {\it Gieseker/$\mu$-semistable} w.r.t. $H$ if
\begin{itemize}
\item $P_\varepsilon(\mathfrak{m})\leq P_{\mathcal{F}}(\mathfrak{m})$ for all $0
\neq  \varepsilon \subset \mathcal{F}$ proper subsheaf.
\item $\mu_{M}(\varepsilon) \leq  \mu_{M}(\mathcal{F})$ of rank $0<r \leq r-1$.
\end{itemize}
If the inequality is strict then $\mathcal{F}$ is called {\it stable}.
\end{definition}

\begin{example}
\label{example-G-and-mu-stability-coincide-in-curve}
$X$ a curve, $d=\text{deg}\mathcal{F}$, $r=\text{rk}\mathcal{F}$,
$p=\text{deg}Hm+\frac{d}{r}+1-g$. Then $\mu$-stability is the same as
G-stability.
\end{example}
In general:
$$
\mu\text{-stability}\implies \text{ G-stability }\implies \text{G semi-stability
}\implies \mu \text{ semi-stability}
$$
\begin{remark}
\label{remark-stability-depends-on-H}
Stability depends on the choice of $H$.
\end{remark}

\begin{example}[Stability depends on choice of ample divisor]
\label{example-stability-depends-on-choice-of-ample-divisor}
$X=\mathbb{P}^1\times \mathbb{P}^1$, then $\text{Pic}(X)
=\mathbb{Z}[\ell]\oplus\mathbb{Z}[m]$ where $\ell^2=m^2=0$ and $\ell m=1$.
Consider $\mathcal{F}$ given by
\begin{equation}
\label{equation-extensions}
\xymatrix{
0\ar[r]&\mathcal{O}_X(\ell-3m)\ar[r]&\mathcal{F}\ar[r]&\mathcal{O}_X(3m)
\ar[r]&0
}
\end{equation}
Then $c_1(\mathcal{F})=\ell$ and $c_2(\mathcal{F})=(\ell-3m)(3m)=3$. Then
$L=\ell+sm$; $L'=\ell+7m$. We will show
that $\mathcal{F}$ is semistable w.r.t. $L$ but not w.r.t. $L'$. We do have
non-trivial extensions as in the sequence \ref{equation-extensions}. These are
parametrized by 
$$
\text{Ext}^1(\mathcal{O}_X(3m)), \mathcal{O}_X(-3m)\cong
H^{1}(X,\mathcal{O}_X(\ell-6m))\cong \ldots \cong \mathbb{C}^{10}
$$
So it is semi-stable w.r.t. $L$.

Suppose $\mathcal{O}(s) \subset \mathcal{F}$. We want to show that
$\mu(\mathcal{O}(s)) \leq  \mu(\mathcal{F})$. 

We claim that we have either $\mathcal{O}(s)\hookrightarrow \mathcal{O}(3m)$ or
$\mathcal{O}(s)\hookrightarrow \mathcal{O}(\ell-3m)$. Claim was proved and
further computations showed the required inequality, so $\mathcal{F}$ is
$\mu$-semistable w.r.t. $L$. On the other side, $\mathcal{F}$ is not semistable
w.r.t.  $L'$ since $\mathcal{O}(\ell-3m) \hookrightarrow  \mathcal{F}$ (so here
I realise that probably taking Chern class will be monotonous with respect to
this inclusionâ€¦) which gives
$\mu_{L'}(\mathcal{O}(\ell-3m))=(\ell-3m)(\ell+7m)=4\not \leq \frac{7}{2}$.
\end{example}

\begin{example}[Results on $\mu$-stability]
\label{example-results-on-mu-stability}
\begin{itemize}
\item All line bundles are stable.
\item If $0\to L_0 \to \mathcal{F} \to L_1 \to 0$ is a non-trivial extension
with degree $L_0=0$, $\text{deg}(L_1)=1$, $L_i$ line bundles, then
$\mathcal{F}$ is stable.
\item $E_i$ semi-stable shows $E_1\oplus E_2$ is semistable if and only if
$\mu(E_i)=\mu(E_2)$.
\item $E$ is $\mu$-semistable if and only if for all $L$ line bundles $E \otimes
L$ is semistable.
\item $E$ is semistable then $E^{\vee}$ is semi-stable.
\item $E_1,E_2$ semistable then $E_1 \otimes E_2$ is semistable.
\end{itemize}
\end{example}

Now we explain some {\bf easy criteria.} (I think it's easy because we find a
condition on cohomology that is equivalent to stability.)

\begin{definition}
\label{definition-norm-sheaf}
$\mathcal{F}$ a reflexive sheaf on $\mathbb{P}^n$ of rank $r$. We define
$\mathcal{F}_{\text{norm}}:=\mathcal{F}(k)$ where $k$ is the unique integer such
that $c_1(\mathcal{F}(k))\in \{-r+1,\ldots,c\}$.
\end{definition}

\begin{proposition}[Cohomological characterization of stability]
\label{proposition-cohomological-characterization-of-stability}
$\mathcal{F}$ reflexive sheaf of rank  $2$, then $\mathcal{F}$ is $\mu$-stable
if and only if $H^{0}(\mathbb{P}^n,\mathcal{F}_{\text{norm}})=0$.
\end{proposition}

\begin{proof}
$\mathcal{F}$ vector bundle of rank $r$ on a smooth projective variety with
$\text{Pic}=\mathbb{Z}$.
\begin{itemize}
\item If $H^{0}(X,(\Lambda^{z}\mathcal{F})_{\text{norm}})=0$ for all $z \in
\{1,\ldots,r-1\}$ then $\mathcal{F}$ is $\mu$-stable.
\item If $H^{0}(X,\Lambda^{z}\mathcal{F})_{\text{norm}}(-1))=0$ for all $z \in
\{1,\ldots,r-1\}$, then $\mathcal{F}$ is $\mu$-semi-stable.
\end{itemize}
\end{proof}

\begin{example}
\label{example-Omega1-on-projective-space-is-stable}
$\Omega_{\mathbb{P}^n}$ is stable, and also $T_{\mathbb{P}^1}$. The cohomologies
vanish using Bott.
\end{example}

\begin{example}
\label{example-lots-of-Os}

\end{example}

{\bf Filtrations.} $H$ ample, $\mathcal{F}$ torsion free sheaf, then there
exists a unique filtration $0 \hookrightarrow  \mathcal{F}_0\subset
\mathcal{F}_1\subset\ldots\subset\mathcal{F}_m=\mathcal{F}$ with
$E_i=\mathcal{F}_i/\mathcal{F}_{i+1}$ $\mu$-semi-stable w.r.t. $H$ and
$\mu(E_1)>\mu(E_2)>\ldots>\mu(E_m)$. This is called {\it Harder-Narorimnan
filtrations}.

Given any Chern classes, can we guarantee the existence of a sheaf with these
Chern classes? No.

\begin{theorem}[Bogomolov inez]
\label{theorem-Bogomolov}
$X$ smooth, projective variety of dimension $\geq 2$, $H$ ample. If
$\mathcal{F}$ is torsion-free, $\mu$ semi-stable sheaf w.r.t. all
$$
\Delta(\mathcal{F}):=(2rc_2(\mathcal{F})\underbrace{-}_{\text{discriminant}}
(r-1)c_1(\mathcal{F})^2)H^{n-2}\geq 0
$$
where $r=\text{rk}(\mathcal{F})$ and $\dim X=n$.
\end{theorem}

\subsection*{Boundedness}
\label{subsection-boundedness}

We need further preparation before we can define moduli spaces.

\begin{definition}
\label{definition-bounded-family}
A family of isomorphism classes of coherent sheaves on $X$ is called {\it
bounded} if there exists $S$ of \underline{finite type} and an $O_{S \times X}$
sheaf $F$ such that the family is contained in $\{ \mathcal{F}_{S \times X}|s
\text{ closed in }S\}$
\end{definition}

\begin{definition}
\label{definition-m-regularity}
A coherent sheaf is called {\it $m$-regular} if $H^{i}(X,\mathcal{F}(m-i))=0$
for all $i>0$.
\end{definition}

\begin{proposition}
\label{proposition-m-regularity}
If $\mathcal{F}$ is $m$-regular,
\begin{itemize}
\item $F$ is $m'$ regular for all $m' \geq m$.
\item $F(m)$ is globally generated.
\end{itemize}
\end{proposition}

\begin{definition}
\label{definition-regular-infimum}
$\text{reg}\mathcal{F}:
=\text{inf}\{m \in \mathbb{Z}:\mathcal{F}\text{ is $m$-regular}\}$
\end{definition}

\begin{lemma}
\label{lemma-}
The following are equivalent:
\begin{itemize}
\item $\{\mathcal{F}_i\}_{i \in I}$ is bounded
\item The set of Hilbert polynomials $\{P(\mathcal{F}_i)\}_{i \in I}$ is finite
and there exists a bound $\rho$ such that $\text{reg}\mathcal{F}_i\leq \rho$ for
all $i \in I$.
\end{itemize}
\end{lemma}

The following is a difficult result that we shall only state and use.

\begin{theorem}
\label{theorem-}
$X$ projective, $H$ ample, $P$ a fixed polynomial of degree $d$. The family of
torsion-free sheaves with Hilbert polynomial $P$ is bounded.
\end{theorem}

\begin{proposition}
\label{proposition-semi-stable-sheaves-are-bounded-on-curves}
Let $X$ be a curve of genus $g$ with fixed Hilbert polynomial. The semi-stable
sheaves on $X$ are bounded.
\end{proposition}

\begin{proof}
Let $E$ be a semis-stable sheaf. We want $m$ such that $H^{1}(X,E(m-1))$. We
apply Serre Duality as follows:
$$
H^{1}(X,E(m-1))\overset{\text{S.D.}}{=}\text{Hom}(E,\omega(1-m))^\vee
$$Then $E \to \omega(m+1)$ $\implies$ $\omega^\vee(m-1)\to E^\vee$. $E$ is
semi-stable then $-\text{deg}(\omega^\vee)\leq \frac{\text{deg}(E^\vee)}{r}$
which implies that $-2g+2+m-1\leq -\frac{d}{r}$ for $d=\text{deg}E$, and then
$m\leq  2g-2-\frac{d}{r}+1$. If we take $m>2g-2\frac{d}{r}+1$.
\end{proof}

\begin{proposition}
\label{proposition-}
If  $E$ is a stable sheaf, then $\text{Hom}(E,E)=\mathbb{C}$.
\end{proposition}

\begin{proof}
If $f:E \to E$ factors through $E \to F \to F$ and is not surjective, then
$\mu(E)<\mu(F)<\mu(E)$ $\implies$ $f$ is injective. As an exercise, prove that
$E$ is stable if and only if for all $E \to F$ surjective we have that
$\mu(E)<\mu(F)$.
\end{proof}

\subsection*{Construction of the moduli space of semi-stable sheaves}
\label{subsection-construction-of-the-moduli-space-of-semi-stable-sheaves}
$$
\mathcal{M}^p(s)=\left\{ \substack{\text{$\mathcal{F}$ on $X\times S$,
pet over $S$}
 \\ \text{with Hilbert polynomial $P$}} \right\} \Big/\sim
$$
where $\mathcal{F}\sim \mathcal{G}$ $\iff$ there exists $L$ on $S$ such that
$\mathcal{F}\otimes \pi^*L \cong \mathcal{G}$ where 
$X \times S\xrightarrow{\pi}\mathcal{G}$.

$\mathcal{F}$ is a semi-stable sheaf is  $\exists $ $m$ such that
$\mathcal{F}$ is $m$-regular, which implies that $\mathcal{F}(m)$ is globally
generated.

{\bf Warning.} Following are several formulas I don't understand and just copied
from the board as they were.
 $$
\dim H^{0}(X,\mathcal{F}(m))=P(m)
$$
$$
H^{i}(X,\mathcal{F}(m-1))=0\qquad \forall i>0
$$
$$
V=\mathcal{O}_X^{\oplus P(m)}\to \mathcal{F}(m)\to 0
$$
$$
\implies \left[ \mathcal{O}_X^{\oplus P(m)}(-m) \to \mathcal{F} \to 0 \right]
\in \text{Quot}(\mathcal{H},P)
$$
Let $R$ be open locus in $\text{Quot}(\mathcal{H},P)$ such that
\begin{itemize}
\item $\mathcal{F}$ is semi-stable.
\item $H^{0}(\mathcal{H}(m))\cong H^{0}(\mathcal{F}(m))$.
\end{itemize}
$\text{GL}(V)\mathbb{y} R$ by $g[\rho]=\pi \circ g$ for $\rho \in R$. 
$$
\xymatrix{
\mathcal{O}^{\oplus p(m)}\ar[r]^{\rho}\ar[d]_{g,\cong}&  \mathcal{F}\\
\mathcal{O}_X^{\oplus p(m)}\ar[ur]
}
$$
We want
``$R/\text{GL}(V)$''.

\begin{theorem}
\label{theorem-exists-coarse-moduli-space-of-semi-stable-sheaves-with-fixed
-Hilbert-polynomial}
There exists a coarse moduli space $M_{X,P}$ of semi-stable sheaves with fixed
Hilbert polynomial $P$, $\mathcal{M}_{X,P}$ is projective and
$\mathcal{M}_{X,P}^s$ of stable sheaves with Hilbert polynomial $P$.
\end{theorem}

{\bf Fact.} The GIT (semi-)stability coincides with the Gieseker
(semi-)stability. Reference: Huybrechts-Lehu, Moduli of Sheaves.

{\bf Remarks on working with stacks.}

\begin{itemize}
\item Instead of constructing sheaves which are coarse/fine moduli spaces we may
find more general geometric objects called ``stacks''.
\item Advantage: Quotients always exist: 
$G \mathbb{y} X \rightsquigarrow [X/G]$.
\item Stacks have universal families.
\item Disadvantage: we need to work with more general moduli functors. Instead
of $\mathcal{M}:(\text{Sch}) \to (\text{Sets})$, we substitute $(\text{Sets})$
with a 2-category.
\item Disadvantage: not all algebraic stacks have coarse moduli spaces but if
the number of automorphisms of points (is finite?)
\item Disadvantage: may not be projective (even if proper/compact).
\end{itemize}

In sum, we may not be able to produce a moduli space, and even if we can, it may
not be projective.

Even in the easiest situation we can have, we don't have universal family:

\begin{example}[The line bundles of degree $d$ on $\mathbb{P}^1$ do not have
universal family]
\label{example-moduli-space-of-line-bundles-of-degree-d-over-P1-
do-not-have-universal-family}
Line bundles on $\mathbb{P}^1$ of degree $d$ are $\mathcal{O}(d)$. Them
$\mathcal{M}=\text{Spec}\mathbb{C}$. It does not have a universal family:
$$
\xymatrix{
\mathcal{O}_{\mathbb{P}^1}\ar[r]\ar[d]&\mathbb{C}\ar[d]\\
\mathbb{P}^1\ar[r]&\text{Spec}\mathbb{C}
}
$$
and $\mathcal{O}(d) \neq \mathcal{O}_{\mathbb{P}^1}$, $d\neq 0$.
\end{example}



\subsection*{Remarks on stacks}
\label{subsection-remarks-on-stacks}

The following was not defined properly. As a stack,
$$
\text{Pic}_{\mathbb{P}^1,d}=\left[ \cdot/\mathbb{G}_m \right] = B\mathbb{G}_m
$$
parametrized by $\mathbb{G}_m$-bundles.
$$
\xymatrix{
\mathcal{L}\setminus\{\text{zero section}\}\ar[r]\ar[d]&\Gamma^A?\ar[d]\\
\mathbb{P}^1\ar[r]_\varphi&B\mathbb{G}_m
}
$$

{\bf Tangent space.} The tangent space of $\mathcal{M}_{X,P}$, in $\ni E$, is
$\text{Ext}^1(E,E)$ if $\text{Ext}^2(E,E)=0 \implies  \mathcal{M}_{X,P}$ is
smooth. ($\text{Ext}$ groups are defined in Algebra, Section
\ref{algebra-section-ext}, also appears to be a theorem in deformation theory.)

\begin{example}
\label{example-moduli-space-of-curves-is-smooth}
Let $X$ be a curve. $E$ is a vector bundle of rank $n$, then
$$
\text{Ext}^2(E,E)=H^{2}(X,E \otimes E^{\vee})=0
$$
then the moduli space is smooth.
\end{example}

The dimension of the stack is $\dim T_{\mathcal{M},E}-\dim \text{Aut}(E)$, which
is just $\dim (\text{Ext}^1(E,E) - \dim \text{Ext}^0(E,E)$, which in turn says
that $\mathcal{X}(X,E \otimes E^\vee)=V^2(f-g)$.

{\bf Question 2.} Once we have a moduli space we want so study its geometry. 
What can we say about $\mathcal{M}_{X,P,H}$?

Let $X$ be a projective surface and $E$ a vector bundle. 
Let $r = \text{rk} E$, $L = \Lambda^{n}E$. Consider
$\mathcal{M}_{X,P,H}(r,L,n)$.
$n=c_2(E)$ 

\begin{theorem}
\label{theorem-moduli-space-that-is-normal-generaically-smooth-irreducible-
quasi-projective-variety}
If $\Delta=2rm-(r-1)L^2 \gg 0$ then $\mathcal{M}_{X,H}(r,L,n)$ is a normal,
generically smooth irreducible quasi-projective variety. (If $\Delta$ is small
then it is not true.)
\end{theorem}

\begin{theorem}
\label{theorem-birrational-moduli-spaces}
Fix $H,H'$ ample. For $\Delta \gg 0$, $\mathcal{M}_{X,H}(r,L,n)$ and
$\mathcal{M}_{X,H}(r,L,n)$ are birrational.
\end{theorem}

An idea: there are ample cones, and walls between them, and when you cross the
wall, you get to a birrational thing.

\begin{definition}
\label{definition-wall}
Let $C_X$ be the ample cone $\mathbb{R} \otimes \text{Num}(X)$. For 
$\xi \in\text{Num}(X)$, 
$W^\xi:=C_X \cap \{x \in \text{Num}(X) \otimes\mathbb{R}:x\cdot\xi=0\}$. 
$W^\xi$ is called a {\it wall} of type 
$(c_1,c_2) \iff \exists G \in\text{Pic}(X)$ with $\xi = G$ such that 
\begin{itemize}
\item $G+c_1$ is divisible by $2$ in $\text{Pic}(X)$
\item $c_1^2-4c_2 \leq G^2 <0$.
\end{itemize}
\end{definition}

\begin{remark}
\label{remark-wall-not-zero-if-exists-ample-with-condition}
$W^\xi \neq 0$ if there exists an ample line bundle $L$ with $L\xi =0$,
$W(c_1,c_2)=\bigcup_{\xi}W^1$.
\end{remark}

\begin{definition}
\label{definition-chamber}
A {\it chamber} is a connected component of $C_X\setminus W(c_1,c_2)$. (Perhaps
this is the same as $C_X \setminus \bigcup_{\xi}W\xi$.)
\end{definition}

\begin{theorem}[Qin]
\label{theorem-Qin}
The moduli space $M_{X,H}(2c_1,c_2)$ of rank 2 locally free sheaves only depends
on the chamber of $H$.
\end{theorem}

\begin{remark}
\label{remark-remarks}
\begin{itemize}
\item $c_1^2-4c_2<0$ is Bogomolov inequality.
\item  $G^2<0$ is Hodge index theorem
\item $F \subset E$ destabilizing line bundle $F$ $\iff$ $H$  
$c_1(F)>\frac{c_1(E)H}{2}$ $\iff$ $(\underbrace{2c_1(F)-c_1(E)}_{=G})H>0$
$\implies$ $2c_1(F)=c_1(G)+c_1(E) \implies c_1(G)+c_1(E)$ is divisible by 2.
\item Suppose we have $0 \to F \to E \to M \otimes |_{Z}\to 0$ with $M$ a line
bundle, $Z$ codimension 2 in $X$.
\end{itemize}
\end{remark}

[Lots of computations I missed.]

\begin{exercise}
\label{exercise-P1timesP1}
$X=\mathbb{P}^1\times \mathbb{P}^1$, $E$ of rank 2, $c_1=\ell$, $c_2=3$.
$G=a\ell+bm$, $G^2=2ab \implies ab<0$, $\Delta=c_1^2-4c_2\leq G^2=ab\implies
-12\leq 2ab<0$, $(a+1)\ell+bm$ divisible by $2$, then $a+1$ is even.

I understand the walls and chambers were computed:
$L_0=(\ell+7m)\in C_0$,
$L_1=(\ell+5m) \in C_1$ and $L_2=(\ell+3m) \in C_2$.

We have
 \begin{itemize}
\item For $L$ in  $C_0$, $\mathcal{M}(2,\ell,3)=\emptyset$. (Proved.)
\item For $L$ in $C_1$, $\mathcal{M}(2,\ell,3)\cong \mathbb{P}^5$.
\item For $L$ in $C_2$, $\mathcal{M}(2,\ell,3)$ is an open in $\mathbb{P}^3$.
\end{itemize}
\end{exercise}

For more general rank:

\begin{theorem}
\label{theorem-general-rank}
$F \subset E$ a subsheaf of rank $r'<r$, $\mu_H(F)=\mu_H(E)$, then 
$\xi=rc_1(F)-r'c_1(E)$ satisfies $\xi H=0$ and 
$\frac{r^2}{4}\Delta \leq \xi^2<0$, with $e_2$ $\iff$ $\xi=0$.
\end{theorem}

\begin{theorem}
\label{theorem-smooth-irreducible-projective-surface-moduli-are-birrational}
$X$ smooth irreducible projective surface, $H,H'$ ample and $\Delta\gg 0$. Then
$\mathcal{M}_{X,H}$ and $\mathcal{M}_{X,H'}$ are birational (any rank).
\end{theorem}

For dimension $\geq 3$, the moduli space of sheaves is in general smooth or
irreducible.

\begin{theorem}[Ein]
\label{theorem-Ein}
Let $C$ be a smooth projective 3-fold, $c_1,H \in \text{Pic}(X)$, $H$ ample.
Assume there exists $a,b$ such that $ac_1=bH$. $\mathcal{M}_{X,H}$ rank 2 vector
bundle on $X$, $\mu$ stable with respect to $d:=c_2H$. $\mu(d)=F$ irreducible
component of $\mathcal{M}_{X,H}(c_1,c_2)$, $\implies $ 
$\lim_{d \to \infty} m(d)=\infty$.
\end{theorem}

\begin{example}
\label{example-}
In DT (Donaldson-Thomas?) theory, $X$ 3-fold,
$$
I(X,P)=\left\{Z \subset X: \substack{Z \text{ a curve with} \\ 
\text{fixed Hilbert polynomial}}\right\}
$$
$P(u)=3u+1$ twisted cubics have  $P(u)=3u+1$. But genus 1 curves with a
point also have  $P(u)=3u+1$. $I(\mathbb{P}^3,3n+1)$ has several components.
\end{example}


\section{Derived categories}
\label{section-derived-categories}

{\bf Upshot.} The derived category of an abelian category is the localization of
its homotopy category with respect to the class of quasi-isomorphisms.
\begin{itemize}
\item The objects of $D(\mathcal{A})$ are complexes in $\mathcal{A}$ and the
arrows are equivalence classes of roofs.
\item $D(\mathcal{A})$ is additive but not abelian unless $\mathcal{A}$ is
semisimple.
\item $D(\text{Vect}_k)=$ graded vector spaces.
\item For all $A,B\in \mathcal{A}$,
$$
\text{Hom}_{D(\mathcal{A})}(A,B[i])=
\begin{cases}
0\qquad &i<0 \\
\text{Hom}_{\mathcal{A}}(A,B)\qquad &i=0\\
\text{Ext}^i(A,B)\qquad &i>0
\end{cases}
$$
\item A sequence
$$
\xymatrix{
A\ar[r]^f&B\ar[r]^b&\text{Cone}(f)\ar[r]^a&A[I]\ar[r]&0
}
$$
gives long exact sequences $\text{Hom}^\bullet_{D(\mathcal{A})}(C,\cdot)$ and 
$\text{Hom}^\bullet_{D(\mathcal{A})}(\cdot,C)$, which are the distinguished
triangles.
\end{itemize}
\medskip
\begin{definition}
\label{definition-abelian-category}
An {\it abelian category} $\mathcal{A}$ is a category such that
\begin{enumerate}
\item $\forall X,Y \in \mathcal{A}$, $\text{Hom}{\mathcal{A}}(X,Y)$ is an
abelian group such that $\text{Hom}_{\mathcal{A}}(X,Y)\times\text{Hom}(Y,Z)\to
\text{Hom}(X,Y)$ is bilinear.
\item There is a zero object $0_{\mathcal{A}}$ such that for every $A \in
\mathcal{A}$, $\text{Hom}(0_{\mathcal{A}},A)=\text{Hom}(A,0)=0$.
\item There exist finite products.
\item For every  $f \in \text{Hom}(A,B)$ there exist kernel and cokernel such
that
$$
\xymatrix{
\Ker f\ar[r]&A\ar[r]^{f}&B\ar[r]&\Coker f
}
$$
\end{enumerate}
\end{definition}

\begin{definition}
\label{definition-additive-category}
$\mathcal{A}$ satisfying 1-3 is called  {\it additive category}.
\end{definition}

Examples: abelian groups, $R$-modules, $\text{Coh}(X)$. Non-example: vector
bundles over $X$, it is an additive category but not abelian.

\medskip\noindent

Now consider the category $\text{Com}(\mathcal{A})$, the category of complexes
in $\mathcal{A}$, with quasi-isomorphisms:

\begin{definition}
\label{definition-quasi-isomorphism}
$f\in \text{Hom}_{\text{Com}(\mathcal{A})}(A',B')$ is a {\it quasi-isomorphism}
if it induces isomorphisms $H^i(f):H^i(A^{\bullet})\cong H^i(B^{\bullet})$ for
all $i$.
\end{definition}

\begin{definition}
\label{definition-derived-category}
Let $\mathcal{A}$ be an abelian category. The {\it derived category} of
$\mathcal{A}$ is the localization $\text{Com}(\mathcal{A})[QIS]^{-1}$, where
$QIS$ is the class of quasi-isomorphisms.
\end{definition}

But what is localization? Given a class of morphisms $S$ inside the class of
morphisms of a given category, the localization will allow us to invert these
morphisms.

\begin{definition}
\label{definition-localization-of-category}
Let $\mathcal{C}$ be a category, $S$ a class of morphisms in
$\mathcal{C}$ and $\text{Iso}(\mathcal{C})$ the class of all isomorphisms of
$\mathcal{C}$. The {\it localization} of $\mathcal{C}$ with respect to $S$ is
the category $\mathcal{C}[S]^{-1}$ with an isomorphism 
$$
Q:\mathcal{C}\to \mathcal{C}[S]^{i-\mathcal{A}}
$$
that satisfy
\begin{enumerate}
\item $Q(S) \subset \text{Iso}(\mathcal{C}[S]^{-1})$
\item (Universality.) For any $F:\mathcal{C}\to \tilde{\mathcal{C}}$ and
$Q:\mathcal{C}\to \mathcal{C}[S^{-1}]$ there exists a unique
$G:\mathcal{C}[S^{-1}]\to \tilde{ \mathcal{C}}$ making the diagram commute, i.e.
$F=GQ$.
\end{enumerate}
\end{definition}

\begin{exercise}
\label{exercise-uniqueness-of-localization}
Show that if $\mathcal{C}[S^{-1}]$ exists, it must be unique up to isomorphism.
\end{exercise}

\begin{definition}
\label{definition-bounded-derived-category}
If instead of $\text{Com}(\mathcal{A})$ we consider
$$
\text{Com}^b(\mathcal{A}):=\{A^{\bullet} \in \text{Com}(\mathcal{A}):
A^i=0\forall  |i|\gg 0\}
$$
Then we obtain the {\it bounded derived category} $D^b(\mathcal{A})$.
\end{definition}

\subsection*{Motivation}
\label{subsection-motivation}

Let $X$ be a smooth projective variety over $\mathbb{C}$. Then
we can associate $X\rightsquigarrow \text{Coh}(X)$.

\begin{theorem}[Gabriel]
\label{theorem-Gabriel}
Let $X$ and $Y$ be smooth projective varieties. If $\text{Coh}(X)\cong
\text{Coh}(Y)$ then $X\cong Y$.
\end{theorem}

This means we may reconstruct $X$ from its coherent sheaf category. But it is
not such an interesting invariant. It's more interesting the derived category.
So the motivation for studying derived categories are:

\begin{enumerate}
\item (Beilinson 1979.) $\text{Coh}(\mathbb{P}^n)\hookrightarrow
D^b(\mathbb{P}^n)$ gives good information about coherent sheaves on
$\mathbb{P}^n$.
\item (Mukai.) If $\mathcal{A}$ is an abelian variety and $\hat{\mathcal{A}}$ is
the dual abelian variety, $D^b(\mathcal{A})\cong D^b(\hat{\mathcal{A}})$.
\item (Bondal, Orlov, 1990's.) Let $X$ be a smooth projective variety with an
ample or anti-ample canonical bundle $\omega_X$. Suppose that $D^b(X)\cong
D^b(Y)$ for a smooth projective variety $Y$. Then $Y \cong X$.
\end{enumerate}

\begin{remark}
\label{remark-derived-category-with-tensor-product}
If you consider not only the bounded derived category $D^b(X)$ but consider it
with the tensor product $D^b \times D^b(X) \xrightarrow{\otimes} D^b(X)$ allow
to reconstruct $X$.
\end{remark}

I hope you are now convinced this is interesting.

\subsection*{Explicit description of localization under some assumption}
\label{subsection-explicit-description-of-localization}

If $S$ satisfies some properties then $\mathcal{C}[S^{-1}]$ can be explicitly
described. The conditions are:

\begin{enumerate}
\item All identities should belong to $S$ and if any two morphisms from $f,g$
and $f \circ g$ (whenever composition is defined) belong to $S$, then all three
belong to $S$.
\item For any diagram 
$$
\xymatrix{
X\ar[d]^{f}&W\ar[l]^{\tilde{s}\in S}\ar[d]\\
Z&\ar[l]^{s\in S}Y
}
$$
can be completed (the arrows from $W$ should be dashed) to a commutative square.
\item If for $f,g\in \text{Hom}_{\mathcal{C}}(A,B)$ and $u:B \to U$ such athat
$u\circ f=u\circ g$ there exists
$t:C \to A$ such that $ft=gt$, that is,
$$
\xymatrix{
C\ar[r]^{t}&A\ar[r]^{f,g}&B\ar[r]^{u}&U
}
$$
\end{enumerate}

The quasi-isomorphisms don't satisfy condition 2.

\begin{proposition}
\label{proposition-caracterization-of-derived-category}
Let $\mathcal{C}$ be a category and $S\subset \text{Mor}(\mathcal{C})$ satisfy
right Ore conditions. Then $\mathcal{C}[S^{-1}]$ can be described as follows:
\begin{itemize}
\item $\text{Ob}(\mathcal{C}[S^{-1}]=\text{Ob}(\mathcal{C})$.
\item $\text{Mor}_{\mathcal{C}[S^{-1}]}(A,B)=\{\text{equivalence classes of
roofs}\}$, where a roof is
$$
\xymatrix{
& C\ar[dl]^{s\in S}\ar[dr]^{f}\\
A&&B
}
$$
where $fs^{-1}\sim gt^{-1}$ if there exists a commutative diagram
$$
\xymatrix{
& & \tilde{W} \ar[ld]^{a \in S} \ar[dr]^{b \in S} & & \\
& C \ar[ld]^{s \in S} \ar[rr]^{f} & & \tilde{C} \ar[rd]^{t} & \\
A & & & & B
}
$$
and composition is defined as follows:
$$
\xymatrix{
& & \tilde{W}\ar[ld]^{a \in S}\ar[dr]^{b \in S}\\
&Z\ar[ld]^{s \in S}\ar[dr]^{f} & & & \tilde{Z}\ar[d]\ar[dl]^{t}\\
A & &B & & C
}
$$
where
$$
(fs^{-1})\circ (gt^{-1})=(sa^{-1})\circ(gb)
$$
\end{itemize}
\end{proposition}

$\mathcal{C}[S^{-1}]$ always exists but morphisms are difficult to describe. The
proof of the proposition is an exercise:

\begin{proof}
\begin{enumerate}
\item This is an equivalence relation.
\item Composition doesn't depend on $a$ and $b$.
\item Composition doesn't depend on the choice of the roof in equivalence
classes.
\item Composition is associative.
\item $\text{Id}_X \times \text{Id}_X^{-1}$ is identity morphism.
\end{enumerate}
\end{proof}

{\bf Definition of} $Q:\mathcal{C} \to \mathcal{C}[S^{-1}]$. (Missing.)

{\bf Universal property.}

$$
\xymatrix{
\mathcal{C}\ar[r]^{F}\ar[dr]^{Q}&  \tilde{\mathcal{C}}\\
&\mathcal{C}[S^{-1}]\ar[u]^{dashed}
}
$$
defines a universal property.

\begin{proposition}
\label{proposition-Ore-conditions}
Let $\mathcal{C}$ be an additive category and $S$ satisfy right Ore conditions.
Then $\mathcal{C}[S^{-1}]$ is also additive and $Q:\mathcal{C} \to
\mathcal{C}[S^{-1}]$ is additive.
\end{proposition}

\begin{proof}
Some indications, then exercise.
\end{proof}

The point is that with Ore conditions you can really define what is addition of
fractions.

\subsection*{Ore conditions for category of complexes}
\label{subsection-Ore-conditions-for-category-of-complexes}

Let $\mathcal{C}=\text{Com}(\mathcal{A})$ and $S=\text{QIS}$. Then QIS {\bf does
not} satisfy Ore conditions: second and third properties fail. But we can
consider instead the homotopy category $\mathcal{H}(\mathcal{A})$. But what is 
that.

\begin{definition}
\label{definition-homotopy-category}
\begin{enumerate}
\item 
A morphism $f \in \text{Hom}_{\text{Com}\mathcal{A}}(A^{\bullet},B^{\bullet})$
is {\it homotopically equivalent to zero}, i.e. $f \sim_{\text{hom}}0$ if for
all $i\in \mathbb{Z}$, $h^i:A^i \to B^i$ such that 
$f^i=d_B^{-1}\circ h^i \circ d_A^i$.
$$
\xymatrix{
A^{i-1}\ar[r]&
A^{i}\ar[r]\ar[dl]_{dashed}^{h^i}\ar[d]^{f^i}&
A^{i+1}\ar[dl]_{\text{dashed}}^{h^{i+1}}\\
B^{i-1}\ar[r]& B^i\ar[r]& B^{i+1}
}
$$
\item $f\sim_{\text{hom}}g$ are {\it homotopically equivalent} if $f-g
\sim_{\text{hom}}0$.
\item The {\it homotopy category}  $\mathcal{H}(\mathcal{A})$ of $\mathcal{A}$
has objects $\text{Ob}(\mathcal{H}(\mathcal{A})=\text{Com}(\mathcal{A})$ and
morphisms
$$
\text{Hom}_{\mathcal{H}(\mathcal{A})}(A^{\bullet},B^{\bullet})
=\text{Hom}_{\text{Com}\mathcal{A}}(A,B )\Big/\{f\sim_{\text{hom}}0\}.
$$
\end{enumerate}
\end{definition}

\begin{exercise}
\label{exercise-homotopy-category}
\begin{enumerate}
\item $f\sim_{\text{hom}}0$, $H^i(f):H^i(A)\xrightarrow{0}H^i(B)$.
\item Morphisms homotopic to zero form an ideal in $\text{Com}(\mathcal{A})$,
that is, abelian subgroups w.r.t. compositions.
\item $\mathcal{H}(\mathcal{A})$ is an additive category and
$\text{Com}(\mathcal{A}) \to \mathcal{H}(\mathcal{A})$ is additive.
\end{enumerate}
\end{exercise}

{\bf Objectives.}
\begin{enumerate}
\item QIS satisfy the Ore conditions in $\mathcal{H}(\mathcal{A})$.
\item $D(\mathcal{A})=\text{Com}(\mathcal{A})[\text{QIS}^{-1}]
\cong \mathcal{H}(\mathcal{A})[\text{QIS}^{-1}]$. This will allow to describe
$D(\mathcal{A})$ explicitly as an additive category.
\item $\mathcal{H}(\mathcal{A})$ and $D(\mathcal{A})$ are not abelian, but
triangulated!
\end{enumerate}

When we lose the property of an abelian category, we lose the notion of exact
sequence.

{\bf Goal.} Now we shall prove that QIS satisfy right Ore conditions on
$\mathfrak{X}(f)$ and $D(\mathcal{A})\cong \mathcal{H}[\text{QIS}]^{-1}$.

\begin{definition}
\label{definition-shift-functor}
The {\it shift functor} is given by
\begin{align*}
[1]: \text{Com}(\mathcal{A}) &\longrightarrow \text{Com}(\mathcal{A}) \\
A^\bullet &\longmapsto (A^\bullet[1])
\end{align*}
where
$$
(A^\bullet[1])^i=A^{i+1},\qquad  d_{A[1]}=-d_A
$$
\end{definition}

\begin{definition}
\label{definition-mapping-cone}
For a morphsm $f \in
\text{Hom}_{\text{Com}(\mathcal{A})}(A^\bullet,B^{\bullet})$, its {\it mapping
cone} is the complex
$$
\text{Cone}(f):=B^{\bullet}\oplus A^{\bullet}[1]
$$
with
\begin{align*}
d_{\text{Cone}(f)}^i: A^{i+1}\oplus B^{i} &\longrightarrow A^{i+2}\oplus B^{i+1} \\
(a^{i+1},b^i) &\longmapsto (-d_Aa^{i+1},d_Bb^i+f(a^{i+1}))
\end{align*}
\end{definition}

\begin{exercise}
\label{exercise-cone-is-complex}
$\text{Cone}(f) \in \text{Com}(\mathcal{A})$.
\end{exercise}

Exact sequence in $\text{Com}(\mathcal{A})$:
$$
\xymatrix{
0\ar[r]&B\ar[r]&\text{Cone}(f)\ar[r]&A^{\bullet}[1]\ar[r]&0
}
$$
\begin{definition}
\label{definition-contractible-complex}
$A^\bullet \in \mathcal{H}(\mathcal{A})$ is {\it contractible} if $\mathcal{A}
\cong 0$ in $\mathcal{H}(\mathcal{A})$, that is,
$\text{Id}_{A^{\bullet}}\sim_{\text{hom}}0$.
\end{definition}

\begin{exercise}
\label{exercise-isomorphism-iff-cone-contractible}
$f \in \text{Hom}(A^{\bullet},B^{\bullet})$ is isomorphism in
$\mathcal{H}(\mathcal{A})$ if and only if $\text{Cone}(f)$ is contractible.
\end{exercise}

\begin{definition}
\label{definition-Hom-of-complexes}
Let  $A^{\bullet},B^{\bullet}\in \text{Com}(\mathcal{A})$. Then we define
$\underline{\text{Hom}}(A^{\bullet},B^{\bullet}) \in \text{Com}(\text{Ab})$,
$$
\text{Hom}^i(A,B)=\prod_{n \in \mathbb{Z}}\text{Hom}(A^n,B^{n+i})
$$
\begin{align*}
d^i_{\underline{\text{Hom}}}: \underline{\text{Hom}}(A,B)^i &\longrightarrow
\underline{\text{Hom}}(A,B)^{i+1} \\
f=\prod f^n &\longmapsto g
\end{align*}
and $g^n=d_Bf^n-(-1)^i f^{n+1}d_A$.
\end{definition}

\begin{exercise}
\label{exercise-Hom}
\begin{enumerate}
\item Check that $\underline{\text{Hom}}$ is a complex.
\item $\Ker
d^i_{\underline{\text{Hom}}}
=\text{Hom}_{\text{Com}(\mathcal{A})}(A^{\bullet},B^{\bullet}[i])$.
\item $\text{Im}d^{i-1}_{\text{Hom}}=\{fsim_{\text{hom}}0\}$
\end{enumerate}
\end{exercise}

Notation:
$\text{Hom}^i(A^{\bullet},B^{\bullet})=\text{Hom}(A^{\bullet},B^{\bullet}[i])$. 

\begin{lemma}
\label{lemma-cone-long-exact-sequence}
Consider the following composition
$$
\xymatrix{
A^\bullet\ar[r]_f&  B^{\bullet}\ar[r]^b&  \text{Cone}(f)\ar[r]^a &
A^{\bullet}[1]
}
$$
(which is your first {\it distinguished triangle in life}) induces the following
long exact sequence for all $C^{\bullet \in \text{Com}(\mathcal{A})}$:
$$
\xymatrix{
\cdots\ar[r]&\text{Hom}^i_{\mathcal{H}(\mathcal{A})}(C^{\bullet},A^{\bullet})\ar[r]&\text{Hom}_{\mathcal{H}}(\mathcal{A})^i(C^{\bullet},B^{\bullet})\ar[r]&\text{Hom}^i_{\mathcal{H}(\mathcal{A})}(C,\text{Cone}(f))\ar[r]&\text{Hom}^{i+1}_{\mathcal{H}(\mathcal{A})}(C^{\bullet},A^{\bullet})\ar[r]&\cdots
}
$$
and the same happens for
$\text{Hom}^i_{\mathcal{H}(\mathcal{A})}(\cdot,C^{\bullet})$.
\end{lemma}

It is very important that we went in $\mathcal{H}(\mathcal{A})$!

\begin{proof}[Idea of proof]
(The long exact sequence is the cohomology exact sequence associated
to a short exact sequence. Also some exercise from the past is hidden in the
details.)

The short exact sequence
$$
\xymatrix{
0\ar[r]&B^{\bullet}\ar[r]&\text{Cone}(f)\ar[r]&A[1]\ar[r]&0
}
$$
splits. This gives
$$
\xymatrix{
0\ar[r]&B^i\ar[r]&B^i\oplus A^{i+1}\ar[r]&A^{i+1}\ar[r]&0
}
$$
Which in turn gives
$$
\xymatrix{
0\ar[r]&\underline{\text{Hom}}(C^{\bullet},B^{\bullet})
\ar[r]&\underline{\text{Hom}}(C^{\bullet},\text{Cone}(f))
\ar[r]&\underline{\text{Hom}}(C^{\bullet},A[1]\ar[r]&0
}
$$
and {\it then} we take the cohomology long exact sequence.
\end{proof}

\begin{exercise}
\label{exercise-simple}
$bf=ab=fa[-1]=0$ in $\mathcal{H}(\mathcal{A})$.
\end{exercise}

\begin{exercise}
\label{exercise-right-Ore-conditions-not-in-Com}
Prove that the right Ore conditions are not satisfied in
$\text{Com}(\mathcal{A})$.
\end{exercise}

\begin{proposition}
\label{proposition-QIS-satisfy-right-Ore-conditions-in-homotopy-category}
QIS satisfy the right Ore conditions in $\mathcal{H}(\mathcal{A})$.
\end{proposition}

\begin{proof}
In lecture we proved condition 1 and part of condition 2 of the right Ore
conditions, see Subsection
\ref{subsection-explicit-description-of-localization}. Finishing the proof was
left as exercise, including Ore condition 3.
\end{proof}

\bigskip\noindent
Now we shall show that
$$
D(\mathcal{A})\cong \mathcal{H}(\mathcal{A})[\text{QIS}]
$$
$$
H:\text{Com}(\mathcal{A}\to \mathcal{H}(\mathcal{A})
$$
\begin{proposition}
\label{proposition-localization-functor}
The localization functor
$$
\xymatrix{
Q:\text{Com}(\mathcal{A})\ar[d]_H\ar[r]
& D(\mathcal{A})\cong\mathcal{H}(\mathcal{A})[\text{QIS}]^{-1}\\
\mathcal{H}(\mathcal{A})\ar[ur]_{Q'}
}
$$
can be be decomposed as $Q' \circ H$. Moreover $Q' \cong
\mathcal{H}(\mathcal{A})$, where
$Q_{\mathcal{H}(\mathcal{A})}:\mathcal{H}(\mathcal{A}) \to
\mathcal{H}(\mathcal{A})[\text{QIS}]^{-1}$.
\end{proposition}

\begin{proof}
Done in class, with some exercises for us to complete.
\end{proof}

This shows that the derived category is equivalent to the homotopy category with
localization. We have the following corollary:

\begin{lemma}
\label{lemma-}
We can specifically describe
$$
D(\mathcal{A}): \text{Ob}(D(\mathcal{A}) = \text{Com}(\mathcal{A})
$$
$$
\text{Hom}_{D(\mathcal{A})}(A^{\bullet},B^{\bullet})
=\{\text{equivelnce classes of roofs}\}
$$
Recall that a roof is
$$
\xymatrix{
& C\ar[dl]_{\text{QIS}\ni S}\ar[dr]^{f}\\
A& & B
}
$$
\end{lemma}

\bigskip\noindent
Now we shall show that $D(\mathcal{A})$ is additive. (Or have we already proved
this? ie. from the corollary?)

\bigskip\noindent
Why $\mathcal{H}(\mathcal{A})$ and $D(\mathcal{A})$ are not abelian: there are
not so many injective and surjective morphisms.

\begin{exercise}
\label{exercise-no-injective-surjective-morphisms-in-derived-categories}
$f \in \text{Hom}_{\mathcal{H}(\mathcal{A})} (A^{\bullet},B^{\bullet})$ is
injective if and only if there exists  $g: B \to A^{\bullet} \in
\text{Hom}_{\mathcal{H}(\mathcal{A})} (B^{\bullet},A^{\bullet})$ such that $g
\circ f=\text{id}_A$. Formulate the same for surjections.
\end{exercise}

\subsection*{Some properties of the derived category}
\label{subsection-some-properties-of-the-derived-category}

For every $i \in \mathbb{Z}$ define
\begin{align*}
\mathcal{A} &\longrightarrow D(\mathcal{A}) \\
A &\longmapsto A[i], \quad \{0 \to \overset{i}{A} \to 0\}
\end{align*}

So $A[i]$ is {\it that} complex. It is ``concentrated in degree i''

{\bf Goal:} understand morphisms between $M,N[i]$.

\begin{definition}
\label{definition-embedding-in-Com}
Let $A \in \text{Com}(\mathcal{A})$. For all $n$, 
$$
\tau_{\leq n}(A^{\bullet})^i:=\begin{cases}
A^i\qquad &i<n \\
\Ker d^n\qquad &i=n\\
0,\quad &i>n
\end{cases}
$$ 
then 
$$
\tau_{\geq  n}(A^{\bullet})^i=\begin{cases}
0\qquad
 &i<n \\
A^n/\text{Im}d^{n-1}\qquad &i=n\\
A^i,\qquad &i>n
\end{cases}
$$
and $A^{\bullet}\to\tau_{\geq n}A^{\bullet}$.
\end{definition}

Then
$$
\tau_{\leq n}:\text{Com}(\mathcal{A}) \to \text{Com}(\mathcal{A})
$$
defines a functor $\tau_{\leq n}(\text{QIS})\subset \text{QIS}$ 
where 
$$
\tau_{\leq }(f \sim _{\text{hom}}0) \subset \sim_{\text{hom}}0
\implies
$$
\begin{align*}
\tau_{\leq n}: \mathcal{H}(\mathcal{A}) &\longrightarrow
\mathcal{H}(\mathcal{A}) \\
D(\mathcal{A}) &\longmapsto D(\mathcal{A})
\end{align*}
the same for $\tau_{\geq n}$.

\medskip
The following lemma allows us to understand how are morphisms behaved.

\begin{lemma}
\label{lemma-Homs}
Let $A,B \in \mathcal{A}$. Then
 \begin{enumerate}
\item $\text{Hom}_{D(\mathcal{A})}(A,B[-i])=0$ for all $i>0$.
\item $\text{Hom}_{\mathcal{A}}(A,B)=\text{Hom}_{D(\mathcal{A})}(A,B)$.
\end{enumerate}
In particular, $\mathcal{A} \hookrightarrow A(\mathcal{A})$ is fully-faithful.
\end{lemma}

Now we introduce a notion of Ext, which will recover the usual Ext (derived
functors).

\begin{definition}
\label{definition-Ext}
For $i>0$,
$$
\text{Ext}^i_{\mathcal{A}}(A,B)=\text{Hom}_{D(\mathcal{A})}(A,B[i]).
$$
\end{definition}

\begin{definition}[Yoneda]
\label{definition-Yoneda}
For $i>0$ let
$$
\text{Ext}_Y^i(A,B):=\{\substack{\text{equivalence classes of exact sequences}\\
B\to K^{i-1}\to K^{i-2}\to \ldots \to K^0 \to A}\}
$$
and say that two such sequences are equivalent if there is a commutative diagram
$$
\xymatrix{
B\ar[r]&  K^{i-1}\ar[r]\ar[d]&  K^{i-2}\ar[r]\ar[d]& \cdots\ar[r]\ar[d]
&K^0\ar[r]\ar[d]&A\\
B\ar[r]&  \tilde{K}^{i-1}\ar[r]&  \tilde{K}^{i-2}\ar[r]& \cdots\ar[r]
&\tilde{K}^0\ar[r]&A
}
$$
and are equivalent if there exists a sequence of equivalent elements
$$
K \sim K_0 \sim \ldots \sim \tilde{K}
$$
\end{definition}

\begin{proposition}
\label{proposition-Ext}
$$
\text{Ext}_{\mathcal{A}}^i(A,B) \cong \text{Ext}_Y^i(A,B)
$$
\end{proposition}

\begin{proof}
Sketched in class.
\end{proof}

\begin{exercise}
\label{exercise-derived-and-homotopy-categories-abelian-characterization}
$D(\mathcal{A})$ and  $\mathcal{H}(\mathcal{A})$ are abelian if and only if
$\mathcal{A}$ is semisimple, that is, all exact sequences in $\mathcal{A}$
split. If $\mathcal{A}$ is semisimple, then $D(\mathcal{A})\cong \bigoplus_{i
inn \mathbb{Z}}\mathcal{A}[-i]$.
\end{exercise}

\subsection*{Triangulated categories}
\label{subsection-triangulated-categories}

\begin{definition}
\label{definition-triangulated-category}
An additive category $\mathcal{T}$ is a {\it triangulated category} if it has
the following structures:
\begin{itemize}
\item $[1]:\mathcal{T} \to \mathcal{T}$ autoequiv.
\item Class of sequences of the form
$$
\xymatrix{
A\ar[r]&B\ar[r]&C\ar[r]&A[1]
}
$$
which are called {\it distinguished triangles}, and satisfy the following
axioms:
\begin{itemize}
\item (Axiom 1.)
\begin{itemize}
\item $\xymatrix{
A\ar[r]^{\text{id}}&A \ar[r]& 0\ar[r]&A[1]
}$ is a distinguished triangle.
\item Any triangle $A \to B \to C \to A[I]$ isomorphic to a distinguished
triangle is a distinguished triangle.
\item Any morphism $(A \xrightarrow{f}B)\in \mathcal{T}$ can be completed to a
distinguished triangle $A\xrightarrow{f}B \to \mathcal{K} \to A[I]$, and
$\mathcal{K}$ is called the {\it cone} of $f$.
\end{itemize}
\item (Axiom 2.) A triangle
$$
\xymatrix{
A\ar[r]^f &  B \ar[r]^g &  C\ar[r]^h & A[1]
}
$$
is distinguished if and only if
$$
\xymatrix{
B\ar[r]^g &  C \ar[r]^g &  A[1]\ar[r]^{f[1]} & B[1]
}
$$
is distinguihsed.

\item (Axiom 3.) For any two distinguished triangles
$$
\xymatrix{
A\ar[r]^f\ar[d]_a &  B \ar[r]\ar[d]^b &  C \ar@{.>}[d]^{u}\ar[r]& 
A[1]\ar[d]^{a[1]}\\
A'\ar[r]_{f'}& B'\ar[r]& C'\ar[r]&A'[1]
}
$$
and any $a,b$ such that $bf=f'a$ there exists $u$ that makes the above diagram
commute (it is not unique!)

\item (Octahedral axiom.) Any two distinguished triangles with a common vertex 
of the form 
$$
\xymatrix{
X\ar[r]^u& Y\ar[r]^v\ar[d]& Z\ar[r]&X[I]\\
& Y'\ar[d]\\
& W\ar[d]\\
& Y[I]
}
$$
can be
completed to the following commutative diagram:
$$
\xymatrix{
X\ar[d]_{=}\ar[r]^u& Y\ar[r]^v\ar[d]&  Z\ar[r]&  X[|]\ar[d]^=\\
X\ar[r]&  Y'\ar[d]\ar[r]&  Z'\ar[d]\ar[r]& X[|]\ar[d]^{u[I]}\\
& W\ar[r]^=\ar[d]_h & W\ar[r]^h\ar[d]&  Y[|]\\
& Y[|]\ar[r]_{v[|]}&Z[|]
}
$$
\end{itemize}
\end{itemize}
\end{definition}

{\bf Properties.} Let $X\xrightarrow{f}Y\xrightarrow{g}Z\xrightarrow{h}X[I]$ be
a distinguished triangle.

\begin{lemma}
\label{lemma-properties-of-distinguished-triangles}
\begin{enumerate}
\item $gf=hg=f[1]h=0$.
\item It induces the following sequence
$$
\xymatrix{ 
\cdots\ar[r]&Z[-1]\ar[r]& X\ar[r]& Y\ar[r]& Z\ar[r]&X[1]
\ar[r]&Y[1]\ar[r]& Z[1]\ar[r]&\cdots
}
$$
such that any sequence of length $h$ (contained in it?) is a distinguished
triangle.
\end{enumerate}
\end{lemma}

\begin{proof}
$$
\xymatrix{
Y\ar[r]^g\ar[d]_=& Z\ar[d]_=\ar[r]^h& C[1]\ar[r]^{f[1]}\ar[d]&
Y[1]\ar[d]^{g[1]}\\
Z\ar[r]^{=}&Z\ar[r]& 0\ar[r]&Z[1]
}
$$
and by axiom 3 we get $gf=0$. By Axiom 2 we get the second statement.
\end{proof}

\begin{lemma}
\label{lemma-long-exact-sequences-for-distinguished-triangles}
If $X \to Y \to Z \to X[1]$ is a distinguished triangle, then for every $U \in
\mathcal{T}$ we have the following long exact sequences:
$$
\xymatrix{
\cdots\ar[r]&\text{Hom}(U,X[i])\ar[r]&\text{Hom}(U,Y[i]\ar[r]&
\text{Hom}(U,Z[i])\ar[r]&\text{Hom}(U,X[i+1]\ar[r]&\cdots
}
$$
and the same happens for $\text{Hom}(\cdot,U)$
\end{lemma}

\begin{proof}
Done in lecture, uses previous lemma and Axiom 3.
\end{proof}

We have the following corollary:

\begin{lemma}
\label{lemma-two-isomorphisms-give-an-isomorphism}
If in Axiom 3 two morphisms are isomorphisms, then the constructed one is also
an isomorphism.
\end{lemma}

\begin{proof}
Exercise. {\bf Hint.} Use Yoneda lemma.
\end{proof}

\begin{exercise}
\label{exercise-inverses-in-distinguished-triangles}
If $A\xrightarrow{f}B\xrightarrow{g}C\xrightarrow{h}A[1]$ is a distinguished
triangle, then $h=0$ if and only if $f$ has a left inverse, if and only if $g$
has a right inverse. 
\end{exercise}

As a corollary,

\begin{lemma}
\label{lemma-cone-of-morphism-is-unique}
The cone of a morphism is unique up to isomorphism.
\end{lemma}

However, the cone is not functorial, which is a problem.

\medskip\noindent
Now we want to show that the homotopy category $\mathcal{H}(\mathcal{A})$ of an
abelian category $\mathcal{A}$ has a triangulated structure. 
We need to say which are the distinguished triangles: but we already did this
for the derived category: they are
$$
\xymatrix{
A\ar[r]^f&B\ar[r]^b&\text{Cone}(f)\ar[r]^a&A[I]\ar[r]&0
}
$$

\begin{theorem}
\label{theorem-homotopy-category-is-triangulated}
$\mathcal{H}(\mathcal{A})$ is triangulated.
\end{theorem}

\begin{proof}
It looks like Axiom 1 should be immediate from our construction. Also Axiom 2
(indeed, we have a notion of $\text{Cone}(f)$ which we obviously expect to
satisfy the property of the cone $\mathcal{K}$. Axiom 3 uses an exercise using
the notion of cylinder. Proving the octahedral axiom is also an exercise with a
big hint.
\end{proof}

{\bf $D(\mathcal{A})$ is triangulated.} Let $\mathcal{C}$ be triangulated, and
$S$ a class of morphisms satisfying the right Ore conditions. We know that
$\mathcal{C}[S]^{-1}$ is an additive category, but when is it triangulated?

\begin{definition}
\label{definition-compatible-class-of-morphisms}
$S$ is {\it compatible} with a triangulated structure if
\begin{enumerate}
\item $s \in S$, $S[1]\in S$,
\item In Axiom 3, if $a,b \in S$ then we can choose $u \in S$.
\end{enumerate}
\end{definition}

\begin{proposition}
\label{proposition-compatible-class-gives-triangulated-localization}
It $\mathcal{T}$ is triangulated an $S$ satisfies the right Ore conditions and
is compatible with the triangulated structure of $\mathcal{T}$ then
$\mathcal{T}[S]^{-1}$ is triangulated.
\end{proposition}

\begin{proof}
Axioms 1-3 proved, Octahedral axiom is exercise with hint.
\end{proof}

We finally obtain:

\begin{lemma}
\label{lemma-derived-category-is-triangulated}
$D(\mathcal{A})$ is triangulated.
\end{lemma}

\begin{proof}
Two or three lines, uses 5 lemma, uses long exact sequences of $\text{Hom}$.
\end{proof}

\subsection*{Derived functors}
\label{subsection-derived-functors}

\begin{definition}
\label{definition-additive-exact-functor}
An additive functor $F:\mathcal{T} \to \mathcal{T}'$ between triangulated
categories is {\it exact} if
\begin{enumerate}
\item $F \circ [1]_{\mathcal{T}}=[1]_{\mathcal{T}'}\circ F$.
\item Maps distinguished triangles to distinguished triangles.
\end{enumerate}
\end{definition}

\medskip\noindent
Here are some bounded notions:
\begin{align*}
\text{Com}^\bullet(\mathcal{A})&\\
\text{Com}^+(\mathcal{A})&=\{A\in \text{Com}(\mathcal{A})
|A^i=0,\quad i\ll 0\}\\
\text{Com}^-(\mathcal{A})&=\{A\in \text{Com}(\mathcal{A})|i \gg 0\}\\
\text{Com}^b(\mathcal{A})&=\{A \in \text{Com}(\mathcal{A})||i|\gg 0\}
\end{align*}
each of which gives a derived category $D^*$ for $*=b,+$ or $-$.

Now consider an exact functor of abelian categories $F:\mathcal{A} \to
\mathcal{B}$. We would like to obtain a functor
$D^*(\mathcal{A}) \to D^*(\mathcal{B})$.

In general functors are not exact. Thus our goal now is:
\begin{itemize}
\item From a left exact functor $F:\mathcal{A} \to \mathcal{B}$ obtain
$RF:D^+(\mathcal{A})\to D^+(\mathcal{B})$,
\item From a right exact functor $G:\mathcal{A}\to \mathcal{B}$ obtain
$LG:D^-(\mathcal{A})\to D^-(\mathcal{B})$.
\end{itemize}
Given an additive category $\mathcal{I} \subset \mathcal{A}$ of injective
objects in $\mathcal{A}$, we have  $\mathcal{H}^* (\mathcal{I})\subset 
\mathcal{H}^* (\mathcal{A}) \xrightarrow{G_{\mathcal{A}}}D^*(\mathcal{A})$.

\begin{lemma}
\label{lemma-embedding-of-injective-subcategory}
Suppose that $\mathcal{A}$ has enough injective objects, 
$\forall A^\bullet \in \mathcal{A}$ can be embedded 
$A \hookrightarrow I \in\mathcal{I}$. Then 
$i:\mathcal{H}^+(\mathcal{I}) \to D^+(\mathcal{A})$ is an equivalence.
\end{lemma}

\begin{proof}
Not proved.
\end{proof}

Suprisingly (to me) it looks like the category of coherent sheaves has not
enough injective objects. Because the derived category of coherent sheaves is
supposed to be mirrored with the Fukaya category of lagrangian subvarietiesâ€¦ so
probably we want our category to have exact functors i.e. lots of injective
objects.

\subsection*{Semiorthogonal decompositions}
\label{subsection-semiorthogonal-decompositions}

{\bf Idea.} To split $D^*(\mathcal{A})$ in smaller pieces that are easier.

\begin{definition}
\label{definition-strictly-full-triangulated-subcategory}
$\mathcal{A} \subset \mathcal{T}$ is a {\it strictly full triangulated
subcategory} if
\begin{itemize}
\item $\text{Hom}_{\mathcal{A}}(A,B)=\text{Hom}_{\mathcal{T}}(A,B)$ for all $A,B
\in \mathcal{A}$.
\item If  $B \in \mathcal{T}$ is isomorphic to an object from $\mathcal{A}$,
then $B \in \mathcal{A}$.
\end{itemize}
\end{definition}

\begin{definition}
\label{definition-semiorthogonal-decomposition}
Let $\mathcal{T}$ be a triangulated category and $\mathcal{A}$, $\mathcal{B}$
strictly full trinagulated subcategories in $\mathcal{T}$. Then
$\mathcal{T}=\left<\mathcal{A},\mathcal{B}\right>$ is a {\it semiorthogonal
decomposition} if
\begin{itemize}
\item $\text{Hom}_{\mathcal{T}}(B,A)=0$ for all $B \in \mathcal{B}$ and $A\in
\mathcal{A}$.
\item For all $T \in \mathcal{T}$ there exists a distinguished triangle
$$
T_B \to T \to T_{\mathcal{A}}\to T_{\mathcal{B}}[1]
$$
where $T_B \in \mathcal{B}$ and $T_\mathcal{A} \in \mathcal{A}$.
\end{itemize}
\end{definition}

\begin{proposition}[Properties of semiorthogonal decomposition]
\label{proposition-properties-of-semiorthogonal-decomposition}
\begin{enumerate}
\item Functoriality: for any $f \in T \to T'$,
$$
\xymatrix{
T_{\mathcal{B}}\ar@{.>}[d]_{\exists f_{\mathcal{B}}}\ar[r]& T\ar[d]^f\ar[r]
& T_{\mathcal{A}}\ar@{.>}[d]^{f_{\mathcal{A}}}\ar[r]& T_{\mathcal{B}}[1]\\
T_{\mathcal{B}}'\ar[r]& T'\ar[r]& T'_{\mathcal{A}}\ar[r]& T'_{\mathcal{B}}[1]
}
$$
there exist $f_{\mathcal{B}}$ and $f_{\mathcal{A}}$ as in the diagram.
\end{enumerate}
\end{proposition}

\begin{proof}
For $f_{\mathcal{A}}$,apply $\text{Hom}_{\mathcal{T}}(\cdot,T_{\mathcal{A}}')$ 
to the upper distinguished triangle, obtain a long exact sequenceâ€¦
\end{proof}

Functoriality: defnote by $\alpha:\mathcal{A} \hookrightarrow  \mathcal{T}$ the
inclusion, then we have a functor $\alpha^*:\mathcal{T} \to \mathcal{A}$ given
by $T \to T_{\mathcal{A}}$, $f \mapsto  f_{\mathcal{A}}$. Similarly for
$\beta:\mathcal{B} \hookrightarrow  \mathcal{T}$ we have a functor $\beta
^*:\mathcal{T} \to \mathcal{B}$ by $T \to T_{\mathcal{B}}$, $f \mapsto
f_{\mathcal{B}}$.

\begin{lemma}
\label{lemma-alpha-and-beta-adjoint}
$\alpha^*$ is left adjoint to $\alpha$ and $\beta^*$ is right adjoint to $\beta.$
\end{lemma}

\begin{proof}
We have for any $A \in \mathcal{A}$,
$\text{Hom}_{\mathcal{A}}(\alpha^*T,A)=\text{Hom}_{\mathcal{T}}(T,\alpha_*A)$.
But that is equal to $\text{Hom}_{\mathcal{A}}(\mathcal{T}_{\mathcal{A}},A)$.
\end{proof}

\begin{exercise}
\label{exercise-orthogonal}
If $\mathcal{T}=\left<\mathcal{A},\mathcal{B}\right>$, then
$$
\mathcal{B}=\mathcal{A}^\perp=\left<B \in \mathcal{T} |
\text{Hom}(B,A), \forall A \in \mathcal{A}\right>:=\Ker \alpha^*
$$
(the $\perp$ sign should be on the left of $\mathcal{A}$ but I don't know how to
write this) and 
$$
\mathcal{A}=\mathcal{B}^\perp=\left<A \in \mathcal{T} |
\text{Hom}(B,A)=0,\forall B \in \mathcal{B}\right>:=\Ker B
$$
(here the $\perp$ is correct on the right side of $\mathcal{B}$).
\end{exercise}

This construction can be reversed.

\begin{definition}
\label{definition-left-and-right-admissible-subcategories}
A strictly full subcategory $\mathcal{A} \hookrightarrow  \mathcal{T}$ is called
\begin{itemize}
\item {\it left admissible} is there exists $\alpha^*:\mathcal{T} \to
\mathcal{A}$ left adjoint,
\item {\it right admissible} is there exists $\alpha^!:\mathcal{T} \to
\mathcal{A}$ right adjoint.
\end{itemize}
\end{definition}

\begin{lemma}
\label{lemma-admissible-implies-semiorthogonal-decomposition}
If $\mathcal{A} \hookrightarrow  \mathcal{T}$ is left admissible, then
$\mathcal{T}=\left<\mathcal{A},\mathcal{A}^\perp\right>$ is semiorthogonal
decomposition. If
$\mathcal{B} \hookrightarrow  \mathcal{T}$ is right admissible then
$\mathcal{T}=\left<\mathcal{B}^\perp, \mathcal{B}\right>$ is semiorthogonal
decomposition.
\end{lemma}

\begin{proof}
Uses a remark, Yoneda lemma.
\end{proof}

\begin{proposition}[Bondall, Van der Borgh]
\label{proposition-Bondall-Van-der-Borgh}
If $\mathcal{T}$ is smooth and proper (if $\mathcal{T}=D^b(X)$, where $X$ is
smooth and proper, we call $\mathcal{T}$ smooth and proper) then
$\mathcal{A} \subset \mathcal{T}$ is left admissible $\iff$ $\mathcal{A}$ is
right admissible $\iff$ $\mathcal{A}$ is smooth proper. If $\mathcal{A}$ is
smooth and proper and $\mathcal{A} \hookrightarrow  \mathcal{T}$ then
$\mathcal{A}$ is left and right admissible.
\end{proposition}

\medskip\noindent
If $D^b(C) \hookrightarrow  \mathcal{T}$ is fully faithful, then it is left and
right admissible.

{\bf Question.} When can we construct a full faithful embedding
 $$
D^b(\text{pt})\cong D^b(\text{mod}k) \hookrightarrow  \mathcal{T}?
$$
Let \begin{align*}
D^b(\text{mod}k) &\longrightarrow \mathcal{T} \\
k &\longmapsto E
\end{align*}
and define
$$
\varphi_E:V^\bullet \to V^\bullet \otimes E
$$
where $V^\bullet$ is a graded vector space.

When is $\varphi_E$ full faithful? Some computations show that $\varphi_E$ is
fully faithful if and only if $\text{Hom}(E,E)=k$. Recall from 
\texttt{categories.tex} that

\begin{definition}
\label{definition-faithful}
Let $F : \mathcal{A} \to \mathcal{B}$ be a functor.
\begin{enumerate}
\item We say $F$ is {\it faithful} if
for any objects $x, y \in \Ob(\mathcal{A})$ the map
$$
F : \Mor_\mathcal{A}(x, y) \to \Mor_\mathcal{B}(F(x), F(y))
$$
is injective.
\item If these maps are all bijective then $F$ is called
{\it fully faithful}.
\end{enumerate}
\end{definition}

\medskip\noindent
\begin{definition}
\label{definition-exceptional-object}
$E \in \mathcal{T}$ is exceptional if 
$$
\text{Hom}(E,E[i])=
\begin{cases}
k\qquad &i=0 \\
0\qquad &i \neq 0
\end{cases}
$$
\end{definition}

\begin{lemma}
\label{lemma-exeptional-implies-fully-faithful}
If $E$ is exceptional then $\varphi_E:D(\text{pt}) \to \mathcal{T}$ is a fully
faithful embedding. Then
$$
\mathcal{T}=\left<\varphi_E(D^b(\text{pt})^\perp,E\right>=
\left<E^\perp,\varphi_E(D^b(\text{pt}))\right>
$$
\end{lemma}

{\bf Notation.} In this case,
$\mathcal{T}=\left<E,E^\perp\right>=\left<E^\perp,E\right>$, where on the first
bracket the $\perp$ should be on the left side of $E$.

\begin{example}
\label{example-all-line-bundles-are-exceptional-on-Fano}
On  $\mathbb{P}^n$, $\mathcal{O}(i)$ is exceptional. More general, if $X$ is
Fano (i.e. smooth projective with $-K_X$ ample), then any line bundle on  $X$ is
ample.
\end{example}

\begin{proof}
$\text{Ext}^i(\mathcal{L},\mathcal{L})=H^{i}(X,\mathcal{O}_X)$,
$H^{0}(X,\mathcal{O})=k$ and $H^{>0}(X,\mathcal{O})=0$ by Kodaira
Vanishing.
\end{proof}

For Fano varieties we have nontrivial semiorthogonal decomposition.

\begin{remark}
\label{remark-CY-have-no-semiorthogonal-decomposition}
If $K_X \cong \mathcal{O}_X$ then there is no semiorthogonal decomposition of
$D^b(X)$ (for K3 or abelian).
\end{remark}

Back to Fano,
\begin{definition}
\label{definition-semiorthogonal-decomposition-for-several-categories}
Let $\mathcal{A}_1,\ldots,\mathcal{A}_n \in \mathcal{T}$ be strictly full
subcategories and $\mathcal{T}=\left<\mathcal{A}_1,\ldots,\mathcal{A}_n\right>$ 
a {\it semiorthogonal decomposition}
\begin{itemize}
\item $\text{Hom}(\mathcal{A}_j,\mathcal{A}_i)=0$ for all $j>i$.
 \item For all $T$ there is a chain of morphisms
 $$
0 = T_n \to T_{n-1}\to \ldots \to T_1 \to T_0=T
$$
such that $\text{Cone}(T_i \to T_{i-1}) \in \mathcal{A}_i$.
\end{itemize}
\end{definition}

\begin{exercise}
\label{exercise-functoriality-and-cone}
Prove functoriality of $T to \text{Cone}(T_i \to T_j)$ for $i>j$.
\end{exercise}

\begin{definition}
\label{definition-exceptional-collection-of-objects}
A collection of objects $E_1,\ldots, E_n$ is {\it exceptional} if
 \begin{enumerate}
\item For all $i$, $E_i$ is exceptional.
\item $\text{Hom}(\left<E_i\right>,\left<E_j\right>)=0$ for all $i>j$, where
$\left<E_j\right>$ is a minimal triangulated category generated by $E_i$.
\end{enumerate}
\end{definition}

We have a corollary:

\begin{lemma}
\label{lemma-exceptional-collection-gives-semiorthogonal-decomposition}
If $E_1,\ldots,E_n$ is an exceptional collection, then
$$
\mathcal{T}=\left<E_1,\ldots,E_n,\left<E_1,\ldots,E_n\right>^\perp\right>
=\left<\left<E_1,\ldots,E_n\right>^\perp,E_1,\ldots,E_n\right>
$$
(where $\perp$ should be on the left of the bracket in the first appearence) 
is a semiorthogonal decomposition.
\end{lemma}

\begin{definition}
\label{definition-full-exceptional-collection}
If $\left<E_1,\ldots,E_n\right>^\perp=0$ (equivalently with $\perp$ on the
left).
\end{definition}

\begin{exercise}
\label{exercise-exceptional-collections-for-Fano}
Let $X$ be a Fano variety with $-K_X=mH$ for $H$ ample ($m$ is the index of
$X$). Then for every line bundle $\mathcal{L}$,
$$
(\mathcal{L}(-m+1)H,\ldots,\mathcal{L}(-H)\mathcal{L})
$$
is an exceptional collection.
\end{exercise}

\begin{proof}
Use Serre duality and Kodaira Vanishing.
\end{proof}

\medskip\noindent
Here is the promised theorem from the beginning of this minicourse:

\begin{theorem}[Beilinson]
\label{theorem-Beilinson}
$D^b(\mathbb{P}^n)=\left<\mathcal{O}(-n),\ldots,\mathcal{O}\right>$ is a full
exceptional collection.
\end{theorem}

This means that we can classify all objects of $D^b(\mathbb{P}^n)$. Because 
whenever we have a semiorthogonal decomposition we get 
these chains of morphisms, i.e. for all $D^b(\mathbb{P}^n)$ there exists a chain 
$$
0=T_n \to \ldots \to T_0=T
$$
such that $\text{Cone}(T_i \to T_{i-1}) \in \left<\mathcal{O}(-i)\right> \cong
D^b(\text{pt})$.

Probably this is the content of \cite{Beilinson-derived}.

\begin{proof}[Proof of Beilinson theorem]
Consider the Koszul complex
$$
0\to \mathcal{O}(-n-1)\to\ldots \to \Lambda^{2}V^\vee \otimes \mathcal{O}(-2)
\to V^{\vee}\otimes \mathcal{O}(-1) to \mathcal{O} \to0
$$
This implies that
$$
\mathcal{O}(n-1) \in \left< \mathcal{O}(-n),\ldots,\mathcal{O}\right>
$$
â€¦ proof completed in class.
\end{proof}

\section{Geometric Invariant theory}
\label{section-GIT}

{\bf Plan.} 
\begin{enumerate}
\item Quotients by finite groups.
\item Linear algebraic groups.
\item GIT (affine case).
\item GIT (general case).
\end{enumerate}

\begin{proposition}
\label{proposition-1}
$\mathcal{O}(X)^G$ is finitely generated and $\mathcal{O}(X)$ is a finite module
over $\mathcal{O}(X)^G$
\end{proposition}

Let $Y = \text{Spec}B$ and $\pi:X\to Y$ a dominant, finite morphism, which
implies it is surjective.

\begin{proposition}
\label{proposition-2}
The set-theoretic fibers of $\pi$ are the orbits $Gx$
\end{proposition}

\begin{proof}
$\pi$ is $G$-invariant, i.e. constant on orbits.
\end{proof}

\begin{proposition}
\label{proposition-2-second}
The quotient map $\pi$ is open and if $U\subset X$ is open, affine, $G$-stable, 
then the restriction $\pi|_{U}$ is the quotient map $U\to U/G$.
\end{proposition}

\begin{proposition}
\label{proposition-quotient-map-is-categorical-quotient}
$f:X\to Z$ $G$-invariant morphism, then there is a unique morphism $\varphi:Y
\to Z$ such that $f=\varphi \circ\pi$. This says that $\pi$ is the categorical
quotient.
\end{proposition}

\begin{proof}[Sketch of proof]
It is clear that $\varphi$ exists as a map of sets. It is continuous since
$\pi$ is open surjective. $\varphi^\sharp:\mathcal{O}_Z \to
\varphi_*(\mathcal{O}_Y)$.
\end{proof}

\begin{example}
\label{example-quotients}
 \begin{enumerate}
\item $G=\mu_n$ the roots of unity of order $n$ (prime to $p$). $G$ acts on
$\mathbb{A}^2$ by $g(x,y)=(gx,gy)$.  $\mathcal{O}(\mathbb{A}^2)=k[x,y]$ and
$\mathcal{O}(\mathbb{A}^2)=k[x^n,x^{n-1}y,\ldots,xy^{n-1},y^n]$.
$\mathbb{A}^2/G$ is a singular surface.
\item $G=S_n$ symmetric group, acts on $\mathbb{A}^n$ permuting the coordinates.
$\mathcal{O}(\mathbb{A}^n)=k[x_1,\ldots,x_n]$,
$\mathcal{O}(\mathbb{A}^2)^G=k[e_1,\ldots,e_n]$ where $e_i$ is the $i$-th
symmetric function. The quotient
$\pi:\mathbb{A}^n\xrightarrow{(e_1,\ldots,e_n)}\mathbb{A}^n$ is finite, flat of
degree $n!$.
\item (Symmetric products.) $X=Z^n$, $Z$ affine algebraic variety, $G=S_n$
acting by permuting copies of $Z$. Then $X/G:=Z^{(n)}$, the $n$-th symmetric
product of $Z$. Points of $Z^{(n)}=$effective $0$-cycles in $Z$ of degree $n$ =
$z_1+\ldots+z_n$, $(z_i \in Z)$ = $n_1z_1+\ldots+n_kz_k$ where $z_i$ are
distinct and $n_i$ are positive integers with some $n$.
\end{enumerate}
\end{example}

\subsection*{Local structure of quotients}
\label{subsection-local-structure-of-quotients}

See Mumford, Abelian Varieties.

\begin{definition}
\label{definition-free-locus}
Points with trivial stabilizer.
\end{definition}

The local structure of  the symmetric product variety $Z^{(n)}$ 
at the point $x$ is the stabilizer
$$
G_x=S_{n_1}\times\ldots\times S_{n_2}\subset S_n=G
$$
and we get
$$
Z^{(n_1)}\times\ldots\times Z^{n_r} = X/G_x \to Z^{(n)}=X/G
$$
which is Ã©tale at the image of $x$.

\begin{proposition}
\label{proposition-variety-smooth-then-symmetric-product-smooth}
If $Z$ is smooth then $Z^{(n)}$ is smooth.
\end{proposition}

\begin{proof}
Using power series rings.
\end{proof}

\begin{proposition}
\label{proposition-simension-geq2-then-symmetric-product-singular}
If $\dim Z \geq 2$ then $Z^{(n)}$ is singular.
\end{proposition}

\begin{proof}
Done in lecture.
\end{proof}

\medskip\noindent
Then we have the {\it Hilbert scheme characteristic morphism}
\begin{align*}
\gamma: \text{Hilb}_n(Z) &\longrightarrow Z^{(n)} \\
W\subset Z &\longmapsto \sum_{z \in Z}\dim (\mathcal{O}_{W,z}z
\end{align*}
where $W$ must be {\bf finite of length }$n$. See Binger, Linear determinants
(older) or J. Bertin, The punctual Hilbert Scheme.

If $Z$ is smooth of dimension 1 then $\gamma$ is an isomorphism. If $Z$ is of
dimension 2 then $\gamma$ is a resolution. In general $\gamma$ is an isomorphism
above $Z_{f_2}^{(n)}$.

\subsection*{Linear algebraic groups}
\label{subsection-linear-algebraic-groups}
\begin{definition}
\label{definition-algebraic-group}
An {\it algebraic group} is a variety $G$ equipped with morphisms
\begin{align*}
m: G\times G &\longrightarrow G \\
(g,h) &\longmapsto gh
\end{align*}
and
\begin{align*}
i: G &\longrightarrow G \\
g &\longmapsto g^{-1}
\end{align*}
with an element $e \in G$ which satisfies the group axioms.
\end{definition}

(In fact this is the same as a group scheme of finite type over $k$.)

\begin{example}
\label{example-algebraic-groups}
\begin{enumerate}
\item Finite groups.
\item $\mathbb{G}_a=$additive group = $(\mathbb{A}^1,+)$ and $\mathbb{G}_m$
=multiplicative group = $(\mathbb{A}^1\setminus\{0\},\times)$.
\item $\text{GL}_n$ = general linear group. This is a principal open subset
($\det \neq 0$), an affine variety.
\item Classical groups $\text{SL}_n,\text{O}_n,\text{Sp}_{2n}$ closed in 
$\text{GL}_n$. Also 
$\text{PGL}_n=\text{GL}_n/\mathbb{G}_n:I_n\hookrightarrow\text{GL}_{n^2}$.
\item $(E,0)$ elliptic curve; there is a unique algebraic group law + with
neutral element $0$. (Abelian varieties.)
\end{enumerate}
\end{example}

\begin{proposition}
\label{proposition-connected-components-of-algebraic-group}
$G$ algebraic group, $G^0$ connected component of $e$: $G^0$ is a closed normal
subgroup of $G$ and the connected components of $G$ are the $gG^0$ for $g \in
G$. Moreover, $G^0$ is irreducible and $G$ is smooth (which is obvious because
it is smooth somewhere and we may just translate).
\end{proposition}
$$
\xymatrix{
1\ar[r]&G^0\ar[r]&G\ar[r]&\pi_0(G)\ar[r]&1
}
$$
\begin{definition}
\label{definition-action-of-algebraic-group}
An {\it action} of an algebraic group $G$ on a variety $X$ is a morphism $a:G
\times X \to X$ which satisfies the axioms of an action:
$$
a(g,x)=g\cdot x,\qquad  g\cdot(h\cdot x)=gh\cdot x,\qquad  e\cdot x=x
$$
The {\it orbit} of $x \in X$ is $G\cdot x=\{g\cdot x|g \in G\}$. The {\it
stabilizer} $G_x$ is $\{g \in G|g\cdot x=x\}$, which is a closed subgroup of
$G$.
\end{definition}

\begin{proposition}
\label{proposition-properties-of-orbit}
\begin{enumerate}
\item Each orgbit $G\cdot x$ is locally closed, smooth of dimension
$\dim(G)-\dim(G_x)$.
\item The orbit map $G \to G\cdot x$, $g \mapsto  g\cdot x$ is faithfully flat.
\item $\overline{G\cdot x}\setminus G\cdot x$ is a union of orbits of smaller
dimension.
\item Closed orbits exist.
\end{enumerate}
\end{proposition}

\begin{proof}
Should be easy.
For example, to see it's faithfully flat you just notice it is flat somewhere
(if it is connected, is it connected?) and then use homogeneity again.
\end{proof}

\begin{proposition}
\label{proposition-bound-on-dimension-of-orbit-gives-open-set}
For any $n \geq 1$, the set $\{x \in X|\dim(G\cdot x)\geq n\}$ is open. That is,
$\{x \in X|\dim(G_x)\leq n\}$ is open.

In particular, the points with finite stabilizer form an open subset.
\end{proposition}

\begin{proof}
Use
\begin{align*}
\gamma: G \times X &\longrightarrow X\times X \\
(g,x) &\longmapsto (g\cdot x,x)
\end{align*}
\end{proof}

\begin{lemma}
\label{lemma-homomorphism-of-algebraic-groups}
Let $f:G \to H$ be an homomorphism of algebraic groups. Then $\Ker (f)$ is a
normal subgroup of $G$. $\text{Im}(f)$ is a
closed subgroup of $H$ of dimension $\dim(G)-\dim \Ker f$.
\end{lemma}

\begin{example}
\label{example-SL2-acts-on-homogeneous-polynomials}
$G=\text{SL}_2$ acts on $k[x,y]_n:=V_n$ (these are called the {\it binary forms 
of degree $n$}) by linear change of variables.
\end{example}

\begin{definition}
\label{definition-linear-algebraic-group}
An algebraic group is {\it linear} if $G \hookrightarrow \text{GL}_n$ for some
$n$.
\end{definition}

\begin{example}
\label{example-multiplicative-group-is-linear}
$\mathbb{G}_a=\left\{\begin{pmatrix}
1&t\\ 
0&q
\end{pmatrix}\right\}$ is linear.
\end{example}

\begin{proposition}
\label{proposition-co-action}
$G$ linear algebraic group,  $X$ a $G$-variety, $G$ acts on
$\mathcal{O}(X)=\Gamma(X,\mathcal{O}_X)$ via $(g\cdot f)(x)=f(g^{-1}\cdot x)$
then $\mathcal{O}(X)$ is a union of f.d. $G$-stable subspaces on which $G$ acts
algebraically.
\end{proposition}

\begin{proof}
From the action $a:G \times X \to X$ we get the {\it co-action} 
\begin{align*}
a^\sharp: \mathcal{O}(X) &\longrightarrow \mathcal{O}(G \times X) \\
f &\longmapsto \sum_{i=1}^n(\varphi_i \otimes \psi_i)
\end{align*}
\end{proof}

\begin{definition}
\label{definition-G-module}
A finite dimensional vector space $V$ is called a {\it $G$-module} if $V$ is equipped
with an action of $G$ via a homomorphism of algebraic groups 
$G \to \text{GL}(V)$.

A  {\it $G$-module} is a vector space $V$ equipped with a linear action og the
group $G$ such that $V=$ union of finite dimensional $G$-submodules.
\end{definition}

\begin{proposition}
\label{proposition-G-modules}
 \begin{enumerate}
\item $X$ affine $G$-variety, $G$ linear algebraic group, then $X
\hookrightarrow  V$ finite dimensional $G$-module as a closed $G$-stable
subvariety.
\item Every affine algebraic group is linear.
\end{enumerate}
\end{proposition}

Let $X$ be an affine $G$-variety. Then
\begin{align*}
\mathcal{O}(X) &\longrightarrow \mathcal{O}(G\times X)
=\mathcal{O}(X)[t,t^{-1}] \\
f &\longmapsto \sum_{n \in \mathbb{Z}}f_n t^n
\end{align*}

In particular, every $\mathbb{G}_m$-module is semisimple: every nonzero
$G$-module contains a nonzero fixed point. Indeed, let $V$ be a
finite-dimensional $G$-module. Let $v \in V$ be a $\mathbb{G}_a$-eigenvector.
Then $g\cdot v=\gamma(g)v$ for ? $X \in
\mathcal{O}(\mathbb{G}_a)^{\times}=k^{\times}$ taking $g=0$ yields $X=1$.

$G$ connected algebraic group, then $G$ is {\it unipotent} if it is an iterated
extension of copies of $\mathbb{G}_a$. Then every nonzero $G$-module contains a
nonzero fixed point.

As an example consider $G=\text{SL}_2$. (We saw that it is not linearly
reductive in the sense described in the next section.)

\subsection*{Quotients by linearly reductive groups}
\label{subsection-quotients-by-linearly-reductive-groups}

\begin{definition}
\label{definition-linearly-reductive-group}
A linear algebraic group $G$ is {\it linearly reductive} if every $G$-module is
semi-simple.
\end{definition}

\begin{exercise}
\label{exercise-linearly-reductive-characterization}
$G$ is linearly reductive if and only if the functor 
$(\text{$G$-modules})\to(\text{vector spaces})$, $V \mapsto V^G$ is exact.
\end{exercise}

\begin{theorem}
\label{theorem-linearly-reductive-normal-unipotent-connected-subgroups-are-
trivial}
 If $G$ is linearly reductive then every connected normal unipotent subgroup $U$ 
of $G$ is trivial. The converse is true in characteristic zero.
\end{theorem}

\begin{proof}
($\implies$) Let $V$ be a $G$-module, $V\neq 0$ and $U$ as in the statement.
Then $V^U\neq 0$ is a $G$-module. Let $W$ be a $G$-module. 
Then $V=V^U \oplus W$. [Missing]

($\impliedby$) We show this for $k= \mathbb{C}$. View $G \supset K$ compact
subgroup, Zariski dense (eg. $C^* \supset S^1$ or 
$\text{GL}_n(\mathbb{C})\supset \text{U}_n$.) [Missing]
\end{proof}

\begin{definition}
\label{definition-reductive-linear-algebraic-group}
A linear algebraic group $G$ is {\it reductive} if it has a nontrivial connected
unipotent normal subgroup.
\end{definition}

The following definition is from StacksProject, \texttt{brauer.tex}:

\begin{definition}
\label{definition-simple}
Let $A$ be a $k$-algebra.
We say an $A$-module $M$ is {\it simple} if it is nonzero and
the only $A$-submodules are $0$ and $M$.
We say $A$ is {\it simple} if the only two-sided ideals of $A$ are
$0$ and $A$.
\end{definition}

\begin{lemma}
\label{lemma-Reynolds-operator}
$G$ linearly reductive, $V$ a $G$-module. Then
\begin{enumerate}
\item There is a unique projection of $G$-modules $R_V:V \to V^G$ called the
{\it Reynolds operator}.
\item 
$$
\xymatrix{
V\ar[d]_{R_V}\ar[r]^f&  W\ar[d]_{R_V}\\
V^G\ar[r]^{f^G}&W^G
}
$$
commutes.
\item $A$ a $G$-algebra, $B:=A^G$. Then $R_A(ab)=bR_A(a)$ for all $a \in A$, $b
\in B$.
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item There is a unique decomposition $V=V^G \oplus V'$ where $V'$ is the sum of
nontrivial simple $G$-submodules.
\item Implied by the decomposition $V=V^G \oplus V'$.
\item 
$$
\xymatrix{
V\ar[d]_{R_A}\ar[r]^b&  W\ar[d]_{R_A}\\
V^G\ar[r]^{b}&W^G
}
$$
commutes.
\end{enumerate}
\end{proof}

\begin{theorem}[Hilbert,Nagata]
\label{theorem-linearly-reductive-action-
implies-invariant-sections-finitely-generated}
If $G$ is a linearly reductive group acting on an affine variety $X$, then
$\mathcal{O}(X)^G$ is finitely generated.
\end{theorem}

\begin{proof}
Done in class, uses $R_A$ and graded Nakayama lemma.
\end{proof}

\medskip\noindent	
$\mathcal{O}(X)^G \subset \mathcal{O}(X)$ yields $\pi:X\to Y$, a $G$-invariant
morphism of affine varieties, giving a good quotient.

\begin{proposition}
\label{proposition-projection}
\begin{enumerate}
\item $\pi$ is regular.
\item If  $Z \subset X$ is closed and $G$-stable, then $\pi|_{Z}$ if the good
quotient of $Z$.
\item If $Z,Z'\subset X$ are closed $G$-stable and disjoint, then $\pi(Z)$,
$\pi_i(Z')$ are disjoint.
\item Every fiber of $\pi$ contains a unique closed $\mathbb{G}$-orbit.
\end{enumerate}
But if $U\subset X$ is open affine $G$-stable, then $\pi|_{U}$ is not the good
quotient.
\end{proposition}

\begin{example}
\label{example-Hopf-surface?}
$G=\mathbb{G}_n$ acts on $\mathbb{A}^n$ by scalar, i.e. 
$g(x_1,\ldots,x_n)=(gx_1,\ldots,gx_n)$. Then $\mathcal{O}(\mathbb{A}^n)^G=k$,
$\pi:\mathbb{A}^n \to \bullet$,
but $f_nU=D(f)$, where $f$ is a nonzero linear form,
$$
\mathcal{O}(U)^{\mathbb{G}_m}=\bigcup_{d \geq 0}\frac{k[x_1,\ldots,x_n]}{f^d}
$$
\end{example}

{\bf Notation:} $Y=X//G$, the space of closed orbits.

\begin{definition}
\label{definition-stable-point}
A point $x \in X$ is called {\it stable} if its orbit $G\cdot x \subset X$ is
closed and the stabilizer  $G_x$ is finite.
\end{definition}

This definition is different from that in Mumford's book on GIT (our definition
there is called {\it properly} stable point.)

\begin{proposition}
\label{proposition-stable-points}
The set of stable points $X^s$ is open, $G$-stable and $\pi(X^s)=Y^s$ is open.
Moreover, $X^s=\pi^{-1}(Y^s)$ and $X^s \to Y^s$ is a geometric quotient.
\end{proposition}

Warning: there might not be any stable points at all! (But it looks like there
are some ways to get around this.)

\begin{proof}
The first trick very elementary; just playing with orbits. 
Let $x_0 \in X$ be stable. Then
$$
G\cdot x_0 \subset \pi^{-1}\pi(x_0)=\{ x \in X 
: \overline{G\cdot x}\supset G\cdot x\}=G\cdot x_0
$$
since $\dim (G\cdot x_0)=\dim G$.

Then, roughly, remove higher dimensional orbits, and since the remaining orbits
have all the same dimension, then they are all closed.

The final assertion $X^s \to Y^s$ is similar to what we did. No deep arguments.
\end{proof}

\begin{example}
\label{example-action-of-SL2-on-forms}
$G=\text{SL}_n$ acts on $X=k[x_1,\ldots,x_n]_d$ by linear change of variables.
Let's consider some values. If $d=1$, then the quotient is  $X//G=\text{pt}$.
For $d=2$, the quadractic forms, we have the discriminant $\Delta$ as an 
invariant, and in fact $\mathcal{O}(\Delta)=k[\Delta]$ {\bf (A nice exercise!)}. 
Actually it looks like $\pi=\Delta:X \to \mathbb{A}^1$, and the stabilizer of 
$f$ is $\text{SO}(f)$, no stable points.

For $d \geq 3$, and $n \geq 5$, then $\mathcal{O}(X)^G$ is not known! But we
also have the discriminant $\Delta \in \mathcal{O}(X)^G$ and in fact (Jordan) if
$\Delta(f) \neq 0$ then $f$ is stable. Let us prove this fact (we don't know how
did Jordan proved this): we show that $G_f$ is finit and stable, i.e.
$\text{Lie}(G_f)=0$. The Lie algebra of $\text{SL}_2$, the traceless matrices,
acts on $X$ by
$$
A\cdot f= \sum_{i=1}^n \ell_i \frac{\partial f}{\partial x_i}
$$
where $\ell_i = \sum_{j=1}^n a_{ij}x_j$. Then $A\cdot f=0$. Now 
$\Delta(f) \neq 0$ iff $\frac{\partial f}{\partial x_j}$ have no nontrivial
common zero, iff, $\frac{\partial f}{\partial x_j}$ form a regular sequence.
This says that the ring Cohen-Macaulay. Then
$$
\ell_i \frac{\partial f}{\partial x_i}
=\sum_{i \neq  j}\ell_j \frac{\partial f}{\partial x_j}
$$
which in turn implies that
$$
\ell_i \in \left(\frac{\partial f}{\partial x_j}, \; j \neq  i\right)
\iff \ell_i=0 \forall  i
$$
â€¦ which says {\it what?}
\end{example}

\medskip\noindent
Let $X$ be a projective $G$-variety, $G$ linearly reductive, $L \to X$ an ample
line bundle
$$
R(X,L)=\bigoplus_{n=0}^{\infty} \Gamma(X,L^{\otimes n})
$$
which is a graded, finitely generated algebra, then $X=\text{Proj}R(X,L)$. If
$G$ acts on $R(X,L)$ ``compatibly'', then $R(X,L)^G$ is finitely generated:
$$
\text{Proj}R(X,L)^G=X//G
$$
and we get a birational map
$$
\xymatrix{
X\ar[r]^{bir}& X//G\\
U\ar[u]_{hook}\ar[ur]^{\pi}
}
$$
where $U$ is the domain of definition.

If $G$ is finite, then  $X= \mathbb{P}(V)$, $V$ finite dimensional $G$-module. 
$L = \mathcal{O}_X(1)$: $G$ acts on $L$ and hence on $R(X,L)$ (``{\it I'll explain
details soon}'')

We have a finite ring extension $R(X,L)^G = R(X,L)$, and we get
$$
X=\text{Proj}R(X,L) \to \text{Proj}R(X,L)^G=Y
$$

\medskip\noindent
Now let $G$ be an algebraic group, $X$ a $G$-variety, $f:L \to X$ a line
bundle.

\begin{definition}
\label{definition-G-linearization}
A  {\it $G$-liearization} of $L$ is a $G$-action on $L$ such that $f$ is
equivariant and $g:L_x \to L_{g\cdot x}$ is linear for all $g \in G, x \in X$.
That is, the $G$-action on $L$ commutes with the $\mathbb{G}_m$-action by
multiplication on fibers.
\end{definition}

Then we get an action on the section ring: $G$ acts on 
$L^{\times}=L\setminus \{\text{zero section}\}$ and hence
$\mathcal{O}(L^{\times})$ is a $G$-module. As we said before,
 $\mathcal{O}(L^{\times})=\bigoplus_{n \in \mathbb{Z}}\Gamma(X,L^{\otimes n})$
is a graded module, and the grading corresponds to the $G$-action! That is, 
this is a $G$-module structure on $\Gamma(X,L^{\otimes n})$. And $R(X,L)$ is a
graded $G$-algebra.

\begin{definition}
\label{definition-semi-stable-line-bundle}
$X$ a $G$-variety, $L$ a $G$-linearized line bundle on $X$ and $x \in X$. We say
$x$ is {\it semi-stable} w.r.t. $L$ if there exists $n \geq 1$ and 
$\sigma \in \Gamma(X,L^{\otimes n})^G$ and that $x \in X_\sigma$ and 
$X_\sigma$ is affine.

$x$ is  {\it stable} if in addition $G\cdot x$ is closed in $X_\sigma$ 
and $G_x$ is finite.
\end{definition}

\begin{theorem}[Mumford]
\label{theorem-Mumford}
The set of semis-stable points $X^{ss}(L)\subset X$ is open, $G$-stable and has 
a good quotient $\pi:X^{ss}(L) \to Y(L)$. (Notice everything depends on the 
line bundle.) The set of stable poins $X^s(L)$ is open $G$-stable and equal to 
$\pi^{-1}\pi(X^s(L))$ and $\pi|_{X^s(L)}$ is a geometric quotient.
\end{theorem}

\begin{proposition}
\label{proposition-on-projectivization-of-V}
Let $x \in \mathbb{P}(V)$ and $x \in [v]$.
\begin{enumerate}
\item $x \in \mathbb{P}(V)^{ss}$ $\iff$ $0 \not \in \overline{G\cdot v}$.
\item $x\in \mathbb{P}(V)^s$ $\iff$ $v \in V^s$ i.e. $G\cdot v$ is closed in $V$
and $G_v$ is finite.
\end{enumerate}
\end{proposition}

\begin{proof}
Done in class.
\end{proof}

The following is our first example of moduli space.

\begin{example}[Smooth hypersurfaces of degree $d$ in $\mathbb{P}^n$]
\label{example-smooth-hypersurfaces}
The isomorphism classes of such surfaces are given by: take degree $d$
polynomials, projectivize, take away diagonal ( this gives an open set) and
finally quoetient by $\text{SL}_{n+1}$:
\begin{align*}
\{\text{isom. classes}\}&=\mathbb{P}(k[x_0,\ldots,x_n]_d)_{\Delta}
/\text{SL}_{n+1}\overset{\text{open}}{\hookrightarrow }\\
\mathbb{P}(\cdot)^1/\text{SL}_{n+1}& \hookrightarrow  
\mathbb{P}(\cdot)^n//\text{SL}_{n+1}
\end{align*}
a projective variety, normal, very singular.
\end{example}

\begin{remark}
\label{remark-categorial-quotient-yields-coarse-moduli-space}
$G \mathbb{y} X$ categorical quotient $\pi:X \to Y$, then $\pi$ yields a coarse
moduli space for
$$
\xymatrix{
X\ar[r]\ar[rd]& [X/G]\ar@{.>}[d]\\
&Y
}
$$
\end{remark}

\begin{proof}
$\text{Hom}(S,[X/G])$ is a category, not a set as usual. Its objects are
$$
\xymatrix{
P\ar[d]_{\substack{\text{principal} \\ \mathbb{G}\text{-bundle}}}
\ar[r]^{\substack{G\text{-equivariant} \\ \text{morphism }b}}&X\\
S
}
$$
and morphisms are
$$
\xymatrix{
&X\\
P\ar[ur]^{b'}\ar[rr]^\varphi \ar[dr]&  &  P\ar[ul]^b\ar[dl]\\
&S
}
$$
(continuesâ€¦)
\end{proof}

\subsection{Hilbert-Mumford criterion}
\label{subsection-Hilbert-Mumford-criterion}

\begin{definition}
\label{definition-one-parameter-subgroup}
A {\it one-parameter subgroup} of  $G$ is a homomorphism
$\lambda:\mathbb{G}_m \to G$. If $G \mathbb{y} X$ and $x \in X$, we say that
$$
\lim_{t \to 0}\lambda(t) 
$$
exists and equals $y \in X$ if $\mathbb{A}^1\setminus\{0\}=\mathbb{G}_m \to X$,
$t \mapsto \lambda(t)\cdot x$ extends to $\mathbb{A}^1 \to X$, $0 \mapsto y$.
\end{definition}

\begin{theorem}[Hilbert-Mumford criterion]
\label{theorem-Hilbert-Mumford-criterion}
$V$ finite-dimensional $G$-module, $G$ linearly reductive, $v \in V$,
$\overline{G\cdot v}\supset G\cdot v$ closed orbit. There exists a one-paremeter
subgroup $\lambda$ such that $\lim_{t \to 0} \lambda(t)\cdot v \in G\cdot w$.
\end{theorem}

We will not prove this theorem. Here are some corollaries.

\begin{lemma}
\label{lemma-unstable}
$v \not \in V^{ss} \iff \exists  \lambda$ such that 
$\lim_{t\to_0}\lambda(t)\cdot v =0$. Then $v$ is called {\it unstable} and 
$$
\{\text{unstable points}\}=\text{{\it nilcone}} \mathcal{N}(V)=V.
$$
\end{lemma}

\begin{lemma}
\label{lemma-orbit-is-closed-iff-limit-lies-in-orbit}
$G\cdot v$ is closed $\iff$ $\lim_{t \to 0} \lambda(t)\cdot v$ exists, then it
lies in $G\cdot v$.
\end{lemma}

\begin{proposition}
\label{proposition-orbit-is-affine-iff-stabilizer-is-linearly-reductive}
$G\cdot v$ is affine $\iff$ $G_v$ is linearly reductive.
\end{proposition}

\begin{proof}
($\implies$) $G_v = H \iff G\cdot v G/H=G//H$.

($\impliedby$) We show that the functor
\begin{align*}
(\text{left $H$-modules}) &\longrightarrow (\text{f.d. vector spces}) \\
V &\longmapsto V^H
\end{align*}
(continuesâ€¦)
\end{proof}

We can characterize stable points using this proposition.

\begin{lemma}
\label{lemma-stable-point-iff-orbit-is-closed-and-not-fixed-by-nontrivial-1PS}
$v \in V^s$ $\iff$ $G\cdot v$ is closed and $v$ is fixed by no nontrivial
one-parameter subgroup.
\end{lemma}

\begin{proof}
The reason is that if $G_v=H$ is linearly reductive then $H^0$ is generated by
images of a one-parameter subgroup.
\end{proof}

\begin{example}[Stable points for $SL_2$ acting on degree $d$ polynomials]
\label{example-stable-points-for-SL2-acting-on-degree-d-polynomials}
If $G=\text{SL}_2$ in characterstic zero, then
$$
\lambda(t)=\begin{pmatrix}
t&0\\ 
0&t^{-1}
\end{pmatrix}
$$
every nontrivial one-parameter subgroup of $G$ is conjugate to $\lambda(t)^n$
for a unique $n \geq 1$. $V=V_d=k[x,y]_d\ni x^e y^{d-e}$.
$$
\lambda(t) x^e y^{d-e}=t^{d-2e}x^ey^{d-e}
$$
$f \in V$ is unstable $\iff$ $\exists g \in G$ such that $gb \in \left<
x^{d/2-t}y^{d/2+1},\ldots, y^d\right>$ if dimension is even, and $
\left<x^{(d-1)/2}y^{(d+1)/2},\ldots, y^d\right>$ if dimension is odd, $\iff$
$f$ has no root of multiplicity $d/2$. $f \not \in V^s$ $\iff$ $f$ has no root
of multiplicity $\geq d/2$.

If $d$ is odd then $V^s=V^{ss}$. If $d$ is even then $x^{d/2}y^{d/2}$ has a
closed orbit and is fixed by $\\text{Im}(\lambda)$.
\end{example}

\subsection*{Hyperelliptic curves}
\label{subsection-hyperelliptic-curves}

Let $C \to \mathbb{P}^1$ be a smooth projective curve of degree $2$, genus $g$,
branched in $2g+2$ distinct points, uniquely determined by the branch divisor.
\begin{gather*}
\{\text{isomorphism classes of hyperellipetic curves of genus $g$}\}\\
=\mathbb{P}(V_{2g+2})_\Delta/\text{SL}_2 \hookrightarrow
\mathbb{P}(V_{2g+2})^{ss}//\text{SL}_2
\end{gather*}
projective normal of dimension $2g-3$.

\subsection*{Local structure of quotients}
\label{subsection-local-structure-of-quotients}
$X$ affine $G$-variety, $G$ reductive, $x\in X$ such that $G\cdot x$ is closed,
$H=G_x$ (reductive).

\begin{theorem}
\label{theorem-}
There exists an affine $H$-stable (locally ?) subvariety $S \subset X$ such that
the sequence
$$
\xymatrix{
(g,s)H\ar[r]^{\text{mapsto}}&g\cdot s\\
(G\times S)/H\ar[d]\ar[r]&  X\ar[d]\\
S//H\ar[r]&  X//G\\
x\ar[r]_{mapsto} &\overline{x}
}
$$
$h(g,s)=(gh^{-1},hs)$ is cartesian with Ã©tale horizontal arrows. If $x \in X$ is
smooth, then there is an $H$-equivariant morphism.
\begin{align*}
S &\longrightarrow T_x(X)/T_x(G\cdot x)=N_{G\cdot x/X,x} \\
x &\longmapsto 0
\end{align*}
\end{theorem}

This finishes the statement of the theorem. The last map may be interpreted as
the inverse of the exponential map from differential geometry.

A corollary:

\begin{lemma}
\label{lemma-}
If $G_x=e$ then $X \to X//G$ is a principal $G$-bundle in a $G$-stable
neighbourhood of $x$.
\end{lemma}

\begin{exercise}
\label{exercise-also-works-for-G-finite-and-S-open}
$G$ finite, works with $S\subset X$ open.
\end{exercise}

\begin{exercise}
\label{exercise-}
$G=\text{SL}_2$, $V=V_G$, $x^3y^3 \in V_G$, stabilizer
$=\mathbb{G}_m=\text{Im}(\lambda)$. Prove that $V_G//\text{SL}_2$ is singular at
the image of $x^3y^3$. ($S=\mathbb{G}_m$-module with weights $-6,-4,0,4,6$.)
{\bf Hint.} To
check for non-smoothness you can check that $\mathcal{O}(S)^{\mathbb{G}_m}$ is
not a polynomial ring; this is equivalent to non-smoothness for the quotient,
and it should be easy to find: you just find that there are too many generators.
\end{exercise}

\section{Quivers}
\label{section-quivers}

\begin{definition}
\label{definition-quiver}
A {\it quiver} is a set of vertices $Q_0$, a set of arrows $Q_1$ equipped with
the maps of source $s$ and target $t$ that to each arrow they assign the point
that is source or target of the arrow.
\end{definition}

\begin{definition}
\label{definition-representation-of-quiver}
A {\it representation} of a quiver is a set of finite dimensional vector spaces
equipped with maps between them realising a given quiver (incompleteâ€¦).
\end{definition}

There is a notion of projective representation, which I missed to write. But it
is analogous to the injective representation:

\begin{definition}
\label{definition-injective-representation-of-quivers}
Given a quiver $Q$, the {\it injective representation} of $Q_0$ is given by, for
$i \in Q_0$,
$$
I(i)_j=\begin{cases}
k\qquad &i=j \\
k^{d'}\qquad &j \neq i
\end{cases}
$$
where $d'$ is the number of paths from $j$ to $i$.
\end{definition}

\bibliography{my}
\bibliographystyle{amsalpha}




\end{document}
